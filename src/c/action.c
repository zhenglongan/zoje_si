//--------------------------------------------------------------------------------------
//        COPYRIGHT(C) 2006 Beijing xingdahao technology Co., Ltd.
//                     ALL RIGHTS RESERVED 
//  Project Number: sewing_machine_controller 
//  File Name : action.c
//  Description: jgj miscellaneous function
//  Version    Date     Author    Description
//  0.01     09/08/08   lm        created
//  ...
//--------------------------------------------------------------------------------------

//--------------------------------------------------------------------------------------
// 	Includes
//--------------------------------------------------------------------------------------
#include "..\..\include\sfr62p.h"         // M16C/62P special function register definitions
#include "..\..\include\typedef.h"        // Data type define
#include "..\..\include\common.h"         // Common constants definition
#include "..\..\include\variables.h"      // External variables declaration
#include "..\..\include\stepmotor.h"      // stepper motor function
#include "..\..\include\delay.h"          // delay time definition    
#include "..\..\include\motor.h"          // constants definition
#include "..\..\include\math.h"           // math library definition
#include "..\..\include\communication.h"  // Communication function
#include "..\..\include\solenoid.h"       // solenoid driver definition
#include "..\..\include\ctmotor.h"        // thread clamp motor function
#include "..\..\include\M_debug.h"        

//--------------------------------------------------------------------------------------
//  Internal function define
//--------------------------------------------------------------------------------------
void go_origin_yj(void);
void go_origin_zx(void);
void go_origin_x(void);
void go_origin_ct(void);
void go_origin_y(void);
void go_yj(INT16 step,INT16 time);
void foot_up(void);
void foot_half_up(void);
void foot_down(void);
void foot_half_down(void);
void inpress_up(void);
void inpress_down(INT16 low_position);
void inpress_to(INT16 a);
void inpress_to_forsingle(INT16 a);
void cut_thread(void);
void go_origin_allmotor(void);
void go_commandpoint(INT32 commandpointcoorx,INT32 commandpointcoory);
void go_origin_xy(void);
void xy_test(void);
void find_dead_center(void);
void find_up_position(void);
void find_dead_point(void);
void go_startpoint(void);
void check_data(UINT8 control_flag);
void calculate_angle(void);
void calculatexy_angle(void);
void process_data(void);
void process_edit_data(void);
void process_sewingtest_data(void);
void go_beginpoint(UINT8 FirstNopmoveFlag);
void conprocess_data(void);
void conprocess_edit_data(void);
void back_endpoint(void);
void back_edit_startpoint(void);
void single_next(void);
void single_inpresser_next(void);
void single_thread_next(void);
void single_edit_next(void);
void single_back(void);
void single_inpresser_back(void);
void single_thread_back(void);
void single_edit_back(void);
void back_startpoint(void);
void single_end(void);
void single_inpresser_end(void);
void single_thread_end(void);
void single_start(void);
void single_inpresser_start(void);
void single_thread_start(void);
void single_stop(void);
void move_next(void);
void move_back(void);
void move_startpoint(void);
void test_move_startpoint(void);
void move_edit_startpoint(void);
void conprocess_sewingtest_data(void);
void go_sewingtest_beginpoint(void);
void course_next(void);
void course_inpresser_next(void);
void course_thread_next(void);
void course_back(void);
void course_inpresser_back(void);
void course_thread_back(void);
void course_stop(void);
void shift_12(void);
void shift_01(void);
void shift_03(void);
void shift_04(void);
void shift_06(void);
void shift_07(void);
void shift_09(void);
void shift_10(void);
void remove_12(void);
void remove_01(void);
void remove_03(void);
void remove_04(void);
void remove_06(void);
void remove_07(void);
void remove_09(void);
void remove_10(void);
void remove_stop(void);
void go_setoutpoint(void);
void turnoff_led(void);
void turnoff_buz(void);
void turnoff_ledbuz(void);
void turnon_led(void);
void turnon_buz(void);
void flash_led(void);
void flash_buz(void);
void emergency(void);
void para_confirm(void);
void sewing_stop(void);
void pause_stop(void);
UINT8 detect_position(void);
void repeat_pattern(void);
void go_manualpoint(void);
void reset_panel(void);
void initial_mainmotor(void);
void move_xy(void);
void move_x_y(void);
void move_ct(void); 
void clamp_out(void);
void clamp_in(void);
void clamp_backstep1(void);
void clamp_backstep2(void);
void clamp_backstep3(void);
void zpl_process(void);
void course_edit_continue_next(void);
void course_edit_continue_back(void); 
void footer_procedure(void);
void footer_both_up(void);
void footer_both_down(void);
void stretch_foot_out(void);
void stretch_foot_in(void);
void stapoint_calc(void);
void do_pat_point_add_one(void);
void do_pat_point_sub_one(void);
void process_bottom_thread(void);
UINT8 check_sewing_range(void);
void go_origin_x1(void);  
void find_start_point(void);
void rotated_cutter_down_positon(void);

/**
  * @中压脚动作高度函数
  * @返回  
  * 分析数据：中压脚的最高位置，由安装的传感器位置指定；动作的具体行程，由软件设定实现。
  * 中压脚的位置基准是中压脚最低位置，最低位置是0；
  */ 

const UINT16 inpress_tab[73]=
{
// 0.0  0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9  
   296, 293, 290, 288, 285, 283, 281, 279, 277, 275, // 0.0-0.9      0-9
// 1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  
   268, 266, 265, 263, 262, 260, 258, 257, 255, 254, // 1.0-1.9      10-19
// 2.0  2.1  2.2  2.3  2.4  2.5  2.6  2.7  2.8  2.9  
   252, 251, 249, 248, 246, 245, 244, 242, 241, 239, // 2.0-2.9      20-29
// 3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
   238, 237, 236, 234, 233, 232, 231, 230, 228, 227, // 3.0-3.9      30-39	 
// 4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  
   226, 225, 223, 222, 221, 220, 218, 217, 216, 214, // 4.0-4.9      40-49
// 5.0  5.1  5.2  5.3  5.4  5.5  5.6  5.7  5.8  5.9  
   213, 212, 211, 210, 209, 208, 206, 205, 204, 203, // 5.0-5.9      50-59
// 6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9  
   202, 201, 200, 199, 198, 197, 196, 195, 194, 193, // 6.0-6.9      60-69	 	 	
// 7.0  origin  limit
   192, 0,      298                                  // 7.0          70,origin,limit 	 
};


#if ( FOLLOW_INPRESS_FUN_ENABLE  )

     #if NEW_STRUCTURE_800_INPRESS
	    const UINT16 inpress_tab2[ ]=
		{
		// 0.0  0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9
		    54,  54,  53,  53,  52,  52,  51,  51,  50,  50, // 0.0-0.9      0-9
		// 1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  
		    50,  50,  49,  49,  48,  48,  47,  47,  47,  46, // 1.0-1.9      10-19
		// 2.0  2.1  2.2  2.3  2.4  2.5  2.6  2.7  2.8  2.9  
		    46,  46,  46,  45,  45,  45,  44,  44,  43,  43, // 2.0-2.9      20-29
		// 3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
		    43,  43,  43,  42,  42,  42,  41,  41,  40,  40, // 3.0-3.9      30-39
		// 4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  
		    39,  39,  39,  38,  38,  38,  37,  37,  37,  36, // 4.0-4.9      40-49
		// 5.0  5.1  5.2  5.3  5.4  5.5  5.6  5.7  5.8  5.9  
		    36,  36,  36,  35,  35,  35,  35,  34,  34,  34, // 5.0-5.9      50-59
		// 6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9  
		    33,  33,  33,  32,  32,  31,  31,  31,  31,  31, // 6.0-6.9      60-69
		// 7.0  origin  limit
		    30,  0,      54                                   // 7.0          70,origin,limit
		};
	 #elif CURRENT_MACHINE == MACHINE_800_NORMAL//小孙随动12步61
		const UINT16 inpress_tab2[ ]=
		{
		// 0.0  0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9
		    61,  61,  61,  61,  61,  61,  61,  61,  60,  60, // 0.0-0.9      0-9
		// 1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  
		    60,  60,  59,  59,  59,  59,  58,  58,  58,  58, // 1.0-1.9      10-19
		// 2.0  2.1  2.2  2.3  2.4  2.5  2.6  2.7  2.8  2.9  
		    57,  57,  57,  57,  56,  56,  56,  56,  55,  55, // 2.0-2.9      20-29
		// 3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
		    55,  55,  54,  54,  54,  54,  53,  53,  53,  53, // 3.0-3.9      30-39
		// 4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  
		    52,  52,  52,  52,  51,  51,  51,  51,  50,  50, // 4.0-4.9      40-49
		// 5.0  5.1  5.2  5.3  5.4  5.5  5.6  5.7  5.8  5.9  
		    50,  50,  49,  49,  49,  49,  48,  48,  48,  48, // 5.0-5.9      50-59
		// 6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9  
		    47,  47,  47,  47,  46,  46,  46,  45,  44,  44, // 6.0-6.9      60-69
		// 7.0  origin  limit
		   44,  0,      61                                   // 7.0          70,origin,limit
		};
	#else
		const UINT16 inpress_tab2[ ]=//900 14步 70
		{
		// 0.0  0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9
		    70,  70,  70,  69,  69,  69,  68,  68,  68,  67, // 0.0-0.9      0-9
		// 1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  
		    67,  67,  67,  66,  66,  66,  65,  65,  65,  64, // 1.0-1.9      10-19
		// 2.0  2.1  2.2  2.3  2.4  2.5  2.6  2.7  2.8  2.9  
		    64,  64,  64,  63,  63,  63,  62,  62,  62,  61, // 2.0-2.9      20-29
		// 3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
		    61,  60,  60,  59,  59,  58,  57,  56,  56,  55, // 3.0-3.9      30-39
		// 4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  
		    54,  54,  54,  54,  53,  53,  53,  52,  52,  51, // 4.0-4.9      40-49
		// 5.0  5.1  5.2  5.3  5.4  5.5  5.6  5.7  5.8  5.9  
		    51,  51,  51,  50,  50,  50,  49,  49,  48,  48, // 5.0-5.9      50-59
		// 6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9  
		    47,  47,  47,  46,  46,  45,  45,  45,  44,  44, // 6.0-6.9      60-69
		// 7.0  origin  limit
		   43,  0,      70                                   // 7.0          70,origin,limit
		};
	#endif
	
	#if NEW_STRUCTURE_900_INPRESS
		//0.9
		const UINT16 inpress_tab3[73]=  //900 23步 88
		{
			// 0.0  0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9
			   88,  87,  87,  86,  85,  85,  84,  84,  83,  82, // 0.0-0.9      0-9
			// 1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  
			   81,  81,  81,  80,  80,  79,  79,  78,  78,  77, // 1.0-1.9      10-19
			// 2.0  2.1  2.2  2.3  2.4  2.5  2.6  2.7  2.8  2.9  
			   76,  76,  75,  75,  75,  74,  74,  73,  73,  72, // 2.0-2.9      20-29
			// 3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
			   71,  71,  71,  70,  70,  69,  69,  69,  68,  68, // 3.0-3.9      30-39
			// 4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  
			   67,  67,  66,  66,  66,  65,  65,  64,  64,  63, // 4.0-4.9      40-49
			// 5.0  5.1  5.2  5.3  5.4  5.5  5.6  5.7  5.8  5.9  
			   63,  62,  62,  62,  61,  61,  60,  60,  60,  59, // 5.0-5.9      50-59
			// 6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9  
			   58,  58,  58,  57,  57,  57,  56,  56,  58,  55, // 6.0-6.9      60-69
			// 7.0  origin  limit5
			   54,  0,      88                                  // 7.0          70,origin,limit
		 };	
	#endif
	
	const UINT16 inpress_follow_down_angle_tab[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   60, 60, 60, 55, 40, 35, 35, 35, 35, 35, 35, 35, 30, 25, 20, 20, 20, 20, 20, 20, 20, 20, 20, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10
	};
	const UINT8 inpress_follow_down_speed_tab[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 63, 50, 50, 41, 34, 29, 26, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 12, 12, 11, 11, 11, 10, 10, 9,  9,  9,  9,
	};

	const UINT16 inpress_follow_up_angle_tab[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  250,250,250,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,220,210,210,200,200,200,200,200,200
	};
	const UINT8 inpress_follow_up_speed_tab[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 63, 50, 50, 41, 34, 29, 26, 23, 22, 21, 20, 18, 17, 16, 15, 14, 13, 12, 11, 11, 11, 10, 10, 10, 10, 10, 9,  8,  8,  8,  8
	};
//===========================================================================	

	const UINT16 inpress_follow_down_angle_tab2[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340,330
	};
	const UINT8 inpress_follow_down_speed_tab2[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 60, 60, 60, 48, 40, 35, 30, 26, 23, 21, 19, 18, 18, 18, 17, 16, 15, 14, 14, 14, 13, 10, 10, 10, 10, 10, 9, 9,  9,  9,  9,
	};

	const UINT16 inpress_follow_up_angle_tab2[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,180,180,180,180,180,160,160,160,160,160
	};
	const UINT8 inpress_follow_up_speed_tab2[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 60, 60, 45, 36, 30, 25, 22, 20, 20, 18, 16, 15, 14, 13, 12, 11, 11, 10, 10, 9,  9,  9,  9,  9,  9,  9,  9,  8,  8,  8,  8
	};
//===========================================================================	
	const UINT16 inpress_follow_down_angle_tab3[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340,340,340,340,340,340,340,340,340,340, 40, 40, 40, 30, 30, 20, 20, 20, 20, 20, 30, 30, 40, 35, 30, 25, 20, 30, 30, 30, 30, 20
	};
	const UINT8 inpress_follow_down_speed_tab3[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 60, 60, 60, 48, 40, 35, 30, 26, 23, 20, 18, 17, 17, 17, 17, 16, 15, 14, 12, 11, 11, 10, 10, 10, 10, 10, 9, 9,  9,  9,  9,
	};

	const UINT16 inpress_follow_up_angle_tab3[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,200,200,200,200,200,200,200,200,200,260,260,250,240,240,250,250,250,250,245,250,250,260,240,240,240,240,240,230,200,180,160
	};
	const UINT8 inpress_follow_up_speed_tab3[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 60, 60, 45, 36, 30, 25, 22, 20, 20, 16, 16, 15, 15, 14, 13, 12, 11, 11, 11, 10, 10, 10, 10,  9,  9,  8,  8,  8,  8,  8,  8
	};

//===========================================================================	
	const UINT16 inpress_follow_down_angle_tab4[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340, 80, 80, 70, 70, 60, 60, 50, 50, 30, 30, 30, 30, 30, 30, 20, 20, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10
	};
	const UINT8 inpress_follow_down_speed_tab4[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 60, 60, 56, 43, 36, 31, 28, 25, 23, 21, 19, 17, 16, 15, 15, 14, 13, 13, 12, 11, 11, 10, 10, 10,  9,  9, 8,  8,  8,  8,  8,
	};

	const UINT16 inpress_follow_up_angle_tab4[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,220,220,215,210,200,200,195,195,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175
	};
	const UINT8 inpress_follow_up_speed_tab4[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 60, 60, 58, 46, 38, 32, 27, 24, 22, 20, 18, 16, 15, 15, 14, 13, 12, 11, 11, 10, 10,  9,  9,  9,  9,  8,  8,  8,  8,  8,  8
	};
	
	//===========================================================================	
	const UINT16 inpress_follow_down_angle_tab5[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340, 40, 40, 40, 40, 40, 40, 40, 340,340,340,340,340,320,320,340,320,340,340,340,340,340,340,340,340,340,340,340,340,340,340,340
	};
	const UINT8 inpress_follow_down_speed_tab5[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 30, 30, 30, 30, 30, 28, 24, 28, 28, 25, 24, 23, 23, 21, 18, 20, 16, 15, 14, 13, 12, 12, 12, 10, 10, 10, 10, 9,  8,  8,  8,
	};

	const UINT16 inpress_follow_up_angle_tab5[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,250,230,230,230,230,230,230,230,220,180,200,190,190,190,180,190,180,185,185,190,200,180,200,200,180,175,175,175,175,175,175
	};
	const UINT8 inpress_follow_up_speed_tab5[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 50, 50, 50, 30, 30, 25, 25, 19, 19, 23, 19, 18, 15, 14, 14, 12, 11, 11, 10, 10, 9,  9,  8,  8,  8,  8,  7,  7,  7,  7,  7
	};
	
	//===========================================================================	
	const UINT16 inpress_follow_down_angle_tab6[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340, 70, 70, 70, 60, 45, 41, 10, 10, 10, 340,340,340,340,340,340,340,340,340,340,340,330,330,330,330,310,310,310,310,310,310,310
	};
	const UINT8 inpress_follow_down_speed_tab6[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 40, 40, 40, 36, 34, 32, 30, 28, 26, 26, 24, 22, 21, 19, 18, 17, 16, 15, 14, 13, 12, 11, 11, 11, 11, 11, 11, 10, 9,  8,  8,
	};

	const UINT16 inpress_follow_up_angle_tab6[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,240,240,245,255,250,240,240,240, 240,190,190,190,190,190,185,185,185,185,185,185,185,175,175,175,155,155,155,155,155,155,155
	};
	const UINT8 inpress_follow_up_speed_tab6[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 50, 50, 40, 30, 26, 20, 19, 18, 16, 18, 17, 15, 14, 14, 13, 12, 11, 11, 10, 9,  9,  9,  9,  9,  9,  9,  9,  8,  7,  7,  7
	};
	//===========================================================================	
	const UINT16 inpress_follow_down_angle_tab7[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340, 70, 70, 70, 60, 45, 41, 10, 10, 10, 340,340,340,340,340,10, 10, 10, 10, 10, 10, 10,330,330,330,310,310,310,310,310,310,310
	};
	const UINT8 inpress_follow_down_speed_tab7[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 40, 40, 40, 36, 34, 32, 30, 28, 26, 26, 25, 22, 21, 21, 16, 15, 14, 13, 11, 13, 12, 11, 11, 11, 11, 11, 11, 10, 9,  8,  8,
	};

	const UINT16 inpress_follow_up_angle_tab7[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,240,240,245,255,250,240,240,240, 240,230,230,210,220,220,220,220,220,220,220,220,220,175,175,175,155,155,155,155,155,155,155
	};
	const UINT8 inpress_follow_up_speed_tab7[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 50, 50, 40, 30, 26, 20, 19, 18, 16, 16, 15, 16, 14, 13, 14, 13, 13, 12, 12, 11, 11,  9,  9,  9,  9,  9,  9,  8,  7,  7,  7
	};
	
	//===========================================================================	
	const UINT16 inpress_follow_down_angle_tab8[]={//k174
	    // 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  340,340, 45, 45, 49, 48, 45, 46, 46, 46, 42, 43, 49, 48, 55, 51, 47, 52, 46, 51, 54, 47, 50, 53, 56, 45, 48, 51, 55, 60, 60, 64, 70
	};
	const UINT8 inpress_follow_down_speed_tab8[]={//k175
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 63, 50, 50, 41, 34, 29, 26, 23, 22, 21, 20, 18, 16, 16, 15, 14, 13, 12, 12, 11, 11, 10, 9,  9,  8,  8,  8,  7,  7,  7,  6,
	};

	const UINT16 inpress_follow_up_angle_tab8[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		  200,200,330,330,330,330,330,330,330,330, 330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330,330
	};
	const UINT8 inpress_follow_up_speed_tab8[]={
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32
		   63, 63, 63, 42, 33, 26, 21, 18, 16, 14, 12, 11, 11, 10, 10, 9,  8,  8,  7,  7,  7,  6,  6,  6,  6,  5,  5,  5,  5,  5,  5,  5,  5
	};
#else

	const UINT16 inpress_tab2[73]=
	{
	// 0.0  0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9
	   195, 192, 190, 188, 186, 184, 181, 179, 177, 174, // 0.0-0.9      0-9
	// 1.0  1.1  1.2  1.3  1.4  1.5  1.6  1.7  1.8  1.9  
	   172, 171, 169, 168, 167, 166, 164, 163, 162, 160, // 1.0-1.9      10-19
	// 2.0  2.1  2.2  2.3  2.4  2.5  2.6  2.7  2.8  2.9  
	   159, 158, 157, 156, 155, 154, 153, 152, 151, 150, // 2.0-2.9      20-29
	// 3.0  3.1  3.2  3.3  3.4  3.5  3.6  3.7  3.8  3.9
	   150, 149, 148, 147, 146, 145, 144, 143, 142, 141, // 3.0-3.9      30-39
	// 4.0  4.1  4.2  4.3  4.4  4.5  4.6  4.7  4.8  4.9  
	   140, 139, 138, 137, 136, 135, 134, 133, 132, 131, // 4.0-4.9      40-49
	// 5.0  5.1  5.2  5.3  5.4  5.5  5.6  5.7  5.8  5.9  
	   130, 129, 128, 127, 126, 125, 124, 123, 122, 122, // 5.0-5.9      50-59
	// 6.0  6.1  6.2  6.3  6.4  6.5  6.6  6.7  6.8  6.9  
	   122, 121, 120, 119, 118, 117, 116, 115, 114, 113, // 6.0-6.9      60-69
	// 7.0  origin  limit
	   112, 0,      195                                  // 7.0          70,origin,limit
	};

#endif


//角度与码盘线数转换表
const INT16 angle_tab[400]=
{
//   0    1    2    3    4    5    6    7    8    9  
	   0,   3,   6,   9,  11,  14,  17,  20,  23,  26, // 0-9   
//  10   11   12   13   14   15   16   17   18   19  
	  28,  31,  34,  37,  40,  43,  46,  48,  51,  54, // 10-19  	      	
//  20   21   22   23   24   25   26   27   28   29  
	  57,  60,  63,  65,  68,  71,  74,  77,  80,  82, // 20-29 	  
//  30   31   32   33   34   35   36   37   38   39  
	  85,  88,  91,  94,  97, 100, 102, 105, 108, 111, // 30-39 	  
//  40   41   42   43   44   45   46   47   48   49  
	 114, 117, 119, 122, 125, 128, 131, 134, 137, 139, // 40-49 	  	
//  50   51   52   53   54   55   56   57   58   59  
	 142, 145, 148, 151, 154, 156, 159, 162, 165, 168, // 50-59 	  		
//  60   61   62   63   64   65   66   67   68   69  
	 171, 174, 176, 179, 182, 185, 188, 191, 193, 196, // 60-69 
//  70   71   72   73   74   75   76   77   78   79  
	 199, 202, 205, 208, 210, 213, 216, 219, 222, 225, // 70-79 	 
//  80   81   82   83   84   85   86   87   88   89  
	 228, 230, 233, 236, 239, 242, 245, 247, 250, 253, // 80-89 	 
//  90   91   92   93   94   95   96   97   98   99  
	 256, 259, 262, 265, 267, 270, 273, 276, 279, 282, // 90-99 	 
// 100  101  102  103  104  105  106  107  108  109  
	 284, 287, 290, 293, 296, 299, 302, 304, 307, 310, // 100-109 	 
// 110  111  112  113  114  115  116  117  118  119  
	 313, 316, 319, 321, 324, 327, 330, 333, 336, 338, // 110-119
// 120  121  122  123  124  125  126  127  128  129  
	 341, 344, 347, 350, 353, 356, 358, 361, 364, 367, // 120-129
// 130  131  132  133  134  135  136  137  138  139  
	 370, 373, 375, 378, 381, 384, 387, 390, 393, 395, // 130-139
// 140  141  142  143  144  145  146  147  148  149  
	 398, 401, 404, 407, 410, 412, 415, 418, 421, 424, // 140-149
// 150  151  152  153  154  155  156  157  158  159  
	 427, 430, 432, 435, 438, 441, 444, 447, 449, 452, // 150-159
// 160  161  162  163  164  165  166  167  168  169  
	 455, 458, 461, 464, 466, 469, 472, 475, 478, 481, // 160-169
// 170  171  172  173  174  175  176  177  178  179  
	 484, 486, 489, 492, 495, 498, 501, 503, 506, 509, // 170-179
// 180  181  182  183  184  185  186  187  188  189  
	 512, 515, 518, 521, 523, 526, 529, 532, 535, 538, // 180-189
// 190  191  192  193  194  195  196  197  198  199  
	 540, 543, 546, 549, 552, 555, 558, 560, 563, 566, // 190-199	 	 	 	 	 	 	  	  	 	 
// 200  201  202  203  204  205  206  207  208  209  
	 569, 572, 575, 577, 580, 583, 586, 589, 592, 594, // 200-209	 	 	 	 	 	 	  	  	 	 	 
// 210  211  212  213  214  215  216  217  218  219  
	 597, 600, 603, 606, 609, 612, 614, 617, 620, 623, // 210-219	 	 	 	 	 	 	  	  	 	 	 	 
// 220  221  222  223  224  225  226  227  228  229  
	 626, 629, 631, 634, 637, 640, 643, 646, 649, 651, // 220-229	 	 	 	 	 	 	  	  	 	 	 	 
// 230  231  232  233  234  235  236  237  238  239  
	 654, 657, 660, 663, 666, 668, 671, 674, 677, 680, // 230-239	 	 	 	 	 	 	  	  	 	 	 	 
// 240  241  242  243  244  245  246  247  248  249  
	 683, 686, 688, 691, 694, 697, 700, 703, 705, 708, // 240-249	 	 	 	 	 	 	  	  	 	 	 	 
// 250  251  252  253  254  255  256  257  258  259  
	 711, 714, 717, 720, 722, 725, 728, 731, 734, 737, // 250-259	 	 	 	 	 	 	  	  	 	 	 	 
// 260  261  262  263  264  265  266  267  268  269  
	 740, 742, 745, 748, 751, 754, 757, 759, 762, 765, // 260-269	 	 	 	 	 	 	  	  	 	 	 	 
// 270  271  272  273  274  275  276  277  278  279  
	 768, 771, 774, 777, 779, 782, 785, 788, 791, 794, // 270-279	 	 	 	 	 	 	  	  	 	 	 	 
// 280  281  282  283  284  285  286  287  288  289  
	 796, 799, 802, 805, 808, 811, 814, 816, 819, 822, // 280-289
// 290  291  292  293  294  295  296  297  298  299  
	 825, 828, 831, 833, 836, 839, 842, 845, 848, 850, // 290-299	 	 	 	 	 	 	  	  	 	 	 	 
// 300  301  302  303  304  305  306  307  308  309  
	 853, 856, 859, 862, 865, 868, 870, 873, 876, 879, // 300-309	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 
// 310  311  312  313  314  315  316  317  318  319  
	 882, 885, 887, 890, 893, 896, 899, 902, 905, 907, // 310-319	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 
// 320  321  322  323  324  325  326  327  328  329  
	 910, 913, 916, 919, 922, 924, 927, 930, 933, 936, // 320-329	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 
// 330  331  332  333  334  335  336  337  338  339  
	 939, 942, 944, 947, 950, 953, 956, 959, 961, 964, // 330-339	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 
// 340  341  342  343  344  345  346  347  348  349  
	 967, 970, 973, 976, 978, 981, 984, 987, 990, 993, // 340-349	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 
// 350  351  352  353  354  355  356  357  358  359  
	 996, 998,1001,1004,1007,1010,1013,1015,1018,1021, // 350-359	
// 360   361  362  363   364  365  366  367  368  369
	1024,1027,1030,1033, 1035,1038,1041,1044,1047,1050, // 360-369	 
// 370   371  372  373   374  375  376  377  378  379
	1052,1055,1058,1061, 1064,1067,1070,1072,1075,1078, // 370-379	
// 380   381  382  383   384  385  386  387  388  389
	1081,1084,1087,1089, 1092,1095,1098,1101,1104,1106, // 380-389 	 
// 390   391  392  393   394  395  396  397  398  399
	1109,1112,1115,1118, 1121,1124,1126,1129,1132,1135  // 390-399	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	  	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	  	  	 	 	 	 	 	 	 	 	 	 	 	 	 	 	 	 
};


//---------------------------------------------------------------------------------------------------------
const UINT16 spdlimit1_tab[]=                         // speed limit table
{                                                     
	// 	0.05 0.10 0.15 0.20 0.25 0.30 0.35 0.40 0.45 0.50 0.55 0.60 0.65 0.70 0.75 0.80 0.85 0.90 0.95 1.00
		2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,	
	// 	1.05 1.10 1.15 1.20 1.25 1.30 1.35 1.40	1.45 1.50 1.55 1.60 1.65 1.70 1.75 1.80 1.85 1.90 1.95 2.00 	
	    2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,	
	// 	2.05 2.10 2.15 2.20	2.25 2.30 2.35 2.40	2.45 2.50 2.55 2.60 2.65 2.70 2.75 2.80 2.85 2.90 2.95 3.00	
		2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,	
	// 	3.05 3.10 3.15 3.20	3.25 3.30 3.35 3.40	3.45 3.50 3.55 3.60 3.65 3.70 3.75 3.80 3.85 3.90 3.95 4.00
		2700,2700,2700,2700,2700,2700,2700,2700,2700,2700,2500,2500,2500,2500,2300,2300,2300,2300,2300,2300,
	// 	4.05 4.10 4.15 4.20	4.25 4.30 4.35 4.40	4.45 4.50 4.55 4.60 4.65 4.70 4.75 4.80 4.85 4.90 4.95 5.00	
		2200,2200,2200,2100,2100,2100,2000,2000,2000,2000,1800,1800,1800,1800,1700,1700,1700,1700,1700,1700,
	// 	5.05 5.10 5.15 5.20	5.25 5.30 5.35 5.40	5.45 5.50 5.55 5.60 5.65 5.70 5.75 5.80 5.85 5.90 5.95 6.00 
		1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600,
	// 	6.05 6.10 6.15 6.20 6.25 6.30 6.35 6.40	6.45 6.50 6.55 6.60	6.65 6.70 6.75 6.80	6.85 6.90 6.95 7.00
		1600,1600,1500,1500,1500,1500,1400,1400,1400,1400,1300,1300,1300,1300,1200,1200,1200,1200,1200,1200,	
	// 	7.05 7.10 7.15 7.20	7.25 7.30 7.35 7.40	7.45 7.50 7.55 7.60	7.65 7.70 7.75 7.80	7.85 7.90 7.95 8.00
		1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,	
	// 	8.05 8.10 8.15 8.20 8.25 8.30 8.35 8.40 8.45 8.50 8.55 8.60 8.65 8.70 8.75 8.80 8.85 8.90 8.95 9.00
		1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1100,1100,1100,1100,1100,1100,1100,1100,
	// 	9.05 9.10 9.15 9.20 9.25 9.30 9.35 9.40 9.45 9.50 9.55 9.60 9.65 9.70 9.75 9.80 9.85 9.90 9.95 10.00	
	    1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1000,1000,1000,1000,
	// 	10.05 10.1 10.15 10.2 10.25	10.3 10.35 10.4 10.45 10.5 10.55 10.6 10.65 10.7 10.75 10.8 10.85 10.9 10.95 11.0
		1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,
	// 	11.05 11.1 11.15 11.2 11.25	11.3 11.35 11.4	11.45 11.5 11.55 11.6 11.65 11.7 11.75 11.8 11.85 11.9 11.95 12.0
		 900,  900, 900, 900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900,
	// 	12.05 12.1	12.15 12.2 12.25 12.3 12.35 12.4 12.45 12.5 12.55 12.6 12.65 12.7 12.75 12.8
		 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900
};

const UINT8 MoveTime1_Speed[] = 
{
//	0	1	2	3	4   5	6	7	8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27 28
	52, 52, 52, 52, 52,	52,	52,	52,	52,	52,	47,	43,	40,	37,	35,	33,	31,	29,	28,	27,	26,	25,	24,	24, 23, 22, 21, 20,20
};

const UINT16 MoveStartAngle1[] = 
{
//	0	1	2	3	4   5	6	7	8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28
   300,300,290,280,270,270,260,230,201,170,169,167,163,162,157,154,153,155,148,143,151,148,145,142,132,132,132,135,130
};
//---------------------------------------------------------------------------------------------------------
const UINT16 spdlimit2_tab_8060[]=                     
{                                                     
	// 	0.05 0.10 0.15 0.20 0.25 0.30 0.35 0.40 0.45 0.50 0.55 0.60 0.65 0.70 0.75 0.80 0.85 0.90 0.95 1.00
		2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,	
	// 	1.05 1.10 1.15 1.20 1.25 1.30 1.35 1.40	1.45 1.50 1.55 1.60 1.65 1.70 1.75 1.80 1.85 1.90 1.95 2.00 	
		2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,	
	// 	2.05 2.10 2.15 2.20	2.25 2.30 2.35 2.40	2.45 2.50 2.55 2.60 2.65 2.70 2.75 2.80 2.85 2.90 2.95 3.00	
		2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,2300,	
	// 	3.05 3.10 3.15 3.20	3.25 3.30 3.35 3.40	3.45 3.50 3.55 3.60 3.65 3.70 3.75 3.80 3.85 3.90 3.95 4.00
		2200,2200,2200,2200,2200,2200,2200,2200,2200,2200,2200,2100,2000,2000,1900,1900,1900,1800,1800,1800,		
	// 	4.05 4.10 4.15 4.20	4.25 4.30 4.35 4.40	4.45 4.50 4.55 4.60 4.65 4.70 4.75 4.80 4.85 4.90 4.95 5.00	
		1800,1800,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1700,1600,1600,
	// 	5.05 5.10 5.15 5.20	5.25 5.30 5.35 5.40	5.45 5.50 5.55 5.60 5.65 5.70 5.75 5.80 5.85 5.90 5.95 6.00 
		1600,1600,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1400,1400,
	// 	6.05 6.10 6.15 6.20 6.25 6.30 6.35 6.40	6.45 6.50 6.55 6.60	6.65 6.70 6.75 6.80	6.85 6.90 6.95 7.00
		1400,1400,1400,1400,1400,1400,1400,1300,1300,1300,1300,1300,1300,1300,1200,1200,1200,1200,1200,1200,	
	// 	7.05 7.10 7.15 7.20	7.25 7.30 7.35 7.40	7.45 7.50 7.55 7.60	7.65 7.70 7.75 7.80	7.85 7.90 7.95 8.00
		1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,	
	// 	8.05 8.10 8.15 8.20 8.25 8.30 8.35 8.40 8.45 8.50 8.55 8.60 8.65 8.70 8.75 8.80 8.85 8.90 8.95 9.00
		1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1100,1100,1100,1100,1100,1100,1100,1100,
	// 	9.05 9.10 9.15 9.20 9.25 9.30 9.35 9.40 9.45 9.50 9.55 9.60 9.65 9.70 9.75 9.80 9.85 9.90 9.95 10.00	
	    1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1000,1000,1000,1000,
	// 	10.05 10.1 10.15 10.2 10.25	10.3 10.35 10.4 10.45 10.5 10.55 10.6 10.65 10.7 10.75 10.8 10.85 10.9 10.95 11.0
		1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,
	// 	11.05 11.1 11.15 11.2 11.25	11.3 11.35 11.4	11.45 11.5 11.55 11.6 11.65 11.7 11.75 11.8 11.85 11.9 11.95 12.0
		 900,  900, 900, 900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900,
	// 	12.05 12.1	12.15 12.2 12.25 12.3 12.35 12.4 12.45 12.5 12.55 12.6 12.65 12.7 12.75 12.8
		 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900
};
const UINT16 spdlimit2_tab_N8060[]=                         // speed limit table
{                                                     
	#if MAX_SPEED_3200

	// 	0.05 0.10 0.15 0.20 0.25 0.30 0.35 0.40 0.45 0.50 0.55 0.60 0.65 0.70 0.75 0.80 0.85 0.90 0.95 1.00
		3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,	
	// 	1.05 1.10 1.15 1.20 1.25 1.30 1.35 1.40	1.45 1.50 1.55 1.60 1.65 1.70 1.75 1.80 1.85 1.90 1.95 2.00 	
		3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,
	// 	2.05 2.10 2.15 2.20	2.25 2.30 2.35 2.40	2.45 2.50 2.55 2.60 2.65 2.70 2.75 2.80 2.85 2.90 2.95 3.00	
		3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,3200,	
		#if ENABLE_3_5MM_HIGH_SPEED
	// 	3.05 3.10 3.15 3.20	3.25 3.30 3.35 3.40	3.45 3.50 3.55 3.60 3.65 3.70 3.75 3.80 3.85 3.90 3.95 4.00
		3200,3100,3000,3000,3000,3000,3000,3000,3000,3000,3000,2900,2800,2700,2600,2500,2400,2300,2200,2200,
		#else
	// 	3.05 3.10 3.15 3.20	3.25 3.30 3.35 3.40	3.45 3.50 3.55 3.60 3.65 3.70 3.75 3.80 3.85 3.90 3.95 4.00
		3200,3100,2900,2800,2700,2600,2500,2400,2300,2300,2300,2200,2200,2200,2200,2200,2200,2200,2200,2200,
		#endif
	#else
	// 	0.05 0.10 0.15 0.20 0.25 0.30 0.35 0.40 0.45 0.50 0.55 0.60 0.65 0.70 0.75 0.80 0.85 0.90 0.95 1.00
		2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,	
	// 	1.05 1.10 1.15 1.20 1.25 1.30 1.35 1.40	1.45 1.50 1.55 1.60 1.65 1.70 1.75 1.80 1.85 1.90 1.95 2.00 	
		2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,	
	// 	2.05 2.10 2.15 2.20	2.25 2.30 2.35 2.40	2.45 2.50 2.55 2.60 2.65 2.70 2.75 2.80 2.85 2.90 2.95 3.00	
		2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,2800,	
	// 	3.05 3.10 3.15 3.20	3.25 3.30 3.35 3.40	3.45 3.50 3.55 3.60 3.65 3.70 3.75 3.80 3.85 3.90 3.95 4.00
		2800,2700,2600,2500,2400,2300,2300,2300,2300,2300,2300,2200,2200,2200,2200,2200,2200,2200,2200,2200,
	#endif	
	// 	4.05 4.10 4.15 4.20	4.25 4.30 4.35 4.40	4.45 4.50 4.55 4.60 4.65 4.70 4.75 4.80 4.85 4.90 4.95 5.00	
		2200,2200,2100,2100,2100,2100,2100,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,
	// 	5.05 5.10 5.15 5.20	5.25 5.30 5.35 5.40	5.45 5.50 5.55 5.60 5.65 5.70 5.75 5.80 5.85 5.90 5.95 6.00 
		2000,2000,2000,1900,1800,1700,1600,1600,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1400,1400,
	// 	6.05 6.10 6.15 6.20 6.25 6.30 6.35 6.40	6.45 6.50 6.55 6.60	6.65 6.70 6.75 6.80	6.85 6.90 6.95 7.00
		1400,1400,1400,1400,1400,1400,1400,1300,1300,1300,1300,1300,1300,1300,1200,1200,1200,1200,1200,1200,	
	// 	7.05 7.10 7.15 7.20	7.25 7.30 7.35 7.40	7.45 7.50 7.55 7.60	7.65 7.70 7.75 7.80	7.85 7.90 7.95 8.00
		1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,	
	// 	8.05 8.10 8.15 8.20 8.25 8.30 8.35 8.40 8.45 8.50 8.55 8.60 8.65 8.70 8.75 8.80 8.85 8.90 8.95 9.00
		1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1100,1100,1100,1100,1100,1100,1100,1100,
	// 	9.05 9.10 9.15 9.20 9.25 9.30 9.35 9.40 9.45 9.50 9.55 9.60 9.65 9.70 9.75 9.80 9.85 9.90 9.95 10.00	
	    1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1000,1000,1000,1000,
	// 	10.05 10.1 10.15 10.2 10.25	10.3 10.35 10.4 10.45 10.5 10.55 10.6 10.65 10.7 10.75 10.8 10.85 10.9 10.95 11.0
		1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,1000, 1000,
	// 	11.05 11.1 11.15 11.2 11.25	11.3 11.35 11.4	11.45 11.5 11.55 11.6 11.65 11.7 11.75 11.8 11.85 11.9 11.95 12.0
		 900,  900, 900, 900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900,
	// 	12.05 12.1	12.15 12.2 12.25 12.3 12.35 12.4 12.45 12.5 12.55 12.6 12.65 12.7 12.75 12.8
		 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900, 900,  900
};
const UINT8 MoveTime_Limtit[] = 
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27 28 29 30 31 32 
	63, 63, 63, 63, 63, 63,	63, 63,	63, 63,	60, 54,	50, 46,	42, 40,	37, 35,	33, 31,	30, 28,	27, 26, 25, 24, 23, 22,21,21,20,19,18
};
//--------------------------------------------------------------------------------------------------------------------
const UINT8 MoveTime2_Speed[] = 
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27 28 29 30 31 32
	52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18,18,17,16,15,14
};
const UINT16 MoveStartAngle2[] = 
{
//	0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28 29 30 31 32
// 300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 67, 67, 67, 67, 67, 67,67,57
   300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 67, 67, 67, 67, 67, 67,67,57,47,47
 };
//

//=================================================================================================
const UINT8 MoveTime_k04_3[] =
{
// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21	22	23	24	25  26  27  28  29  30  31  32
   52, 52, 60, 58, 56, 54, 52, 50, 47, 47, 42, 40, 38, 34, 34, 34, 34, 32, 32, 31, 27, 25,	23, 22, 21, 20, 20, 20, 20, 19, 18 ,17, 16
};
const UINT16 MoveStartAngle_k04_3[] =
{
//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
   300,300,250,230,220,220,220,220,190,190,190,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,167,157,157,157
};


#if SECOND_GENERATION_PLATFORM

const UINT8 MoveTime_Speed_750_x[] =
{
// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21	22	23	24	25  26  27  28  29  30  31  32
// 52, 52, 50, 48, 46, 44, 21, 20, 18, 18, 15, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14,	13, 12, 11, 10, 10, 10, 10, 10, 10 ,10, 10
// 52, 52, 51, 49, 47, 45, 22, 21, 19, 18, 15, 12, 12, 12, 13, 13, 13, 12, 12, 12, 12, 13,	13, 12, 11, 10, 10, 10,  7,  7,  6 , 6,  6
   60, 60, 58, 56, 54, 52, 29, 28, 26, 26, 23, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,  21, 20, 19, 18, 16, 16, 14, 12, 10, 10, 10 
};
const UINT16 MoveStartAngle_750_x[] =
{
//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
// 300,300,260,240,230,230,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,215,210,187,177,177,177,177,177,167,157,157,157
// 300,300,270,250,240,240,230,230,230,220,220,200,200,200,190,164,164,156,156,156,156,145,130, 97, 87, 77, 47, 27, 20, 20, 20, 20, 20
   300,300,280,260,250,250,260,240,240,240,240,200,200,200,200,180,180,160,140,130,130,125,120, 97, 87, 67, 67, 67, 77, 67, 87, 60, 60

};
const UINT8 MoveTime_Speed_750_y[] =
{
//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
//  60, 58, 56, 50, 42, 38,	36, 34,	32, 30,	28, 28,	26, 24,	22, 20,	20, 20,	20, 20,	20, 20,	20, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14 
//  73, 71, 69, 63, 52, 48,	44, 39,	37, 35,	33, 33,	31, 29,	27, 25,	29, 25,	25, 25,	24, 21,	21, 19, 17, 12, 12, 12, 12, 11, 10,  9,  8 
//  80, 80, 80, 74, 66, 62,	60, 58,	52, 50,	42, 38,	34, 32,	30, 22,	22, 22,	20, 17,	17, 17,	17, 17, 16, 15, 15, 15, 15, 14, 13, 12, 11 
	80, 80, 63, 63, 63, 63,	63, 63,	63, 63,	56, 48,	42, 40,	38, 24,	24, 24,	20, 14,	14, 14,	14, 14, 13, 12, 12, 12, 12, 11, 10,  9,  8 
};
const UINT16 MoveStartAngle_750_y[] =
{
//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
// 300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 87, 117,70, 20, 20, 20, 67, 57, 57, 57
// 300,300,290,270,250,210,200,200,170,150,150,130,130,105, 70, 70, 70, 70, 60, 40, 20, 20, 20, 20,  20,20, 20, 20, 20, 20, 20, 20, 20
// 300,300,260,240,220,220,220,200,180,200,199,180,180,199,200,190,190,210,210,220,220,215,210,177, 217,190,140,120,120,167,157,157,157
   300,300,270,250,230,230,230,190,190,230,229,210,210,249,270,250,250,290,290,310,310,305,300,267, 317,310,260,220,220,267,257,257,257
};

#else

	#if SUPPORT_UNIFY_DRIVER

	#if  COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER35	
		const UINT8 MoveTime_Speed_750_x[] =
		{
		// 0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		// 52,  52, 50, 48, 46, 44, 42, 40, 37, 28, 25, 23, 22, 21, 21, 21, 21, 19, 19, 18, 17, 15, 13, 12, 11, 10, 10, 10, 10, 10, 10 ,10, 10
		// 63,  63, 63, 63, 63, 63, 63, 63, 62, 53, 50, 46, 39, 36, 33, 31, 31, 29, 29, 27, 26, 24,	21, 20, 19, 18, 18, 18, 14, 14, 12 ,12, 12
		   63,  63, 53, 53, 53, 53, 53, 53, 52, 43, 40, 36, 29, 26, 23, 21, 26, 24, 24, 22, 21, 19,	16, 15, 14, 13, 13, 13, 14, 14, 12 ,12, 12
		};
		const UINT16 MoveStartAngle_750_x[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		// 300,300,250,230,220,220,220,220,220,220,220,220,220,220,220,220,170,170,170,170,190,185,180,137,127,127,127,127,127,117,107,107,107
		// 300,300,260,240,230,200,200,180,160,160,140,140,140,150,150,150,130,120,100,100, 90, 85,110, 87, 77, 77, 67, 57, 57, 37, 37, 37, 37
		   280,280,240,220,210,180,180,160,140,140,120,120,120,130,130,130,120,110, 90, 90, 80, 75,100, 77, 67, 67, 57, 57, 57, 37, 37, 37, 37
		};
		const UINT8 MoveTime_Speed_750_y[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		//  52, 52, 52, 52, 52, 52,	52, 52,	47, 37,	32, 28,	25, 21,	20, 20,	18, 15,	15, 14,	18, 17,	16, 15, 19, 18, 18, 18, 18, 17, 16, 15, 14 
		//  63, 63, 63, 63, 63, 63,	63, 63,	63, 58,	51, 45,	42, 36,	31, 28,	24, 19,	16, 15,	19, 16,	13, 12, 14, 13, 13, 13, 13, 12, 11, 15, 14 
		    63, 63, 63, 63, 63, 63,	63, 63,	63, 58,	51, 45,	42, 36,	31, 36,	24, 24,	21, 20,	24, 21,	18, 17, 19, 23, 13, 13, 13, 12, 11, 11, 11 
		};
		const UINT16 MoveStartAngle_750_y[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		// 300,300,250,230,210,210,210,210,190,180,179,160,160,155,140,140,130,130,130,130,100, 95, 90, 57, 57, 50, 20, 20, 20, 67, 57, 57, 57
		// 300,300,280,260,240,190,170,170,150,140,139,130,130,125,110,110,100,100,170,170,140,135,130, 97, 77, 70, 80, 120,120,167,157,157,157
		   300,300,280,260,240,190,170,170,150,140,139,130,130,125,110,100,100,110,180,180,140,135,130, 97, 77, 60, 90, 90,120,167,157,157,147
		};
		
	#else

		const UINT8 MoveTime_Speed_750_x[] =
		{
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21	22	23	24	25  26  27  28  29  30  31  32
		// 52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13
		// 52, 52, 50, 48, 46, 44, 42, 40, 37, 37, 32, 30, 28, 24, 24, 24, 24, 22, 22, 21, 17, 15,	13, 12, 11, 10, 10, 10, 10, 10, 10 ,10, 10
		   52, 52, 50, 48, 46, 44, 42, 40, 37, 28, 25, 23, 22, 21, 21, 21, 21, 19, 19, 18, 17, 15,	13, 12, 11, 10, 10, 10, 10, 10, 10 ,10, 10
		};
		const UINT16 MoveStartAngle_750_x[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		 //300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 67, 67, 67, 67, 67, 67, 67, 57, 57, 57
		 //300,300,250,230,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,215,210,187,177,177,177,177,177,167,157,157,157
		   300,300,250,260,220,220,220,220,220,220,220,220,220,220,220,220,170,170,170,170,190,185,180,137,127,127,127,127,127,117,107,107,107
		};
		#if	CURRENT_STEPPER_CONFIG_TYPE ==  CONFIG_MACHINE_TYPE_12080_BELT
			const UINT8 MoveTime_Speed_750_y[] =
			{
			//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
			//  52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14 
			  //63, 63, 63, 63, 63, 63,	63, 63,	63, 63,	60, 54,	50, 46,	42, 40,	37, 35,	33, 31,	30, 28,	27, 26, 25, 24, 23, 22, 21, 21, 20, 19, 18
			    52, 52, 52, 52, 52, 48,	42, 36,	32, 32,	31, 30,	29, 28,	27, 26,	25, 25,	24, 24,	24, 24,	24, 24, 24, 23, 22, 21, 20, 19, 19, 18, 17 
			
			};
		#else
			const UINT8 MoveTime_Speed_750_y[] =
			{
			//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
			//  52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14 
			    52, 52, 52, 52, 52, 52,	52, 52,	47, 37,	32, 28,	25, 21,	20, 20,	18, 15,	15, 14,	18, 17,	16, 15, 19, 18, 18, 18, 18, 17, 16, 15, 14 
			};
		#endif
		const UINT16 MoveStartAngle_750_y[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		// 300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 87, 117,70, 20, 20, 20, 67, 57, 57, 57
		   300,300,250,230,210,210,210,210,190,180,179,160,160,155,140,140,130,130,130,130,100, 95, 90, 57, 57, 50, 20, 20, 20, 67, 57, 57, 57
		};
	#endif	
		
#else //非一体化驱动

		const UINT8 MoveTime_Speed_750_x[] =
		{
		// 0   1   2   3   4   5   6   7   8   9   10  11  12  13  14  15  16  17  18  19  20  21	22	23	24	25  26  27  28  29  30  31  32
		// 52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13
		   52, 52, 50, 48, 46, 44, 42, 40, 37, 37, 32, 30, 28, 24, 24, 24, 24, 22, 22, 21, 17, 15,	13, 12, 11, 10, 10, 10, 10, 10, 10 ,10, 10
		};
		const UINT16 MoveStartAngle_750_x[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		 //300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 67, 67, 67, 67, 67, 67, 67, 57, 57, 57
		   300,300,250,230,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,215,210,187,177,177,177,177,177,167,157,157,157
		};
		const UINT8 MoveTime_Speed_750_y[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		    52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14 
		};
		const UINT16 MoveStartAngle_750_y[] =
		{
		//	0	1	2	3	4	5	6	7	8	9	10	11	12	13	14	15	16	17	18	19	20	21	22	23	24	25  26  27  28  29  30  31  32
		   300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120, 87, 117,70, 20, 20, 20, 67, 57, 57, 57
		};
	#endif
#endif

const UINT16 MoveStartAngleTab_750X_N[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28   
   {350,350,330,310,300,290,280,270,250,235,220,200,190,180,170,165,160,152,152,152,152,140,140,140,136,125,125,125,125},//0.0~0.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28   
   {350,350,330,310,300,290,280,270,250,235,220,200,190,180,170,165,160,152,152,152,152,140,140,140,136,125,125,125,125},//0.5~0.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,330,310,300,290,280,270,250,235,220,200,190,180,170,165,160,152,152,152,152,140,140,140,136,125,125,125,125},//1.0~1.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,200,199,180,180,175,160,160,160,160,160,160,160,155,150,140,140,125,125,125,125},//1.5~1.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,200,199,180,180,175,160,160,160,160,160,160,160,145,140,140,130,125,115,125,125},//2.0~2.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,190,179,160,160,155,140,140,140,140,120,120,120,125,135,135,130,125,125,125,125},//2.5~2.9
//  0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,200,199,180,170,155,140,130,130,130,130,130,125,125,125,125,125,125,125,125,125},//3.0~3.4  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {300,300,250,230,210,210,210,210,190,180,179,160,160,155,140,130,130,130,130,130,130,125,120,120,120,115,115,115,115},//3.5~3.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21  22  23  24  25   26  27  28
   {350,350,350,350,340,320,300,285,265,255,245,230,225,225,215,205,195,190,180,165,150,130,108,108,108,108,108,108,108},//4.0~4.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,315,295,285,270,265,250,250,250,240,225,215,200,185,130,130,130,130,130,130,130,130,130},//4.5~4.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20 21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,315,305,300,280,265,250,250,250,240,225,215,200,115,170,155,140,125,125,125,125,125,125},//5.0~5.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,320,305,300,280,265,250,225,200,180,150,130,170,145,140,140,140,140,140,140,125,125,125},//5.5~5.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21  22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,320,305,300,280,265,250,225,200,180,165,195,170,145,140,140,140,140,140,140,125,125,125},//6.0~6.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15@	16  17	18  19	20* 21	22  23  24  25  26  27  28
   {350,350,350,340,340,320,320,305,300,280,265,250,225,200,180,165,170,150,150,150,150,150,150,150,150,150,150,150,150},//6.5~6.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12*  13	14  15@	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,330,305,300,290,270,250,225,200,180,165,170,150,150,150,150,150,150,150,150,150,150,150,150},//7.0~7.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12*  13	14@  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,300,280,280,250,240,210,195,175,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//7.5~7.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12*  13  14@  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,320,300,300,290,280,270,260,255,250,230,210,195,175,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//8.0~8.4
//	0   1	2   3	4	5	6	7	8	9   10  11*	12* 13@	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,340,320,300,290,270,260,250,220,200,180,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//8.5~8.9
//	0   1	2   3	4	5	6	7	8	9   10  11*	12  13@	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,340,340,340,320,300,280,260,250,220,200,190,180,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//9.0~9.4
//	0   1	2   3	4	5	6	7	8	9   10* 11*@ 12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,340,340,320,300,280,260,250,230,205,185,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//9.5~9.9
//	0   1	2   3	4	5	6	7	8	9   10* 11@	12  13	14 15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,340,290,280,250,250,250,240,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//10.0~10.4
//	0   1	2   3	4	5	6	7	8	9   10* 11@	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,290,270,250,220,200,200,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//10.5~10.9
//	0   1	2   3	4	5	6	7	8@	9   10* 11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//11.0~11.4
//	0   1	2   3	4	5	6	7	8@	9*  10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//11.5~11.9
//	0   1	2   3	4	5	6	7	8@	9*   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//12.0~12.4
//	0   1	2   3	4	5	6	7	8	9*   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160}//12.5~12.7
};

const UINT16 MoveStartAngleTab_750Y_N[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28   
   {350,350,330,310,300,290,280,270,250,235,220,200,190,180,170,165,160,152,152,152,152,140,140,140,136,125,125,125,125},//0.0~0.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28   
   {350,350,330,310,300,290,280,270,250,235,220,200,190,180,170,165,160,152,152,152,152,140,140,140,136,125,125,125,125},//0.5~0.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,330,310,300,290,280,270,250,235,220,200,190,180,170,165,160,152,152,152,152,140,140,140,136,125,125,125,125},//1.0~1.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,200,199,180,180,175,160,160,160,160,160,160,160,155,150,140,140,125,125,125,125},//1.5~1.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,200,199,180,180,175,160,160,160,160,160,160,160,145,140,140,130,125,115,115,115},//2.0~2.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,190,179,160,160,155,140,140,140,140,120,120,120,125,135,135,130,125,125,125,125},//2.5~2.9
//  0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,310,280,260,250,240,240,210,200,199,180,170,155,140,130,130,130,130,130,125,125,125,125,125,125,125,125,125},//3.0~3.4  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {300,300,250,230,210,210,210,210,190,180,179,160,160,155,140,130,130,130,130,130,130,125,120,120,120,115,115,115,115},//3.5~3.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21  22  23  24  25   26  27  28
   {350,350,350,350,340,320,300,285,265,255,245,230,225,225,215,205,195,190,180,165,150,130,108,108,108,108,108,108,108},//4.0~4.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,315,295,285,270,265,250,250,250,240,225,215,200,185,130,130,130,130,130,130,130,130,130},//4.5~4.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20 21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,315,305,300,280,265,250,250,250,240,225,215,200,115,170,155,140,125,125,125,125,125,125},//5.0~5.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,320,305,300,280,265,250,225,200,180,150,130,170,145,140,140,140,140,140,140,125,125,125},//5.5~5.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21  22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,320,305,300,280,265,250,225,200,180,165,195,170,145,140,140,140,140,140,140,125,125,125},//6.0~6.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15@	16  17	18  19	20* 21	22  23  24  25  26  27  28
   {350,350,350,340,340,320,320,305,300,280,265,250,225,200,180,165,170,150,150,150,150,150,150,150,150,150,150,150,150},//6.5~6.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12*  13	14  15@	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,330,305,300,290,270,250,225,200,180,165,170,150,150,150,150,150,150,150,150,150,150,150,150},//7.0~7.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12*  13	14@  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,350,340,340,320,300,280,280,250,240,210,195,175,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//7.5~7.9
//	0   1	2   3	4	5	6	7	8	9   10  11	12*  13  14@  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,320,300,300,290,280,270,260,255,250,230,210,195,175,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//8.0~8.4
//	0   1	2   3	4	5	6	7	8	9   10  11*	12* 13@	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,340,320,300,290,270,260,250,220,200,180,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//8.5~8.9
//	0   1	2   3	4	5	6	7	8	9   10  11*	12  13@	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,340,340,340,320,300,280,260,250,220,200,190,180,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//9.0~9.4
//	0   1	2   3	4	5	6	7	8	9   10* 11*@ 12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,340,340,320,300,280,260,250,230,205,185,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//9.5~9.9
//	0   1	2   3	4	5	6	7	8	9   10* 11@	12  13	14 15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,340,290,280,250,250,250,240,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//10.0~10.4
//	0   1	2   3	4	5	6	7	8	9   10* 11@	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,290,270,250,220,200,200,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//10.5~10.9
//	0   1	2   3	4	5	6	7	8@	9   10* 11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//11.0~11.4
//	0   1	2   3	4	5	6	7	8@	9*  10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//11.5~11.9
//	0   1	2   3	4	5	6	7	8@	9*   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160},//12.0~12.4
//	0   1	2   3	4	5	6	7	8	9*   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28
   {350,350,350,340,330,310,270,230,200,220,200,180,165,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160}//12.5~12.7
};
#if CURRENT_MACHINE == MACHINE_800_NORMAL
const UINT16 MoveStartAngleTab_750X2_MBJ[26][]=
{
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//0.0~0.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//0.5~0.9
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//1.0~1.4   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//1.5~1.9
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 127,127,127,127,117,117,117},//2.0~2.4   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,179,160,160,165,160,160,160,160,160,160,160,155,150,117,117,117,117,117,117,117,107,107,107},//2.5~2.9   
  //0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,179,160,160,155,160,160,160,160,160,160,160,155,150,137,137,137,137,137,137,137,127,127,127},//3.0~3.4     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,165,165,160,150,150,160,160,170,170,170,165,160,122,122,122,122,122,122,122,112,112,112},//3.5~3.9    
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,185,185,184,180,180,175,170,170,170,170,170,170,170,165,160,107,107,107,107,107,107,107,97, 97, 97},//4.0~4.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,185,185,184,180,180,175,170,170,170,170,170,170,170,165,160,107,107,107,107,107,107,107,97, 97, 97},//4.5~4.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,195,195,194,190,190,195,190,190,190,190,190,190,210,205,200,147,147,147,147,147,147,147,137,137,137},//5.0~5.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,195,195,194,190,190,195,190,190,190,190,190,190,210,205,200,147,147,147,147,147,147,147,137,137,137,},//5.5~5.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,200,200,199,190,190,185,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//6.0~6.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,200,200,199,190,190,185,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//6.5~6.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,260,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//7.0~7.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,260,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//7.5~7.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//8.0~8.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//8.5~8.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,205,205,200,185,185,185,185,185,185,185,180,175,122,122,122,122,122,122,127,117,117,117},//9.0~9.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,205,205,200,185,185,185,185,185,185,185,180,175,122,122,122,122,122,122,127,117,117,117},//9.5~9.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,190,190,185,170,170,170,170,170,170,170,165,160,107,107,107,107,107,107,107,97, 97, 97},//10.0~10.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,190,190,185,170,170,170,170,170,170,170,165,160,107,107,107,107,107,107,107,97, 97, 97},//10.5~10.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97},//11.0~11.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97},//11.5~11.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97},//12.0~12.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97}//12.5~12.7
};

const UINT8 MoveTimeSpeedTab_750X2_MBJ[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//0.0~0.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//0.5
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//1.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//1.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18, 16, 15, 14, 13, 11, 11, 11, 11, 11, 11, 11},//2.0         
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//2.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//3.0   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 25, 23, 20, 20, 16, 12, 10, 8,  15, 14, 13, 13, 13, 13, 13, 13, 13, 13},//3.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 16, 12, 10, 8,  7,  6,  5,  5,  5,  5,  5,  5,  5,  5},//4.0   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 16, 12, 10, 8,  7,  6,  5,  5,  5,  5,  5,  5,  5,  5},//4.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//5.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//5.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//6.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//6.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//7.0                           
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//7.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//8.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//8.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//9.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//9.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//10.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//10.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//11.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//11.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 32, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//12.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 32, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//12.5                         
};

const UINT16 MoveStartAngleTab_750Y2_MBJ[26][]=
{
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//0	
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//0.5
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//1.0
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//1.5      
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 50, 60, 60, 67, 57, 57, 57},//2.0	
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 50, 50, 50, 67, 57, 57, 57},//2.5
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 50, 50, 50, 67, 57, 57, 57},//3.0   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 30, 38, 38, 67, 57, 57, 57},//3.5  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 10, 10, 10, 67, 57, 57, 57},//4.0   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 10, 10, 10, 67, 57, 57, 57},//4.5   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,145,145,145,145,145,145,140,135,102,132,85, 35, 35 ,35, 35, 35, 35, 35},//5.0  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,145,145,145,145,145,145,140,135,102,132,85, 35, 35 ,35, 35, 35, 35, 35},//5.5  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//6.0 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//6.5
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//7.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//7.5   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,220,220,220,230,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//8.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,220,220,220,230,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//8.5    
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,190,190,189,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//9.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,190,190,189,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//9.5     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//10.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//10.5     
  //0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//11.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//11.5  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,230,230,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//12.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,230,230,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//12.5                 
};

const UINT8 MoveTimeSpeedTab_750Y2_MBJ[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//0.0~0.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//0.5
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//1.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//1.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18, 16, 15, 14, 13, 6,  6,  6,  6,  6,  6,  6},//2.0           
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 23, 22, 21, 20, 19, 20, 16, 15, 13, 13, 13, 13, 12, 12, 11},//2.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 23, 22, 21, 19, 18, 17, 16, 15, 13, 13, 13,  8,  8,  8,  8},//3.0      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 14, 14, 13, 13, 13, 13, 13, 13},//3.5    
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  5,  5,  5,  5},//4.0     
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  5,  5,  5,  5},//4.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 28, 26, 22, 22, 21, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//5.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 28, 26, 22, 22, 21, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//5.5     
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//6.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//6.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//7.0                           
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//7.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 45, 40, 36, 33, 29, 28, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//8.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 45, 40, 36, 33, 29, 28, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//8.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//9.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//9.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 43, 38, 34, 31, 27, 26, 26, 24, 21, 21, 20, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//10.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 43, 38, 34, 31, 27, 26, 26, 24, 21, 21, 20, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//10.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//11.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//11.5    
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//12.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//12.5
   
};
#else

const UINT16 MoveStartAngleTab_750X2_MBJ[26][]=
{
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//0.0~0.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//0.5~0.9
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//1.0~1.4   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,97, 97, 97, 97, 97, 97, 97, 87, 87, 87},//1.5~1.9
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,100,100,100,100,100,100,100,100,100,100},//2.0~2.4   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,179,160,160,165,160,160,160,160,160,160,160,155,150,117,117,117,117,117,100,100,100,100,100},//2.5~2.9   
  //0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,179,160,160,155,160,160,160,160,160,160,160,155,150,137,137,110,100,90, 90, 90, 90, 90, 90},//3.0~3.4     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,165,165,160,150,150,160,160,170,170,170,165,160,152,142,142,142,142,142,132,112,112,112},//3.5~3.9    
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,107,107,107,107,107,107,107,97, 97, 97},//4.0~4.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,107,107,107,107,107,107,107,97, 97, 97},//4.5~4.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,195,195,194,190,190,195,190,190,190,190,190,190,210,205,200,147,147,147,147,147,147,147,137,137,137},//5.0~5.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,195,195,194,190,190,195,190,190,190,190,190,190,210,205,200,147,147,147,147,147,147,147,137,137,137,},//5.5~5.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,200,200,199,190,190,185,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//6.0~6.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,225,200,200,199,190,190,185,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//6.5~6.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,260,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//7.0~7.4
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,260,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//7.5~7.9   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//8.0~8.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,200,200,195,180,180,180,180,180,180,190,185,180,127,127,127,127,127,127,127,117,117,117},//8.5~8.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,205,205,200,185,185,185,185,185,185,185,180,175,122,122,122,122,122,122,127,117,117,117},//9.0~9.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,205,205,200,185,185,185,185,185,185,185,180,175,122,122,122,122,122,122,127,117,117,117},//9.5~9.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,190,190,185,170,170,170,170,170,170,170,165,160,107,107,107,107,107,107,107,97, 97, 97},//10.0~10.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,240,230,230,230,230,210,210,209,190,190,185,170,170,170,170,170,170,170,165,160,107,107,107,107,107,107,107,97, 97, 97},//10.5~10.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97},//11.0~11.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97},//11.5~11.9   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97},//12.0~12.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,250,230,230,230,230,220,220,219,200,200,195,180,180,180,180,180,180,180,175,170,117,117,117,117,117,117,107,97, 97, 97}//12.5~12.7
};

const UINT8 MoveTimeSpeedTab_750X2_MBJ[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//0.0~0.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//0.5
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//1.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18,	16, 15, 14, 13, 13, 13, 13, 13, 13 ,13, 13},//1.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18, 16, 15, 14, 13, 11, 11, 11, 11, 11, 11, 11},//2.0         
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//2.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//3.0   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 25, 23, 20, 20, 16, 12, 10, 8,  15, 14, 13, 13, 13, 13, 13, 13, 13, 13},//3.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 16, 12, 10, 8,  7,  6,  5,  5,  5,  5,  5,  5,  5,  5},//4.0   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 16, 12, 10, 8,  7,  6,  5,  5,  5,  5,  5,  5,  5,  5},//4.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//5.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 42, 37, 33, 30, 26, 25, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//5.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//6.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//6.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//7.0                           
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//7.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//8.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//8.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//9.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 30, 27, 23, 22, 22, 20, 17, 17, 16, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//9.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//10.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 42, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//10.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//11.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 34, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//11.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 32, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//12.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 47, 39, 39, 32, 28, 25, 21, 20, 20, 18, 15, 15, 14, 15, 13, 11, 10, 9,  8,  8,  8,  8,  8,  8,  8,  8},//12.5                         
};

const UINT16 MoveStartAngleTab_750Y2_MBJ[26][]=
{
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//0	
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//0.5
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//1.0
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 20, 20, 20, 67, 57, 57, 57},//1.5      
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 50, 60, 60, 67, 57, 57, 57},//2.0	
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 50, 50, 50, 67, 57, 57, 57},//2.5
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 50, 50, 50, 67, 57, 57, 57},//3.0   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 30, 38, 38, 67, 57, 57, 57},//3.5  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 10, 10, 10, 67, 57, 57, 57},//4.0   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,170,170,169,150,150,145,130,130,130,130,130,130,130,125,120,87, 117,70, 10, 10, 10, 67, 57, 57, 57},//4.5   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,145,145,145,145,145,145,140,135,102,132,85, 35, 35 ,35, 35, 35, 35, 35},//5.0  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,145,145,145,145,145,145,140,135,102,132,85, 35, 35 ,35, 35, 35, 35, 35},//5.5  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//6.0 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,180,180,179,160,160,155,140,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//6.5
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//7.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,210,210,210,210,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//7.5   
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,220,220,220,230,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//8.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,220,220,220,230,190,190,189,170,170,165,150,150,150,150,150,150,150,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//8.5    
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,190,190,189,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//9.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,190,190,189,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//9.5     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//10.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//10.5     
  //0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//11.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,225,225,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//11.5  
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,230,230,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//12.0     
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {300,300,250,230,230,230,225,230,200,200,199,180,180,175,160,160,160,160,160,160,160,145,140,107,137,90, 40, 40, 40, 35, 35, 35, 35},//12.5                 
};

const UINT8 MoveTimeSpeedTab_750Y2_MBJ[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//0.0~0.4
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//0.5
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//1.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52,	52, 52,	47, 47,	42, 38,	35, 31,	30, 30,	28, 25,	25, 24,	23, 22,	21, 20, 19, 18, 18, 18, 18, 17, 16, 15, 14},//1.5   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 25, 24, 20, 18, 16, 15, 14, 13, 6,  6,  6,  6,  6,  6,  6},//2.0           
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 23, 22, 21, 20, 19, 20, 16, 15, 13, 13, 13, 13, 12, 12, 11},//2.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 30, 28, 25, 23, 22, 21, 19, 18, 17, 16, 15, 13, 13, 13,  8,  8,  8,  8},//3.0      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 14, 14, 13, 13, 13, 13, 13, 13},//3.5    
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  5,  5,  5,  5},//4.0     
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  5,  5,  5,  5},//4.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 28, 26, 22, 22, 21, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//5.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 40, 36, 33, 29, 28, 28, 26, 22, 22, 21, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//5.5     
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//6.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 47, 42, 38, 35, 31, 30, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//6.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//7.0                           
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 52, 47, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//7.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 45, 40, 36, 33, 29, 28, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//8.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 45, 40, 36, 33, 29, 28, 28, 26, 23, 23, 22, 21, 20, 19, 18, 17, 16, 16, 16, 16,  8,  8,  8,  8},//8.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//9.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 50, 45, 44, 39, 35, 32, 28, 27, 27, 25, 22, 22, 21, 20, 19, 18, 17, 16, 15, 15, 15, 15,  8,  8,  8,  8},//9.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 43, 38, 34, 31, 27, 26, 26, 24, 21, 21, 20, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//10.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 43, 38, 34, 31, 27, 26, 26, 24, 21, 21, 20, 19, 18, 17, 16, 15, 14, 14, 14, 14,  8,  8,  8,  8},//10.5      
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//11.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//11.5    
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//12.0
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25  26  27  28  29  30  31  32 
   {52, 52, 52, 52, 52, 52, 52, 49, 44, 42, 37, 33, 30, 26, 25, 25, 23, 20, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13,  8,  8,  8,  8},//12.5
   
};
#endif
const UINT16 MoveStartAngleTab_750X2_8060[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,181,176,173,160,160,130,130,120,103,103,103,100,100},//0.10~0.50
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,181,176,173,160,160,130,130,120,103,103,103,100,100},//0.55~1.00
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,181,176,173,160,160,130,130,120,103,103,103,100,100},//1.05~1.50	
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {233,233,306,270,234,228,223,219,210,207,207,206,204,181,176,173,160,160,130,130,120,103,103,103,100,100},//1.55~2.00
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {233,233,306,270,234,228,223,219,210,207,207,206,204,181,176,173,160,160,130,130,120,103,103,103,100,100},//2.05~2.50   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,181,176,173,160,160,130,130,126,123,123,123,100,100},//2.55~3.00
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  
   {233,233,306,270,234,228,213,209,200,197,197,186,194,171,166,133,130,120,103,103,103,103,103,103,100,100},//3.05~3.50    
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18   
   {233,233,306,270,234,218,213,209,200,197,197,176,194,171,160,155,155,155,155,120,120,120,120,103,100,100},//3.55~4.00  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17		 
   {233,233,346,310,274,258,253,249,240,237,222,216,194,181,150,150,150,150,100,100,100,100,100,100,100,100},//4.05~4.50  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  
   {233,233,306,270,234,218,213,209,200,197,182,186,174,162,162,162,162,136,136,136,132,150,136,133,119,120},//4.55~5.00   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  
   {233,233,306,270,234,218,213,209,200,197,182,186,184,160,155,155,155,150,150,150,150,150,136,133,119,120},//5.05 ~5.50 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  
   {233,233,306,270,234,218,213,209,200,197,182,196,184,176,176,155,155,155,155,155,152,150,136,133,119,120},//5.55  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	
   {233,233,306,270,234,228,223,219,210,207,200,200,170,161,116,133,112,115,159,155,152,150,136,133,119,120},//6.05    
//	0   1	2   3	4	5	6	7	8	9   10  11	12
   {233,233,306,270,234,228,223,219,210,207,204,204,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//6.55 
   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  
   {233,233,306,270,234,228,223,219,210,207,192,186,169,151,156,163,162,165,159,155,152,150,136,133,119,120},//7.05  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13  
   {233,233,306,270,234,228,223,219,210,207,192,186,184,171,166,163,162,165,159,155,152,150,136,133,119,120},//7.55  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	
   {233,233,306,270,234,228,223,219,210,207,192,186,184,141,166,163,162,165,159,155,152,150,136,133,119,120},//8.05  
//	0   1	2   3	4	5	6	7	8	9   10  11 	12
   {233,233,306,270,234,228,223,219,210,207,192,196,184,171,166,163,162,165,159,155,152,150,136,133,119,120},//8.55   
//	0   1	2   3	4	5	6	7	8	9   10  11 	12
   {233,233,306,270,234,228,223,219,210,207,192,196,174,171,166,163,162,165,159,155,152,150,136,133,119,120},//9.05  
//	0   1	2   3	4	5	6	7	8	9   10  11 
   {233,233,306,270,234,228,223,219,210,207,192,206,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//9.55  
//	0   1	2   3	4	5	6	7	8	9   10
   {233,233,306,270,234,228,223,219,220,207,202,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//10.05   
//	0   1	2   3	4	5	6	7	8	9   10 
   {233,233,306,270,234,228,223,219,220,217,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//10.55  
//	0   1	2   3	4	5	6	7	8	9   10 
   {233,233,306,270,234,228,223,219,210,207,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//11.05   
//	0   1	2   3	4	5	6	7	8	9  
   {233,233,306,270,234,228,223,219,210,207,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//11.55   
//	0   1	2   3	4	5	6	7	8	9 
   {233,233,306,270,234,228,223,219,210,207,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//12.05
//	0   1	2   3	4	5	6	7	8	9 
   {233,233,306,270,234,228,223,219,210,207,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//12.55
};

const UINT8 MoveTimeSpeedTab_750X2_8060[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	27,	27,	27,	24,	23,	23,	22, 22, 21},//0.10~0.50
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	27,	27,	27,	24,	23,	23,	22, 22, 21},//0.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	27,	27,	27,	24,	23,	23,	22, 22, 21},//1.05	
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	27,	27,	27,	24,	23,	23,	22, 22, 21},//1.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	27,	27,	27,	24,	23,	23,	22, 22, 21},//2.05 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	27,	27,	27,	24,	23,	23,	22, 22, 21},//2.55   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	29,	29,	29,	28,	27,	27,	26,	25, 22, 21},//3.05   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23 
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 35, 35, 32,	31,	28,	28,	28,	28,	28,	27,	26,	23, 22, 21},//3.55 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	 
   {70,70, 63, 63, 63, 63, 58, 50, 45, 40, 38, 35, 36, 34, 33,	32,	29,	29,	29,	29,	29,	27,	25,	23, 23, 22},//4.05   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 43, 40, 40, 40, 39,	38,	37,	34,	32,	30,	25,	23,	23,	23, 23, 22},//4.55  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 43, 41, 40, 41, 40,	39,	37,	34,	32,	25,	25,	23,	23,	23, 23, 22},//5.05
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 44, 41, 41, 40, 39,	38,	36,	34,	32,	25,	24,	23,	23,	23, 23, 22},//5.55 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17  
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 43, 42, 43, 44, 40,	39,	37,	34,	28,	25,	24,	23,	23,	23, 23, 22},//6.05    
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 44, 41, 39,	36,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//6.55  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 43, 43, 37,	37,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//7.05  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13  
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 44, 42, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//7.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 48, 44, 42, 43, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//8.05  
//	0   1	2   3	4	5	6	7	8	9   10  11 	12	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//8.55   
//	0   1	2   3	4	5	6	7	8	9   10  11 	12 
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 46, 43, 43, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//9.05   
//	0   1	2   3	4	5	6	7	8	9   10  11  
   {70,70, 63, 63, 63, 63, 63, 59, 51, 47, 44, 41, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//9.55   
//	0   1	2   3	4	5	6	7	8	9   10-	
   {70,70, 63, 63, 63, 63, 63, 59, 51, 49, 47, 43, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//10.05   
//	0   1	2   3	4	5	6	7	8	9   10 
   {70,70, 63, 63, 63, 63, 63, 60, 53, 46, 46, 43, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//10.55  
//	0   1	2   3	4	5	6	7	8	9   10 
   {70,70, 63, 63, 63, 63, 63, 60, 55, 50, 48, 40, 37, 37, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//11.05   
//	0   1	2   3	4	5	6	7	8	9 
   {70,70, 63, 63, 63, 63, 63, 60, 55, 51, 46, 43, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//11.55  
//	0   1	2   3	4	5	6	7	8	9  
   {70,70, 63, 63, 63, 63, 63, 56, 51, 47, 43, 40, 37, 37, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//12.05
//	0   1	2   3	4	5	6	7	8	9  
   {70,70, 63, 63, 63, 63, 63, 62, 58, 53, 43, 40, 37, 37, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//12.55
};

const UINT16 MoveStartAngleTab_750Y2_8060[26][]=
{
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,200,200,173,165,160,160,150,130,113,113,103,100,100},//0.10
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,200,200,173,165,160,160,150,130,113,113,103,100,100},//0.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,200,200,173,165,160,160,150,130,113,113,103,100,100},//1.05
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,200,200,173,165,160,160,150,130,113,113,103,100,100},//1.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {233,233,306,270,234,228,223,219,210,207,207,206,204,200,200,173,165,160,160,150,130,113,113,103,100,100},//2.05 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {233,233,306,270,234,228,223,219,210,207,207,206,204,200,200,173,165,160,160,150,130,113,113,103,100,100},//2.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24
   {233,233,306,270,234,228,223,219,240,237,227,206,210,260,210,183,175,170,170,160,140,143,108,73,100,100},//3.05
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  
   {233,233,306,270,234,228,233,229,210,217,200,186,200,195,195,170,160,155,155,145,135,125,90,123,100,100},//3.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	 
   {233,233,306,270,234,238,233,239,230,237,232,191,244,181,176,170,170,170,169,165,160,140,140,133,119,120},//4.05   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	
   {233,233,306,270,234,238,233,229,220,217,222,246,214,201,186,163,162,165,99,75,152,150,136,133,119,120},//4.55   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  
   {233,233,306,270,234,238,233,229,220,217,222,216,214,211,186,183,172,145,79,155,152,150,136,133,119,120},//5.05  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18
   {233,233,306,270,234,238,233,229,220,217,212,206,194,181,166,153,162,165,159,155,152,150,136,133,119,120},//5.55  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17 
   {233,233,306,270,234,238,233,229,220,217,202,196,194,181,176,173,172,175,159,155,152,150,136,133,119,120},//6.05
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15
   {233,233,306,270,234,228,223,219,210,207,192,186,184,171,166,163,162,165,159,155,152,150,136,133,119,120},//6.55 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14	
   {233,233,306,270,234,228,223,219,210,207,192,186,184,151,156,163,162,165,159,155,152,150,136,133,119,120},//7.05 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13  
   {233,233,306,270,234,228,223,219,210,207,192,186,184,171,166,163,162,165,159,155,152,150,136,133,119,120},//7.55   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	
   {233,233,306,270,234,228,223,219,210,207,192,186,184,151,166,163,162,165,159,155,152,150,136,133,119,120},//8.05   
//	0   1	2   3	4	5	6	7	8	9   10  11 	12
   {233,233,306,270,234,228,223,219,210,207,192,196,184,171,166,163,162,165,159,155,152,150,136,133,119,120},//8.55 
//	0   1	2   3	4	5	6	7	8	9   10  11 	12
   {233,233,306,270,234,228,223,219,210,217,202,206,184,171,166,163,162,165,159,155,152,150,136,133,119,120},//9.05  
//	0   1	2   3	4	5	6	7	8	9   10  11 
   {233,233,306,270,234,228,223,219,210,217,202,206,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//9.55  
//	0   1	2   3	4	5	6	7	8	9   10
   {233,233,306,270,234,228,223,219,220,207,202,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//10.05   
//	0   1	2   3	4	5	6	7	8	9   10 
   {233,233,306,270,234,228,223,219,220,217,202,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//10.55  
//	0   1	2   3	4	5	6	7	8	9   10 
   {233,233,306,270,234,228,223,219,210,217,202,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//11.05 
//	0   1	2   3	4	5	6	7	8	9  
   {233,233,306,270,234,228,223,219,210,217,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//11.55  
//	0   1	2   3	4	5	6	7	8	9 
   {233,233,306,270,234,228,223,219,210,207,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//12.05
//	0   1	2   3	4	5	6	7	8	9 
   {233,233,306,270,234,228,223,219,210,207,192,186,204,171,166,163,162,165,159,155,152,150,136,133,119,120},//12.55
};

const UINT8 MoveTimeSpeedTab_750Y2_8060[26][]=
{
 //	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 34, 31, 31, 30,	29,	28,	27,	26,	26,	25,	24,	23,	22, 22, 21},//0.15
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 34, 31, 31, 30,	29,	28,	27,	26,	26,	25,	24,	23,	22, 22, 21},//0.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25 
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 34, 31, 31, 30,	29,	28,	27,	26,	26,	25,	24,	23,	22, 22, 21},//1.05	
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 34, 31, 31, 30,	29,	28,	27,	26,	26,	25,	24,	23,	22, 22, 21},//1.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 34, 31, 31, 30,	29,	28,	27,	26,	26,	25,	24,	23,	22, 22, 21},//2.05 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24  25
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 34, 31, 31, 30,	29,	28,	27,	26,	26,	25,	24,	23,	22, 22, 21},//2.55   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22  23  24
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 35, 33, 32, 31,	30,	29,	28,	27,	27,	26,	26,	26,	25, 22, 21},//3.05   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	22   
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 37, 35, 32, 32, 31,	30,	29,	28,	27,	27,	27,	27,	26,	22, 22, 21},//3.55   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	20  21	 
   {70,70, 63, 63, 63, 63, 57, 49, 44, 39, 38, 35, 36, 34, 33,	32,	32,	31,	28,	27,	28,	27,	25,	23, 23, 22},//4.05 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  19	
   {70,70, 63, 63, 63, 63, 63, 55, 50, 39, 37, 34, 37, 35, 40,	36,	36,	34,	32,	30,	25,	23,	23,	23, 23, 22},//4.55 
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18  
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 43, 39, 35, 34, 33,	34,	35,	34,	32,	25,	25,	23,	23,	23, 23, 22},//5.05  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17	18
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 43, 40, 36, 34, 36,	36,	35,	34,	32,	25,	24,	23,	23,	23, 23, 22},//5.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	16  17 
   {70,70, 63, 63, 63, 63, 63, 55, 50, 45, 43, 41, 41, 41, 40,	36,	35,	36,	28,	25,	24,	23,	23,	23, 23, 22},//6.05  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14  15	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 43, 40, 38,	36,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//6.55  
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	14	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 43, 43, 37,	37,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//7.05   
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13  
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 44, 41, 41, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//7.55
//	0   1	2   3	4	5	6	7	8	9   10  11	12  13	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 48, 44, 41, 41, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//8.05   
//	0   1	2   3	4	5	6	7	8	9   10  11 	12	
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 47, 43, 41, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//8.55 
//	0   1	2   3	4	5	6	7	8	9   10  11 	12 
   {70,70, 63, 63, 63, 63, 63, 59, 54, 49, 45, 41, 40, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//9.05   
//	0   1	2   3	4	5	6	7	8	9   10  11  
   {70,70, 63, 63, 63, 63, 63, 59, 54, 47, 44, 41, 40, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//9.55   
//	0   1	2   3	4	5	6	7	8	9   10	
   {70,70, 63, 63, 63, 63, 63, 59, 51, 45, 43, 43, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//10.05
//	0   1	2   3	4	5	6	7	8	9   10 
   {70,70, 63, 63, 63, 63, 63, 60, 55, 49, 47, 43, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//10.55   
//	0   1	2   3	4	5	6	7	8	9   10 
   {70,70, 63, 63, 63, 63, 63, 60, 55, 50, 46, 40, 37, 37, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//11.05 
//	0   1	2   3	4	5	6	7	8	9 
   {70,70, 63, 63, 63, 63, 63, 60, 55, 50, 46, 43, 42, 40, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//11.55   
//	0   1	2   3	4	5	6	7	8	9  
   {70,70, 63, 63, 63, 63, 63, 61, 56, 52, 43, 40, 37, 37, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//12.05
//	0   1	2   3	4	5	6	7	8	9 -44 
   {70,70, 63, 63, 63, 63, 63, 62, 58, 53, 43, 40, 37, 37, 35,	33,	29,	27,	26,	25,	24,	23,	23,	23, 23, 22},//12.55
};   
  

/**
  * @函数功能 中压脚查找原点函数
  * @参数 无
  * @返回值 无
  * 硬件相关：中压脚传感器采用的是ITR0802光耦，当传感器被挡上时，输出低电平,经主控板非门以后，表现为高电平。
  * 从代码上看，引脚低电平表示没到达光耦位置；
  约定：中压脚最高位置对应光耦刚由没挡到挡的跳变；在测试界面，按-号下降，+号上升 验明电机转向正确。
 
  */

void go_origin_zx(void)
{	
	UINT8 i,time,not_covered,covered;
	UINT16 temp16,dly_time;
	
	if( inpress_type == AIR_INPRESS)
	{
		inpress_up();
		return;
	}
		
	#if SECOND_GENERATION_PLATFORM ==1
		#if IORG_REVERSE_LEVEL
			covered = 0;		//0712  挡上
			not_covered = 1;
		#else
			covered = 1;		//0802  挡上
			not_covered = 0;
		#endif
		time = 1;
		dly_time = 1000;
	#elif COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER30 || COMPILE_MACHINE_TYPE >= MACHINE_CONFIG_NUMBER35
		not_covered = 0;
		covered = 1;
		time = 1;
		dly_time = 800;
	#elif CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800//4代系统小模板机+激光切割	
	    not_covered = 0;
		covered = 1;
		time = 1;
		dly_time = 800;
		
	#elif NEW_STRUCTURE_800_INPRESS == 1
		not_covered = 1;
		covered = 0;
		time = 1;
		dly_time = 800;
	#elif SUPPORT_NEW_DRIVER == 1
		not_covered = 0;
		covered = 1;
		time = 0;
		dly_time = 800;
	#else
		not_covered = 0;
		covered = 1;
		time = 1;
		dly_time = 800;
	#endif
	
	//=============================================
	#if USE_ENCODER_Z_PULSE
	if ( get_IORG_status()== not_covered)
	#else
	if(IORG == not_covered)    //1、没有进入传感器的检测区间 的 处理过程
	#endif
	{	
		temp16 = 0;
		
		#if ( CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037) ||(CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800|| CURRENT_STEPPER_CONFIG_TYPE == MACHINE_CONFIG_NUMBER30)
		  inpress_litter_footer_action_value = 0;
    	  inpress_litter_footer_action_counter = para_catch_delay_time;
		  inpress_litter_footer_action_flag = 1;
		#endif
		#if USE_ENCODER_Z_PULSE
		while ( get_IORG_status()== not_covered)
		#else
    	while(IORG == not_covered)
		#endif
    	{
			movestep_zx(1,time); 
			delay_us(dly_time);
  		  	temp16 = temp16 + 1;
     	  	if(temp16 > 2000)             //1.2 连续运行一段距离或时间后，还没找到传感器的跳变信号，则认为出现问题了。
  		  	{
  		  		sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if( sys.error == 0)
    	  		sys.error = ERROR_29;     //1.3 报错：中压脚原点检测异常	            
    	  		return;
  		  	}	
    	}
 	}
    else  //第二种情况：已经在传感器感应区了，还要先退出来一段距离，然后重新走进来，实现不挡到挡的跳变；
  	{
  		temp16 = 0;
  	    //2.0 先将框架从传感器感应区移出来，反转出来。
		#if USE_ENCODER_Z_PULSE
		while( get_IORG_status()== covered)
		#else
		while(IORG == covered)    
		#endif              
    	{
			movestep_zx(-1,time); 
			delay_us(dly_time);
  		  	temp16 = temp16 + 1;
		  	if(temp16 > 2000)             //2.0.1 对移动的距离做限定、判断
  		  	{
  		  		sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if( sys.error == 0)
    	  		sys.error = ERROR_29;     //2.0.2 超范围报错：中压脚原点检测异常	 	            
    	  		return;
  		  	}	
    	}
		//2.1 多出一断，确保退出传感器的感应区范围
		for(i=10;i>0;i--)  
		{
			movestep_zx(-1,time); 
			delay_us(dly_time);
		}
		delay_ms(10);
		temp16 = 0;
		//2.2  再次执行找原点传感器跳变沿的过程，这样无论在什么位置最终找原点的处理是一致的，位置是一致的。
		#if USE_ENCODER_Z_PULSE
		while ( get_IORG_status()== not_covered)
		#else
		while(IORG == not_covered)
		#endif
	   	{
				movestep_zx(1,time); 
				#if USE_ENCODER_Z_PULSE
				delay_ms(5);
				#else
		    	delay_us(1000);
				#endif
	  	  		temp16 = temp16 + 1;
				if(temp16 > 2000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
	      			sys.error = ERROR_29;     // inpress origin sensor is not normal  	 	            
	      			return;
	  	  		}	
	    }
  	}
	
    //3.0 确认原点位置传感器位置
    for(i=0;i<3;i++)    
	{
		movestep_zx(1,time); 
	    delay_us(1000);
	}
	
  	//4.0 中压脚到最高位置，设定相关的工作参数。

  	allin_step = 0;
	inpress_flag = 1;     
	inpress_com = 1;      
	MotorPositionSet = 0;
  	inpress_position = IN_ORIGIN;  
	//5.0 提升辅助压脚
	#if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
		L_AIR = 0;
	#elif CURRENT_STEPPER_CONFIG_TYPE == MACHINE_CONFIG_NUMBER30
		FA = 0;	
	#else	
		delay_ms(delay_before_inpress_down);
		FA = 0;
	#endif
}

/**
  * @函数功能 XY找原点函数
  * @参数 无
  * @返回值 无
  * @控制使用的全局变量或参数
  *     @opl_origin_flag --找原点的方式标志 0-表示用传感器信号 1-表示用闭环（0,0）位置当原点
  *                        两者区别：传感器找原点速度慢，但位置一致性好；用（0,0）位置找，找原点速度快
  *     @nop_move_pause_flag  --空送过程中出现按急停操作，停在中途任意一个位置了
  *     @finish_nopmove_pause_flag---在回起缝点的空送过程中，按急停了
  *     @special_go_allmotor_flag ---在发现空送急停时，发现回读的XY走过的距离出现问题，出现这种情况找原点就只能用传感器找
  */
void go_origin_xy(void)
{   	    
	if( (k92 == 4)&&(nop_move_pause_flag ==0)&&(finish_nopmove_pause_flag == 0) )
	{
		go_commandpoint(allx_step,0); 
		delay_ms(20);//350
		go_origin_y();
		allx_step = 0;
		ally_step = 0;
		allx_edit_step = 0;
		end_flag = 0;
		return;
	}
	if(opl_origin_flag == 0)                    //用传感器找原点的处理 	   
    {  
	    go_origin_y();
		if(sys.status == ERROR)
	  	{
	    	return;
	  	}
	     go_origin_x();	
		if(sys.status == ERROR)
	  	{
	    	return;
	  	}
		opl_origin_flag = 1;
		last_direction = 0;
		last_x_direction = 0;
	 }
	 else                                       //加快回原点的处理速度，先直接回到（0,0）位置，再用传感器找原点
	 { 
		  //1.0 如果说出现空送急停了，不论是平时空送还是回起缝点空送，都要从发生停车的位置返回到（0,0）
		  if( (nop_move_pause_flag ==1)||(finish_nopmove_pause_flag==1) )
		  {
		     allx_step = last_allx_step + read_step_x;//坐标值更新到与当前位置对应起来，否则Y向就出现撞出台板
			 ally_step = last_ally_step + read_step_y;
			 nop_move_pause_flag = 0;
			 finish_nopmove_pause_flag = 0;
		  }
		  /*
		    对模板机而言，回起缝点有可能就是回原点的过程。U39＝1参数指定的，但是如果是在回起缝点过程中，发生空送急停
		    这时模板先停在原地，但后面接着执行找原点动作，那就和我们设计的要求相违背了。不能出现先停了一下，接着又自己走
			了的情况。
		  */
		  if (special_go_allmotor_flag == 0)//空送急停后回读坐标出错，不知道当前位置，就不能通过直接回到（0,0）方式回原点
		  {
			#if SPECIAL_GO_ORIGIN_FUN
			if( (X_AXIS_ORGIN_ENABLE == 0)&&(find_x_origin_counter >=6) )
			{
				go_commandpoint(-x_origin_offset,0); 
				delay_ms(20);
				go_origin_x1();
				find_x_origin_counter = 0;
				find_start_point();
				already_auto_find_start_point = 1;
			}
			else
			{
				go_commandpoint(0,0); 
				delay_ms(20);//350
			}
			#else
				go_commandpoint(0,0); 
				delay_ms(120);//350
			#endif
		  }
		  if( finish_nopmove_pause_flag ==0)//没有在找原点空送到（0,0）阶段出现急停，则再执行传感器找原点操作
		  {
			  go_origin_y();                //按传感器信号执行查找原点操作
			  delay_ms(20);
			  go_origin_x();
			  last_direction = 0;
			  last_x_direction = 0;
		  }
		  opl_origin_flag = 1;
		  special_go_allmotor_flag = 0;
	 }
	 //2.0 没有发生回原点空送急停，就可以清除XY轴坐标，否则还要保证之前的值。
	 if( finish_nopmove_pause_flag ==0 )
	 {
		allx_step = 0;
		ally_step = 0;
		allx_edit_step = 0;
		end_flag = 0;
	 }
}

/**
  * @函数功能 X轴找原点函数
  * @参数 无
  * @返回值 无
  * 硬件相关：传感器采用的是接近传感器，当传感器被挡上时，输出低电平,经主控板非门以后，表现为高电平。
  * 从代码上看，引脚低电平表示没到达光耦位置；
  */
void go_origin_x1(void)
{
	UINT8 i;
	UINT16 temp16;
	
	if( (sys.error != 0)&&(sys.status == ERROR) )
		return;
	if( x_sensor_pos == 0)
	{
		if(XORG == 0)            				//1.0 从传感器外侧向传感器运行
		{	
			temp16 = 0;
	    	while(XORG == 0)
	    	{
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
	    		movestep_x(-1);  
				
				//#if COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER18	||COMPILE_MACHINE_TYPE >= MACHINE_CONFIG_NUMBER35
	  	  		delay_us(300);
				//#else
				//delay_ms(1);
				//#endif
	  	  		temp16 = temp16 + 1;
		  		rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)    //确保没有其它错误的情况下，再报X轴原点异常
	      			   sys.error = ERROR_25;     
	      			return;
	  	  		}
				if(sys.status == ERROR)
				  return;	
	    	}
	  	}
	  	else                    				//已经在传感器区间，先退出来，然后再重新进入，确认从同一点进入。
	  	{
			temp16 = 0;
	  		while(XORG == 1)
	    	{
	    		#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
				movestep_x(1);  	  
	  	  		//delay_ms(1);
				delay_us(300);
	  	  		temp16 = temp16 + 1;
		  		rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)
	      			sys.error = ERROR_25;     	//X轴原点检测异常	 	            
	      			return;
	  	  		}	
				if(sys.status == ERROR)
				  return;
	    	}
	    	for(i=5;i>0;i--)     				// continue running
			{
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
				movestep_x(1);  	  
	  	  		delay_ms(1);
			}
			delay_ms(10);
			temp16 = 0;
			while(XORG == 0)
	    	{
	    		#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
	    		movestep_x(-1);  	  
	  	  		delay_ms(1);
	  	  		temp16 = temp16 + 1;
		  		rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)
	      			sys.error = ERROR_25;     	// X origin sensor is not normal  	 	            
	      			return;
	  	  		}
				if(sys.status == ERROR)
				  return;
	    	}
	  	}
	}
	else
	{
		if(XORG == 1)            				//1.0 从传感器外侧向传感器运行
		{	
			temp16 = 0;
	    	while(XORG == 1)
	    	{
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
	    		movestep_x(-1);  	  
	  	  		//#if COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER18	||COMPILE_MACHINE_TYPE >= MACHINE_CONFIG_NUMBER35 
	  	  		delay_us(300);
				//#else
				//delay_ms(1);
				//#endif
	  	  		temp16 = temp16 + 1;
		  		rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)    //确保没有其它错误的情况下，再报X轴原点异常
	      			   sys.error = ERROR_25;     
	      			return;
	  	  		}
				if(sys.status == ERROR)
				  return;	
	    	}
	  	}
	  	else                    				//已经在传感器区间，先退出来，然后再重新进入，确认从同一点进入。
	  	{
			temp16 = 0;
	  		while(XORG == 0)
	    	{
	    		#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
				movestep_x(1);  	  
	  	  		//delay_ms(1);
				delay_us(300);
	  	  		temp16 = temp16 + 1;
		  		rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)
	      			sys.error = ERROR_25;     	//X轴原点检测异常	 	            
	      			return;;
	  	  		}	
				if(sys.status == ERROR)
				  return;
	    	}
	    	for(i=5;i>0;i--)     				// continue running
			{
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
				movestep_x(1);  	  
	  	  		delay_ms(1);
			}
			delay_ms(10);
			temp16 = 0;
			while(XORG == 1)
	    	{
	    		#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = 0;
				#endif
	    		movestep_x(-1);  	  
	  	  		delay_ms(1);
	  	  		temp16 = temp16 + 1;
		  		//rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)
	      			sys.error = ERROR_25;     	// X origin sensor is not normal  	 	            
	      			return;
	  	  		}
				if(sys.status == ERROR)
				  return;
	    	}
	  	}
	}
}
/**
  * @函数功能 X轴找原点函数
  * @参数 无
  * @返回值 无
  * 硬件相关：传感器采用的是接近传感器，当传感器被挡上时，输出低电平,经主控板非门以后，表现为高电平。
  * 从代码上看，引脚低电平表示没到达光耦位置；
  */
void go_origin_x(void)
{	
	if(X_AXIS_ORGIN_ENABLE == 1)
	{
		go_origin_x1();
	}

	delay_ms(1);			
	allx_step = 0;	
}

/**
  * @函数功能 Y轴找原点函数
  * @参数 无
  * @返回值 无
  * 硬件相关：传感器采用的是接近传感器，当传感器被挡上时，输出低电平,经主控板非门以后，表现为高电平。
  * 从代码上看，引脚低电平表示没到达光耦位置；
  */
void go_origin_y(void)	
{
#if Y_AXIS_ORGIN_ENABLE		

 #if SUPPORT_NEW_Y_ORIGIN
	UINT8 i;
	UINT16 temp16;
	UINT16 speed_time,run_time;
	UINT16 j=1;
	
	speed_time = 300- 50/go_origin_speed; 
	j = 1;
	step_movetype = 0;
	
	if(YORG == 0)    						// sensor is covered
	{	
		temp16 = 0;
		j = 1;
		run_time = 12000;
		while(YORG == 0)
		{ 
	        if( j<40 )
				timer_y = OPEN_LOOP_TIME;
			else
	        	timer_y = CLOSE_LOOP_TIME;
			movestep_y(-1);
			
			if(run_time <850)  
			   run_time = 850;	
				    
			delay_us(run_time);
			if( j<= 40 )
			{
				run_time -= speed_time;
				j++;
			}
	    	temp16 = temp16 + 1;
  	  		if(temp16 > 20000)
  	  		{
  	  			sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if(sys.error == 0)
      				sys.error = ERROR_26;     	// Y origin sensor is not normal  	 	            
      			return;
  	  		}
			rec_com();
	  	}
	 
		if(j>=40)
 		   timer_y = CLOSE_LOOP_TIME;
		else
		   timer_y = OPEN_LOOP_TIME;
					
		for(i=5;i>0;i--) 
	    {   
		    	 movestep_y(-1);  	  
	  	     	 run_time += (speed_time*8-1600); 
	  	     	 delay_us(run_time);
	    }
		delay_ms(20);
		while( YORG == 1)
		{
				 timer_y = OPEN_LOOP_TIME;
		    	 movestep_y(1);
				 delay_ms(12);
		}
		
		for( i=0;i<5;i++)
		{
				 timer_y = OPEN_LOOP_TIME;
		    	 movestep_y(1);
				 delay_ms(12);
		}
  	}
  	else            						// sensor is not covered
  	{
  		temp16 = 0;
		j = 1;
		run_time = 12000;
  		while(YORG == 1)
    	{
	        if(j<40)
			    timer_y = OPEN_LOOP_TIME;
			else
		     	timer_y = CLOSE_LOOP_TIME;
			movestep_y(1);
			
			if(run_time < 850)  
			   run_time = 850;	
			  	  
			delay_us(run_time);
			if( j<= 40 )
			{
				run_time -= speed_time;
				j++;
			}
  	  		temp16 = temp16 + 1;
  	  		if(temp16 > 20000)
  	  		{
  	  			sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if(sys.error == 0)
      				sys.error = ERROR_26;     	// Y origin sensor is not normal  	 	            
      			return;
  	  		}
			rec_com();	
    	}
	    if(j>=40)
		   timer_y = CLOSE_LOOP_TIME;
		else
		   timer_y = OPEN_LOOP_TIME;
			
		for(i=5;i>0;i--) 
	    { 
			movestep_y(1);  	  
  	  		run_time += (speed_time*8-1600); 
  	     	delay_us(run_time);
		}
		
		delay_ms(20);
	}
    temp16 = 0;
	delay_ms(12);
	for(i=0;i<3;i++)
	{
		while(YORG == 0)
    	{
	        timer_y = OPEN_LOOP_TIME;
			step_movetype = 0;
			movestep_y(-1);  	  
  	  		delay_ms(12);

  	  		temp16 = temp16 + 1;
  	  		if(temp16 > 8000)//8000
  	  		{
  	  			sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if(sys.error == 0)
      			   sys.error = ERROR_26;     		 	            
      			return;
  	  		}
			rec_com();	
    	}    
		delay_ms(20);  
  	}
 #else
	UINT8 i,SON,SOFF;
	UINT16 temp16;
	UINT16 j=1;
	#if YORG_REVERSE_LEVEL
		SON = 0;		//0712  挡上
		SOFF = 1;
	#else
		SON = 1;		//0802  挡上
		SOFF = 0;
	#endif
	if( (sys.error != 0)&&(sys.status == ERROR) )
	   return;
    //Y轴的负载比较大，所以找原点采用了一个升降速的设计，并确保找原点都是从一个方向的处理过程，使原点位置一致。	
	if(YORG == SOFF)    						
	{	
		 temp16 = 0;
		 //1.0 先低速升到匀速段，并进入到传感器感应范围内
		 while(YORG == SOFF)
		 { 
      		#if SUPPORT_UNIFY_DRIVER
			timer_y = 0;
			#else
			timer_y = 0;
			#endif
    	    movestep_y(-1);  				//升降速设计，大幅面高频启动容易出现停车不稳的情况，沿用开环设计
	  	    if(j==1)
			   delay_us(1500);
			else if(j==2)
			   delay_us(1000);
			else if(j==3)
			   delay_us(800);
			else if(j==4)
			   delay_us(600);
			else 
			   delay_us(100*(UINT16)go_origin_speed);
	    	temp16 = temp16 + 1;
			rec_com();
	    	if(temp16 > 20000)
  	  		{
  	  			sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if( sys.error == 0)
      			    sys.error = ERROR_26;     	// Y origin sensor is not normal  	 	            
      			return;
  	  		}
			if(sys.status == ERROR)
			  return;
			j++;
	  	 }
	    //1.1  进入传感器范围内，等框架稳定后，再低速退出传感器的范围
			delay_ms(12);
			while(YORG == SON)
			{
				timer_y = 1;
	    		movestep_y(1);
				delay_ms(2);
			}
			for(i=0;i<5;i++)
			{
				movestep_y(1);
				delay_ms(2);
			}
			delay_ms(5);
		//1.2 采用低速查找传感器由不挡到挡的跳变沿
			temp16 = 0;
			while(YORG == SOFF)
    		{
	    		#if SUPPORT_UNIFY_DRIVER
				timer_y = 0;
				#else
				timer_y = 0;
				#endif
	            movestep_y(-1);
	  	  		delay_ms(2);
	  	  		temp16 = temp16 + 1;
		  		rec_com();
	  	  		if(temp16 > 20000)
	  	  		{
	  	  			sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if(sys.error == 0)
	      			sys.error = ERROR_26;     	// Y origin sensor is not normal  	 	            
	      			return;
	  	  		}
				if(sys.status == ERROR)
			  		return;
    		} 
  	  }
  	else            						//另一种找原点的情况，已经在传感器范围内
  	{
  		temp16 = 0;
		//2.0 已经在传感器内，则首先升速退出传感器的感应范围
  		while(YORG == SON)
    	{
    		#if SUPPORT_UNIFY_DRIVER
			timer_y = 0;
			#else
			timer_y = 0;
			#endif
    	    movestep_y(1);
  	  		if(j==1)
			   delay_us(1500);
			else if(j==2)
			   delay_us(1000);
			else if(j==3)
			   delay_us(800);
			else if(j==4)
			   delay_us(600);
			else 
			   delay_us(100*(UINT16)go_origin_speed);
  	  		temp16 = temp16 + 1;
	  		rec_com();
  	  		if(temp16 > 20000)
  	  		{
  	  			sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if( sys.error == 0)
      			  sys.error = ERROR_26;     	// Y origin sensor is not normal  	 	            
      			return;
  	  		}
			if(sys.status == ERROR)
			  return;
			j++;
    	}
		//2.1 再多走一段，缓慢停车，即确认退出感应范围，又缓和了停车过程。
    	for(i=10;i>5;i--)     				
		{
			#if SUPPORT_UNIFY_DRIVER
			timer_y = 0;
			#else
			timer_y = 0;
			#endif
		    movestep_y(1); 
            if(i==10)
			   delay_us(100*(UINT16)go_origin_speed);
			else if(i==9)
			   delay_us(600);
			else if(i==8)
			   delay_us(800);
			else if(i==7)
			   delay_us(1000);
			else 
			   delay_us(1500);
		}
		delay_ms(5);
		temp16 = 0;
		//2.2 采用低速查找传感器由不挡到挡的跳变沿
		while(YORG == SOFF)
    	{
    		#if SUPPORT_UNIFY_DRIVER
			timer_y = 0;
			#else
			timer_y = 0;
			#endif
            movestep_y(-1);
  	  		delay_ms(2);
  	  		temp16 = temp16 + 1;
	  		rec_com();
  	  		if(temp16 > 20000)
  	  		{
  	  			sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if(sys.error == 0)
      			sys.error = ERROR_26;     		 	            
      			return;
  	  		}
			if(sys.status == ERROR)
			  return;
    	}    
  	}
	#endif
#endif
  delay_ms(1);		
  ally_step = 0;
}

/*
	旋转切刀伺服电机回零位
*/
void go_origin_yj(void)
{
	#if COMPILE_MACHINE_TYPE  == MACHINE_CONFIG_NUMBER40
	UINT8 i,flag;
	UINT16 temp16,ret;
	INT16 offset;
	//cutter_angle_adjust = get_cutter_motor_angle();
	//return;
	if( para.rotate_cutter_working_mode != 55)	
		return;
	if( (sys.error != 0)&&(sys.status == ERROR) )
		return;		
	//1
	ret = get_YJORG_status();	
	flag = 1;
	//2
	while(flag == 1)
	{
		movestep_yj(-1,1);
		delay_ms(1);
		ret = get_YJORG_status();
		delay_ms(1);
		if( ret == 1)
		{
			delay_ms(2);
			for(i=0;i<5;i++)//持续走几步
			{
				movestep_yj(-1,1);
				delay_ms(2);
			}	
			while(1)
			{
				movestep_yj(1,10);
				delay_ms(10);
				ret = get_YJORG_status();
				delay_ms(10);
				if( ret == 1)
				{
					flag = 0;
					break;
				}
			}
		}
	}	
	
	if( para.go_special_position_mode != 0)//88
	{		
		offset = para.go_special_position_mode;
		for( i =0;i<para.go_special_position_mode;i++)
		{
			movestep_yj(-1,1);
			delay_ms(1);
		}
	}
	cutter_angle_adjust = get_cutter_motor_angle();
	#endif
}

/**
  * @函数功能 外压框（剪线）电机处理函数
  * @参数 无
  * @返回值 无
  */
void go_yj(INT16 step,INT16 time)
{
}

/**
  * @函数功能 系统找原点函数
  * @参数 无
  * @返回值 无
  */
void go_origin_allmotor(void)
{	
	UINT8 temp8;
	UINT16 temp16;
	
	//1.0 首先检查针杆位置，框架动作之前把针先提起来，防止撞针
	temp8 = detect_position();	
	if(temp8 == OUT)    								
	{
		find_dead_center();
	}
	already_find_startpoint_flag = 0;
	
	
	if(ROTATED_CUTTER == 1)
	{
		if ( rotated_cutter_enable ==1 )
		{
			//DRILL_MOTOR_UPDOWN = 0;//铣刀先降下去
			rotated_cutter_down_positon();
			drill_motor_run_enable = 0;   //铣刀关电
			DRILL_FOOTER = 0;
			delay_ms(200);
			milling_first_move = 0;
			milling_cutter_action_flag = 0;
			go_origin_rotated_cutter();
			delay_ms(50);
		}
	}
#if	ENABLE_LOOPER_CUTTER
	if( stepper_cutter_enable == 1)
		go_origin_stepper_cutter();
#endif

#if ENABLE_LASER_CUTTER
	LASER_POWER_PIN = 0;
	LASER_FUN_PIN = 0;
	LASER_INDICATIOR_LED = LASER_LED_ON;
#endif
    start_to_speed_down = 0;		//回原点时清除
	cutter_speed_done_flag = 0;
	double_xy_time_flag = 0;
  	//--------------------------------------------------------------------------------------
  	//  thread clamp motor go origin
  	//-------------------------------------------------------------------------------------- 
	#if SPECIAL_MOTOR_CUTTER
	if( SUPPORT_CS3_FUN == 1)
		output_cs3(0x20,0x00);
	else
		CUTTER_HOLDING_PART = 0;
	if(u46 == 0)
	#else
  	if(u35==0)   
	#endif
  	{
  		go_origin_ct();
  	  	if(sys.status == ERROR)
  	  	{
  	    	return;
  	  	}
  	}
	
	//1.1 降下压框 这里的气动压框；步进压框先要找原点，模板机不考虑这种情况了	
    #if CHANGE_DOUBLE_FRAMEWORK   //双换模板
	#else
  	if( k74 == 1)
    {
		#if ENABLE_SCRATCH_FUN
		if(k169 != MACHINE_BOBBIN_CUTTER)
	    {
			EXTEND = 0;
			delay_ms(250);
		}
		#endif
		LM_AIR = 0;   
    } 
	#endif
	autosewing_allset_flag = 0;
	autosewing_allow_working = 0;
	over_counter = 0;
	FW = 0;       
  	delay_ms(100);//这个时间是否考虑减少？
	R_AIR = 0;
	marking_finish_flag = 0;
	marking_flag = 0;
	//1.2 系统状态、标志、控制变量进行初始化    
	pat_point = (PATTERN_DATA *)(pat_buf);
	sta_point = pat_point; 
	move_flag = 0;
	lastmove_flag = 0;
	stop_flag = 0;
	nopmove_flag = 0;
	origin2_lastmove_flag = 0;
	single_flag = 0;       
  	foot_count = 0;	
	cut_count = 1;        
  	foot_flag = 0;           
  	foot_com = 0;      
	//pattern_change_flag = 0; 

	SewTestStitchCounter = 0;
	pat_buff_total_counter = 0;//回原点意味着所有花样计数归零，花样指针回到缓冲区首位置

	pat_buff_write_offset = 0;
	allx_edit_step = 0;
	if( k115 == 0 )
		already_auto_find_start_point = 0;
	//1.3 翻转压脚、伸缩压脚的处理 模板机里没意义
	if(k110 == 1)
	{
	   FL = 0;
	   foot_half_flag = 0;       	
	}
    else if(k110 == 2)
	{
		stretch_foot_in();
	} 	 
  	//1.4 中压脚查找原点  中压脚处理最高的位置
	go_origin_zx();	
	inpress_high = inpress_high_hole;
	inpress_act_flag = 0; 
	if(sys.status == ERROR)
  	{
  	  return;
  	}  
  	//1.5 X、Y轴执行找原点，分成是否有翻转装置来选择检索原点的顺序
	if(k110 == 1)
	{
		switch(k93)
		{
			case 0:
			case 1:
			case 2:
				go_origin_xy();
				break;
			
			case 3:
				go_origin_x();
				delay_ms(2);
				go_origin_y();
				allx_step = 0;
				ally_step = 0;
				break;
			default:
				break;
		}
	}
	else
	{
		switch(k92)
		{
			case 0:
			case 1:
			case 2:
				go_origin_xy();
				break;
	
			case 3:
				go_origin_x();
				delay_ms(2);
				go_origin_y();
				allx_step = 0;
				ally_step = 0;
				break;
			case 4:
				go_origin_y();
				allx_step = 0;
				ally_step = 0;
			break;
			default:
				break;
		}
	} 
	allx_edit_step = 0;
	
	if(sys.status == ERROR)
  	{
    	return;
  	}	
	//1.6 根据停车位置情况，调整机针最后的停针点
	if(u42 == 0)
	{
		if(u94 == 1)
		{
			find_up_position();
		}
	}
	return_from_setout = 0;
	//1.7 确认移动过程中针杆位置没偏离停针点	
	temp8 = detect_position();	
	if(temp8 == OUT)    								
	{
		find_dead_center();
	}
	nop_move_pause_flag = 0;	
	OutOfRange_flag = 0;
	if( second_start_switch == 1)//二次启动的计数处理
	{
		second_start_counter = 1;
	}
	last_direction = 0;
	last_x_direction = 0;
	milling_cutter_action_flag = 0;
	milling_first_move = 0;
	need_action_once = 0;
	special_pause_flag = 0;
	
	monitor_allx_step = 0;
	monitor_ally_step = 0;
	monitor_pat_point = (PATTERN_DATA *)(pat_buf);
	monitor_refresh_flag = 1;
}

/**
  * @函数功能 抬外压框处理函数
  * @参数 无
  * @返回值 无
  */
void foot_up(void)
{
	if(foot_flag == 0)
	{
		if(k74 == 1)//k74压框类型选择
		  {
	        LM_AIR = 1;
			#if ENABLE_SCRATCH_FUN
			if(k169 != MACHINE_BOBBIN_CUTTER )
	    	{
				EXTEND = 1;
			}
			#endif
		  }     
	}    
    delay_ms(5); 
	foot_flag = 1;      
	foot_com = 1;       
	FootNumber = 0;	 
}

/**
  * @函数功能 抬辅助压框处理函数
  * @参数 无
  * @返回值 无
  */
void foot_half_up(void)
{
	//辅助压框根据外设不同产生不动动作，伸缩和翻转的动作不同
	if(k110 == 2)
	{
		stretch_foot_in();
	}
	else if(foot_half_flag == 0)
	{
		#if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
		#else
	    FL = 1;
	    delay_ms(5);
		#endif
	}
	foot_half_flag = 1; 
  
}

/**
  * @函数功能 同时抬压框处理函数
  * @参数 无
  * @返回值 无
  @受影响的全局变量 
  *     @k74 ---电机/气动压框选择 0-电机 *1-气动压脚
  *     @u81 ---外压脚-脚踏开闭
  *     @k110---翻转装置与伸缩压脚控制
  *     @FootNumber---踩脚踏板的次数
  @控制引脚信号
  *     @LM_AIR ----外压框的气动控制信号
  *     @FL     ----辅助压框的气动控制信号
  */
void footer_both_up(void)
{ 
	if(foot_flag == 0)
	{
		if(k74 == 1)//外压框是气动的情况
		{
			if(u81 == 0 || u81>= 4)//脚踏板只控制外压框的情况
			{
				  LM_AIR = 1;
				 #if ENABLE_SCRATCH_FUN
				 if(k169 != MACHINE_BOBBIN_CUTTER)
	    		 {
				  	EXTEND = 1;//2016-10-06
				 }
				  #endif
			}
			else //脚踏板控制多压框的情况
			{
				  if(k110 == 0)       
				  {
					    LM_AIR = 1;  
						#if ENABLE_SCRATCH_FUN
						if(k169 != MACHINE_BOBBIN_CUTTER)
	    				{
							EXTEND = 1;//2016-10-06
						}
						#endif
				   }
				  else if(k110 == 1)//打开翻转装置后，辅助压框与外压框一起抬起来
				   {
					    FL = 1;
						LM_AIR = 1;    
				   }
				   else if(k110 == 2)//使用伸缩装置后，先将伸缩装置收回，然后再抬外压框
				   {  
			            stretch_foot_in();
						if(FL == 1)  
					      FL = 0;
						delay_ms(100); 
						LM_AIR = 1;
				   }
				  
			  }
		
		  }
		   
	  } 
	  //设置压框状态 
	  delay_ms(5);       
	  foot_flag = 1;      
	  foot_com = 1; 	
	  foot_half_flag = 1;	
	  FootNumber = 0;	 
}

/**
  * @函数功能 降外压框处理函数
  * @参数 无
  * @返回值 无
  */
void foot_down(void)
{
	if(foot_flag == 1)
	{
		if(k74 == 1)
		  {
	          #if ENABLE_SCRATCH_FUN
			  if(k169 != MACHINE_BOBBIN_CUTTER )
	    	  {
			  	EXTEND = 0;
			  	delay_ms(250);
			  }
			  #endif
			  LM_AIR = 0;      
			  if( identify_mode == 1)//如果压板落下后进行识别，则增加一段时间让压框稳定，这是之前传感器时有
			      delay_ms( 50);  	  
			  
			  foot_flag = 0;       	
              foot_com = 0;  
		   }     
  	}
}
/**
  * @函数功能 降辅助压框处理函数
  * @参数 无
  * @返回值 无
  */
void foot_half_down(void)
{
	//分伸缩、翻转分开处理
	if(k110 == 2)   
	{
		stretch_foot_out();//对伸缩而言，下降是工作状态，对应着就是伸出下压
	}
	else
	{
	   if(foot_half_flag == 1)
	   {
		   #if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
		   #else
	      FL = 0;
		  #endif
		  delay_ms(10);
  	   }
	}	
	foot_half_flag = 0;      
	      
}

/**
  * @函数功能 同时降压框处理函数
  * @参数 无
  * @返回值 无
  @受影响的全局变量 
  *     @k74 ---电机/气动压框选择 0-电机 *1-气动压脚
  *     @u81 ---外压脚-脚踏开闭
  *     @k110---翻转装置与伸缩压脚控制
  *     @FootNumber---踩脚踏板的次数
  @控制引脚信号
  *     @LM_AIR ----外压框的气动控制信号
  *     @FL     ----辅助压框的气动控制信号
  */
void footer_both_down(void)
{
	   if(foot_flag == 1)
	   {
		 if(k74==1)//只响应气动外压框
 		 {
                if(u81 == 0 || u81 >= 4)
				{
					#if ENABLE_SCRATCH_FUN
					if(k169 != MACHINE_BOBBIN_CUTTER )
	    			{
					    EXTEND = 0;
						delay_ms(250);
					}
					#endif
						LM_AIR = 0;						
				 }
				else
				{
				    if(k110 == 0)     
				    {
						LM_AIR = 0;   
					}
					else if(k110 == 1)
					{
					        LM_AIR = 0;     
			                FL = 0;
					 }
					else if(k110 == 2)
					 {
					        LM_AIR = 0;     
			                stretch_foot_out();
					  }
				}
				delay_ms(5);     	             
	 	        foot_count = 1;
   	            foot_flag = 0;       
	  	        foot_com = 0;        
		        foot_half_flag = 0;       	
			  }
		}
		FootNumber = 2;	
}
/**
  * @函数功能 踩踏板压框处理函数
  * @参数 无
  * @返回值 无
  @受影响的全局变量 
  *     @k74 ---电机/气动压框选择 0-电机 *1-气动压脚
  *     @u104 ---中压脚随压框动作控制
  *     @k110---翻转装置与伸缩压脚控制
  *     @FootNumber---踩脚踏板的次数
  *     @k60 三级踏板使能 *0-无效 1-有效
  */
void footer_procedure(void)
{
	if(k60 == 0)   
	{
		//1.0  没有使用三联脚踏板的情况，当踩下踏板后的处理，压框踏下的次数循环加1
		FootNumber++;
		if(FootNumber >= 4)
			FootNumber = 1;
		//	
		if( k74 ==1 )//只考虑气动压框情况下的处理
		{
		   switch(FootNumber)
		   {
			 //1.1 第一次踩下踏板的情况
			 case 1:
			      switch(u81)
					{
					 case 0: //1.1.0 只有外压框的情况，首次踩踏板就落下压框
						    foot_down();  
						    if(u104 == 1)//如果中压脚随踏板动作，就随后跟着落下
							{	      	
							     delay_ms(50);
							     inpress_down(inpress_high); 
							}	
					 break;
					 case 1://1.1.1 如果选择有两段压框，则调用同时降压框函数
							footer_both_down();
						    if(u104 == 1)
					        {	      	
						           delay_ms(50);
						           inpress_down(inpress_high); 
					        }	
					 break;   
					 case 2://1.1.2 一种分开控制，先降外压框
							foot_down();  
							if(u104 == 1)
							{	      	
							      delay_ms(50);
								  inpress_down(inpress_high); 
							}	  
					 break;
					 case 3: //1.1.3 另一种分开控制，先降辅助压框
							foot_half_down();
							break;    		          
					 default://1.1.4 其它参数的默认动作	 
							foot_down();
							if(u104 == 1)
							{	      	
							     delay_ms(50);
								 inpress_down(inpress_high); 
							 }	 
					  break;  
				     }	   // end switch(u81)        					
			      break;
			   //1.2 第二次踩脚踏板的处理	  						
			   case 2:					   
				     switch(u81)
					   {
						  case 0:  //1.2.0 只有外压框时，抬外压框。中压脚随动时，先抬起中压脚。
								  if(u104 == 1)
					              {	      	
						             inpress_up(); 
						             delay_ms(150);
					               }		
								   foot_up(); 
						  break;
						  case 1:  //1.2.1 多种压框同时抬起
								   if(u104 == 1)
					               {	      	
						               inpress_up(); 
						               delay_ms(150);
					                }	
			                        footer_both_up();
						  break;   
						  case 2:  //1.2.2 分开控制 ，其次辅助压框
								   foot_half_down();
						  break;
						  case 3:  //1.2.3 分开控制 外压框
								  foot_down();  
								  if(u104 == 1)
							      {	      	
							      	delay_ms(50);
									inpress_down(inpress_high);
								  } 
						  break;    		          
						  default:	 
							      if(u104 == 1)
					              {	      	
						              inpress_up(); 
						              delay_ms(150);
					               }		
								  foot_up(); 	 
						  break;
					  }	           
			   break;
			   //1.3 第三次踩脚踏板
			   case 3:
			            if(u104 == 1)//直接抬所有压框
					    {	      	
						   inpress_up(); 
						   delay_ms(150);
					    }	
			            footer_both_up();
			            break;
			   default:
			            FootNumber = 0;
			            break;
		    }	
	   }
	}
	else    //有三联踏板的处理过程 模板机没有对应功能支持。
	{
	   if(k74 == 1)
	   {
		   if(foot_flag == 0)
		   {
			   foot_up();
		   }
		   else
		   {
			   foot_down();
		   }
	   }	
	}
}

/**
  * @函数功能 伸缩压脚伸出函数
  * @参数 无
  * @返回值 无
  @受影响的全局变量 
  *     @k115 缝制过程中伸缩压脚位置 *0-上 1-下
  *     @k112 伸缩压脚伸出延时
  *     @k114 伸缩压脚下降延时
  @控制引脚信号
  *     @R_AIR ----伸出或收回 控制信号
  *     @FL    ----下降或抬起 控制信号
  */
void stretch_foot_out(void)
{
	UINT8 i;
	if(stretch_foot_flag == 1)// in&down
	{
	    //1.0 如果要求运行过程必须降下，则这时将装置抬起
		if( (sys.status == RUN) && (k115 == 1) )
		{
		      FL = 0 ;
		      for(i=0; i<4; i++)
		      {
		         delay_us(10000);
		      }
		}
		//1.1 伸出装置，并进行延时
		R_AIR = 1;	
		for(i=0; i<30; i++) 
		{
		    delay_us(10000);
		}
        for(i=0; i<k112; i++)
		{
		    delay_us(10000);
		}
		//1.2 装置下压，并延时
		FL = 1; 
		for(i=0; i<k114; i++)
		{
		    delay_us(10000);
		}
	  	stretch_foot_flag = 0; 
		foot_half_flag = 0;
  	}
}
/**
  * @函数功能 伸缩压脚收回函数
  * @参数 无
  * @返回值 无
  @受影响的全局变量 
  *     @k115 缝制过程中伸缩压脚位置 *0-上 1-下
  *     @k112 伸缩压脚伸出延时
  *     @k113 伸缩压脚抬起延时
  *     @k114 伸缩压脚下降延时
  @控制引脚信号
  *     @R_AIR ----伸出或收回 控制信号
  *     @FL    ----下降或抬起 控制信号
  */
void stretch_foot_in(void)
{
	UINT8 i;
	if(stretch_foot_flag == 0)//out&down
	{
	    //1.0 装置先抬起来，并进行延时
		FL = 0;     
		for(i=0; i<4; i++)
 		{
		    delay_us(10000);
		}
		for(i=0; i<k113; i++)
		{
		    delay_us(10000);
		}
		//1.1 装置回收动作，
		R_AIR = 0;   
	    //1.2 如果要求运行过程中必须降下，则降下装置，并延时
		if( (sys.status == RUN) && (k115 == 1) )
		{
		     for(i=0; i<4; i++)
		     {
		         delay_us(10000);
		     }
		     FL = 1 ;
		}
		stretch_foot_flag = 1;     
		foot_half_flag = 1;    
	}
}

/**
  * @函数功能 抬中压脚函数
  * @参数 无
  * @返回值 无
  */
void inpress_up(void)
{
	if( inpress_type == AIR_INPRESS)
	{
		INPRESS_PIN = 0;
		inpress_flag = 1;     
		inpress_com = 1;      
		MotorPositionSet = 0;
	}
	else
	{
		if(inpress_flag == 0)
		{
			#if FOLLOW_INPRESS_FUN_ENABLE
				go_origin_zx();
			#else
				#if SUPPORT_NEW_DRIVER
					go_origin_zx();
					inpress_flag = 1;     
					inpress_com = 1;      
					MotorPositionSet = 0;
					#if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
					 L_AIR = 0;
					 #else
					 FA = 0;
					#endif
				#else
					inpress_to(IN_ORIGIN);
					inpress_flag = 1;     
					inpress_com = 1;      
					MotorPositionSet = 0;
					FA = 0;
					go_origin_zx();
				#endif
			
			
			#endif
		}
	}
}
/**
  * @函数功能 降中压脚函数
  * @参数 low_position --降落到指定位置
  * @返回值 无
  */
void inpress_down(INT16 low_position)
{
  if( inpress_type == AIR_INPRESS)
  {
	  inpress_flag = 0;     
	  inpress_com = 0;   
	  INPRESS_PIN = 1;
  }
  else
  {
  	  if(inpress_flag == 1)
	  {
		 #if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
		 L_AIR = 1;
		 delay_ms(para_y_backward_dis);			 
		 #elif CURRENT_STEPPER_CONFIG_TYPE == MACHINE_CONFIG_NUMBER30
		 FA = 1;
		 delay_ms(para_y_backward_dis);
		 #endif
		 inpress_to(low_position);  
	  	 inpress_flag = 0;     
	  	 inpress_com = 0;  		
  	  }
  }
}

/**
  * @函数功能 中压脚动作函数
  * @参数   a----下降到指定位置
  * @返回值 无
  @受影响的全局变量 
  *     @inpress_position  记录中压脚的当前位置
  */
void inpress_to(INT16 a)
{
	INT16 step;
	UINT16 temp;
	INT16 now_position;
	INT16 obj_position;
	if( inpress_type == AIR_INPRESS)
	{
	    return;
	}
	
	#if 0//UART1_DEBUG_OUTPUT_MODE
	uart1_send_char('[');
	uart1_send_char(inpress_position/10+'0');
	uart1_send_char(inpress_position%10+'0');
	uart1_send_char(',');
	uart1_send_char(a/10+'0');
	uart1_send_char(a%10+'0');
	uart1_send_char(']');
	#endif
	
	now_position = inpress_position;
	obj_position = a;
	//1.0 中压脚升降之前，确认辅助压脚的位置，如果中压脚要到达的位置不是最高点，则辅助压脚就落下；
	if( obj_position < IN_ORIGIN )
	{
		#if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
		//inpress_litter_footer_action_value = 1;
    	//inpress_litter_footer_action_counter = para_y_backward_dis;
		//inpress_litter_footer_action_flag = 1;
		L_AIR = 1;
		#elif CURRENT_STEPPER_CONFIG_TYPE == MACHINE_CONFIG_NUMBER30
		FA = 1;
		#else
		FA = 1;
		delay_ms(delay_before_inpress_down);
		#endif
		inpress_flag = 0;  
	}
	//1.1 根据中压脚目标位置 和 当前位置 决定是否给步进发中压脚动作指令
	if(obj_position != now_position)
	{		
		//1.1.1 由目标位置 和 当前位置 计算出两者相差的脉冲数  距离 与 脉冲 的转换是通过非线性表格实现的
		#if FOLLOW_INPRESS_FUN_ENABLE
			#if NEW_STRUCTURE_900_INPRESS
				step = inpress_tab3[now_position] - inpress_tab3[obj_position]; 
			#else
				step = inpress_tab2[now_position] - inpress_tab2[obj_position]; 
			#endif
		#else
			if( inpress_type == NEW_MOTOR_INPRESS)
				step = inpress_tab2[now_position] - inpress_tab2[obj_position]; 	
	        else
			    step = inpress_tab[now_position] - inpress_tab[obj_position]; 		
		#endif

		temp = fabsm(step);	
		de_bug.fun_ID = temp;
		#if 0//UART1_DEBUG_OUTPUT_MODE
		uart1_send_char('(');	
		uart1_send_char( temp/100+'0');
		uart1_send_char((temp%100)/10+'0');
		uart1_send_char( temp%10 +'0');
		uart1_send_char(')');
		#endif
		//1.1.2 发给步进电机动作指令 根据动作距离决定动作的时间， 步进时间单位是 8ms 整数倍
		if(temp <= 3)                     // only move 0.1mm
		{	    
			movestep_zx(step,8);             
	        delay_ms(10);
	    }
	    else if((temp > 3) && (temp < 20))     // move more than 0.1mm
		{	    
			movestep_zx(step,16);             
	        delay_ms(18);
	    } 
	    else if((temp >= 20) && (temp < 40))   // move more than 1.0mm
		{	    
			movestep_zx(step,24);             
	        delay_ms(24);
	    }  	
	    else if((temp >= 40) && (temp < 60))   // move more than 2.0mm
		{	
			#if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800   
			movestep_zx(step,63);             
	        delay_ms(65);
			#else
			movestep_zx(step,32);             
	        delay_ms(34);
			#endif
	    }   
	 	#if FOLLOW_INPRESS_FUN_ENABLE
		else
		{
			movestep_zx(step,63);             
		    delay_ms(63);
		}
		#else			
	    else if((temp >= 60) && (temp < 100))  // move more than 3.5mm
		{	    
			movestep_zx(step,96);             
	        delay_ms(100);
	    }  
	    else if((temp >= 100) && (temp < 150))  // move more than 3.5mm
		{	    
			movestep_zx(step,128);             
	        delay_ms(130);
	    } 			
		else                 // move origin 7.0 --- 0.0mm
		{	    
			movestep_zx(step,148); 
			delay_ms(158); //198
		} 
		#endif
		inpress_position = obj_position;           
	} 	
	//1.2 中压脚动作完成后，确认辅助压框的位置，如果中压脚抬起，辅助压框也自动抬起
	if( inpress_position >= IN_ORIGIN )
	{
		   #if SECOND_GENERATION_PLATFORM || CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037_800
		   L_AIR = 0;
		   #else
		   FA = 0;
		   #endif		   
		   inpress_flag = 1;  
	}		
}

/**
  * @函数功能 运行过程中，中压脚动作函数
  * @参数   a----下降到指定位置
  * @返回值 无
  @受影响的全局变量 
  *     @inpress_position  记录中压脚的当前位置
  * 与inpress_to区别就是发完指令不延时，所以动作时主轴要降速
  */
void inpress_to_forsingle(INT16 a)
{
	INT16 step;
	UINT16 temp;
	INT16 now_position;
	INT16 obj_position;
	if( inpress_type == AIR_INPRESS)
	    return;
	//--------------------------------------------------------------------------------------
  	//  inpresser up or down 
  	//--------------------------------------------------------------------------------------  
	now_position = inpress_position;
	obj_position = a;
	inpress_real_delta_runing = now_position - obj_position;
	if(obj_position != now_position)
	{		
		#if FOLLOW_INPRESS_FUN_ENABLE
			step = inpress_tab2[now_position] - inpress_tab2[obj_position]; 
		#else
			if( inpress_type == NEW_MOTOR_INPRESS)
				step = inpress_tab2[now_position] - inpress_tab2[obj_position]; 	
			else
		    	step = inpress_tab[now_position] - inpress_tab[obj_position];
		#endif	
		temp = fabsm(step);	
		//-----------------------------------------------------------------------	
    	// move and set time
    	//-----------------------------------------------------------------------			
    	if(temp < 20)                     	   // move Δ from 0.1mm to 0.8mm
		{	    
			movestep_zx(step,8);//cost 8ms
    	} 
    	else if((temp >= 20) && (temp < 40))   // move Δ from 0.9mm to 2.0mm
		{	    
			movestep_zx(step,16);//cost 16ms
	    }  	
	    else if((temp >= 40) && (temp < 60))   // move Δ from 2.1mm to 3.5mm
		{	    
			movestep_zx(step,24);//cost 24ms
	    }     			
	    else if((temp >= 60) && (temp < 80))  // move Δ from 3.6mm to 4.7mm
		{	    
			movestep_zx(step,40);//cost 40ms 
	    } 
	    else if((temp >= 80) && (temp < 99))  // move Δ from 4.8mm to 5.8mm
		{	    
			movestep_zx(step,48);//cost 48ms 
	    }
	    else if((temp >= 99) && (temp <= 120))  // move Δ from 5.9mm to 7.0mm
		{	    
			movestep_zx(step,56);//cost 56ms 
	    }
	    else
		{
			movestep_zx(step,64);
		}
    	//--------------------------------------------------------------------------------------
    	//  save inpresser position 
    	//--------------------------------------------------------------------------------------    
	    inpress_position = obj_position;            // inpresser position
	} 			
}

/**
  * @函数功能 查找停车位 函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @u42  机针停止位置 *0-上位置 1-上死点
  *     @k61  主轴电机停车角度 *53
  */
void find_dead_center(void)
{	 
	UINT8 temp8;	
	INT16 temp16;	
	//1.0 首先确认主轴电机已经停稳了
	while(motor.stop_flag == 0)    
  	{
    	rec_com(); 
  	}
	//1.1 分两种情况考虑停车处理 u42=0表示停在上位置 u42=1表示停在上死点
	if(u42 == 0)     	
  	{	
	   //1.1.1 停在上位置的处理 判定电机转向 如果当前停在180度范围之内，则电机反转提针；否则电机正转继续运行
	   temp16 = motor.angle_adjusted;		
       if( (temp16 > k61)&&(temp16 < DEGREE_180) )
	   {
		   	motor.dir = 1;
	   }
	   else
	   {
	        motor.dir = 0;
	   }
	   //1.1.2 给定电机转速，主轴电机开始按指定的方向进行旋转,并等待转速到达给定值稳定下来	
	   motor.spd_obj = 120;
		while(1)
    	{
    		rec_com(); 
	    	if(motor.spd_ref == motor.spd_obj)
	    	{
		    	break;
	    	}
    	}
		//1.1.3 给出停车角度和停车指令  角度由k61参数指定 这里是按编码器的线数给定
		motor.stop_angle = k61;
		if(motor.stop_angle >= 1024)
		{
			motor.stop_angle = motor.stop_angle - 1024;
		}
		motor.spd_obj = 0;  
		//1.1.4 等待主轴电机停稳
	    while(motor.stop_flag == 0)    
	    {
	    	rec_com(); 
	    } 
	}
	else //停到上死点的处理
	{
	   //1.2.1 根据当前角度是否在180度之内，决定电机的转向 
	   temp16 = motor.angle_adjusted;		
       if( (temp16 > DEADPOINT)&&(temp16 < DEGREE_180) )
		   	motor.dir = 1;
	   else
	        motor.dir = 0;
	   //1.2.2 	给定电机转速，主轴电机开始按指定的方向进行旋转,并等待转速到达给定值稳定下来	
	    motor.spd_obj = 120;	
	    while(1)
	    {
	    	rec_com(); 
		   	if(motor.spd_ref == motor.spd_obj)
		   	{
		    	break;
		   	}
	    }
		//1.2.3 给出停车角度和停车指令  角度固定不受参数控制
	    motor.stop_angle = DEADPOINT;
		if(motor.stop_angle >= 1024)
		{
			motor.stop_angle = motor.stop_angle - 1024;
		}          	  
	    motor.spd_obj = 0;  
		//1.2.4 等待主轴电机停稳
	    while(motor.stop_flag == 0)    
	    {
	    	rec_com(); 
	    }	
	}
	delay_ms(20);
}

/**
  * @函数功能 停到上死点 函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @u42  机针停止位置 *0-上位置 1-上死点
  *     @k61  主轴电机停车角度 *53
  */
void find_dead_point(void)
{	 
	UINT8 temp8;	
	INT16 temp16;	
	//1.0 确认主轴电机之前已经停稳
	while(motor.stop_flag == 0)    
  	{
    	rec_com();
  	}
	//1.1 确认电机的停车位置有偏移，为了兼容开环找零位时，不多转一圈，如果在零位就不动作了。
	temp8 = detect_position();
	if(temp8 == OUT)
	{	
	   //同find_dead_center函数 停在上死点的流程
	   temp16 = motor.angle_adjusted;		
       if( (temp16 > DEADPOINT)&&(temp16 < DEGREE_180) )
		   	motor.dir = 1;
	   else
	        motor.dir = 0;
	    motor.spd_obj = 120;	
	    while(1)
	    {
	    	rec_com(); 
		   	if(motor.spd_ref == motor.spd_obj)
		   	{
		    	break;
		   	}
	    }
	    motor.stop_angle = DEADPOINT;
		if(motor.stop_angle >= 1024)
		{
			motor.stop_angle = motor.stop_angle - 1024;
		}          	  
	    motor.spd_obj = 0;  
	    while(motor.stop_flag == 0)    
	    {
	    	rec_com(); 
	    }	
	  	delay_ms(20);    
	}
}

/**
  * @函数功能 停到上位置 函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @u42  机针停止位置 *0-上位置 1-上死点
  *     @k61  主轴电机停车角度 *53
  */
void find_up_position(void)
{	 
	UINT8 temp8;	
	INT16 temp16;	
	//同find_dead_center停在上位置的处理流程
	while(motor.stop_flag == 0)    
  	{
    	rec_com();
  	}
	temp8 = detect_position();
	if(temp8 == OUT)
	{	
	   temp16 = motor.angle_adjusted;		
       if( (temp16 > k61)&&(temp16 < DEGREE_180) )
		   	motor.dir = 1;
	   else
	        motor.dir = 0;
	    motor.spd_obj = 120;	
		while(1)
    	{
    		rec_com(); 
	    	if(motor.spd_ref == motor.spd_obj)
	    	{
		    	break;
	    	}
    	}
		motor.stop_angle = k61;
		if(motor.stop_angle >= 1024)
		{
			motor.stop_angle = motor.stop_angle - 1024;
		}
		motor.spd_obj = 0;  
	    while(motor.stop_flag == 0)    
	    {
	    	rec_com(); 
	    } 
  		delay_ms(20);
	}
}

/**
  * @函数功能 停到上死点 函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @u42  机针停止位置 *0-上位置 1-上死点
  *     @k61  主轴电机停车角度 *53
  */
void find_zero(void)
{
	UINT8 temp8;	
	INT16 temp16;	
	//同 find_dead_point 处理一致
	while(motor.stop_flag == 0)    
  	{
    	rec_com();             				
  	}
	
	temp8 = detect_position();
	if(temp8 == OUT)
	{	
		temp16 = motor.angle_adjusted;		
	    if( (temp16 > DEADPOINT)&&(temp16 < DEGREE_180) )
			   	motor.dir = 1;
		else
		        motor.dir = 0;
		motor.spd_obj = 120;	
		while(1)
		{
		    	rec_com(); 
			   	if(motor.spd_ref == motor.spd_obj)
			   	{
			    	break;
			   	}
		}
		motor.stop_angle = DEADPOINT;
		if(motor.stop_angle >= 1024)
		{
			motor.stop_angle = motor.stop_angle - 1024;
		}          	  
		motor.spd_obj = 0;  
	    while(motor.stop_flag == 0)    
	    {
		    rec_com(); 
	    }
	}
  	delay_ms(20);	
	
}

/**
  * @函数功能 移框到缝制起缝点 函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @x_bios  起缝点X轴偏移位置
  *     @y_bios  起缝点Y轴偏移位置
  *     @sta_point 花样起缝点指针
  */
void go_startpoint(void)
{
	UINT8 FirstNopmoveFlag;
	PATTERN_DATA *TempPatpoint;
	
	origin2_lastmove_flag = 0;
	nopmove_flag = 0;
	move_flag = 0;
	end_flag = 0;		
	pat_point = (PATTERN_DATA *)(pat_buf);
	pat_buff_total_counter = 0; 
	FirstNopmoveFlag = 1;
	
	//1.0 读取当前花样数据并分析
	process_data();
	//2.0 如果当前花样数据是空送码的处理
	if(nopmove_flag == 1)
    {	  
		end_flag = 0;
		//2.1 如果是空送代码，则一直向后遍历处理花样数据，
		while(nopmove_flag == 1 || PatternDelayFlag == 1)
		{
			do_pat_point_sub_one();
			if(PatternDelayFlag == 1)
			{
				PatternDelayFlag = 0;				
			}
			else
			{
    	  		//2.1.1 直接走完这一段空送 遇到空送结束或其它功能码退出
				go_beginpoint(0); 
				FirstNopmoveFlag = 0;
			}
			//2.1.2 如果空送过程中超出缝制范围，则不再处理后续代码
			if(OutOfRange_flag == 1)
			{
				break;
			}
			//2.1.3 判定下一针是否还是空送，这样是为了处理分段空送考虑 
			process_data();
			if(nopmove_flag == 1)
			{
				delay_ms(QUICKMOVETIME);//多段空送之间的延时，类似“顶点延时”
			}
			else if(origin2_lastmove_flag == 1 || stop_flag == 1 || RotateFlag == 1 || move_flag == 1)
			{
				do_pat_point_sub_one();//其它功能码，则恢复花样指针并退出
				break;
			}
			else if(PatternDelayFlag == 1)//花样延时码的处理
			{
				delay_ms(PattenrDelayTime);
				PatternDelayFlag = 0;
				process_data();
			}
			else if(end_flag == 1)//如果直接空送+结束码
			{
				do_pat_point_sub_one();
				end_flag = 0;
				break;
			}
			else if ( (milling_cutter_action_flag ==1)&&(rotated_cutter_enable ==1))//空送里遇到旋转切刀启动命令
			{
				do_pat_point_sub_one();
				break;
			}
			#if ENABLE_LOOPER_CUTTER
			else if ( (milling_cutter_action_flag ==1)&&(stepper_cutter_enable==1) )
			{
				do_pat_point_sub_one();
				break;
			}
			#endif
			else //其它功能码的处理
			{
				while(1)//只到找到一个可识别的代码再退出
				{
					process_data();
					if(nopmove_flag == 1 || move_flag == 1 || origin2_lastmove_flag == 1 || stop_flag == 1 || RotateFlag == 1 || end_flag == 1 || PatternDelayFlag == 1)
					{
						if(nopmove_flag == 0)
						   do_pat_point_sub_one();
						break;
					}
				}
				if(move_flag == 1 || origin2_lastmove_flag == 1 || stop_flag == 1 || RotateFlag == 1 || end_flag == 1)
				{
					break;
				}
				else if(PatternDelayFlag == 1)
				{
					delay_ms(PattenrDelayTime);
					PatternDelayFlag = 0;
					process_data();
				}
			}
			//考虑其它代码处理过程遇到结束的情况
			if(end_flag == 1)
			{
				do_pat_point_sub_one();
				end_flag = 0;
				break;
			}
		}
	}
	else //2.2 非空送码的处理
	{
		FirstNopmoveFlag = 0;
		go_commandpoint(x_bios,y_bios);//没有空送，则直接到起缝点偏移位置，如果没有则停在（0,0）点
		do_pat_point_sub_one();
	}
	//3.0 当前花样没有发现第二原点的处理	 
	if(origin2_lastmove_flag == 0)
	{
		//3.0.1 记录当前指针作为起缝点指针
		TempPatpoint = pat_point;
		sta_point = pat_point;  	
		//3.0.2 根据下一针是否为车缝，来设定试缝针数			
		process_data();
		if(move_flag == 1)
		{
			SewTestStitchCounter = 1;
			move_flag = 0;
		}
		else if(end_flag == 1)
		{
			SewTestStitchCounter = 0;
			end_flag = 0;
		}
		pat_point = TempPatpoint;	
	}
	else if(origin2_lastmove_flag == 1)//3.1 当前花样是第二原点
	{
		sta_point = pat_point;
		SewTestStitchCounter = 0;
	}
}

/**
  * @函数功能 移框到缝制起缝点 函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @x_bios  起缝点X轴偏移位置
  *     @y_bios  起缝点Y轴偏移位置
  *     @sta_point 花样起缝点指针
  */
void stapoint_calc(void)
{
	UINT8 FirstNopmoveFlag;
	PATTERN_DATA *TempPatpoint;
	
	origin2_lastmove_flag = 0;
	lastmove_flag = 0;	
	nopmove_flag = 0;
	move_flag = 0;
	end_flag = 0;
	//1.0 花样指针调整到缓冲区开始位置	
	pat_point = (PATTERN_DATA *)(pat_buf);
    //2.0 扫描花样，调整花样指针到正确的起针点位置
	process_data();
	
	if(nopmove_flag == 1 || PatternDelayFlag == 1)
    {	  
		while(1)
  	    {				
  			process_data();           
    		if(origin2_lastmove_flag == 1 || stop_flag == 1 || RotateFlag == 1 || move_flag == 1)
    		{
    		  do_pat_point_sub_one();    	    	
    	 	  break;   	
    	    }	                                     	        
  	    }   	    
	}
	else
	{
		do_pat_point_sub_one();
	}
	//3.0 记录正确的起缝点指针
	sta_point = pat_point; 
}


const UINT16 X2_tab[]=
{
//   0    1    2    3    4    5    6    7    8    9  
	 0,   1,   4,   9,  16,  25,  36,  49,  64,  81,
//  10   11   12   13   14   15   16   17   18   19  
	100, 121, 144, 169, 196, 225, 256, 289, 324, 361,
//  20   21   22   23   24   25   26   27   28   29  
	400, 441, 484, 529, 576, 625, 676, 729, 784, 841,
//  30   31   32   33   34   35   36   37   38   39  
	900, 961, 1024,1089,1156,1225,1296,1369,1444,1521,
//  40   41   42   43   44   45   46   47   48   49  
	1600,1681,1764,1849,1936,2025,2116,2209,2304,2401,
//  50   51   52   53   54   55   56   57   58   59  
	2500,2601,2704,2809,2916,3025,3136,3249,3364,3481,
//  60   61   62   63   64   65   66   67   68   69  
	3600,3721,3844,3969,4096,4225,4356,4489,4624,4761,
//  70   71   72   73   74   75   76   77   78   79  
	4900,5041,5184,5329,5476,5625,5776,5929,6084,6241,
//  80   81   82   83   84   85   86   87   88   89  
	6400,6561,6724,6889,7056,7225,7396,7569,7744,7921,
//  90   91   92   93   94   95   96   97   98   99  
	8100,8281,8464,8649,8836,9025,9216,9409,9604,9801,
// 100   101   102   103   104   105   106   107   108   109  
   10000,10201,10404,10609,10816,11025,11236,11449,11664,11881,
// 110   111   112   113   114   115   116   117   118   119  
   12100,12321,12544,12769,12996,13225,13456,13689,13924,14161,
// 120   121   122   123   124   125   126   127   128  129
   14400,14641,14884,15129,15376,15625,15876,16129,16384,16641,
// 130   131   132   133   134   135   136   137   138  139      
   16900,17161,17424,17689,17956,18225,18496,18769,19044,19321,
// 140   141   142   143   144   145   146   147   148  149     
   19600,19881,20164,20449,20736,21025,21316,21609,21904,22201,
// 150   151   152   153   154   155   156   157   158  159     
   22500,22801,23104,23409,23716,24025,24336,24649,24964,25281,
// 160   161   162   163   164   165   166   167   168  169   
   25600,25921,26244,26569,26896,27225,27556,27889,28224,28561,
// 170   171   172   173   174   175   176   177   178  179
   28900,29241,29584,29929,30276,30625,30976,31329,31684,32041,
// 180   181   182   183   184   185   186   187   188  189   
   32400,32761,33124,33489,33856,34225,34596,34969,35344,35721,
// 190   191   192   193   194   195   196   197   198  199   
   36100,36481,36864,37249,37636,38025,38416,38809,39204,39601,
// 200   201   202   203   204   205   206   207   208   209 
   40000,40401,40804,41209,41616,42025,42436,42849,43264,43681,
// 210   211   212   213   214   215   216   217   218   219    
   44100,44521,44944,45369,45796,46225,46656,47089,47524,47961,
// 220   221   222   223   224   225   226   227   228   229      
   48400,48841,49284,49729,50176,50625,51076,51529,51984,52441,
// 230   231   232   233   234   235   236   237   238   239      
   52900,53361,53824,54289,54756,55225,55696,56169,56644,57121,
// 240   241   242   243   244   245   246   247   248   249      
   57600,58081,58564,59049,59536,60025,60516,61009,61504,62001,
// 250   251   252   253   254   255    
   62500,63001,63504,64009,64516,65025
};

#if FOLLOW_INPRESS_FUN_ENABLE
void calculate_inpress_angle(INT16 speed)
{	
	INT16 temp_speed;
	if( inpress_follow_range_pc == 0)//k173，中压脚随动高度，操作头下发
	{
		if( inpress_follow_mode == 5 )//模式5.随动范围是13，否则为8
		    inpress_follow_range = 13;
		else	
			inpress_follow_range = INPRESS_DELTA_RANGE;
	}
	else
		inpress_follow_range = inpress_follow_range_pc;
	
	//如果启动了前几针改变中压脚上升高度的功能，且当前针数属于指定的针数内，那么使用指定的随动范围
	//在run_status()里面缝制前修改inpress_follow_range是没有用的，因为缝制中会不断调用此函数将其更新
	if(para.start_sew_change_inpress_high_enable==55
		&&stitch_counter<=para.start_sew_change_inpress_high_stitchs
		&& stitch_counter < 20
		/*&&para.start_sew_change_inpress_high_range<=inpress_follow_range*/)
	{
		//如果启用此功能，并且各个参数合适，且属于指定的缝制前几针，此时赋值
		inpress_follow_range = para.start_sew_change_inpress_high_range;
	}
	
	temp_speed = speed / 100;
	if( temp_speed > 30)
	    temp_speed = 30;
	if( inpress_follow_mode == 0 )
	{
		inpress_follow_down_angle = inpress_follow_down_angle_tab2[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab2[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab2[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab2[temp_speed];
		
	}	
	else if( inpress_follow_mode == 1 )
	{
	    inpress_follow_down_angle = inpress_follow_down_angle_tab3[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab3[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab3[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab3[temp_speed];
	}
	else if( inpress_follow_mode == 2 )
	{
		inpress_follow_down_angle = inpress_follow_down_angle_tab4[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab4[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab4[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab4[temp_speed];
	}
	else if( inpress_follow_mode == 3 )
	{
	    inpress_follow_down_angle = inpress_follow_down_angle_tab[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab[temp_speed];
	}
	else if( inpress_follow_mode == 4 )
	{
	    inpress_follow_down_angle = inpress_follow_down_angle_tab5[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab5[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab5[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab5[temp_speed];
	}
	else if( inpress_follow_mode == 5 )
	{
	    inpress_follow_down_angle = inpress_follow_down_angle_tab6[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab6[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab6[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab6[temp_speed];
	}
	else if( inpress_follow_mode == 6 )
	{
	    inpress_follow_down_angle = inpress_follow_down_angle_tab8[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab8[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab8[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab8[temp_speed];
		inpress_follow_range = 3;
	}
	else
	{
	    inpress_follow_down_angle = inpress_follow_down_angle_tab7[temp_speed];
		inpress_follow_down_speed = inpress_follow_down_speed_tab7[temp_speed];
		inpress_follow_up_angle   = inpress_follow_up_angle_tab7[temp_speed];
		inpress_follow_up_speed   = inpress_follow_up_speed_tab7[temp_speed];
	}

	if( temp_speed == MotorSpeedRigister)
	{
			if( inpress_follow_down_angle_pc != 0) 
	        	inpress_follow_down_angle = inpress_follow_down_angle_pc;
			if( inpress_follow_down_speed_pc !=0 )	
				inpress_follow_down_speed = inpress_follow_down_speed_pc;
			if( inpress_follow_up_angle_pc != 0)
				inpress_follow_up_angle   = inpress_follow_up_angle_pc;
			if( inpress_follow_up_speed_pc != 0)
				inpress_follow_up_speed   = inpress_follow_up_speed_pc;
	}
}	
#endif


/**
  * @函数功能 缝制转速计算函数
  * @参数   无
  * @返回值 无
  @受影响的全局变量 
  *     @x_bios  起缝点X轴偏移位置
  *     @y_bios  起缝点Y轴偏移位置
  *     @sta_point 花样起缝点指针
  */
void check_data(UINT8 control_flag)
{
	UINT16 i,k;
	static UINT8 Dec_Counter;
	INT16 x_temp,y_temp;
	INT16 inpress_temp_delta;
	INT16 inpress_temp_new;
	INT16 inpress_temp_old;
	INT16 inpress_temp_change;
	UINT8 temp8;
	UINT8 max8,m;
	UINT16 temp16;
	UINT16 max16;
	UINT16 length,setup_speed;
	INT16 temp_speed,inpress_tmp_speed;
	INT16 speed_margin;
	INT8 length_margin;
	INT16 temp_speed_xy;
	INT16 temp_speed_inpress;
	UINT8 temp_timer;   
	UINT8 c_flag,d_flag,d_stitchs;
	UINT32 tmp1,tmp2;
	c_flag = 0;
	x_temp = 0;
	y_temp = 0;
	temp16 = 0;
	max16 = 0;
	inpress_temp_delta = 0;
	inpress_temp_new = 0;
	inpress_temp_old = inpress_high;
	inpress_temp_change = 0;
	temp8 = 0;
	max8 = 0;
	slow_flag = 0;
	d_flag = 0;
	//1.0 扫描从当前花样指针开始的后5针花样数据，确认最大的针距 以及 中压脚动作变化距离 还有 要降速的特殊功能码
	for(i=0;i<5;i++)  
	{
	    switch((pat_point+i)->func & 0xFF)
	    {
	        	case 0xC0: 
	    		switch((pat_point+i)->xstep)
	          	{	
	    	        case 0x01: //结束码  要提前降速
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
	    	        case 0x03: //中途停止码 提前降速
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
	    	        case 0x04://剪线码 提前降速
						if( (slow_flag == 0) ||(sewingcontrol_tail_flag >=1) )
						{
							slow_flag = 1; 
							Dec_Counter = i;
							c_flag = 1;
							d_flag = 0;
						   
						} 
						break;
				    case 0x05:                   
				    case 0x0b://伸缩、翻转压脚码 提前降速
						if( (slow_flag == 0)&&(k110 != 0))
						{
							slow_flag = 1;
							Dec_Counter = i;
						} 
					    break;
					case 0x09://花样延时码 提前降速
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						} 
						break;
					case 0x1B://缝纫机停止 提前降速
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;	
					case 0x13://拐角降速
						d_flag = 1;				//拐角降速标志
						Dec_Counter = i;
						d_stitchs = (pat_point+i)->ystep;	//拐角降速针数
						/*
						  如果过了降速点，再遇到拐角就还得处理
						*/
						if( start_to_speed_down == 1 )
						{
							if( speed_down_stitchs <= 3)//4
							{
								start_to_speed_down = 0;
							}
						}
					break;
	    	        default:   
						break;
				}
	    		break;
			case 0xC3:
				switch((pat_point+i)->xstep)
	          	{
					case 0x03: 
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:   
						break;
				}
				break;
			case 0xC4:
				switch((pat_point+i)->xstep)
	          	{
					case 0x03: 
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					case 0x1B:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:   
						break;
				}
				break;
			case 0xC7:
				switch((pat_point+i)->xstep)
	          	{
					case 0x03: 
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:   
						break;
				}
				break;
			case 0xC8:
				switch((pat_point+i)->xstep)
	          	{
					case 0x03: 
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:   
						break;
				}
				break;
			case 0xCB:
				switch((pat_point+i)->xstep)
	          	{
					case 0x03: 
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					case 0x1B:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:   
						break;
				}
				break;
	    	case 0x80:
				switch((pat_point+i)->xstep) 
				{
					case 0x03:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					case 0x04://cut
						if( (slow_flag == 0) ||(sewingcontrol_tail_flag >=1) )
						{
							slow_flag = 1; 
							Dec_Counter = i;
							c_flag = 1;
							d_flag = 0;
							
						} 
						break;
					case 0x05:                   
				    case 0x0b:
						if( (slow_flag == 0)&&(k110 != 0))
						{
							slow_flag = 1;
							Dec_Counter = i;
						} 
					    break;

					case 0x07:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
		
					case 0x09:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						} 
						break;
					case 0x1B:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					case 0x13:
						d_flag = 1;
						Dec_Counter = i;
						d_stitchs = (pat_point+i)->ystep;
						/*
						  如果过了降速点，再遇到拐角就还得处理
						*/
						if( start_to_speed_down == 1 )
						{
							if( speed_down_stitchs <= 3)//4
							{
								start_to_speed_down = 0;
							}
						}
					break;
					case 0x14:
						SewingSpeedFlag = 1;
						if(i == 0)
						{
							if(pat_point->ystep == 0)
							{
								SewingSpeedValue = MAXSPEED0;
							}
							else
							{
								SewingSpeedValue = pat_point->ystep;
								if(SewingSpeedValue > MAXSPEED0)
								{
									SewingSpeedValue = MAXSPEED0;
								}
							} 
						}
						break;
					case 0x15:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:
						break;
				}
				break; 
			case 0x83:
				switch((pat_point+i)->xstep) 
				{
					case 0x03:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:
						break;
				}
				break;
			case 0x84:
				switch((pat_point+i)->xstep) 
				{
					case 0x03:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					case 0x1B:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:
						break;
				}
				break;
			case 0x87:
				switch((pat_point+i)->xstep) 
				{
					case 0x03:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:
						break;
				}
				break;
			case 0x88:
				switch((pat_point+i)->xstep) 
				{
					case 0x03:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					case 0x1B:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:
						break;
				}
				break; 
			case 0x8B:
				switch((pat_point+i)->xstep) 
				{
					case 0x03:
						if(slow_flag == 0) 
						{
							slow_flag = 1; 
							Dec_Counter = i;
						}
						break;
					default:
						break;
				}
				break;   					
	    	default:   
				break;
	    }
	    switch((pat_point+i)->func & 0xF0)
    	{
     		case 0xC0:
    		case 0x80:
    			switch((pat_point+i)->xstep) //中压脚高度值遍历
				{
    				case 0x1A:// 80 1A high ，中压脚高度调整功能码？
    					inpress_temp_delta = ((INT16)((pat_point+i)->ystep))*4;//y位移存着中压脚高度的高8位
    					switch((pat_point+i)->func & 0x0F)//功能码的低2位存着中压脚高度的低2位
    					{
							case 0x00: break;
							case 0x01: inpress_temp_delta = inpress_temp_delta + 1;  break;
							case 0x02: inpress_temp_delta = inpress_temp_delta + 2;  break;
							case 0x03: inpress_temp_delta = inpress_temp_delta + 3;  break;
							default:   break;
	    				}
						//代码中的是中压脚高度相对值，再加上中压脚基准高度，就是中压脚高度绝对值
	    				inpress_temp_new = inpress_high_hole + inpress_temp_delta;
	    				if(inpress_temp_new > 70)
							inpress_temp_new = 70;
						if(inpress_temp_new < 0)
							inpress_temp_new = 0;
						//记录下相邻两次中压脚高度变化，取相邻几针的最大值	
	    				inpress_temp_change = inpress_temp_new - inpress_temp_old;
	    				inpress_temp_old = inpress_temp_new;
	    				break;
					case 0x13://拐角降速
						d_flag = 1;
						Dec_Counter = i;
						d_stitchs = (pat_point+i)->ystep;
					break;
	    			default:
	    				break;
				}
				break;
    		//-----------------------------------------------------------------------	
	      	// only move stepper motor 
	      	//-----------------------------------------------------------------------		   		
	    	case 0x50: 
	    	case 0x00:			
	      	case 0x10: 
				break;         	              							
	    	//-----------------------------------------------------------------------	
	      	// normal stitch
	      	//-----------------------------------------------------------------------		   		  	  			
	      	case 0x20: 
	      	case 0x30: 
	     	case 0x60: 
	    	case 0x70: 
    		    x_temp = ((INT16)((pat_point+i)->xstep))*2; 
                y_temp = ((INT16)((pat_point+i)->ystep))*2; 
      	        switch((pat_point+i)->func & 0x0F) 
                {	
    	            case 0x00: break;
    	            case 0x08: x_temp = x_temp+1; break;
    	            case 0x02: y_temp = y_temp+1; break;
    	            case 0x0A: x_temp = x_temp+1; y_temp = y_temp+1; break;
    	            default:   break;
                }
    		    break;    					
    	    //-----------------------------------------------------------------------	
      		// default
      		//-----------------------------------------------------------------------		   		  	  				
    		default:   
				break;
    	}
		//平常所说的针长是指线迹缝制效果，有可能3mm针长线迹分解成不同长度的X、Y位移，花样数据格式里是以（X,Y)相对位移来表示的
		//所以这里要根据XY位移算出正确的针长
		if ( x_temp >= 0)
			  temp16 = X2_tab[x_temp];
		else
			  temp16 = X2_tab[-x_temp];
		if ( y_temp >= 0)
			  temp16 += X2_tab[y_temp];
		else
			  temp16 += X2_tab[-y_temp];
			 
		 for(k=0;k<256;k++)//Z^2=>z (Z^2<127^2)
		 {
				 if( temp16 <= X2_tab[k])
				   break;
		 } 
		 //计算平方根，确认连续几针的最大值
		 temp16 = k;
		 if(temp16 > max16)
		 {
		      	max16 = temp16;	
		 }
		 //确认中压脚升降变化量的最大值
       	temp8 = fabsm((INT8)inpress_temp_change);
    	if(temp8 > max8)
    	{
      		max8 = temp8;	
    	}	 
		//有降速则直接退出  
    	if(slow_flag == 1)  
    	{
    		break;
    	}
   
  	}
 	if( (d_flag == 1)&&(c_flag == 0) )//遇到拐点降速 不是 剪线降速
	{
    	if( start_to_speed_down == 0 )//先看是否已经启动了拐角降速
		{
		    setup_speed = (UINT16)Corner_deceleration_speed*100; 
			
			if( ( d_stitchs != 0)&&(motor.spd_obj > setup_speed) )//针数没有设置错误						 
			 {		   
						   start_to_speed_down = 1;
						   speed_down_counter = 0;
						   speed_margin =  motor.spd_obj - setup_speed;//转速差
						   speed_down_stitchs = 9;
						   
						   //目前是提前5针扫描花样,所以最早找到降速码时一定是第5针(i=4)
						   //要看一下拐点降速的针数 和 当前的位置 来决定后面的共计9针的速度变化
						   //用0表示转速不变,1表示低一档,2表示降两档,类推.
						  
						   //0 1 2 3 4 5 6 7 8
						   //0 0 0 0 1 0 0 0 0  1针降速
						   //0 0 0 1 2 1 0 0 0  2针降速
						   //0 0 1 2 3 2 1 0 0  3针降速
						   //0 1 2 3 4 3 2 1 0  4针降速
						   //1 2 3 4 5 4 3 2 1  5针降速
						   for( k=0;k<10;k++)
						       ratio_array [k] = motor.spd_obj;	//默认维持原速	
							   
						  ratio_array[4] = setup_speed;//默认中间一针降到设定转速
						  
						  switch(d_stitchs)//看拐点要降几针
						  {
							  case 1:							  		
							  break;
							  case 2://2针降速
							  		speed_margin = speed_margin/2;
									ratio_array[3] = motor.spd_obj - speed_margin;
									ratio_array[5] = ratio_array[3];//setup_speed + speed_margin ;
							  break;
							  case 3://3针降速	
							  		speed_margin = speed_margin/3;						   		
									ratio_array[2] = motor.spd_obj - speed_margin; 
									ratio_array[3] = motor.spd_obj - 2*speed_margin;
									ratio_array[5] = ratio_array[3];//setup_speed + speed_margin ;
									ratio_array[6] = ratio_array[2];//setup_speed + 2*speed_margin ;							
							  break;
							  case 4://4针降速
							  		speed_margin = speed_margin/4;	
							  		ratio_array[1] = motor.spd_obj - speed_margin;
							     	ratio_array[2] = motor.spd_obj - 2*speed_margin;
									ratio_array[3] = motor.spd_obj - 3*speed_margin;
																	
									ratio_array[5] = ratio_array[3];//setup_speed + speed_margin ;
									ratio_array[6] = ratio_array[2];//setup_speed + 2*speed_margin ;
									ratio_array[7] = ratio_array[1];//setup_speed + 3*speed_margin ;
							  break;
							  case 5://5针降速
							  		speed_margin = speed_margin/5;	
									
							  		ratio_array[0] = motor.spd_obj - speed_margin;
									ratio_array[1] = motor.spd_obj - 2*speed_margin;
							     	ratio_array[2] = motor.spd_obj - 3*speed_margin;
									ratio_array[3] = motor.spd_obj - 4*speed_margin;
																		
									ratio_array[5] = ratio_array[3];//setup_speed + speed_margin ;
									ratio_array[6] = ratio_array[2];//setup_speed + 2*speed_margin ;
									ratio_array[7] = ratio_array[1];//setup_speed + 3*speed_margin ;
									ratio_array[8] = ratio_array[0];//setup_speed + 4*speed_margin ;
							  break;
						  }//end switch
						
						#if ENABLE_CONFIG_PARA	  						 		 
						
						ratio_array[0] = (UINT16)para.Corner_deceleration_speed4*100;
						if( ratio_array[0] > motor.spd_obj)
							ratio_array[0] = motor.spd_obj;
						ratio_array[1] = (UINT16)para.Corner_deceleration_speed3*100;
						if( ratio_array[1] > motor.spd_obj)
							ratio_array[1] = motor.spd_obj;
						ratio_array[2] = (UINT16)para.Corner_deceleration_speed2*100;
						if( ratio_array[2] > motor.spd_obj)
							ratio_array[2] = motor.spd_obj;
						ratio_array[3] = (UINT16)para.Corner_deceleration_speed1*100;
						if( ratio_array[3] > motor.spd_obj)
							ratio_array[3] = motor.spd_obj;
						ratio_array[4] = (UINT16)Corner_deceleration_speed*100;
						ratio_array[5] = ratio_array[3];
						ratio_array[6] = ratio_array[2];
						ratio_array[7] = ratio_array[1];
						ratio_array[8] = ratio_array[0];							  
					
						#endif
			}//end if
		}
	}
	//花样当中设定了改变缝速的处理，默认情况花样中的设定转速 比 面板上设定转速 优先级要高一些。
	if(SewingSpeedValue >= 2 && SewingSpeedValue <= MAXSPEED0)
	{
		if(sew_speed >= 100*SewingSpeedValue)
		{
			sew_speed = 100*SewingSpeedValue;
		}
	} 
	 
  	//保存当前主轴转速  
  	last_speed = motor.spd_obj;     
    
	//按针长、机型 查表确认对应的工作设定转速 和 动作时间
	 if( max16 == 0) 
	 	 max16 = 1;
	 if( max16 > 255)
	 	 max16 = 255;			
	 HighSpeedStitchLength = max16;	
	 	
     if(k02 == 0)//1510
	 {     
		   temp_speed_xy = spdlimit1_tab[max16-1]; 
		   temp_timer = MoveTime1_Speed[temp_speed_xy/100];  
	 }
	 else 
	 {	  
		   if(ZJ_8060 == 1)
		   {
		   		temp_speed_xy = spdlimit2_tab_8060[max16-1]; 
		   }
		   else
		   {
				temp_speed_xy = spdlimit2_tab_N8060[max16-1]; 
		   }
		   temp_timer = MoveTime2_Speed[temp_speed_xy/100]; 
	 }
	  before_down_speed = temp_speed_xy; //厚料算法用
	  
	 //根据参数限制最高工作转速范围
	  switch(u101)
	  {
			case 0:
				if (temp_speed_xy >= MAX_SPEED_LIMIT)
					temp_speed_xy = MAX_SPEED_LIMIT;
				break;
			case 1:
				if (temp_speed_xy >= 2200)
					temp_speed_xy = 2200;
				break;		
			case 2:
				if (temp_speed_xy >= 1800)
					temp_speed_xy = 1800;
				break;	
			case 3:
				if (temp_speed_xy >= 1400)
					temp_speed_xy = 1400;
				break;	
			default:
				break;
      }
    //根据中压脚高度，对缝制转速进行限定
  	if(max8 <= 8)
  		temp_speed_inpress = MAX_SPEED_LIMIT;
  	else if(max8 <= 20)
  		temp_speed_inpress = 2500;	
  	else if(max8 <= 34)
  		temp_speed_inpress = 1600;	
  	else if(max8 <= 47)
  		temp_speed_inpress = 1000;	
  	else if(max8 <= 58)
  		temp_speed_inpress = 800;	
  	else if(max8 <= 70)
  		temp_speed_inpress = 700;	

	if(temp_speed_xy >= temp_speed_inpress)
	  	temp_speed = temp_speed_inpress;
	else 
	  	temp_speed = temp_speed_xy;
		
    //物料厚度算法 调速工作转速
    if(k06 != 0)    
    {
	    /*
		  1mm对应5度；k07--厚度毫米值
		  默认情况：110度入布 250度出布
		  
		*/
		  if(k06 == 1)        //中厚料
		  {
		     temp16 = 166*(240 - 10*k07);   // 1mm corresponds 5 degree
			 temp_speed = temp16 / temp_timer;	  
		  }
		  else                //厚料
		  {
		     temp16 = 166*(210 - 10*k07);   // 1mm corresponds 5 degree
			 temp_speed = temp16 / temp_timer;	
		  }  
		  if(temp_speed > sew_speed)
		    temp_speed = sew_speed;	
    }
  //-----------------------------------------------------------------------	
  // speed increase or speed decrease
  //-----------------------------------------------------------------------  
  //转速变化的控制策略  
  //sew_speed ---面板或花样当中指定的转速
  //temp_speed---当前转速控制策略算出的，准备改变的速度
  if(sew_speed > temp_speed)      //面板（或花样指定的速度）要比规化速度大，因为有可能是极限速度，不能升速处理
  {
	  	if(last_speed > temp_speed)  //上一圈比规化要大，意味着要降速了。  
	  	{
	  		speed_margin = last_speed - temp_speed;
	  		if(speed_margin > 1200)//500
	  		{
	  			temp_speed = last_speed - 1200;//转速不能一下子降下去，每次降500rpm
	  		} 
	  	}
	  	else  //升速的处理也是单针不能超500rpm
	  	{
	  		speed_margin = temp_speed - last_speed;
	  		if(speed_margin > 1200)
	  		{
	  			temp_speed = last_speed + 1200;
	  		}
		}
  }
  else  //规化速度高，但面板设定的速度（或花样里设定的速度）比较小的情况，也是以规化速度为准，升降不超500rpm
  {
  	if(last_speed > sew_speed)
  	{
  		speed_margin = last_speed - sew_speed;
  		if(speed_margin > 1200)
  		{
  			temp_speed = last_speed - 1200;
  		}
  		else
  		{
  			temp_speed = sew_speed;
  		}
  	}
  	else                          
  	{
  		speed_margin = sew_speed - last_speed;
  		if(speed_margin > 1200)
  		{
  			temp_speed = last_speed + 1200;  			
  		}
  		else
  		{
  			temp_speed = sew_speed;
  		}
  	}
  } 
  
  
  if(slow_flag == 1)               //提前降速的处理
  {
	 //if( (c_flag == 1)&&(sewingcontrol_tail_flag >=1)&&(cutter_speed_done_flag == 0 )&&(Dec_Counter == 4) )//借用拐点降速算法，直接指定转速
	 if( (c_flag == 1)&&(sewingcontrol_tail_flag >=1)&&(cutter_speed_done_flag == 0 ) )//
	 {
					/*     
					[2700 -》2400-》2100-》last4-》last3-》last2-》last1-》k43 ]
					[1] 只要第七针发现需要尾部加固的情况就开始规化转速了。
					[2] 低于规化的转速那按当前速度继续进行
					*/
					test_flag = 41;
					cutter_speed_done_flag = 1;
					start_to_speed_down = 1;
					speed_down_counter  = 0;
					for( k=0;k<16;k++)
						 ratio_array [k] = motor.spd_obj;	
					//提前5针扫描到剪线+加固信号 ：5+3+3＝11针，按现在的算法，最后剪线走了两针
				    //降速设定  m取值   0   1   2   3   4   5   6   7    8   9   10  11  12  13  14  15
					//  1针     2      S   S   L4  L3  L2  L1  K43
					//  2针     4      S   S   S   S   L4  L3  L2  L1  K43
					//  3针     6      S   S   S   S   S   S   L4  L3  L2  L1  K43
					//  4针     8      S   S   S   S   S   S   S   S   L4  L3  L2  L1  K43
					//  加固退出时要空转一圈，再加上剪线时的一圈，实际上要多两圈
					switch( sewingcontrol_tail_flag )
					{
						case 1:
							  	m	= 3;//2;
							    speed_down_stitchs = 8;//7;
						break;
						case 2:
								m	= 5;//4;
							    speed_down_stitchs = 10;//9;
						break;
						case 3:
								m	= 7;//6;
							    speed_down_stitchs = 12;//11;
						break;
						case 4:
								m	= 9;//8;
							    speed_down_stitchs = 14;//13;
						break;
					}
						
					if( motor.spd_obj >= last1_speed * 100)
				  	    ratio_array[m] = last1_speed * 100;	
					m++;
					if( motor.spd_obj >= last2_speed * 100)
					    ratio_array[m] = last2_speed * 100;	
					m++;
					if( motor.spd_obj >= last3_speed * 100)
						ratio_array[m] = last3_speed * 100;	
					m++;
					for(;m<16;m++)
					{
					 if( motor.spd_obj >= last4_speed * 100)
					    ratio_array[m] = last4_speed * 100;
					}
					//m++;
					//for(;m<16;m++)
					//	ratio_array[m] =  10*k43;	
					for( k=3;k<16;k++)
					{
						if( ratio_array [k] >last1_speed * 100)
						    ratio_array [k] = last1_speed * 100;
					}
				
	 }
	 else
	 {		  
		  if( (c_flag == 1)&&(sewingcontrol_tail_flag ==0 ) )
		  {
			  start_to_speed_down = 0;
		  }
		  
		  switch(Dec_Counter)
		  {
				case 0:	  
					    if( motor.spd_obj >= k43*10)
						{
							temp_speed = k43*10;
					    }
						else
						{
						 	temp_speed = last_speed;
					 	}	     
						 break;
					
				case 1:                                    
						temp16 = last4_speed * 100;
						if(motor.spd_obj >= temp16)
						{
							temp_speed = temp16;  
						}
						else
						{
							temp_speed = last_speed;
						}
						break;
					
				case 2:     
						temp16 = last3_speed * 100; 
						if(motor.spd_obj >= temp16)
						{
							temp_speed = temp16;
						}
						else
						{
							temp_speed = last_speed;
						}
					break;
				case 3:       
						temp16 = last2_speed * 100; 
						if(motor.spd_obj >= temp16)
						{
							temp_speed = temp16;
						}
						else
						{
							temp_speed = last_speed;
						}
					break;	
				case 4:
						temp16 = last1_speed * 100;  
						if(motor.spd_obj >= temp16)
						{
							temp_speed = temp16;
						}
						else
						{
							temp_speed = last_speed;
						}
				break;
			   default: break;
	 	   }
	    }
   }
    /*
	   拐点降速的处理
	   有设定的具体降速值,用几针降到指定转速,然后再升速回去	   
	*/
   if( start_to_speed_down == 1 )
	{
		if( speed_down_stitchs >0)
		{
			if( control_flag == 1 )
				speed_down_stitchs--;
			temp_speed = (ratio_array[speed_down_counter] + 50)/100*100;		
			if( temp_speed < 200)
		   		temp_speed = 200;
			if( control_flag == 1 )
				speed_down_counter++;
			test_flag = 1;
		}
		else
		{
		    start_to_speed_down = 0;
			d_flag = 0;
		    test_flag = 21;
			temp_speed = (ratio_array[speed_down_counter] + 50)/100*100;
		}
	}
	
    /*
	  前5针的转速设计，分是否配有抓线。有抓线第一针转速受抓线动作时间限定，可以提高第一针转速。
	  正常情况下，前几针不能过高转速，容易出现带不上线，脱线；
	  前五针转速不能超过设定的低转速、剪线速度
	*/
	#if ENABLE_CONFIG_PARA 
	
	if(	(para.slow_start_mode == 55 )&&(stitch_counter <= para.slow_start_stitchs) )
	{
		if( start_to_speed_down == 1 )//前几针有降速
		{
			temp_speed = MotorSpeedRigister*100;
			start_to_speed_down = 0;
		}
		temp16 = (UINT16)para.slow_start_speed[stitch_counter - 1]*100;
		if( temp_speed > temp16 )
	    {
	      	temp_speed = temp16;	
	    } 	
	}
	else
	#endif
  	if(stitch_counter < 6)
  	{
		if( start_to_speed_down == 1 )//前几针有降速
		{
			temp_speed = MotorSpeedRigister*100;
			start_to_speed_down = 0;
		}
	  	if(clamp_com == 0)           							// without thread clamp
	  	{	
  	  		switch(stitch_counter)
  	  		{
		  	  	case 1: 
					temp16 = u10 * 100;  
					break;  	  	      
		      	case 2: 
					temp16 = u11 * 100;
					break;  	  	      
		      	case 3: 
					temp16 = u12 * 100;   
					break;      		      
		      	case 4: 
					temp16 = u13 * 100;   
					break;	      	      	            	
		      	case 5: 
					temp16 = u14 * 100;   
					break;      		      
		      	default:                      
					break;        			
  	  		}
    	}
    	else                         							// with thread clamp
    	{
	    	switch(stitch_counter)
	  	  	{
		  	  	case 1: 
					temp16 = u02 * 100;   
					break;  	  	 	  	      
		      	case 2: 
					temp16 = u03 * 100;   
					break;  	      	      			  	      
		      	case 3: 
					temp16 = u04 * 100;   
					break;        	    		      
		      	case 4: 
					temp16 = u05 * 100;   
					break;	      	      	            	      	 
		      	case 5: 
					temp16 = u06 * 100;   
					break;      		            	
		      	default:                      
					break;        			
  	  		}
    	}
    	if(temp_speed > temp16)
    	{
      		temp_speed = temp16;	
    	} 	
  	}
	
	
	/*
	  此函数一般在零度附近调用，如果前几针（或转速变化）在这个角度执行时，会出现动框跨两针转速的情况
	  后来改成在动框以后转速才变化，这样虽然把转速变化区间与动框配合上了，但是是否和实际缝制时机配合好，
	  还要考虑。	 
	*/

	//if( motor.spd_obj> temp_speed)
	//    inpress_tmp_speed = (motor.spd_obj-temp_speed)/2+temp_speed;
	//else
		inpress_tmp_speed = temp_speed;
	
	//inpress_tmp_speed = (inpress_tmp_speed+50)/100;
	//inpress_tmp_speed = inpress_tmp_speed*100;
		
	check_data_speed = inpress_tmp_speed;
		
	if( control_flag == 1 )
	    motor.spd_obj = inpress_tmp_speed;
	
#if FOLLOW_INPRESS_FUN_ENABLE
	calculate_inpress_angle(inpress_tmp_speed);
#endif
	

}
/*
找到增益的区间，按给定时间做匀速处理，保证从主控这边给出的匀速度是一致的
输入的是转速时间，跟针距没关系
*/

void adjust_xy_time(UINT8 timex,UINT8 timey)
{
	UINT16 xx,yy,tmp1,tmp2;
	xx = fabsm(xstep_cou);
	yy = fabsm(ystep_cou);
	switch(xx/30)
	{
		case 0://0.1-1.5 => 2 -30
				tmp1 = timex;
				tmp2 = (xx*tmp1)/30;
				timer_x = tmp2;
		break; 
		case 1://1.6-2.5 => 32-50
				tmp1 = timex;
				tmp2 = (xx*tmp1)/50;
				timer_x = tmp2;
		break;
		case 2://2.6-3.5 => 52 -70
				tmp1 = timex;
				tmp2 = (xx*tmp1)/70;
				timer_x = tmp2;
		break;
		case 3://3.6-4.5 => 72-90
				tmp1 = timex;
				tmp2 = (xx*tmp1)/90;
				timer_x = tmp2;
		break;
		case 4://4.6-5.5 => 92-110
		break;
		default:
		break;
	}	
	switch(yy/30)
	{
		case 0://0.1-1.5 => 2 -30
				tmp1 = timey;
				tmp2 = (yy*tmp1)/30;
				timer_y = tmp2;
		break; 
		case 1://1.6-2.5 => 32-50
				tmp1 = timey;
				tmp2 = (yy*tmp1)/50;
				timer_y = tmp2;
		break;
		case 2://2.6-3.5 => 52 -70
				tmp1 = timey;
				tmp2 = (yy*tmp1)/70;
				timer_y = tmp2;
		break;
		case 3://3.6-4.5 => 72-90
				tmp1 = timey;
				tmp2 = (yy*tmp1)/90;
				timer_y = tmp2;
		break;
		case 4://4.6-5.5 => 92-110
		break;
		default:
		break;
	}	
}

/**
  * @函数功能 计算动框角度函数
  * @参数 
  * @返回值 无
  */
void calculate_angle(void)
{
	INT16 temp_angle,range;
	INT16 temp_speed,tmpx,tmpy,total_time;
	UINT8 temp_timer;
	UINT32 tmp1,tmp2;
	UINT16 length,temp16_x,temp16_y,temp16_max;
    
	temp_timer = 0;
    
    temp_speed = check_data_speed /100;//为查表方便，较转速转化
	//厚料的转速基准
    if( k06 != 0 )   
	    temp_speed = before_down_speed/100;
    
	temp16_y = fabsm(ystep_cou);
	temp16_x = fabsm(xstep_cou);
	if(temp16_x > temp16_y)
	{
		temp16_max = temp16_x;
	}
	else
	{
		temp16_max = temp16_y;
	}
	length = temp16_max/10;
	HighSpeedStitchLength = length;
	
    if(k02 == 0)    //0--410 else 750//按机型查找指定转速的动框角度 和 动框时间
    {
       temp_angle = MoveStartAngle1[temp_speed];
	   timer_x = MoveTime1_Speed[temp_speed]+k27;	
	   	   
	   if( timer_x >= MoveTime_Limtit[temp_speed])
		   timer_x = MoveTime_Limtit[temp_speed] -1;
	   if( timer_x < 18)
	   	   timer_x = 18; 
	   timer_y = timer_x;
	
	   if( stitch_counter < 6)
	       temp_angle = temp_angle + k25 ;//k05
	   else	
	       temp_angle = temp_angle + k26;
			   
	   if( temp_angle < 20)
		   temp_angle = 20;
	   if( temp_angle > 350)
	       temp_angle = 350;
    }
    else
    { 
		if( xy_move_mode >= 1)//分时动框,X,Y采用不同动框角度和动框时间
		{
			if( xy_move_mode == 2)
			{
				if(ZJ_8060 == 1)
				{
					movestepx_angle = MoveStartAngleTab_750X2_8060[(temp16_x-1)/10][temp_speed];
					movestepy_angle = MoveStartAngleTab_750Y2_8060[(temp16_y-1)/10][temp_speed];
					timer_x = MoveTimeSpeedTab_750X2_8060[(temp16_x-1)/10][temp_speed];
				    timer_y = MoveTimeSpeedTab_750Y2_8060[(temp16_y-1)/10][temp_speed] ;
				}
				else
				{
					movestepx_angle = MoveStartAngleTab_750X2_MBJ[temp16_x/10][temp_speed];
					movestepy_angle = MoveStartAngleTab_750Y2_MBJ[temp16_y/10][temp_speed];
					timer_x = MoveTimeSpeedTab_750X2_MBJ[temp16_x/10][temp_speed];
				    timer_y = MoveTimeSpeedTab_750Y2_MBJ[temp16_y/10][temp_speed] ;
				}
				if( stitch_counter >= 6)
				{
				    timer_x += k27;
					timer_y += k28;
				}
				if( timer_x >= MoveTime_Limtit[temp_speed])
				    timer_x = MoveTime_Limtit[temp_speed] -1;
			    if( timer_x < 12)
	                timer_x = 12; 
  
				if( timer_y >= MoveTime_Limtit[temp_speed])
				    timer_y = MoveTime_Limtit[temp_speed] -1;
			    if( timer_y < 18)
	                timer_y = 18;
			}
			else if( xy_move_mode == 1)
			{
				movestepx_angle = MoveStartAngleTab_750X_N[temp16_x/10][temp_speed];
				movestepy_angle = MoveStartAngleTab_750Y_N[temp16_y/10][temp_speed];
			
				timer_x = MoveTime2_Speed[temp_speed] + k27 +k28;
				if( timer_x >= MoveTime_Limtit[temp_speed])
				    timer_x = MoveTime_Limtit[temp_speed] -1;
				if( timer_x < 12)
		            timer_x = 12; 
				timer_y = timer_x ;
			}
			else if( xy_move_mode == 3)
			{
			
				movestepx_angle = MoveStartAngle_k04_3[temp_speed];
				movestepy_angle = movestepx_angle;
				
			    timer_x = MoveTime_k04_3[temp_speed];
			    timer_y = timer_x;
				
				if( stitch_counter >= 6)
				{
					timer_x += k27;
					timer_y += k28;
				}
			
				if( timer_x >= MoveTime_Limtit[temp_speed])
					timer_x = MoveTime_Limtit[temp_speed] -1;
			    if( timer_x < 12 )
		            timer_x = 12; 
  
				if( timer_y >= MoveTime_Limtit[temp_speed])
					timer_y = MoveTime_Limtit[temp_speed] -1;
			    if( timer_y < 18 )
		            timer_y = 18;
			}
							
			if( (temp16_x == 0 )&&(temp16_y > 0) )
				 movestepx_angle = movestepy_angle;
			else if( (temp16_y == 0 )&&(temp16_x > 0) )
			     movestepy_angle = movestepx_angle;
			
			if( stitch_counter < 6)
	  		{
				movestepx_angle = movestepx_angle + k21;//k05
				movestepy_angle = movestepy_angle + k22;
			}
			else
			{
				movestepy_angle = movestepy_angle + k24;
				movestepx_angle = movestepx_angle + k23;//k05
			}
			if( movestepy_angle < 20)
				movestepy_angle = 20;
			if( movestepy_angle > 350)
			    movestepy_angle = 350;
			if( movestepx_angle < 20)
				movestepx_angle = 20;
			if( movestepx_angle > 350)
				movestepx_angle = 350;
				
			if( movestepx_angle > movestepy_angle )
			    temp_angle = movestepy_angle;
			else
			    temp_angle = movestepx_angle;
		}
		else
		{
			
		   	movestepx_angle = MoveStartAngle_750_x[temp_speed];
			movestepy_angle = MoveStartAngle_750_y[temp_speed];
				
			timer_x = MoveTime_Speed_750_x[temp_speed];
			timer_y = MoveTime_Speed_750_y[temp_speed];
			
			#if ENABLE_CONFIG_PARA
			//系统参数第1组的参数168，等于55表示使用动框角度分别调整功能，每个转速下的动框时间和角度由系统参数第五组指定
			if( para.adjust_mode_enable == 55 )
			{
				if( para5.x_time_adjust[temp_speed-1] <128 )
					timer_x += para5.x_time_adjust[temp_speed-1];
				else
					timer_x -= ( para5.x_time_adjust[temp_speed-1]- 128);
					
				if( para5.y_time_adjust[temp_speed-1] <128 )
					timer_y += para5.y_time_adjust[temp_speed-1];
				else
					timer_y -= ( para5.y_time_adjust[temp_speed-1]- 128);
				
				if( para5.x_angle_adjust[temp_speed-1] <128 )
					movestepx_angle += para5.x_angle_adjust[temp_speed-1];
				else
					movestepx_angle -= ( para5.x_angle_adjust[temp_speed-1]- 128);
				
				if( para5.y_angle_adjust[temp_speed-1] <128 )
					movestepy_angle += para5.y_angle_adjust[temp_speed-1];
				else
					movestepy_angle -= ( para5.y_angle_adjust[temp_speed-1]- 128);
			}
			
			if( para.first_5_adjust == 55)
			{
				if(	stitch_counter<6)
				{
					switch(stitch_counter)
					{
						case 1:
							timer_x += para.stitch1_speed;
						break;
						case 2:
							timer_x += para.stitch2_speed;
						break;
						case 3:
							timer_x += para.stitch3_speed;
						break;
						case 4:
							timer_x += para.stitch4_speed;
						break;
						case 5:
							timer_x += para.stitch5_speed;
						break;
					}
					if( timer_x > 63 )
						timer_x = 63;
					timer_y = timer_x;
				}
				else
				{
					timer_x += k27;//X轴动框时间微调
					timer_y += k28;//Y...
				}
			}
			else
			{
				timer_x += k27;
				timer_y += k28;
			}
			#else			
			//if( stitch_counter >= 6)
			{
				timer_x += k27;
				timer_y += k28;
			}
			#endif
			if( inpress_follow_mode == 6 )
			{
				timer_y -= 7;
				timer_x -= 7;
			}
			//monitor_tabx_time = timer_x;
			//monitor_taby_time = timer_y;
			
			//adjust_xy_time(timer_x,timer_y);
			
			//monitor_x_step = fabsm(xstep_cou);
			//monitor_y_step = fabsm(ystep_cou);
			//monitor_x_time = timer_x;
			//monitor_y_time = timer_y;
			//monitor_point =  pat_point - (PATTERN_DATA *)(pat_buf);
				
			
			
			if( timer_x >= MoveTime_Limtit[temp_speed])
				timer_x = MoveTime_Limtit[temp_speed] -1;
		    if( timer_x < 5 )//12
	            timer_x = 5; 
  
			if( timer_y >= MoveTime_Limtit[temp_speed])
				timer_y = MoveTime_Limtit[temp_speed] -1;
		    if( timer_y < 5 )//18
	            timer_y = 5;
							
			if( (temp16_x == 0 )&&(temp16_y > 0) )
			{
				 movestepx_angle = movestepy_angle;
				 timer_x = timer_y;
			}
			else if( (temp16_y == 0 )&&(temp16_x > 0) )
			{
			     movestepy_angle = movestepx_angle;
				 timer_y = timer_x;
			}
			
			if( stitch_counter < 6)
	  		{
				movestepx_angle = movestepx_angle + k21;
				movestepy_angle = movestepy_angle + k22;
			}
			else
			{
				movestepx_angle = movestepx_angle + k23;
				movestepy_angle = movestepy_angle + k24;				
			}
			
			if( inpress_follow_mode == 6 )
			{
				movestepy_angle += 120;
				movestepx_angle += 60;
			}
			
			if( movestepy_angle < 20)
				movestepy_angle = 20;
			if( movestepy_angle > 350)
			    movestepy_angle = 350;
			if( movestepx_angle < 20)
				movestepx_angle = 20;
			if( movestepx_angle > 350)
				movestepx_angle = 350;
				
			if( movestepx_angle > movestepy_angle )
			    temp_angle = movestepy_angle;
			else
			    temp_angle = movestepx_angle;
			/*
			   temp_angle = MoveStartAngle2[temp_speed];
			   timer_x = MoveTime2_Speed[temp_speed] + k27 +k28; 
			   if( timer_x >= MoveTime_Limtit[temp_speed])
				   timer_x = MoveTime_Limtit[temp_speed]-1;
			   if( timer_x < 18)
	           	   timer_x = 18; 
	   		   timer_y = timer_x;
			   if( stitch_counter < 6)
				   temp_angle = temp_angle + k25 ;
			   else
			       temp_angle = temp_angle + k26;
			   if(temp_angle < 20)
			      temp_angle = 20;
			   if( temp_angle > 350)
			      temp_angle = 350;
			*/
	    }
    }  	
	
    if(k06 != 0)//厚料的动框角度
	{
		temp_angle = temp_angle + 80 + 5*k07;  // adjust movestart_angle to be more than 250 degree
		if(temp_angle > 310)
		   temp_angle = 310;		
	}
    //动框角度限制
	if( temp_angle < 20)
	    temp_angle = 20;
	if( temp_angle > 350)
	    temp_angle = 350;
		
#if NEW_CONTROL_PROTOCOL

	if( timer_x >63)
	    timer_x = 63;
	if( timer_y >63)
	    timer_y = 63;
	if ( timer_y >= timer_x)
	     timer_x = timer_y;
	else
		 timer_y = timer_x;
#endif

    movestep_angle  = angle_tab[temp_angle];  
	movestepx_angle = angle_tab[movestepx_angle]; 
	movestepy_angle = angle_tab[movestepy_angle]; 
}

/**
  * @函数功能 花样功能码处理
  * @参数 无
  * @返回值 无
  */
void process_data(void)
{
	UINT8 break_flag;
	break_flag = 0;
	xstep_cou = 0;
	ystep_cou = 0;

	while(1)
	{
    	switch(pat_point->func & 0xFF)
    	{
    		case 0xC0: 
    			switch(pat_point->xstep)
               	{	
    	        	case 0x00: 						           
						break;
    	            case 0x01: //结束码
						end_flag = 1;   
						break_flag = 1; 
						break;
    	            case 0x02://第二原点
						origin2_lastmove_flag = 1;
						break_flag = 1; 
						break;	        
    	            case 0x03: //中途停止
						stop_flag = 1;  
						stop_number = 1;//外压脚抬起
						break_flag = 1; 
						break;
    	            case 0x04: //剪线码
						cut_flag = 1;   
						break_flag = 1; 
						break;
					case 0x05: 
					case 0x0b:
						switch(pat_point->ystep)
						{
							case 0://画笔结束
								making_pen_status = 4;
								FootRotateFlag = 1; 
							break;
							case 1://画笔开始
								making_pen_status = 3;
								FootRotateFlag = 1; 
							break;
							case 3://激光切割结束
								milling_cutter_action_flag = 2;
							break;
							case 4://激光切割开始
								milling_cutter_action_flag = 1;
							break;
							default:
								FootRotateFlag = 1;  
							break;
						}
						
						break_flag = 1;		   
						break;
					case 0x07://输出
						OutputFlag = 1;
						OutputNumber = pat_point->ystep;
						if( OutputNumber == 0 )
						    milling_cutter_action_flag = 1;
						else if( OutputNumber == 1 )
						    milling_cutter_action_flag = 2;
						break_flag = 1;	
						break;
					case 0x09://花样延时
						PatternDelayFlag = 1;
						PattenrDelayTime = pat_point->ystep;
						PattenrDelayTime = PattenrDelayTime*100; 
						break_flag = 1;
						break;
					case 0x0C://跳缝
						RotateFlag = 1;
						break_flag = 1;
						break;
					case 0x13:
						inflection_poin_flag = 1;
						break;
    	            default:   
						break;
             	}
    		  	break;
			case 0xC1:
				switch(pat_point->xstep)
				{
					default:
						break;
				}
				break;
			case 0xC2:
				switch(pat_point->xstep)
				{
					default:
						break;
				}
				break;
			case 0xC3:
				switch(pat_point->xstep)
				{
					case 0x03://中途停止
						stop_flag = 1;
						stop_number = 2;//外压框不抬起
						break_flag = 1;	
						break;
					default:
						break;
				}
				break;
			case 0xC4:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 3;//外压框抬起，停上死点
						break_flag = 1;
						break;
					case 0x1B://缝纫机中停停止
						SewingStopFlag = 1;
						SewingStopValue = 2;
						break_flag = 1;  
						break;
					default:
						break;
				}
				break;
			case 0xC7:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 4;//外压框落下，停到上死点
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			case 0xC8:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 5;//外压框抬，针停下位
						break_flag = 1;
						break;
					case 0x1B:
						SewingStopFlag = 1;
						SewingStopValue = 3;
						break_flag = 1;    
						break;
					default:
						break;
				}
				break;
			case 0xCB:
				switch(pat_point->xstep)
				{
					case 0x03:
					    stop_flag = 1;   
						stop_number = 6; //外压框下，中停下位
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
    		case 0x80: 
				switch(pat_point->xstep)
				{
					case 0x02:
						origin2_lastmove_flag = 1;
						break_flag = 1;
						break;
					case 0x03:
						stop_flag = 1;
						stop_number = 1;											// foot up,taken-up up
						break_flag = 1;
						break;
					case 0x04: 
						cut_flag = 1;   
						break_flag = 1; 
						break;
				 	case 0x0b:
					case 0x05:
						
						switch(pat_point->ystep)
						{
							case 0://画笔结束
								making_pen_status = 4;
								FootRotateFlag = 1; 
							break;
							case 1://画笔开始
								making_pen_status = 3;
								FootRotateFlag = 1; 
							break;
							case 3://激光切割结束
								milling_cutter_action_flag = 2;
							break;
							case 4://激光切割开始
								milling_cutter_action_flag = 1;
								break;
							default:
								FootRotateFlag = 1;  
							break;
						}
						break_flag = 1;	
						break;
					case 0x06:
						InpressHighControlFlag = 1;
						InpressAbsoluteHigh = pat_point->ystep;
						break;
					case 0x07://输出
						OutputFlag = 1;
						OutputNumber = pat_point->ystep;
						if( OutputNumber == 0 )
						    milling_cutter_action_flag = 1;
						else if( OutputNumber == 1 )
						    milling_cutter_action_flag = 2;
						break_flag = 1;	
						break;
					case 0x08://输入
						InputFlag = 1;
						InputNumber = pat_point->ystep;
						break;
					case 0x09:
						PatternDelayFlag = 1;
						PattenrDelayTime = pat_point->ystep;
						PattenrDelayTime = PattenrDelayTime*100;                 
						break_flag = 1;
						break;
					case 0x0C:
						RotateFlag = 1;
						break_flag = 1;
						break;
					case 0x0D://第三线张力
						Tension3thFlag = 1;
						break;
					case 0x11:
						AreaDivisionFlag = 1;
						break; 
					case 0x12:
						KnifeDriveFlag = 1;
						KnifeStyle = pat_point->ystep;
						break;
					case 0x13:
						inflection_poin_flag = 1;
					break;
					case 0x14://改变缝制速度
						SewingSpeedFlag = 1;
						if(pat_point->ystep == 0)
						{
							SewingSpeedValue = MAXSPEED0;
						}
						else
						{
							SewingSpeedValue = pat_point->ystep;
							if(SewingSpeedValue > MAXSPEED0)
							{
								SewingSpeedValue = MAXSPEED0;
							}
						}
						break;
					case 0x15:
						NopmoveFuncFlag = 1;
						NopmoveSpeed = pat_point->ystep;
						break;
					case 0x1B:
						SewingStopFlag = 1;
						SewingStopValue = 1;
						break_flag = 1;    
						break;

					default:
						break;
				}	
				break; 
			case 0x81:
				switch(pat_point->xstep)
				{
					default:
						break;
				}
				break;
			case 0x82:
				switch(pat_point->xstep)
				{
					default:
						break;
				}
				break;
			case 0x83:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 2;											// foot down,taken-up up
						break_flag = 1;	
						break;
					default:
						break;
				}
				break;
			case 0x84:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 3;											// foot up,taken-up dead point
						break_flag = 1;
						break;
					case 0x1B:
						SewingStopFlag = 1;
						SewingStopValue = 2;
						break_flag = 1;     
						break;
					default:
						break;
				}
				break;
			case 0x87:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 4;										// foot down,taken-up dead point
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			case 0x88:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 5;										// foot up, taken-up down
						break_flag = 1;
						break;
					case 0x1B:
						SewingStopFlag = 1;
						SewingStopValue = 3;
						break_flag = 1;    
						break;
					default:
						break;
				}
				break;
			case 0x8B:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 6;								
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
    		//-----------------------------------------------------------------------	
      		// default
      		//-----------------------------------------------------------------------		   		  	  				
    		default:   
				break;
    	}
    	switch(pat_point->func & 0xF0)
    	{
    		//-----------------------------------------------------------------------	
	      	// inpress and tension fuction code
	      	//-----------------------------------------------------------------------
    		case 0xC0:
    		case 0x80://缝制过程中，中压脚高度变化
    			switch(pat_point->xstep)
				{
					case 0x1A:
    					inpress_delta = ((INT16)(pat_point->ystep))*4;
    					switch(pat_point->func & 0x0F)
    					{
							case 0x00: 					                   break;
							case 0x01: inpress_delta = inpress_delta + 1;  break;
							case 0x02: inpress_delta = inpress_delta + 2;  break;
							case 0x03: inpress_delta = inpress_delta + 3;  break;
							default:	 				 				   break;
	    				}
	    				
						inpress_high = inpress_high_hole + inpress_delta;
	    				if(inpress_high > 70)
							inpress_high = 70;
						if(inpress_high < 0)
							inpress_high = 0;
						inpress_act_flag = 1;
						break;
						
    				case 0x0F://缝制过程中，线张力变化
    					tension_delta = ((INT16)(pat_point->ystep))*4;
    					switch(pat_point->func & 0x0F)
    					{
							case 0x00: 					                   break;
							case 0x01: tension_delta = tension_delta + 1;  break;
							case 0x02: tension_delta = tension_delta + 2;  break;
							case 0x03: tension_delta = tension_delta + 3;  break;
					    	default:	 				 				   break;
	    				}
						tension = tension_hole + tension_delta;
	    				if(tension > 200)
							tension = 200;
						if(tension < 0)
							tension = 0;
						break;
					case 0x0e://旋转切刀角度设置指令
						cutter_function_flag = 1;
						cutter_rotated_abs_angle = (pat_point->func)&0x0f;
						cutter_rotated_abs_angle = cutter_rotated_abs_angle <<8;
						cutter_rotated_abs_angle += (UINT8)pat_point->ystep;
					 	milling_cutter_action_flag = 1;
						break_flag = 1;
					break;
					default:
						break;
    			}
    			break;	
    		//-----------------------------------------------------------------------	
      		// only move stepper motor 
      		//-----------------------------------------------------------------------		   		
    		case 0x50: lastmove_flag = 1; 		   		
    		case 0x10: lastmove_flag = 1;		
      		case 0x00:   
				 	  xstep_cou = ((INT16)pat_point->xstep)*2; 
                 	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      	         	  switch(pat_point->func & 0x0F)
                 	  {	
    	         	      case 0x00: break;
    	         	      case 0x08: xstep_cou = xstep_cou+1; break;
    	         	      case 0x02: ystep_cou = ystep_cou+1; break;
    	         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    	         	      default:   break;
                 	  } 
    		    nopmove_flag = 1; 
    		    break_flag = 1;
    		    break;    					
    		//-----------------------------------------------------------------------	
      		// normal stitch
      		//-----------------------------------------------------------------------
			case 0x60:  laststitch_flag = 1;
    		case 0x70:  laststitch_flag = 1;		   		  	  			
      		case 0x20: 
      		case 0x30: 
				 	  xstep_cou = ((INT16)pat_point->xstep)*2; 
                 	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      	         	  switch(pat_point->func & 0x0F)
                 	  {	
    	         	      case 0x00: break;
    	         	      case 0x08: xstep_cou = xstep_cou+1; break;
    	         	      case 0x02: ystep_cou = ystep_cou+1; break;
    	         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    	         	      default:   break;
                 	  } 
    		    move_flag = 1; 
    		    break_flag = 1;
    		    break;    					
    	    //-----------------------------------------------------------------------	
      		// default
      		//-----------------------------------------------------------------------		   		  	  				
    		default:   
				break;
    	}
    	do_pat_point_add_one();  
    	if(break_flag == 1)
    	{
    		break;
    	}	 
  	}                           
}

/**
  * @函数功能 试缝过程中的花样处理
  * @参数 无
  * @返回值 无
       与缝制过程不同的是，个别功能码是不要响应的，类似中途停止
  */
void process_sewingtest_data(void)
{
	UINT8 break_flag;
	xstep_cou = 0; 
	ystep_cou = 0;
	break_flag = 0;	
	start_flag = 0;
	end_flag = 0;   
	
	while(1)
	{		
    	switch(pat_point->func & 0xFF)
	    {
	    	//-----------------------------------------------------------------------	
	      	// fuction code
	      	//-----------------------------------------------------------------------		   		
	    	case 0xC0: 
	    		switch(pat_point->xstep)
	            {	
	    	        case 0x00: 						           
						break;
	    	        case 0x01: 
						end_flag = 1;   
						break_flag = 1; 
						break;
	    	        case 0x02: 
						break;	        
	    	        case 0x03: 
						stop_flag = 1;  
						stop_number = 1;											// foot up,taken-up up
						StopStatusFlag = 1;
						break_flag = 1; 
						break;
	    	        case 0x04: 
						break;
					case 0x05:
					case 0x0b:
						switch(pat_point->ystep)
						{
							case 0://画笔结束
								making_pen_status = 4;
								FootRotateFlag = 1; 
							break;
							case 1://画笔开始
								making_pen_status = 3;
								FootRotateFlag = 1; 
							break;
							case 3://激光切割结束
								milling_cutter_action_flag = 2;
								find_laser_start_stop_flag = 1;
							break;
							case 4://激光切割开始
								milling_cutter_action_flag = 1;
								find_laser_start_stop_flag = 1;
							break;
							default:
								FootRotateFlag = 1;  
							break;
						}
						break_flag = 1;	
						break;
					case 0x07://输出
						OutputFlag = 1;
						OutputNumber = pat_point->ystep;
						if( OutputNumber == 0 )
						    milling_cutter_action_flag = 1;
						else if( OutputNumber == 1 )
						    milling_cutter_action_flag = 2;
						break_flag = 1;	
						break;
	    	        default:   
						break;
	            }
	    		break;
				
			case 0xC3:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 2;											// foot down,taken-up up
						break_flag = 1;	
						StopStatusFlag = 1;
						break;
					default:
						break;
				}
				break;
			case 0xC4:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 3;											// foot up,taken-up dead point
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			case 0xC7:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 4;										// foot down,taken-up dead point
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			case 0xC8:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 5;										// foot up, taken-up down
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			case 0xCB:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 6;										// foot down,taken-up down
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			
	    	case 0x80: 
				switch(pat_point->xstep)
				{
					case 0x02:
						origin2_lastmove_flag = 1;
						break;
					case 0x03:
						stop_flag = 1;
						stop_number = 1;											// foot up,taken-up up
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					case 0x05:
					case 0x0b:
					
						switch(pat_point->ystep)
						{
							case 0://画笔结束
								making_pen_status = 4;
								FootRotateFlag = 1; 
							break;
							case 1://画笔开始
								making_pen_status = 3;
								FootRotateFlag = 1; 
							break;
							case 3://激光切割结束
								milling_cutter_action_flag = 2;
								find_laser_start_stop_flag = 1;
							break;
							case 4://激光切割开始
								milling_cutter_action_flag = 1;
								find_laser_start_stop_flag = 1;
							break;
							default:
								FootRotateFlag = 1;  
							break;
						}
						break_flag = 1;	//2010-4-22
						break;
					case 0x06:
						break;
					case 0x07:
						break;
					case 0x08:
						break;
					case 0x09:
						break;
					case 0x0C:
						break;
					case 0x0D:
						break;
					case 0x11:
						break; 
					case 0x12:
						break;
					case 0x13://2013-11-19
						break;	
					case 0x14:
						break;
					case 0x15:
						break;
					case 0x1A:
						break;
					case 0x1B:
						break;
					default:
						break;
				}	
				break; 
			case 0x81:
				switch(pat_point->xstep)
				{
					case 0x0F:
						break;
					case 0x1A:
						break;
					default:
						break;
				}
				break;
			case 0x82:
				switch(pat_point->xstep)
				{
					case 0x0F:
					case 0x1A:
						break;
					default:
						break;
				}
				break;
			case 0x83:
				switch(pat_point->xstep)
				{
					case 0x0F:
						break;
					case 0x1A:
						break;
					case 0x03:
						stop_flag = 1;
						stop_number = 2;											// foot down,taken-up up
						StopStatusFlag = 1;
						break_flag = 1;	
						break;
					default:
						break;
				}
				break;
			case 0x84:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 3;											// foot up,taken-up dead point
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					case 0x1B:
						break;
					default:
						break;
				}
				break;
			case 0x87:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 4;										// foot down,taken-up dead point
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					default:
						break;
				}
				break;
			case 0x88:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 5;										// foot up, taken-up down
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					case 0x1B:
						break;
					default:
						break;
				}
				break;
			case 0x8B:
				switch(pat_point->xstep)
				{
					case 0x03:
						stop_flag = 1;
						stop_number = 6;										// foot down,taken-up down
						StopStatusFlag = 1;
						break_flag = 1;
						break;
					default:
						break;
				}
				break;					
	    	//-----------------------------------------------------------------------	
	      	// default
	      	//-----------------------------------------------------------------------		   		  	  				
	    	default:   
				break;
	   	}
	   	
	   	switch(pat_point->func & 0xF0)
    	{
    		//-----------------------------------------------------------------------	
	      	// inpress and tension fuction code
	      	//-----------------------------------------------------------------------
    		case 0xC0:
    		case 0x80:
    			switch(pat_point->xstep)
				{
					case 0x1A:
					     if((single_comm == 0x01) || (single_comm == 0x02))
						{
							inpress_delta = ((INT16)(pat_point->ystep))*4;
    					    switch(pat_point->func & 0x0F)
    					     {
							    case 0x00: 					                   break;
							    case 0x01: inpress_delta = inpress_delta + 1;  break;
							    case 0x02: inpress_delta = inpress_delta + 2;  break;
							    case 0x03: inpress_delta = inpress_delta + 3;  break;
							    default:	 				 				   break;
	    				     }
							single_inpress_flag = 1;  
						    inpress_high = inpress_high_hole + inpress_delta;
	    				    if(inpress_high > 70)
							  inpress_high = 70;
						    if(inpress_high < 0)
							  inpress_high = 0;		  
					    }
    					course_run_stop_flag = 1;
						break;
					case 0x0F:
						course_thread_run_stop_flag = 1;
						break;
					case 0x0e:
						cutter_function_flag = 1;
						cutter_rotated_abs_angle = (pat_point->func)&0x0f;
						cutter_rotated_abs_angle = cutter_rotated_abs_angle <<8;
						cutter_rotated_abs_angle += (UINT8)pat_point->ystep;
					 	milling_cutter_action_flag = 1;
					break;
					default:
						break;
    			}
    			break;	
    						
    		//-----------------------------------------------------------------------	
      		// only move stepper motor 
      		//-----------------------------------------------------------------------		   		
    		case 0x50: lastmove_flag = 1,LastNopMoveFlag = 1; 		   		
    		case 0x10: lastmove_flag = 1,LastNopMoveFlag = 1;		
      		case 0x00:   
				 	  xstep_cou = ((INT16)pat_point->xstep)*2; 
                 	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      	         	  switch(pat_point->func & 0x0F)
                 	  {	
    	         	      case 0x00: break;
    	         	      case 0x08: xstep_cou = xstep_cou+1; break;
    	         	      case 0x02: ystep_cou = ystep_cou+1; break;
    	         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    	         	      default:   break;
                 	  } 
    		    nopmove_flag = 1; 
    		    break_flag = 1;
    		    break;    					
    		//-----------------------------------------------------------------------	
      		// normal stitch
      		//-----------------------------------------------------------------------
			case 0x60:  laststitch_flag = 1;
    		case 0x70:  laststitch_flag = 1;		   		  	  			
      		case 0x20: 
      		case 0x30: 
				 	  xstep_cou = ((INT16)pat_point->xstep)*2; 
                 	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      	         	  switch(pat_point->func & 0x0F)
                 	  {	
    	         	      case 0x00: break;
    	         	      case 0x08: xstep_cou = xstep_cou+1; break;
    	         	      case 0x02: ystep_cou = ystep_cou+1; break;
    	         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    	         	      default:   break;
                 	  } 
    		    move_flag = 1; 
    		    break_flag = 1;
    		    break;    					
    	    //-----------------------------------------------------------------------	
      		// default
      		//-----------------------------------------------------------------------		   		  	  				
    		default:   
				break;
    	}
    	do_pat_point_add_one();  
    	if(break_flag == 1)
    	{
    		break;
    	}	 
  	}                           
}
/**
  * @函数功能 编辑状态下的数据处理
  * @参数 无
  * @返回值 无
  */
void process_edit_data(void)
{
	UINT8 break_flag;
	xstep_cou = 0; 
	ystep_cou = 0; 
	break_flag = 0;	
	while(1)
	{
    	if(end_flag == 1)
		{
			break_flag = 1;
		}
		else
		{
			first_stitch_flag = 0;

			switch(pat_point->func & 0xFF)
	    	{
	    		//-----------------------------------------------------------------------	
	      		// fuction code
	      		//-----------------------------------------------------------------------		   		
	    		case 0xC0:
	    			switch(pat_point->xstep)
	               	{	
	    	        	case 0x00: 									
							break_flag = 1;		
							break;
	    	            case 0x01: 
							end_flag = 1;  				 	
							break_flag = 1; 	
							break;
	    	            case 0x02: 									
							break_flag = 1;		
							break;	        
	    	            case 0x03: 
							stop_flag = 1; 
							break_flag = 1;		
							break;
	    	            case 0x04: 
							cut_flag = 1;  
							break_flag = 1; 	
							break;
						case 0x05: 
						case 0x0b:
							switch(pat_point->ystep)
							{
								case 0://画笔结束
									making_pen_status = 4;
									FootRotateFlag = 1; 
								break;
								case 1://画笔开始
									making_pen_status = 3;
									FootRotateFlag = 1; 
								break;
								case 3://激光切割结束
									milling_cutter_action_flag = 2;
								break;
								case 4://激光切割开始
									milling_cutter_action_flag = 1;
								break;
								default:
									FootRotateFlag = 1;  
								break;
							}
							break_flag = 1; 	
							break;
						case 0x09:
							break_flag = 1;
							break;
						case 0x0A:									
							break_flag = 1;		
							break;
						case 0x1A:									
							break_flag = 1; 	
							break;	
						case 0x0F:									
							break_flag = 1; 	
							break;		
	    	            default:   
							break;
	             	}
	    		  	break;
				case 0xC1:
					switch(pat_point->xstep)
					{
						case 0x1A:
							break_flag = 1;
							break;
						case 0x0F:
							break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC2:
					switch(pat_point->xstep)
					{
						case 0x1A:
							break_flag = 1;
							break;
						case 0x0F:
							break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC3:
					switch(pat_point->xstep)
					{
						case 0x1A:
							break_flag = 1;
							break;
						case 0x0F:
							break_flag = 1;
							break;
						default:
							break;
					}
					break;
	    		case 0x80: 
					switch(pat_point->xstep)
					{
						case 0x02:
							origin2_lastmove_flag = 1;
							break_flag = 1;
							break;
						case 0x03:
							break_flag = 1;
							break;
						case 0x04:
							cut_flag = 1;
							break_flag = 1;
							break;
						case 0x0b:
						case 0x05:
							switch(pat_point->ystep)
							{
								case 0://画笔结束
									making_pen_status = 4;
									FootRotateFlag = 1; 
								break;
								case 1://画笔开始
									making_pen_status = 3;
									FootRotateFlag = 1; 
								break;
								case 3://激光切割结束
									milling_cutter_action_flag = 2;
								break;
								case 4://激光切割开始
									milling_cutter_action_flag = 1;
								break;
								default:
									FootRotateFlag = 1;  
								break;
							}
							break_flag = 1;
							break;
						case 0x06:
							break_flag = 1;
							break;
						case 0x07:
							break_flag = 1;
							break;
						case 0x08:
							break_flag = 1;
							break;
						case 0x09:
							break_flag = 1;
							break;
						case 0x0A:
							break_flag = 1;
							break;
						case 0x0C:
							break_flag = 1;
							break;
						case 0x0D:
							break_flag = 1;
							break;
						case 0x0F:
							break_flag = 1;
							break;
						case 0x11:
							break_flag = 1;
							break; 
						case 0x12:
							break_flag = 1;
							break;
						case 0x13:
					    	break_flag = 1; 
						break;
						case 0x14:
							SewingSpeedFlag = 1;
							break_flag = 1;
							break;
						case 0x15:
							NopmoveFuncFlag = 1;
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						case 0x1B:
							break_flag = 1;
							break;
						default:
							break;
					}

					break; 
				case 0x81:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						default:
							break;
					}

					break;
				case 0x82:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						default:
							break;
					}

					break;
				case 0x83:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						case 0x03:
							break_flag = 1;											
							break;
						default:
							break;
					}

					break;
				case 0x84:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;											// foot up,taken-up dead point
							break;
						case 0x1B:
							break_flag = 1;
							break;
						default:
							break;
					}

					break;
				case 0x87:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;									
							break;
						default:
							break;
					}

					break;
				case 0x88:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;										
							break;
						case 0x1B:
							break_flag = 1;
							break;
						default:
							break;
					}
	
					break;
				case 0x8B:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;										
							break;
						default:
							break;
					}

					break;					
	    		//-----------------------------------------------------------------------	
	      		// default
	      		//-----------------------------------------------------------------------		   		  	  				
	    		default:   
					break;
	    	}
	    	switch(pat_point->func & 0xF0)
    		{
    			//-----------------------------------------------------------------------	
	      		// only move stepper motor 
	      		//-----------------------------------------------------------------------		   		
	    		case 0x50: lastmove_flag = 1,ElementPointFlag = 1; 		   		
	    		case 0x10:			
	      		case 0x00:     	         	               							
	      	     		  xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  }        
	    		    nopmove_flag = 1; 

	    		    break_flag = 1;
	    		    break;    					
	    		//-----------------------------------------------------------------------	
	      		// normal stitch
	      		//-----------------------------------------------------------------------		   		  	  			
	      		case 0x70: ElementPointFlag = 1;
	      		case 0x60: ElementPointFlag = 1;
					      xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  }         
	    		    move_flag = 1; 
	    		    break_flag = 1;
	    		    break; 
	     		case 0x30: ShapePointFlag = 1;
	    		case 0x20: SewDataFlag = 1;
	    			      xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  }         
	    		    move_flag = 1; 

	    		    break_flag = 1;
	    		    break;  				
    		    //-----------------------------------------------------------------------	
      			// default
      			//-----------------------------------------------------------------------		   		  	  				
    			default:   
					break;
    		}
		}
		do_pat_point_add_one();
    	if(break_flag == 1)
    	{
    		break;
    	}	 
  	}                           
}

UINT32 Calculate_QuickMove_Time(UINT32 temp16_x,UINT32 temp16_y)
{
	UINT32 temp32,kk,bb,aa;
	UINT8  val;
	UINT32 temp32_max,delta;
	UINT32 sw_value;
	UINT32 temp16_max;
	
	#if	0//COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER41

		 if( (sys.status == SETOUT)||(sys.status == FINISH))
			sw_value = go_setout_speed % 10;	
		else
			sw_value = nop_move_speed % 10;
	
		//==========X轴空送时间计算==========
		if(( temp16_x <= 127 )&&( temp16_x > 0 ))
		{
			delta =(temp16_x-1)/20;
			switch(delta)
			{
				case 0://<2MM
						temp32 = 60;				
						break;
				case 1://<4MM
						temp32 = 75;
						break;
				case 3://<6MM
						temp32 = 90;
						break;
				case 4://<8MM
						temp32 = 105;
			    		break;
				case 5://<10MM
						temp32 = 120;
						break;
				case 6://<12MM
						temp32 = 130;
						break;
				default:
						temp32 = 140;
						break;	
			
			}
			    temp32_max =temp32*2- temp32*sw_value/9;
			
		}
		else if( temp16_x > 127 )
		{
			delta =(temp16_x-1)/500;
			switch(delta)
			{
				case 0://<50MM
						temp32 = 190;				
					break;
				case 1://<100MM
						temp32 = 350;
					break;
				case 2:
				case 3://<200MM
						temp32 = 490;
					break;
				case 4:
				case 5://<300MM
						temp32 = 600;
			    	break;
				case 6:
				case 7://<400MM
						temp32 = 690;
					break;
				case 8:
				case 9://<500MM
						temp32 = 800;
					break;
				case 10:
				case 11://<600MM
				        temp32 = 920;
					break;
				case 12:
				case 13://<700MM
						temp32 = 1060;
					break;
				case 14:
				case 15://<800MM
						temp32 = 1170;
					break;
				case 16:
				case 17://<900
						temp32 = 1300;//1210
					break;
				case 18:
				case 19://<1000MM
						temp32 = 1460;//1310
						break;
				case 20:
				case 21://<1100MM
						temp32 = 1560;//
						break;
				case 22:
				case 23://<1200MM
						temp32 = 1660;
						break;
				case 24:
				case 25://<1300MM
						temp32 = 1750;
						break;
				case 26:
				case 27://<1400MM
						temp32 = 1850;
						break;
				case 28:
				case 29://<1500
						temp32 = 1950;
						break;
				case 30:
				case 31://<1600
						temp32 = 2050;
						break;
				case 32:
				case 33://<1700
						temp32 = 2150;
						break;
				case 34:
				case 35://<1800
						temp32 = 2250;
						break;
				case 36:
				case 37://<1900
						temp32 = 2350;
						break;
				case 38:
				case 39://<2000
						temp32 = 2450;
						break;
				default:
						temp32 = 3010;
						break;	
			
			}

			temp32_max =temp32*2- temp32*sw_value/9;
		}
		else 
		    temp32_max = 0;
		//==========y轴空送时间计算==========
		if(( temp16_y <= 127 )&&(temp16_y > 0 ))
		{
			delta =(temp16_y-1)/20;
			switch(delta)
			{
				case 0://<20
						temp32 = 60;				
						break;
				case 1://<40
						temp32 = 75;
						break;
				case 3://<60
						temp32 = 90;
						break;
				case 4://<80
						temp32 = 105;//105;
			    		break;
				case 5://<100
						temp32 = 130;//120;
						break;
				case 6://<120
						temp32 = 130;//130;
						break;
				default:
						temp32 = 140;//140;
						break;	
			}
				temp32 =temp32*2- temp32*sw_value/9;
		}
		else if( temp16_y > 127 )
		{
			delta =(temp16_y-1)/500;
			switch(delta)
			{

				case 0://<50
						temp32 = 190;				
					break;
				case 1://<100
						temp32 = 350;
					break;
				case 2:
				case 3://<200
						temp32 = 490;
					break;
				case 4:
				case 5://<300
						temp32 = 600;
			    	break;
				case 6:
				case 7://<400
						temp32 = 690;
					break;
				case 8:
				case 9://<500
						temp32 = 780;
					break;
				case 10:
				case 11://<600
				        temp32 = 880;
					break;
				case 12:
				case 13://<700
						temp32 = 990;
					break;
				case 14:
				case 15://<800
						temp32 = 1100;
					break;
				case 16:
				case 17://<900
						temp32 = 1210;
					break;
				default:
						temp32 = 1400;
				break;	
			
			}

			temp32 =temp32*2- temp32*sw_value/9;
		}
		else
			temp32 = 0;
		
		if( temp32_max<=temp32)
			temp32_max=temp32;
		
		return (temp32_max);
	
#else 
	
	    if( temp16_x > temp16_y )
			temp16_max = temp16_x;
		else
			temp16_max = temp16_y;
			
		#if CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037 

			if( (sys.status == SETOUT)||(sys.status == FINISH))
			     val = go_setout_speed % 10;
		    else
			     val = nop_move_speed % 10;
		
			if( temp16_x <=800 )//40mm 800
			   	kk = 70;
			else if( temp16_x <=1600 )//80mm 1600
			   	kk = 74;
			else if( temp16_x <=2400 )//120mm 2400
			   	kk = 78;
			else if( temp16_x <=3200 )//160mm 3200
			   	kk = 82;
			else if( temp16_x <=4000 )//200mm 4000
			   	kk = 87;
			else if( temp16_x <=4800 )//240mm 4800
				kk = 91;
			else if( temp16_x <=5600 )//280mm 5600
				kk = 95;
			else 
				kk = 100;	 
				
			if( temp16_x <=1000 )//<=50mm
			   	aa = 29;
			else if( temp16_x <=2000 )//<=100mm
			   	aa = 52;
			else if( temp16_x <=3000 )//<=150mm
			   	aa = 75;
			else if( temp16_x <=4000 )//<=200mm 
			   	aa = 93;
			else if( temp16_x <=6000 )//<=300mm
			   	aa = 172;
			else if( temp16_x <=8000 )//<=400mm 
				aa = 282;
			else if( temp16_x <=10000 )//<=500mm
				aa = 408;
			else 
				aa = 485;
			bb = val;
			
			temp32 =(UINT32)temp16_x *10/kk + bb*50;
			if( temp32 > aa)
				temp32 -= aa;
			if( temp32 < 100)
				temp32 = 100;
			
			if( temp16_y <=800 )//40mm 800
			   	kk = 70;
			else if( temp16_y <=1600 )//80mm 1600
			   	kk = 74;
			else if( temp16_y <=2400 )//120mm 2400
			   	kk = 78;
			else if( temp16_x <=3200 )//160mm 3200
			   	kk = 82;
			else if( temp16_y <=4000 )//200mm 4000
			   	kk = 87;
			else if( temp16_y <=4800 )//240mm 4800
				kk = 91;
			else if( temp16_y <=5600 )//280mm 5600
				kk = 95;
			else 
				kk = 100;
				
			bb = val;
			
			temp32_max =(UINT32)temp16_y *10/kk + bb*50;
			if( temp32_max < 100)
				temp32_max = 100;
				
			if( temp16_y != 0)
			{
				if( temp32_max > temp32)
					temp32 = temp32_max;					
			}
		 	/*
			if( temp16_max <=800 )//40mm 800
			   	kk = 70;
			else if( temp16_max <=1600 )//80mm 1600
			   	kk = 74;
			else if( temp16_max <=2400 )//120mm 2400
			   	kk = 78;
			else if( temp16_max <=3200 )//160mm 3200
			   	kk = 82;
			else if( temp16_max <=4000 )//200mm 4000
			   	kk = 87;
			else if( temp16_max <=4800 )//240mm 4800
				kk = 91;
			else if( temp16_max <=5600 )//280mm 5600
				kk = 95;
			else 
				kk = 100;	 
				
			if( temp16_max <=1000 )//<=50mm
			   	aa = 29;
			else if( temp16_max <=2000 )//<=100mm
			   	aa = 52;
			else if( temp16_max <=3000 )//<=150mm
			   	aa = 75;
			else if( temp16_max <=4000 )//<=200mm 
			   	aa = 93;
			else if( temp16_max <=6000 )//<=300mm
			   	aa = 172;
			else if( temp16_max <=8000 )//<=400mm 
				aa = 282;
			else if( temp16_max <=10000 )//<=500mm
				aa = 408;
			else 
				aa = 485;
			bb = val;
			
			if( temp16_y == 0)
		    	temp32 =(UINT32)temp16_max *10/kk + bb*50 - aa;
			else
				temp32 =(UINT32)temp16_max *10/kk + bb*50 + 50;
			*/
			
		#else
			if( temp16_max <= 255)
			  return 95;
			if( (sys.status == SETOUT)||(sys.status == FINISH))
			     val = go_setout_speed % 10;
		    else
			     val = nop_move_speed % 10;
		 
			if( temp16_max <=1300 )//65mm 1300
			   	kk = 125;
			else if( temp16_max <=1600 )//80mm 1600
			   	kk = 135;
			else if( temp16_max <=2300 )//110mm 2300
			   	kk = 145;
			else if( temp16_max <=2400 )//150mm 2400
			   	kk = 150;
			else if( temp16_max <=3000 )//150mm 3000
			   	kk = 160;
			else if( temp16_max <=4200 )//210mm 4200
				kk = 170;
			else if( temp16_max <=5000 )//250mm 5000
				kk = 173;
			else if( temp16_max <=6000 )//300mm 6000
				kk = 175;
			else if( temp16_max <=7000 )//350mm 7000
				kk = 185;
			else if( temp16_max <=8000 )//400mm 8000
				kk = 190;
			else if( temp16_max <=9000 )//450mm 9000
				kk = 200;
			else if( temp16_max <=10000 )//500mm 10000
				kk = 205;
			else if( temp16_max <=11000 )//550mm 11000
				kk = 208;//208
			else if( temp16_max <=12000 )//600mm 12000
				kk = 210;//210
			else 
				kk = 215;//215	 
			/*	
			if( temp16_max <=1000 )//<=50mm
			   	aa = 29;
			else if( temp16_max <=2000 )//<=100mm
			   	aa = 52;
			else if( temp16_max <=3000 )//<=150mm
			   	aa = 75;
			else if( temp16_max <=4000 )//<=200mm 
			   	aa = 93;
			else if( temp16_max <=6000 )//<=300mm
			   	aa = 172;
			else if( temp16_max <=8000 )//<=400mm 
				aa = 282;
			else if( temp16_max <=10000 )//<=500mm
				aa = 408;
			else 
				aa = 485;
			*/	
			bb = val;
			if(bb <1)
			   bb = 1;
			#if COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER35 || COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER36
		    temp32 =(UINT32)temp16_max *10/kk + bb*50 + 125;//350
			#else
			temp32 =(UINT32)temp16_max *10/kk + bb*50 + 350;
			#endif
			
		#endif
		    
			#if DEBUG_NOPMOVE_SPEED
			if( temp32 > para_x_take_offset_right)
				temp32 -= para_x_take_offset_right;	//k204
			#endif
			return temp32;
				
 #endif
}
/**
  * @函数功能 检测底线的剩余量
  * @参数 无
  * @返回值 无
  */

UINT8 check_bottom_remain(void)
{
	UINT16 x_temp, y_temp,k,temp16;
	PATTERN_DATA *TempPatpoint;
	
}

/**
  * @函数功能 空送一段距离找到起缝点
  * @参数 FirstNopmoveFlag---是否有偏差
  * @返回值 无
  */
void go_beginpoint(UINT8 FirstNopmoveFlag)
{	
	UINT32 temp16_x,temp16_y,temp16_max,temp32;	
	UINT16 i,j; 
	UINT16 time_shiled_pause;
	INT32 allx_temp_step,ally_temp_step;	
	INT32 tempx_step,tempy_step,add_x,add_y; 
	UINT16 quick_time = 60,tmpx,tmpy;	
	PATTERN_DATA *TempPatpoint;

	stepmotor_need_double_time = 1;
	move_flag = 0;
	nopmove_flag = 0;
	lastmove_flag = 0;	
	tempx_step = 0;
	tempy_step = 0;
	time_shiled_pause = 0;
	
	//因为空送中途可能按急停，所以在空送动作之前把当时的指针、坐标保存下来，准备后退时使用。
	TempPatpoint = pat_point;
	allx_temp_step = allx_step;
	ally_temp_step = ally_step;
	bakeup_total_counter = pat_buff_total_counter;
	add_x = 0;
	add_y = 0;
	//--------------------------------------------------------------------------------------
  	//  process pattern data
  	//--------------------------------------------------------------------------------------
	while(1)
	{				
  		process_data();           
    	if(nopmove_flag == 1)//统计这一段空送的距离。
    	{	  
    		tempx_step = tempx_step + xstep_cou;
      		tempy_step = tempy_step + ystep_cou;      
      		allx_step = allx_step + xstep_cou;
      		ally_step = ally_step + ystep_cou;  			
			
			//确认统计距离没超过缝制范围
			if( check_sewing_range())
			{
				allx_step = allx_temp_step;
				ally_step = ally_temp_step;
				pat_point = TempPatpoint;
				OutOfRange_flag = 1;
				return;
			}
			/*
			遇到空送结束先看一下是不是选择直接到起缝点功能，直接到起缝点则忽略掉多段空送的情况，统计完整的空送距离，一次走到位
			判定条件：空送结束+按空送走 或者 空送结束+直接到起缝点，但不是第一段空送
			k32 0-直接到起缝点 1-按空送路线走		
			*/
      		if( (lastmove_flag == 1)&&( (second_point_passby_flag != 0)||(already_find_startpoint_flag !=0)) )//遇到空送分段结束，要停下来先走一段
      		{    	  
				//记录下空送之后要到达的目标位置。空送中途急停后，按+就运行到目标位置；按-就返回空送前的位置；
				//保存上下文：花样指针、XY坐标、缝制的总针数
				target_pat_point = pat_point;
    			target_allx_step = allx_step;
				target_ally_step = ally_step;
				target_total_counter = pat_buff_total_counter;
				/*
				看是否有加固缝处理
				sewingcontrol_flag =  0 不加固
				sewingcontrol_flag ＝ 1 在第一针加固
				sewingcontrol_flag ＝ 2 在前几针加固
				need_backward_sewing ＝ 1 要进行加固处理的条件满足了
				sewingcontrol_stitchs 加固的针数
				针数 > 0 采用的是 V 型加固，要先移动几针，再反向缝制回来；指针、坐标先调整过去；
				针数 < 0 采用的是 W 型加固，到下个起缝点，先走几针，再返回来，再重新缝制下去；
				*/
				if( (sewingcontrol_flag == 2)&&(need_backward_sewing == 1) )
				{
					process_data();
					if(origin2_lastmove_flag == 1) //如果是空送中遇到第二原点，就跳过去
					{
						origin2_lastmove_flag = 0;
						process_data();
						do_pat_point_sub_one();
					}
					else
					    do_pat_point_sub_one();
					   
					if( move_flag == 1)//如果空送后面就是车缝了，准备加固处理
					{
					    if( sewingcontrol_stitchs !=0 )//有加固的计数设定
						    need_action_once = 1;
						if( sewingcontrol_stitchs > 0 )//遇到V字型加固方式
						{
							i = 0;
							need_action_once = 1;
							while( i < sewingcontrol_stitchs )
							{
								move_flag = 0;
								process_data();
								if( move_flag == 1 )//先找几针车缝（注意这里没考虑车缝接着空送的情况）
								{
									  i++;
									  tempx_step = tempx_step + xstep_cou;//在原来结束点的基础上再做前后调整
						      		  tempy_step = tempy_step + ystep_cou;      
									  allx_step = allx_step + xstep_cou;
		      						  ally_step = ally_step + ystep_cou;   
									  add_x += xstep_cou;
									  add_y += ystep_cou;            
									  move_flag = 0;
  								}
								//if( (end_flag==1)||(nopmove_flag==1) )
								//  break;
							}
						}
					}
				}
				nopmove_flag = 0;
    	  		lastmove_flag = 0;	
				move_flag = 0;		
    	  		break;   	    	    	
      		}       
      		nopmove_flag = 0;
			lastmove_flag = 0;
			move_flag = 0;
    	}
		else if( (second_point_passby_flag == 0)&&(origin2_lastmove_flag == 1) )
				origin2_lastmove_flag = 0;
    	else
    	{
			do_pat_point_sub_one();  
			target_pat_point = pat_point;
    		target_allx_step = allx_step;
			target_ally_step = ally_step;
			target_total_counter = pat_buff_total_counter;
			FootRotateFlag = 0;//如果这针是记号笔，后面直接就处理了一次，然后下针又处理一次，原地扎针了
			
			if( move_flag == 1)
				already_find_startpoint_flag = 1;
		    
    		break;   	
    	}	
    	rec_com();                                        	        
  	}//while(1)     
	
	  
	//根据 X Y的位移大小，采用直接指令 或 快走协议 处理。	
   	temp16_y = fabsm(tempy_step);
	temp16_x = fabsm(tempx_step);
	
	if(temp16_x > temp16_y)
  	{
  	   temp16_max = temp16_x;
  	}
  	else
  	{
  	    temp16_max = temp16_y;
  	}

    if(temp16_max > 255)
    {
	    //quick_time = Calculate_QuickMove_Time(temp16_max);
		quick_time = Calculate_QuickMove_Time(temp16_x,temp16_y);
     }
	 else if(temp16_max <= 255 && temp16_max > 0)
	 {
		  quick_time = 62;
	 }
	 
	 if( (temp16_y <= 255)&&(temp16_y>0) )
	 {
	  	  timer_y = 62;
		  movestep_y(-tempy_step);
	 }
	 else if( temp16_y > 255)
	 {
		  quickmove_y_process(quick_time,-tempy_step);
	 }
	  
	 delay_ms(1);
  
	  if( (temp16_x <=255)&&(temp16_x >0) )
	  { 
	  	   timer_x = 62;
		   movestep_x(-tempx_step);
	  }
	  else if( temp16_x >255)
	  {	
		   quickmove_x_process(quick_time,-tempx_step);
	  }
  
    
  //发出给步进的动作指令后，要等待步进的动作完成，这期间还要扫描是否在空送中按下了急停。
  stepmotor_need_double_time = 0;
  if( temp16_max < 255)
  {
  	  delay_ms(130);
  }
  else
  {
	  	if( (u35==0)&&(sys.status == RUN) )                    
        {
          	if(clamp_com == 1)
          	{
          		if(clamp_flag == 0)
    			{
    				delay_ms(20);
					go_origin_ct();
					delay_ms(20);
    				clamp_out();
    				clamp_stepflag = 1;          			 
					movect_angle = 800;     
    			}
    			if(TSENS == 0)             // sensor is covered
	    		{	
	    			delay_ms(10);
        			if(TSENS == 0)
        			{
      	  				sys.status = ERROR;
						StatusChangeLatch = ERROR;
						if( sys.error == 0)
          					sys.error = ERROR_23;	 // clamp is not in normal position  		  
          				return;
        			}
      			}
         	}	
		}
		 
#if STEPPER_WAITTING_PROTOCOL
        

	for(i=0;i<quick_time;i++)
	{
		delay_ms(1);
		//if( (cutter_function_flag == 1)&&(milling_cutter_action_flag == 1) )
		{
			if( (PAUSE == pause_active_level)&&(special_pause_flag  == 0) )
			{
			   delay_ms(2);
			   if(PAUSE == pause_active_level)
			   {
				  special_pause_flag = 1; 
				  //turnon_buz();
			   }
			}
		}
		if( (enable_stop_in_nopmove == 1)&&(sys.status == RUN)&&(FirstNopmoveFlag ==0)  )
		{
			 if(PAUSE == pause_active_level)   
		     {
			     delay_ms(2);
			     if(PAUSE == pause_active_level)
			     {				
				     nop_move_pause_flag = 1; 
				     nop_move_emergency(temp16_x,temp16_y); //急停命令
					 for(j=0;j<500;j++)
					 {
						delay_ms(1);
						if( check_motion_done() )
						   break;
				  	 }
				     if( j == 500)
					 {
					 	   sys.error = ERROR_70;//ERROR_15;
						   special_go_allmotor_flag = 1;
						   sys.status = ERROR;
						   return;
					 }
					 tmpx = 0;
					 tmpy = 0;
					 delay_ms(10);
					 if( temp16_x > 255 )
					     tmpx = get_x_distance();					 
					 else if( temp16_x != 0)
					     tmpx = temp16_x;
					 else
					 	 tempx_step = 0;
						 
					 delay_ms(10);
					 
					 if( temp16_y > 255  )
					     tmpy = get_y_distance();
					 else if( temp16_y != 0 )
					     tmpy = temp16_y;					 
					 else
						 tempy_step = 0;
					test_nop_emergency(tmpx,tmpy);	
					 //防止另一轴没动作				 
					 if( tmpx == IGNORE_STOP )
					 {
					   tmpx = temp16_x;				   	
					 }		 
					 if(tmpy ==IGNORE_STOP )
					 {
					   tmpy = temp16_y;	
					 }			   
					   
					 read_step_x = tmpx;
					 read_step_y = tmpy;
					 
					 last_pattern_point = TempPatpoint;
					 last_allx_step = allx_temp_step;
					 last_ally_step = ally_temp_step;
					 
					 //**************************
					  if( (tmpx == 0)&&(temp16_x !=0) )//回读为0的处理
					  {
						  if( tmpy !=0)
						      read_step_x = temp16_x;
					  }
					  if( (tmpy == 0)&&(temp16_y !=0) )
					  {
						  if(tmpx !=0)
						    read_step_y = temp16_y;
					  }
					 
					 
					 if( tempx_step >0 )
					 {
					  	 nop_move_remainx = tempx_step - read_step_x;
						 if( nop_move_remainx < 0)
						 {
						     sys.error = ERROR_69;
							 special_go_allmotor_flag = 1;
							 sys.status = ERROR;
						 }
							 
					 }
					 else if ( tempx_step < 0)
					 {
					     nop_move_remainx = tempx_step + read_step_x;
						 if( nop_move_remainx > 0)
						 {
						     sys.error = ERROR_69;
							 special_go_allmotor_flag = 1;
							 sys.status = ERROR;
						  }
						 read_step_x = -read_step_x;
					 }
					 else
					 {
						 nop_move_remainx = 0;
						 read_step_x = 0;
					 }
					      
					 if( tempy_step >0 )	 
					 {
					     nop_move_remainy = tempy_step - read_step_y;
						 if( nop_move_remainy <0 )
						 {
						   sys.error = ERROR_69;
						   special_go_allmotor_flag = 1;
						   sys.status = ERROR;
						 }
					 }
					 else if( tempy_step <0 )
					 {
					     nop_move_remainy = tempy_step + read_step_y;
						 if( nop_move_remainy >0 )
						 {
						   sys.error = ERROR_69;
						   special_go_allmotor_flag = 1;
						   sys.status = ERROR;
						 }
						 read_step_y = -read_step_y;
					 }
					 else
					 {
						 nop_move_remainy = 0;
						 read_step_y = 0;
					 }
					 //**************************
					 if( (sewingcontrol_flag == 2)&&(sewingcontrol_stitchs > 0) )
					 {
						 if (tempx_step != 0)
						     nop_move_remainx -= add_x;
						 if (tempy_step != 0)
						     nop_move_remainy -= add_y;
						 //if( sewingcontrol_stitchs >0 )
						     need_action_once = 0;
					 }
					 break;
		  	     }
			 }
		 }
	}
	if( nop_move_pause_flag == 0)
	{
		for(i=0;i<quick_time;i++)
		{
			delay_ms(1);
			if( check_motion_done() )
			{
			   delay_ms(5);
			   break;
			}
		}
		monitor_allx_step = allx_step;
		monitor_ally_step = ally_step;
		monitor_pat_point = pat_point - 1; 
		monitor_refresh_flag = 1;
	}
#else		 
		 
	  if(stepversion1 > 32)//根据驱动版本号决定是否在空送结束前一段时间屏蔽急停
	  {
		  time_shiled_pause = 0;
	  }
	  else
	  {
		  time_shiled_pause = 300;
	  }
	  if(quick_time < (98 + time_shiled_pause))
	    quick_time = 98 + time_shiled_pause;
					 
	  for(i=0;i<quick_time - (time_shiled_pause + 98);i++)//58
	  {
	     delay_ms(1);
	
		 if( (enable_stop_in_nopmove == 1)&&(sys.status == RUN) )
		 {
			 if(PAUSE == pause_active_level)   
		     {
			     delay_ms(2);
			     if(PAUSE == pause_active_level)
			     {				
				     nop_move_pause_flag = 1; 
				     nop_move_emergency(temp16_x,temp16_y); //急停命令
					 delay_ms(20);
					 
					 tmpx = 0;
					 tmpy = 0;
					 if( temp16_x > 255 )
					     tmpx = get_x_distance();					 
					 else if( temp16_x != 0)
					     tmpx = temp16_x;
					 else
					 	 tempx_step = 0;
						 
					 delay_ms(10);
					 
					 if( temp16_y > 255  )
					     tmpy = get_y_distance();
					 else if( temp16_y != 0 )
					     tmpy = temp16_y;					 
					 else
						 tempy_step = 0;
						
					 //防止另一轴没动作				 
					 if( tmpx == IGNORE_STOP )
					   tmpx = temp16_x;					 
					 if(tmpy ==IGNORE_STOP )
					   tmpy = temp16_y;					   
					   
					 read_step_x = tmpx;
					 read_step_y = tmpy;
					 
					 last_pattern_point = TempPatpoint;
					 last_allx_step = allx_temp_step;
					 last_ally_step = ally_temp_step;
					 
					 //**************************
					  if( (tmpx == 0)&&(temp16_x !=0) )//回读为0的处理
					  {
						  if(tmpy !=0)
						    read_step_x = temp16_x;
					  }
					  if( (tmpy == 0)&&(temp16_y !=0) )
					  {
						  if(tmpx !=0)
						    read_step_y = temp16_y;
					  }
					 
					 
					 if( tempx_step >0 )
					 {
					  	 nop_move_remainx = tempx_step - read_step_x;
						 if( nop_move_remainx < 0)
						 {
						     sys.error = ERROR_15;
							 special_go_allmotor_flag = 1;
						 }
							 
					 }
					 else if ( tempx_step < 0)
					 {
					     nop_move_remainx = tempx_step + read_step_x;
						 if( nop_move_remainx > 0)
						 {
						    sys.error = ERROR_15;
							special_go_allmotor_flag = 1;
						  }
						 read_step_x = -read_step_x;
					 }
					 else
					 {
						 nop_move_remainx = 0;
						 read_step_x = 0;
					 }
					      
					 if( tempy_step >0 )	 
					 {
					     nop_move_remainy = tempy_step - read_step_y;
						 if( nop_move_remainy <0 )
						 {
						   sys.error = ERROR_15;
						   special_go_allmotor_flag = 1;
						 }
					 }
					 else if( tempy_step <0 )
					 {
					     nop_move_remainy = tempy_step + read_step_y;
						 if( nop_move_remainy >0 )
						 {
						   sys.error = ERROR_15;
						   special_go_allmotor_flag = 1;
						 }
						 read_step_y = -read_step_y;
					 }
					 else
					 {
						 nop_move_remainy = 0;
						 read_step_y = 0;
					 }
					 
					 //**************************
					 if( (sewingcontrol_flag == 2)&&(need_backward_sewing == 1) )
					 {
						 /*
						 tempx_step -= add_x;
						 tempy_step -= add_y;
						 if( sewingcontrol_stitchs >0 )//空送急停后，再启动不加固了。
						    need_action_once = 0;
						 */
						 if (tempx_step != 0)
						     nop_move_remainx -= add_x;
						 if (tempy_step != 0)
						     nop_move_remainy -= add_y;
						 if( sewingcontrol_stitchs >0 )//空送急停后，再启动不加固了。
						     need_action_once = 0;
					 }
					 break;
		  	     }
			 }
		 }
		
	  }
	  delay_ms(106 + time_shiled_pause);
#endif
  }
}
//--------------------------------------------------------------------------------------
//  Name:		go_sewingtest_beginpoint
//  Parameters:	None
//  Returns:	None
//  Description: x motor and y motor go beginpoint
//--------------------------------------------------------------------------------------
void go_sewingtest_beginpoint(void)
{	
	UINT32 temp16_x,temp16_y,temp16_max,temp32;	
	UINT16 i;	
	INT32 tempx_step,tempy_step; 
	INT32 allx_temp_step,ally_temp_step,tmpx,tmpy;
	UINT16 quick_time = 60;
	UINT8 temp8;
	PATTERN_DATA *TempStart_pointTemp, *TempPatpoint;
	
	move_flag = 0;
	nopmove_flag = 0;
	lastmove_flag = 0;	
	tempx_step = 0;
	stop_flag = 0;
	tempy_step = 0;
	LastNopMoveFlag = 0;
	
	stepmotor_need_double_time = 1;
	
	TempStart_pointTemp = pat_point;
	TempPatpoint = pat_point;
	allx_temp_step = allx_step;
	ally_temp_step = ally_step;
	bakeup_total_counter = pat_buff_total_counter;
	//--------------------------------------------------------------------------------------
  	//  process pattern data
  	//--------------------------------------------------------------------------------------
	while(1)
	{				
  		process_sewingtest_data();           
    	if(nopmove_flag == 1)
    	{	  
    		tempx_step = tempx_step + xstep_cou;
      		tempy_step = tempy_step + ystep_cou;      
      		allx_step = allx_step + xstep_cou;
      		ally_step = ally_step + ystep_cou; 
		    if( check_sewing_range())
			{
				allx_step = allx_temp_step;
				ally_step = ally_temp_step;
				pat_point = TempStart_pointTemp;
				sys.error = ERROR_15;
				StatusChangeLatch = ERROR;
				return;
			}
			nopmove_flag = 0;
			if(lastmove_flag == 1)
      		{    	  
				target_pat_point = pat_point;
    			target_allx_step = allx_step;
				target_ally_step = ally_step;
				target_total_counter = pat_buff_total_counter;
				
				process_sewingtest_data();
				
				if(stop_flag == 1 && move_flag == 1)
				{
					SewTestStitchCounter++;
					do_pat_point_sub_one();
					move_flag = 0;
					stop_flag = 0;       
					StopStatusFlag = 0; 
				}
				else if(stop_flag == 1 && move_flag == 0)
				{	
					do_pat_point_sub_one();
					stop_flag = 0;      
					StopStatusFlag = 0; 
				}
				else if(nopmove_flag == 1 || FootRotateFlag ==1 ||end_flag == 1)
				{
					do_pat_point_sub_one();
					FootRotateFlag = 0;
				}
				else if(move_flag == 1 && stop_flag == 0)
				{
					SewTestStitchCounter++;
					do_pat_point_sub_one();
					move_flag = 0;
				}
    	  		lastmove_flag = 0;
				origin2_lastmove_flag = 0;
    	  		break;   	    	    	
      		}    
      		nopmove_flag = 0;
    	}
    	else
    	{
    		do_pat_point_sub_one();   	    	
    		break;   	
    	}	
    	rec_com();                                      	        
  	}     
  
  temp8 = detect_position();	
  if(temp8 == OUT)    
  {
	find_dead_center();
  }
  if(inpress_flag == 0)  		
  {
	inpress_up();        	
   }
  	
  //--------------------------------------------------------------------------------------
  // y go start point
  //--------------------------------------------------------------------------------------
    temp16_y = fabsm(tempy_step);
    temp16_x = fabsm(tempx_step);

	
  if(temp16_x > temp16_y)
  	{
  		temp16_max = temp16_x;
  	}
  	else
  	{
  		temp16_max = temp16_y;
  	}

   	if(temp16_max > 255)
	{
		//quick_time = Calculate_QuickMove_Time(temp16_max);
		quick_time = Calculate_QuickMove_Time(temp16_x,temp16_y);
	}
	else if(temp16_max <= 255 && temp16_max > 0)
	{
		quick_time = 62;
	}
  if(temp16_y < 255)
  {
	timer_y = 62;
	movestep_y(-tempy_step);
  }
  else
  {
	  quickmove_y_process(quick_time,-tempy_step);	
  }
  delay_ms(1);
  //--------------------------------------------------------------------------------------
  // x go start point
  //--------------------------------------------------------------------------------------
  
  if(temp16_x < 255)
  {
  	timer_x = 62;
	movestep_x(-tempx_step);
  }
  else
  {
    quickmove_x_process(quick_time,-tempx_step);	
  }
  stepmotor_need_double_time = 0;
  if(temp16_max < 255)
  {
  	delay_ms(130);
  }
  else
  {
	 delay_ms(quick_time);
	 for(i =0;i<quick_time-58;i++)
	 {
			delay_ms(1);
			if( check_motion_done() )
			{
			   delay_ms(50);
			   break;
			}
	 }
 	 delay_ms(168);
  }
  	
}
//--------------------------------------------------------------------------------------
//  Name:		conprocess_data
//  Parameters:	None
//  Returns:	None
//  Description: process pattern data
//--------------------------------------------------------------------------------------
void conprocess_data(void)//mei you diao yong
{
	UINT8 break_flag;
		
	break_flag = 0;	
	start_flag = 0;
	while(1)
	{
		if( (pat_point == sta_point)&&(super_pattern_flag == 0) )
		{
			start_flag = 1;
			break_flag = 1;
		}
		else
		{	 
			do_pat_point_sub_one();
      		switch(pat_point->func & 0xF0)
      		{
      		//-----------------------------------------------------------------------	
        	// fuction code
        	//-----------------------------------------------------------------------		   		
      			case 0xC0: 
      		     	switch(pat_point->xstep)
                   	{	
      	           		case 0x00: break_flag =1;start_flag = 1;break;
      	             	case 0x01: break;
      	             	case 0x02: break;	
      	             	case 0x03: break;
      	             	case 0x04: break;
      	             	case 0x1A: break;
						case 0x0F: break;
      	             	default:   break;
                   	}
      		        break;
      			case 0x80: 
					switch(pat_point->xstep)
					{
						case 0x02:
							origin2_lastmove_flag = 1;
							break_flag = 1;
							break;
						case 0x0e:
							xstep_cou = 0; 
                 	  		ystep_cou = 0;
							break_flag = 1;
						break;
						default:
							break;
					}
					break; 
      			//-----------------------------------------------------------------------	
        		// only move stepper motor 
        		//-----------------------------------------------------------------------		   		
      			case 0x50: lastmove_flag = 1; 		   		
      			case 0x10: lastmove_flag = 1; 		
        		case 0x00:       	        	               							
        	      	  xstep_cou = ((INT16)pat_point->xstep)*2; 
                 	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      	         	  switch(pat_point->func & 0x0F)
                 	  {	
    	         	      case 0x00: break;
    	         	      case 0x08: xstep_cou = xstep_cou+1; break;
    	         	      case 0x02: ystep_cou = ystep_cou+1; break;
    	         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    	         	      default:   break;
                 	  }     
         
      		      	nopmove_flag = 1; 
      		       	break_flag = 1;
      		       	break;    					
      				//-----------------------------------------------------------------------	
        			// normal stitch
        			//-----------------------------------------------------------------------		   		  	  			
        		case 0x20: 
        		case 0x30: 
       			case 0x60: 
      			case 0x70: 
      		     	  xstep_cou = ((INT16)pat_point->xstep)*2; 
                 	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      	         	  switch(pat_point->func & 0x0F)
                 	  {	
    	         	      case 0x00: break;
    	         	      case 0x08: xstep_cou = xstep_cou+1; break;
    	         	      case 0x02: ystep_cou = ystep_cou+1; break;
    	         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    	         	      default:   break;
                 	  } 
      
      		       	move_flag = 1; 
      		       	break_flag = 1;
      		       	break;    					
      			//-----------------------------------------------------------------------	
        		// default
        		//-----------------------------------------------------------------------		   		  	  				
      			default:   break;
      		}
    	}     
    	if(break_flag == 1)
    	{
    		break;
    	}	 
  	}                           
}
//--------------------------------------------------------------------------------------
//  Name:		conprocess_edit_data
//  Parameters:	None
//  Returns:	None
//  Description: process pattern data
//--------------------------------------------------------------------------------------
void conprocess_edit_data(void)
{
	UINT8 break_flag;
	xstep_cou = 0; 
	ystep_cou = 0; 
	break_flag = 0;	
	start_flag = 0;
	while(1)
	{
		if(first_stitch_flag == 1)
		{
			break_flag = 1;
		}
		else
		{	
			end_flag = 0;
			switch(pat_point->func & 0xFF)
      		{
      		//-----------------------------------------------------------------------	
        	// fuction code
        	//-----------------------------------------------------------------------		   		
      			case 0xC0: 
      		     	switch(pat_point->xstep)
                   	{	
      	           		case 0x00: 
							first_stitch_flag = 1;	
							break_flag = 1; 			
							break;
      	             	case 0x01: 
							break_flag = 1;										
							break;
      	             	case 0x02: 
							break_flag = 1;										
							break;	
      	             	case 0x03: 
							break_flag = 1;	
				
							break;
      	             	case 0x04: 
							break_flag = 1;	
				
							break;
						case 0x0b:
						case 0x05: 
							switch(pat_point->ystep)
							{
								case 0://画笔结束
									making_pen_status = 4;
									FootRotateFlag = 1; 
								break;
								case 1://画笔开始
									making_pen_status = 3;
									FootRotateFlag = 1; 
								break;
								case 3://激光切割结束
									milling_cutter_action_flag = 2;
								break;
								case 4://激光切割开始
									milling_cutter_action_flag = 1;
								break;
								default:
									FootRotateFlag = 1;  
								break;
							}

							break_flag = 1; 	
							break;
						case 0x09:
							break_flag = 1;
							break;
						case 0x0A:									  
							break_flag = 1; 	
							break;	
						case 0x1A:									  
							break_flag = 1; 	
							break;
      	             	default:   											
							break;
                   	}
      		        break;
				case 0xC1:
					switch(pat_point->xstep)
					{
						case 0x1A:
							break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC2:
					switch(pat_point->xstep)
					{
							break;
						default:
							break;
					}
					break;
				case 0xC3:
					switch(pat_point->xstep)
					{
						case 0x03:  //2013-7-29 add
						     break_flag = 1;
							 break;
						case 0x1A:
							break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC4:  //2013-7-29 add
					switch(pat_point->xstep)
					{
						case 0x03:  
						     break_flag = 1;
							 break;
						default:
							break;
					}
					break;
				case 0xC7:  //2013-7-29 add
					switch(pat_point->xstep)
					{
						case 0x03:  
						     break_flag = 1;
							 break;
						default:
							break;
					}
					break;
				case 0xC8:  //2013-7-29 add
					switch(pat_point->xstep)
					{
						case 0x03:  
						     break_flag = 1;
							 break;
						default:
							break;
					}
					break;
				case 0xCB:  //2013-7-29 add
					switch(pat_point->xstep)
					{
						case 0x03:  
						     break_flag = 1;
							 break;
						default:
							break;
					}
					break;
      			case 0x80: 
					switch(pat_point->xstep)
					{
						case 0x02:
							origin2_lastmove_flag = 1;
							break_flag = 1;
							break;
						case 0x03:
							// foot up,taken-up up
							break_flag = 1;
							break;
						case 0x04:
							break_flag = 1;
							break;
						case 0x0b:
						case 0x05:
							switch(pat_point->ystep)
							{
								case 0://画笔结束
									making_pen_status = 4;
									FootRotateFlag = 1; 
								break;
								case 1://画笔开始
									making_pen_status = 3;
									FootRotateFlag = 1; 
								break;
								case 3://激光切割结束
									milling_cutter_action_flag = 2;
								break;
								case 4://激光切割开始
									milling_cutter_action_flag = 1;
								break;
								default:
									FootRotateFlag = 1;  
								break;
							}
							break_flag = 1;
							break;
						case 0x06:
							break_flag = 1;
							break;
						case 0x07:
							break_flag = 1;
							break;
						case 0x08:
							break_flag = 1;
							break;
						case 0x09:
							break_flag = 1;
							break;
						case 0x0A:									  
							break_flag = 1; 	
							break;
						case 0x0C:
							break_flag = 1;
							break;
						case 0x0D:
							break_flag = 1;
							break;
						case 0x0F:
							break_flag = 1;
							break;
						case 0x11:
							break_flag = 1;
							break; 
						case 0x12:
							break_flag = 1;
							break;
						case 0x13://2013-11-19
					    	break_flag = 1; 
						break;
						case 0x14:
							break_flag = 1;
							break;
						case 0x15:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						case 0x1B:
							break_flag = 1;
							break;
						default:
							break;
					}
	
					break; 
				case 0x81:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						default:
							break;
					}

					break;
				case 0x82:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						default:
							break;
					}

					break;
				case 0x83:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break_flag = 1;
							break;
						case 0x1A:
							break_flag = 1;
							break;
						case 0x03:
							break_flag = 1;											// foot down,taken-up up	
							break;
						default:
							break;
					}
			
					break;
				case 0x84:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;											// foot up,taken-up dead point
							break;
						case 0x1B:
							break_flag = 1;
							break;
						default:
							break;
					}
					
					break;
				case 0x87:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;										// foot down,taken-up dead point
							break;
						default:
							break;
					}
		
					break;
				case 0x88:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;										// foot up, taken-up down
							break;
						case 0x1B:
							break_flag = 1;
							break;
						default:
							break;
					}
		
					break;
				case 0x8B:
					switch(pat_point->xstep)
					{
						case 0x03:
							break_flag = 1;										// foot down,taken-up down
							break;
						default:
							break;
					}
	
					break; 			
      			//-----------------------------------------------------------------------	
        		// default
        		//-----------------------------------------------------------------------		   		  	  				
      			default:   break;
      		}
      		switch(pat_point->func & 0xF0)
    		{
    			//-----------------------------------------------------------------------	
        		// only move stepper motor 
        		//-----------------------------------------------------------------------		   		
      			case 0x50: lastmove_flag = 1; 		   		
      			case 0x00:			
        		case 0x10:       	        	               							
        	      	      xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  }    
	         
      		      	nopmove_flag = 1; 
      		       	break_flag = 1;
      		       	break;    					
      				//-----------------------------------------------------------------------	
        			// normal stitch
        			//-----------------------------------------------------------------------		   		  	  			
        		case 0x20: 
        		case 0x30: 
       			case 0x60: 
      			case 0x70: 
      		     	      xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  }  
        
      		       	move_flag = 1; 
      		       	break_flag = 1;
      		       	break;  					
    		    //-----------------------------------------------------------------------	
      			// default
      			//-----------------------------------------------------------------------		   		  	  				
    			default:   
					break;
    		}
			do_pat_point_sub_one();
    	}     
    	if(break_flag == 1)
    	{
    		break;
    	}	 
  	}                           
}
//--------------------------------------------------------------------------------------
//  Name:		conprocess_sewingtest_data
//  Parameters:	None
//  Returns:	None
//  Description: process pattern data
//--------------------------------------------------------------------------------------
void conprocess_sewingtest_data(void)
{
	PATTERN_DATA *TempStart_pointTemp;   
	UINT8 break_flag;
	xstep_cou = 0;
	ystep_cou = 0;		
	break_flag = 0;	
	start_flag = 0;
	end_flag = 0;
	while(1)
	{
		if(pat_point == sta_point && super_pattern_flag == 0)
		{
			start_flag = 1;
			break_flag = 1;
		}
		else if( (pat_point == sta_point)&&(super_pattern_flag == 1)&&(pat_buff_total_counter < HALF_STITCH_COUNTER))
		{
			start_flag = 1;
			break_flag = 1;
		}
		else
		{	 
			do_pat_point_sub_one(); 
			
      		switch(pat_point->func & 0xFF)
      		{
					
				case 0xC0: 
		    		switch(pat_point->xstep)
		            {	
		    	        case 0x00: 		
							start_flag = 1;
							break_flag = 1;			           
							break;
		    	        case 0x01: 
							end_flag = 1;   
							break_flag = 1; 
							break;
		    	        case 0x02: 
							break;	        
		    	        case 0x03: 
							stop_flag = 1;  
							stop_number = 1;											// foot up,taken-up up
							StopStatusFlag = 1;
	//						break_flag = 1; 
							break;
		    	        case 0x04: 
							break;
						case 0x0b:
						case 0x05:
							switch(pat_point->ystep)
							{
								case 0://画笔结束
									making_pen_status = 4;
									FootRotateFlag = 1; 
								break;
								case 1://画笔开始
									making_pen_status = 3;
									FootRotateFlag = 1; 
								break;
								case 3://激光切割结束
									milling_cutter_action_flag = 2;
								break;
								case 4://激光切割开始
									milling_cutter_action_flag = 1;
								break;
								default:
									FootRotateFlag = 1;  
								break;
							}
							break_flag = 1;	 //2010-4-22
							break;
						case 0x07://输出
						OutputFlag = 1;
						OutputNumber = pat_point->ystep;
						if( OutputNumber == 0 )
						    milling_cutter_action_flag = 1;
						else if( OutputNumber == 1 )
						    milling_cutter_action_flag = 2;
						break_flag = 1;	
						break;
		    	        default:   
							break;
		            }
		    		break;
				
				case 0xC3:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 2;											// foot down,taken-up up
	//						break_flag = 1;	
							StopStatusFlag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC4:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 3;											// foot up,taken-up dead point
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC7:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 4;										// foot down,taken-up dead point
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xC8:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 5;										// foot up, taken-up down
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0xCB:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 6;										// foot down,taken-up down
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						default:
							break;
					}
					break;
			
		    	case 0x80: 
					switch(pat_point->xstep)
					{
						case 0x02:
							origin2_lastmove_flag = 1;
							break;
						case 0x03:
							stop_flag = 1;
							stop_number = 1;											// foot up,taken-up up
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						case 0x0b:
						case 0x05:
							switch(pat_point->ystep)
							{
								case 0://画笔结束
									making_pen_status = 4;
									FootRotateFlag = 1; 
								break;
								case 1://画笔开始
									making_pen_status = 3;
									FootRotateFlag = 1; 
								break;
								case 3://激光切割结束
									milling_cutter_action_flag = 2;
								break;
								case 4://激光切割开始
									milling_cutter_action_flag = 1;
								break;
								default:
									FootRotateFlag = 1;  
								break;
							}
							break_flag = 1;	//2010-4-22
							break;
						case 0x06:
							break;
						case 0x07:
							break;
						case 0x08:
							break;
						case 0x09:
							break;
						case 0x0C:
							break;
						case 0x0D:
							break;
						case 0x0F:
							break;
						case 0x11:
							break; 
						case 0x12:
							break;
						case 0x14:
							break;
						case 0x15:
							break;
						case 0x1A:
							break;
						case 0x1B:
							break;
						default:
							break;
					}	
					break; 
				case 0x81:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break;
						case 0x1A:
							break;
						default:
							break;
					}
					break;
				case 0x82:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break;
						case 0x1A:
							break;
						default:
							break;
					}
					break;
				case 0x83:
					switch(pat_point->xstep)
					{
						case 0x0F:
							break;
						case 0x1A:
							break;
						case 0x03:
							stop_flag = 1;
							stop_number = 2;											// foot down,taken-up up
							StopStatusFlag = 1;
	//						break_flag = 1;	
							break;
						default:
							break;
					}
					break;
				case 0x84:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 3;											// foot up,taken-up dead point
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						case 0x1B:
							break;
						default:
							break;
					}
					break;
				case 0x87:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 4;										// foot down,taken-up dead point
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						default:
							break;
					}
					break;
				case 0x88:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 5;										// foot up, taken-up down
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						case 0x1B:
							break;
						default:
							break;
					}
					break;
				case 0x8B:
					switch(pat_point->xstep)
					{
						case 0x03:
							stop_flag = 1;
							stop_number = 6;										// foot down,taken-up down
							StopStatusFlag = 1;
	//						break_flag = 1;
							break;
						default:
							break;
					}
					break;	
      			//-----------------------------------------------------------------------	
        		// default
        		//-----------------------------------------------------------------------		   		  	  				
      			default:   break;
      		}
      		switch(pat_point->func & 0xF0)
    		{
    			//-----------------------------------------------------------------------	
	      		// inpress and tension fuction code
	      		//-----------------------------------------------------------------------
    			case 0xC0:
    			case 0x80:
    				switch(pat_point->xstep)
					{
						case 0x1A:
							 if((single_comm == 0x81) || (single_comm == 0x82)) //2013-5-23 modify
							 {
								  TempStart_pointTemp = pat_point;
					       
								  TempStart_pointTemp--;
					              while(TempStart_pointTemp > (PATTERN_DATA *)(pat_buf))
					              {
						               if( (((TempStart_pointTemp->func & 0xF0) == 0x80) || ((TempStart_pointTemp->func & 0xF0) == 0xC0)) && (TempStart_pointTemp->xstep == 0x1A) )
						                {
							                  inpress_delta = ((INT16)(TempStart_pointTemp->ystep))*4;
    					                      switch(TempStart_pointTemp->func & 0x0F)
    					                      {
							                       case 0x00: 					                   break;
							                       case 0x01: inpress_delta = inpress_delta + 1;  break;
							                       case 0x02: inpress_delta = inpress_delta + 2;  break;
							                       case 0x03: inpress_delta = inpress_delta + 3;  break;
							                       default:	 				 				   break;
	    				                       }
							   
							                   inpress_high = inpress_high_hole + inpress_delta;
	    				                       if(inpress_high > 70)
							                      inpress_high = 70;
						                       if(inpress_high < 0)
							                      inpress_high = 0;	
						                       break;
						                }
						                //do_pat_point_sub_one();
										TempStart_pointTemp--;
					           }
					           if(TempStart_pointTemp == (PATTERN_DATA *)(pat_buf))
					              inpress_high = inpress_high_hole;
						
								
								single_inpress_flag = 1;
							}
    						course_run_stop_flag = 1;          
							break;
						case 0x0F:
							course_thread_run_stop_flag = 1;  
							break;
						case 0x0e:
							cutter_function_flag = 1;
							cutter_rotated_abs_angle = (pat_point->func)&0x0f;
							cutter_rotated_abs_angle = cutter_rotated_abs_angle <<8;
							cutter_rotated_abs_angle += (UINT8)pat_point->ystep;
						 	milling_cutter_action_flag = 1;
						break;
						default:
							break;
    				}
    				break;	
    			//-----------------------------------------------------------------------	
        		// only move stepper motor 
        		//-----------------------------------------------------------------------		   		
      			case 0x50: lastmove_flag = 1,LastNopMoveFlag = 1; 		   		
      			case 0x10: lastmove_flag = 1,LastNopMoveFlag = 1; 		
        		case 0x00:       	        	               							
        	      	      xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  }  
 	         
      		      	nopmove_flag = 1; 
      		       	break_flag = 1;
      		       	break;    					
      			//-----------------------------------------------------------------------	
        		// normal stitch
        		//-----------------------------------------------------------------------		   		  	  			
        		case 0x20: 
        		case 0x30: 
       			case 0x60: 
      			case 0x70: 
      		     	      xstep_cou = ((INT16)pat_point->xstep)*2; 
        	         	  ystep_cou = ((INT16)pat_point->ystep)*2; 
      		         	  switch(pat_point->func & 0x0F)
        	         	  {	
    		         	      case 0x00: break;
    		         	      case 0x08: xstep_cou = xstep_cou+1; break;
    		         	      case 0x02: ystep_cou = ystep_cou+1; break;
    		         	      case 0x0A: xstep_cou = xstep_cou+1; ystep_cou = ystep_cou+1; break;
    		         	      default:   break;
        	         	  } 
      		       	move_flag = 1; 
      		       	break_flag = 1;
      		       	break;  			
    		    //-----------------------------------------------------------------------	
      			// default
      			//-----------------------------------------------------------------------		   		  	  				
    			default:   
					break;
    		}
    	}  
  	    
    	if(break_flag == 1)
    	{
    		break;
    	}	 
  	}                           
}
//--------------------------------------------------------------------------------------
//  Name:		back_endpoint
//  Parameters:	None
//  Returns:	None
//  Description: x motor and y motor back endpoint
//--------------------------------------------------------------------------------------
void back_endpoint(void)
{	
	UINT32 temp16_x,temp16_y,temp16_max,temp32;	
	UINT16 i;	
	INT32 tempx_step,tempy_step,tmpx,tmpy;
	UINT16 quick_time = 60;	
	PATTERN_DATA *TempPatpoint;
	INT32 allx_temp_step,ally_temp_step;
	
	move_flag = 0;
	nopmove_flag = 0;
	lastmove_flag = 0;	
	tempx_step = 0;
	tempy_step = 0;
	stop_flag = 0;
	origin2_lastmove_flag = 0;
	LastNopMoveFlag = 0;
	
	stepmotor_need_double_time = 1;
	
	TempPatpoint = pat_point;
	allx_temp_step = allx_step;
	ally_temp_step = ally_step;
	bakeup_total_counter = pat_buff_total_counter;

	//--------------------------------------------------------------------------------------
  	//  process pattern data
  	//--------------------------------------------------------------------------------------
	conprocess_sewingtest_data();
	if(nopmove_flag == 1)//????
	{	
    	tempx_step = tempx_step + xstep_cou;
      	tempy_step = tempy_step + ystep_cou;      
      	allx_step = allx_step - xstep_cou;
      	ally_step = ally_step - ystep_cou;                             
      	nopmove_flag = 0;

		if(lastmove_flag == 1)
		{
			lastmove_flag = 0;
		}
		if(LastNopMoveFlag == 1)
		{
			do_pat_point_add_one();
			process_sewingtest_data();
			if(move_flag == 1)
			{
				SewStitchCounterFlag = 1;
				move_flag = 0;
			}
			do_pat_point_sub_one();
			conprocess_sewingtest_data();
			lastmove_flag = 0;
			nopmove_flag = 0;
			LastNopMoveFlag = 0;
		}
		if(SewStitchCounterFlag == 1)
		{
			SewTestStitchCounter--;
			SewStitchCounterFlag = 0;
		}
    }
	while(1)
	{				
	  	conprocess_sewingtest_data();            
	    if(nopmove_flag == 1)
	    {
			if(lastmove_flag == 1)
			{
				do_pat_point_add_one();
				break;
			}
    		tempx_step = tempx_step + xstep_cou;
      		tempy_step = tempy_step + ystep_cou;      
      		allx_step = allx_step - xstep_cou;
      		ally_step = ally_step - ystep_cou;                             
      		nopmove_flag = 0;

    	}
    	else
    	{
			if(origin2_lastmove_flag == 1)
			{
				
			}
			else
			{
    			do_pat_point_add_one();
			}
    		lastmove_flag = 0;
			origin2_lastmove_flag = 0;
    		break;
    	}	
    	rec_com();    // communication with panel                                       	        
  	}     
    temp16_y = fabsm(tempy_step);
    temp16_x = fabsm(tempx_step);

	if(temp16_x > temp16_y)
  	{
  		temp16_max = temp16_x;
  	}
  	else
  	{
  		temp16_max = temp16_y;
  	}

   	if(temp16_max > 255)
	{
		//quick_time = Calculate_QuickMove_Time(temp16_max);
		quick_time = Calculate_QuickMove_Time(temp16_x,temp16_y);
	}
	else if(temp16_max <= 255 && temp16_max > 0)
	{
		quick_time = 62;
	}

  //--------------------------------------------------------------------------------------
  // y go start point
  //--------------------------------------------------------------------------------------
  
  if(temp16_y < 255)
  {
	timer_y = 62;
	movestep_y(tempy_step);
  }
  else
  {
     quickmove_y_process(quick_time,tempy_step);	
  }
  delay_ms(1);
  //--------------------------------------------------------------------------------------
  // x go start point
  //--------------------------------------------------------------------------------------

  if(temp16_x < 255)
  { 
  	timer_x = 62;
	movestep_x(tempx_step);
  }
  else
  {
    quickmove_x_process(quick_time,tempx_step);		
  }
  //--------------------------------------------------------------------------------------
  // delay
  //-------------------------------------------------------------------------------------- 
  stepmotor_need_double_time = 0;
   if(temp16_max < 255)
  {
  	delay_ms(130);
  }
  else
  {
     for(i=0;i<quick_time + 78;i++)
	 {
    	delay_ms(1);
	 }
  }
}
//--------------------------------------------------------------------------------------
//  Name:		single_next
//  Parameters:	None
//  Returns:	None
//  Description: single next step
//--------------------------------------------------------------------------------------
void single_next(void)
{
	INT16 xstep_cou_latch,ystep_cou_latch;

	if( ((foot_flag == 0)||(u202==1) )&&(laser_emergency_stop == 0) )
	{	
		if(SewingTestEndFlag == 0)
		{
			if(TestStatusChangeFlag == 0)
			{
				TestStatusChangeFlag = 1;
			}

			nopmove_flag = 0;
			move_flag = 0;
			cut_flag = 0;
			stop_flag = 0;
			process_sewingtest_data();
			//--------------------------------------------------------------------------------------
	    	//  end of pattern
	    	//-------------------------------------------------------------------------------------- 
			if(end_flag == 1)
	    	{   
	    		single_flag = 0; 	
	    		single_reply = 0x51;     	// stepper motor is not move
	    		do_pat_point_sub_one();
	    		end_flag = 0;  
				predit_shift = 0;
	    		return;
	    	}
			if(FootRotateFlag == 1)
			{
				if( (k110 == 0) )
				{
					marking_flag = 1;
					single_flag = 1;
	  	    		single_reply = 0x01;
				}
				else
				{
					if(k110 == 1)
					  R_AIR = R_AIR^1;
					else if(k110 == 2)
					{
					   if(stretch_foot_flag == 0)
						  stretch_foot_in();
						else
						  stretch_foot_out();	
					}
					FootRotateFlag = 0;
				}
				
			}
			if(nopmove_flag == 1)
			{
				do_pat_point_sub_one();
				single_flag = 4;
	  	    	single_reply = 0x01;   	// stepper motor move next
			}     
	    	//--------------------------------------------------------------------------------------
	    	//  move stepper motor
	    	//-------------------------------------------------------------------------------------- 	
	    	if(move_flag == 1)
	    	{	
		    	if(SewStitchCounterFlag == 1)
				{
					SewStitchCounterFlag = 0;
				}
				single_flag = 1;
	      		single_reply = 0x01;
	    	}	
		}
		else
		{
			single_flag = 0; 	
	    	single_reply = 0x51;     	// stepper motor is not move
		}
  	}
  	else
  	{
		single_flag = 0; 	
	  	single_reply = 0x51;     // stepper motor is not move
  	}
	single_comm = 0x00;   //2012-4-18 add	
}
//--------------------------------------------------------------------------------------
//  Name:		single_inpresser_next
//  Parameters:	None
//  Returns:	None
//  Description: single next step
//--------------------------------------------------------------------------------------
void single_inpresser_next(void)
{
	INT16 xstep_cou_latch,ystep_cou_latch;
	
	if(foot_flag == 0)
	{	
		if(SewingTestEndFlag == 0)
		{
			if(TestStatusChangeFlag == 0)
			{
				TestStatusChangeFlag = 1;
			}
			nopmove_flag = 0;
			move_flag = 0;
			cut_flag = 0;
			stop_flag = 0;
			process_sewingtest_data();
			if(course_run_stop_flag == 1)
			{
				if(move_flag == 1 || nopmove_flag == 1)
				{
					do_pat_point_sub_one();
					move_flag = 0;
					nopmove_flag = 0;
				}
				course_run_stop_flag = 0;
			}
			//--------------------------------------------------------------------------------------
	    	//  end of pattern
	    	//-------------------------------------------------------------------------------------- 
			if(end_flag == 1)
	    	{   
	    		single_flag = 0; 	
	    		single_reply = 0x51;     
	    		do_pat_point_sub_one();
	    		end_flag = 0;  
	    		return;
	    	}
			if(FootRotateFlag == 1)
			{
				if(k110 == 1)     
					     R_AIR = R_AIR^1;
				else if(k110 == 2)      
				{
						     if(stretch_foot_flag == 0)
							   stretch_foot_in();
						    else
							   stretch_foot_out();
				}
				FootRotateFlag = 0;
			}
			if(nopmove_flag == 1)
			{
				do_pat_point_sub_one();
				single_flag = 4;
	  	    	single_reply = 0x03;   	// stepper motor move next
			}     
	    	//--------------------------------------------------------------------------------------
	    	//  move stepper motor
	    	//-------------------------------------------------------------------------------------- 	
	    	if(move_flag == 1)
	    	{	
		    	if(SewStitchCounterFlag == 1)
				{
					SewStitchCounterFlag = 0;
				}
				single_flag = 1;
	      		single_reply = 0x03;
				xstep_cou_latch = xstep_cou;
				ystep_cou_latch = ystep_cou;
				process_sewingtest_data();
				if(move_flag == 1 || nopmove_flag == 1 || end_flag == 1)
				{
					do_pat_point_sub_one();
					move_flag = 0;
					nopmove_flag = 0;
					end_flag = 0;
				}
				xstep_cou = xstep_cou_latch;
				ystep_cou = ystep_cou_latch;
	    	}	
		}
		else
		{
			single_flag = 0; 	
	    	single_reply = 0x51;     	// stepper motor is not move
		}
  	}
  	else
  	{
		if(u202 == 1)
		{
			if(SewingTestEndFlag == 0)
			{
				if(TestStatusChangeFlag == 0)
				{
					TestStatusChangeFlag = 1;
				}
			

				nopmove_flag = 0;
				move_flag = 0;
				cut_flag = 0;
				stop_flag = 0;
				process_sewingtest_data();
				//--------------------------------------------------------------------------------------
		    	//  end of pattern
		    	//-------------------------------------------------------------------------------------- 
				if(end_flag == 1)
		    	{   
		    		single_flag = 0; 	
		    		single_reply = 0x51;     	// stepper motor is not move
		    		do_pat_point_sub_one();
		    		end_flag = 0;  
		    		return;
		    	} 
				if(nopmove_flag == 1)
				{
					do_pat_point_sub_one();
					single_flag = 4;
		  	    	single_reply = 0x03;   	// stepper motor move next
				}
		    	//--------------------------------------------------------------------------------------
		    	//  move stepper motor
		    	//-------------------------------------------------------------------------------------- 	
		    	if(move_flag == 1)
		    	{	
			    	single_flag = 1;
		      		single_reply = 0x01;
		    	}
			}
			else
			{
				single_flag = 0; 	
	  			single_reply = 0x51;     // stepper motor is not move
			}
		}
		else if(u202 == 0)
		{
	  		single_flag = 0; 	
	  		single_reply = 0x51;     // stepper motor is not move
		}
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		single_thread_next
//  Parameters:	None
//  Returns:	None
//  Description: single next step
//--------------------------------------------------------------------------------------
void single_thread_next(void)
{
	INT16 xstep_cou_latch,ystep_cou_latch;
	
	if(foot_flag == 0)
	{	
		if(SewingTestEndFlag == 0)
		{
			if(TestStatusChangeFlag == 0)
			{
				TestStatusChangeFlag = 1;
			}
		

			nopmove_flag = 0;
			move_flag = 0;
			cut_flag = 0;
			stop_flag = 0;
			process_sewingtest_data();
			if(course_thread_run_stop_flag == 1)
			{
				if(move_flag == 1 || nopmove_flag == 1)
				{
					do_pat_point_sub_one();
					move_flag = 0;
					nopmove_flag = 0;
				}
				course_thread_run_stop_flag = 0;
			}
			//--------------------------------------------------------------------------------------
	    	//  end of pattern
	    	//-------------------------------------------------------------------------------------- 
			if(end_flag == 1)
	    	{   
	    		single_flag = 0; 	
	    		single_reply = 0x51;     	// stepper motor is not move
	    		do_pat_point_sub_one();
	    		end_flag = 0;  
	    		return;
	    	}
			if(FootRotateFlag == 1)
			{
						if(k110 == 1)     
					     R_AIR = R_AIR^1;
					   else if(k110 == 2)      //2012-6-7
					    {
						     if(stretch_foot_flag == 0)
							   stretch_foot_in();
						    else
							   stretch_foot_out();
					    }
					FootRotateFlag = 0;

			}
			if(nopmove_flag == 1)
			{
				do_pat_point_sub_one();
				single_flag = 4;
	  	    	single_reply = 0x05;   	// stepper motor move next
			}     
	    	//--------------------------------------------------------------------------------------
	    	//  move stepper motor
	    	//-------------------------------------------------------------------------------------- 	
	    	if(move_flag == 1)
	    	{	
		    	if(SewStitchCounterFlag == 1)
				{
					SewStitchCounterFlag = 0;
				}
				single_flag = 1;
	      		single_reply = 0x05;
				xstep_cou_latch = xstep_cou;
				ystep_cou_latch = ystep_cou;
				process_sewingtest_data();
				if(move_flag == 1 || nopmove_flag == 1 || end_flag == 1)
				{
					do_pat_point_sub_one();
					move_flag = 0;
					nopmove_flag = 0;
					end_flag = 0;
				}
				xstep_cou = xstep_cou_latch;
				ystep_cou = ystep_cou_latch;
	    	}	
		}
		else
		{
			single_flag = 0; 	
	    	single_reply = 0x51;     	// stepper motor is not move
		}
  	}
  	else
  	{
		if(u202 == 1)
		{
			if(SewingTestEndFlag == 0)
			{
				if(TestStatusChangeFlag == 0)
				{
					TestStatusChangeFlag = 1;
				}
			
	
				nopmove_flag = 0;
				move_flag = 0;
				cut_flag = 0;
				stop_flag = 0;
				process_sewingtest_data();
				//--------------------------------------------------------------------------------------
		    	//  end of pattern
		    	//-------------------------------------------------------------------------------------- 
				if(end_flag == 1)
		    	{   
		    		single_flag = 0; 	
		    		single_reply = 0x51;     	// stepper motor is not move
		    		do_pat_point_sub_one();
		    		end_flag = 0;  
		    		return;
		    	} 
				if(nopmove_flag == 1)
				{
					do_pat_point_sub_one();
					single_flag = 4;
		  	    	single_reply = 0x05;   	// stepper motor move next
				}
		    	//--------------------------------------------------------------------------------------
		    	//  move stepper motor
		    	//-------------------------------------------------------------------------------------- 	
		    	if(move_flag == 1)
		    	{	
			    	single_flag = 1;
		      		single_reply = 0x01;
		    	}
			}
			else
			{
				single_flag = 0; 	
	  			single_reply = 0x51;     // stepper motor is not move
			}
		}
		else if(u202 == 0)
		{
	  		single_flag = 0; 	
	  		single_reply = 0x51;     // stepper motor is not move
		}
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		single_edit_next
//  Parameters:	None
//  Returns:	None
//  Description: single next step
//--------------------------------------------------------------------------------------
void single_edit_next(void)
{
	if(foot_flag == 0)
	{	
		if(sys.error == OK)
		{
			process_edit_data();
		}
		else if(sys.error == ERROR_15)
		{
			single_flag = 0; 	
  			single_reply = 0x51;     // stepper motor is not move
			return;
		}
	
		//--------------------------------------------------------------------------------------
    	//  end of pattern
    	//-------------------------------------------------------------------------------------- 
		if(end_flag == 1)
    	{   
    		single_flag = 0; 	
    		single_reply = 0x51;     			// stepper motor is not move  
			end_flag = 0;
			do_pat_point_sub_one();
			
    		return;
    	}        

		if(FootRotateFlag == 1)
		{
				if(k110 == 1)
				  R_AIR = R_AIR^1;
				else if(k110 == 2)
				   {
					   if(stretch_foot_flag == 0)
						  stretch_foot_in();
						else
						  stretch_foot_out();	
				   }
				FootRotateFlag = 0;
		}
    	//--------------------------------------------------------------------------------------
    	//  move stepper motor
    	//-------------------------------------------------------------------------------------- 	
    	if(move_flag == 1 || nopmove_flag == 1)
    	{	
	    	allx_step = allx_step + xstep_cou;
  			ally_step = ally_step + ystep_cou;
			
		    if( check_sewing_range())
			{
				do_pat_point_sub_one();
				
				single_flag = 0; 	
  				single_reply = 0x51;     // stepper motor is not move
				nopmove_flag = 0;
				move_flag = 0;
				sys.error = ERROR_15;
				StatusChangeLatch = ERROR;
				allx_step = allx_step - xstep_cou;
  				ally_step = ally_step - ystep_cou;
				return;
			}
			else
			{
				single_flag = 1;
	      		single_reply = 0x01;
				nopmove_flag = 0;
				allx_step = allx_step - xstep_cou;
  				ally_step = ally_step - ystep_cou;
			}
    	}	
  	}
  	else
  	{
  		single_flag = 0; 	
  		single_reply = 0x51;     // stepper motor is not move
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		single_back
//  Parameters:	None
//  Returns:	None
//  Description: single back step
//--------------------------------------------------------------------------------------
void single_back(void)
{		
	//if( (foot_flag == 0)||(u202 ==1) )
	if( ((foot_flag == 0)||(u202==1) )&&(laser_emergency_stop == 0) )
	{	
		if(SewingTestEndFlag == 0)
		{
			nopmove_flag = 0;
			move_flag = 0;
			lastmove_flag = 0;
			stop_flag = 0;
			single_inpress_flag = 0;  
			conprocess_sewingtest_data();
			
		  	//--------------------------------------------------------------------------------------
	    	//  end of pattern
	    	//-------------------------------------------------------------------------------------- 
	    	if(start_flag == 1)
	    	{
				start_flag = 0;
	    		single_flag = 0; 	
	  	  		single_reply = 0x51;    
				predit_shift = 0;        
	  	  		return;
	    	}	
			if(FootRotateFlag == 1)
			{
				if( (k110 == 0) )
				{
					marking_flag = 1;
					single_flag = 2;
	  	    		single_reply = 0x01;
					FootRotateFlag = 0;
				}
				else
				{
					if(k110 == 1)
					  R_AIR = R_AIR^1;
					else if(k110 == 2)
					{
					   if(stretch_foot_flag == 0)
						  stretch_foot_in();
						else
						  stretch_foot_out();	
					}
					FootRotateFlag = 0;
				}
			}
		  	//--------------------------------------------------------------------------------------
	    	//  back to endpoint
	    	//-------------------------------------------------------------------------------------- 
			if( nopmove_flag == 1)
	    	{    	
				single_flag = 5; 	
	    		single_reply = 0x81; 
	    		process_sewingtest_data();
				nopmove_flag = 0;
				move_flag = 0;   
				lastmove_flag = 0;	
	    		return;
	    	}            
			
	   	 	//--------------------------------------------------------------------------------------
	    	//  move stepper motor
	    	//-------------------------------------------------------------------------------------- 	
	    	if(move_flag == 1)
	    	{	
				LastNopMoveFlag = 0;
		    	single_flag = 2;
	      		single_reply = 0x81;
	    	}
			
		}
		else
		{
			single_flag = 0; 	
	  		single_reply = 0x51;
		}
		if( (end_flag == 1) && (finish_nopmove_pause_flag ==1) )//2014-9-25
		{
			single_flag = 2;
		    single_reply = 0x81;
		}
  	}
 	else 
	{
	  		single_flag = 0; 	
	  		single_reply = 0x51;
	}

	single_comm = 0x00;  //2012-4-18 add
}

//--------------------------------------------------------------------------------------
//  Name:		single_inpresser_back
//  Parameters:	None
//  Returns:	None
//  Description: single back step
//--------------------------------------------------------------------------------------
void single_inpresser_back(void)
{	
	PATTERN_DATA *TempPatpoint;
	UINT16 TempCounter;
	TempPatpoint = pat_point;
	TempCounter = pat_buff_total_counter; 
	stapoint_calc();
	pat_point = TempPatpoint;
	pat_buff_total_counter = TempCounter;
	
	if(foot_flag == 0)
	{	
		if(SewingTestEndFlag == 0)
		{
			
			nopmove_flag = 0;
			move_flag = 0;
			lastmove_flag = 0;
			
		  	conprocess_sewingtest_data();
		
		
		  	//--------------------------------------------------------------------------------------
	    	//  end of pattern
	    	//-------------------------------------------------------------------------------------- 
	    	if(start_flag == 1)
	    	{
	    		start_flag = 0;
	    		single_flag = 0; 	
	  	  		single_reply = 0x51;     
				predit_shift = 0;   
	  	  		return;
	    	}	
			if(FootRotateFlag == 1)
			{
						if(k110 == 1)     
					     R_AIR = R_AIR^1;
					else if(k110 == 2)      //2012-6-7
					   {
						     if(stretch_foot_flag == 0)
							   stretch_foot_in();
						    else
							   stretch_foot_out();
					    }
					FootRotateFlag = 0;
			}
		  	//--------------------------------------------------------------------------------------
	    	//  back to endpoint
	    	//-------------------------------------------------------------------------------------- 
		  	if(lastmove_flag == 1)
	    	{    	
	    		single_flag = 5; 	
	    		single_reply = 0x83; 
	    		process_sewingtest_data();
				nopmove_flag = 0;
				move_flag = 0;   
				lastmove_flag = 0;	
	    		return;
	    	}            
	   	 	//--------------------------------------------------------------------------------------
	    	//  move stepper motor
	    	//-------------------------------------------------------------------------------------- 	
	    	if(move_flag == 1)
	    	{	
				LastNopMoveFlag = 0;
		    	single_flag = 2;
	      		single_reply = 0x83;
	    	}
		}
		else
		{
			single_flag = 0; 	
	  		single_reply = 0x51;
		}
  	}
  	else    
  	{
		if(u202 == 1)
		{
			if(SewingTestEndFlag == 0)
			{
				nopmove_flag = 0;
				move_flag = 0;
				lastmove_flag = 0;
			  	conprocess_sewingtest_data();
		
				
			  	//--------------------------------------------------------------------------------------
		    	//  end of pattern
		    	//-------------------------------------------------------------------------------------- 
		    	if(start_flag == 1)
		    	{
		    		start_flag = 0;
		    		single_flag = 0; 	
		  	  		single_reply = 0x51;     // stepper motor is not move
		  	  		return;
		    	}	
			  	//--------------------------------------------------------------------------------------
		    	//  back to endpoint
		    	//-------------------------------------------------------------------------------------- 
			  	if(lastmove_flag == 1)
		    	{    	
		    		single_flag = 5; 	
		    		single_reply = 0x83; 
		    		process_sewingtest_data();
					nopmove_flag = 0;
					move_flag = 0;   
					lastmove_flag = 0;	
		    		return;
		    	}            
		   	 	//--------------------------------------------------------------------------------------
		    	//  move stepper motor
		    	//-------------------------------------------------------------------------------------- 	
		    	if(move_flag == 1)
		    	{	
					LastNopMoveFlag = 0;
			    	single_flag = 2;
		      		single_reply = 0x83;
		    	}
			}
			else
			{
				single_flag = 0; 	
	  			single_reply = 0x51;
			}
		}
		else if(u202 == 0)
		{
	  		single_flag = 0; 	
	  		single_reply = 0x51;
		}
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		single_thread_back
//  Parameters:	None
//  Returns:	None
//  Description: single back step
//--------------------------------------------------------------------------------------
void single_thread_back(void)
{	
	if(foot_flag == 0)
	{	
		if(SewingTestEndFlag == 0)
		{
			nopmove_flag = 0;
			move_flag = 0;
			lastmove_flag = 0;
		  	conprocess_sewingtest_data();
		
			
		  	//--------------------------------------------------------------------------------------
	    	//  end of pattern
	    	//-------------------------------------------------------------------------------------- 
	    	if(start_flag == 1)
	    	{
	    		start_flag = 0;
	    		single_flag = 0; 	
	  	  		single_reply = 0x51;     // stepper motor is not move
	  	  		return;
	    	}	
			if(FootRotateFlag == 1)
			{
						if(k110 == 1)     
					     R_AIR = R_AIR^1;
					   else if(k110 == 2)      //2012-6-7
					    {
						     if(stretch_foot_flag == 0)
							   stretch_foot_in();
						    else
							   stretch_foot_out();
					    }
					FootRotateFlag = 0;
			}
		  	//--------------------------------------------------------------------------------------
	    	//  back to endpoint
	    	//-------------------------------------------------------------------------------------- 
		  	if(lastmove_flag == 1)
	    	{    	
	    		single_flag = 5; 	
	    		single_reply = 0x85; 
	    		process_sewingtest_data();
				nopmove_flag = 0;
				move_flag = 0;   
				lastmove_flag = 0;	
	    		return;
	    	}            
	   	 	//--------------------------------------------------------------------------------------
	    	//  move stepper motor
	    	//-------------------------------------------------------------------------------------- 	
	    	if(move_flag == 1)
	    	{	
				LastNopMoveFlag = 0;
		    	single_flag = 2;
	      		single_reply = 0x85;
	    	}
		}
		else
		{
			single_flag = 0; 	
	  		single_reply = 0x51;
		}
  	}
  	else    
  	{
		if(u202 == 1)
		{
			if(SewingTestEndFlag == 0)
			{
				nopmove_flag = 0;
				move_flag = 0;
				lastmove_flag = 0;
			  	conprocess_sewingtest_data();
		
				
			  	//--------------------------------------------------------------------------------------
		    	//  end of pattern
		    	//-------------------------------------------------------------------------------------- 
		    	if(start_flag == 1)
		    	{
		    		start_flag = 0;
		    		single_flag = 0; 	
		  	  		single_reply = 0x51;     // stepper motor is not move
		  	  		return;
		    	}	
			  	//--------------------------------------------------------------------------------------
		    	//  back to endpoint
		    	//-------------------------------------------------------------------------------------- 
			  	if(lastmove_flag == 1)
		    	{    	
		    		single_flag = 5; 	
		    		single_reply = 0x85; 
		    		process_sewingtest_data();
					nopmove_flag = 0;
					move_flag = 0;   
					lastmove_flag = 0;	
		    		return;
		    	}            
		   	 	//--------------------------------------------------------------------------------------
		    	//  move stepper motor
		    	//-------------------------------------------------------------------------------------- 	
		    	if(move_flag == 1)
		    	{	
					LastNopMoveFlag = 0;
			    	single_flag = 2;
		      		single_reply = 0x85;
		    	}
			}
			else
			{
				single_flag = 0; 	
	  			single_reply = 0x51;
			}
		}
		else if(u202 == 0)
		{
	  		single_flag = 0; 	
	  		single_reply = 0x51;
		}
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		single_edit_back
//  Parameters:	None
//  Returns:	None
//  Description: single back step
//--------------------------------------------------------------------------------------
void single_edit_back(void)
{	
	if(foot_flag == 0)
	{	
	  	conprocess_edit_data();
		
	  	//--------------------------------------------------------------------------------------
    	//  end of pattern
    	//-------------------------------------------------------------------------------------- 
    	if(first_stitch_flag == 1)
    	{
			start_flag = 0;
    		single_flag = 0; 	
  	  		single_reply = 0x51;     			// stepper motor is not move
			first_stitch_flag = 0;
			do_pat_point_add_one();
			
  	  		return;
    	}		
		
		if(FootRotateFlag == 1)
		{
				if(k110 == 1)
					  R_AIR = R_AIR^1;
				else if(k110 == 2)
					{
					   if(stretch_foot_flag == 0)
						  stretch_foot_in();
						else
						  stretch_foot_out();	
					}
				FootRotateFlag = 0;
		}		
    	if(nopmove_flag == 1 || move_flag == 1)
    	{	
			allx_step = allx_step - xstep_cou;
  			ally_step = ally_step - ystep_cou;
			
			if( check_sewing_range())
			{
				do_pat_point_add_one();
				single_flag = 0; 	
  				single_reply = 0x51;     // stepper motor is not move
				nopmove_flag = 0;
				move_flag = 0;
				sys.error = ERROR_15;
				StatusChangeLatch = ERROR;
				allx_step = allx_step + xstep_cou;
  				ally_step = ally_step + ystep_cou;
				return;
			}
			else
			{
		    	single_flag = 2;
	      		single_reply = 0x81;
				nopmove_flag = 0;
				allx_step = allx_step + xstep_cou;
  				ally_step = ally_step + ystep_cou;
			}
    	}
  	}
  	else    
  	{
  		single_flag = 0; 	
  		single_reply = 0x51;
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		back_startpoint
//  Parameters:	None
//  Returns:	None
//  Description: back to startpoint
//--------------------------------------------------------------------------------------
void back_startpoint(void)
{
	if( ((foot_flag == 0)||(u202==1) )&&(laser_emergency_stop == 0) )
	{	
		if(SewingTestEndFlag == 0)
		{			  
		  	single_flag = 3; 
		  	single_reply = 0x31;
		}
		else
		{
			single_flag = 0; 
	  		single_reply = 0x51;
		}
  	}
  	else    
  	{ 		single_flag = 0; 
	  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		back_startpoint
//  Parameters:	None
//  Returns:	None
//  Description: back to startpoint
//--------------------------------------------------------------------------------------
void back_edit_startpoint(void)
{
//	if(foot_flag == 0)
//	{				  
	  	single_flag = 3; 
	  	single_reply = 0x31;
/*  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
*/
}
//--------------------------------------------------------------------------------------
//  Name:		single_end
//  Parameters:	None
//  Returns:	None
//  Description: move to endpoint
//--------------------------------------------------------------------------------------
void single_end(void)
{
  	if( ((foot_flag == 0)||(u202==1) )&&(laser_emergency_stop == 0) )
	{
		if(SewingTestEndFlag == 0)
		{				  
		  	single_flag = 6; 
		  	single_reply = 0x02;
		}
		else
		{
			single_flag = 0; 
  			single_reply = 0x51;
		}
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		single_end
//  Parameters:	None
//  Returns:	None
//  Description: move to endpoint
//--------------------------------------------------------------------------------------
void single_inpresser_end(void)
{
  	if(foot_flag == 0)
	{
		if(SewingTestEndFlag == 0)
		{				  
		  	single_flag = 11; 
		  	single_reply = 0x04;
		}
		else
		{
			single_flag = 0; 
  			single_reply = 0x51;
		}
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		single_thread_end
//  Parameters:	None
//  Returns:	None
//  Description: move to endpoint
//--------------------------------------------------------------------------------------
void single_thread_end(void)
{
  	if(foot_flag == 0)
	{
		if(SewingTestEndFlag == 0)
		{				  
		  	single_flag = 13; 
		  	single_reply = 0x06;
		}
		else
		{
			single_flag = 0; 
  			single_reply = 0x51;
		}
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		single_start
//  Parameters:	None
//  Returns:	None
//  Description: move to startpoint
//--------------------------------------------------------------------------------------
void single_start(void)
{
	//if(foot_flag == 0)
	if( ((foot_flag == 0)||(u202==1) )&&(laser_emergency_stop == 0) )
	{		
		if(SewingTestEndFlag == 0)
		{		  
		  	single_flag = 7; 
			CourseBackStartFlag = 1;
		  	single_reply = 0x82;
		}
		else
		{
			single_flag = 0; 
  			single_reply = 0x51;
		}
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		single_start
//  Parameters:	None
//  Returns:	None
//  Description: move to startpoint
//--------------------------------------------------------------------------------------
void single_inpresser_start(void)
{
	PATTERN_DATA *TempPatpoint;
	UINT16 TempCounter;
	if(foot_flag == 0)
	{		
		if(SewingTestEndFlag == 0)
		{		  
			TempPatpoint = pat_point;
			TempCounter = pat_buff_total_counter;
			stapoint_calc();
			pat_buff_total_counter = TempCounter;
			pat_point = TempPatpoint;
			
			single_flag = 12; 
			CourseBackStartFlag = 1;
		  	single_reply = 0x84;
		}
		else
		{
			single_flag = 0; 
  			single_reply = 0x51;
		}
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		single_thread_start
//  Parameters:	None
//  Returns:	None
//  Description: move to startpoint
//--------------------------------------------------------------------------------------
void single_thread_start(void)
{
	if(foot_flag == 0)
	{		
		if(SewingTestEndFlag == 0)
		{		  
		  	single_flag = 14; 
			CourseBackStartFlag = 1;
		  	single_reply = 0x86;
		}
		else
		{
			single_flag = 0; 
  			single_reply = 0x51;
		}
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		single_stop
//  Parameters:	None
//  Returns:	None
//  Description: move stop
//--------------------------------------------------------------------------------------
void single_stop(void)
{
	if(foot_flag == 0)
	{				  
	  	single_flag = 8; 
	  	single_reply = 0x52;
  	}
  	else    
  	{
  		single_flag = 0; 
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		move_next
//  Parameters:	None
//  Returns:	None
//  Description: move next
//--------------------------------------------------------------------------------------
void move_next(void)
{
	UINT16 temp_xy_max,temp_x_length,temp_y_length,movestepxy_time;  
	
	allx_step = allx_step + xstep_cou;
  	ally_step = ally_step + ystep_cou;
	
	temp_x_length = fabsm(xstep_cou);
	temp_y_length = fabsm(ystep_cou);
	
	if(temp_x_length > temp_y_length)       
	   temp_xy_max = temp_x_length;
	else
	   temp_xy_max = temp_y_length;
	if(temp_xy_max == 0)
	   temp_xy_max = 1;
	   
	
	#if DEBUG_XY_MOVEMODE
	timer_x = k112;
	timer_y = k112;  
    #else
	timer_x = 0;
	timer_y = 0;  
	#endif
	if(temp_x_length > 0)
	{   
		step_movetype = 1;
		#if DEBUG_XY_MOVEMODE
		#else
		timer_x = 62;
		if(timer_x > (temp_x_length <<TIME_PARAMETER_1) )
		{
		   timer_x = temp_x_length <<TIME_PARAMETER_1;				   
	   	}
	 	#endif
	 	movestep_x(-xstep_cou);
	 	delay_us(400);
	}
	if(temp_y_length > 0)
	{   
		step_movetype = 1;
		#if DEBUG_XY_MOVEMODE
		#else
		timer_y = 62;
		if(timer_y > (temp_y_length <<TIME_PARAMETER_1) )
		{
		   timer_y = temp_y_length <<TIME_PARAMETER_1;				      
		} 
		#endif
		movestep_y(-ystep_cou);
	}
	if( timer_y > timer_x )
		movestepxy_time = timer_y;
	else
	    movestepxy_time = timer_x;
	
  	move_flag = 0; 
  	delay_ms(movestepxy_time + 1);
  	single_flag = 0; 
	xstep_cou = 0;
	ystep_cou = 0;
	step_movetype = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		move_back
//  Parameters:	None
//  Returns:	None
//  Description: move back
//--------------------------------------------------------------------------------------
void move_back(void)
{
	UINT16 temp_xy_max,temp_x_length,temp_y_length,movestepxy_time;
	
	allx_step = allx_step - xstep_cou;
  	ally_step = ally_step - ystep_cou;
	
	
	temp_x_length = fabsm(xstep_cou);
	temp_y_length = fabsm(ystep_cou);
	
	if(temp_x_length > temp_y_length)       
	   temp_xy_max = temp_x_length;
	else
	   temp_xy_max = temp_y_length;
	if(temp_xy_max == 0)
	   temp_xy_max = 1;
	   
	timer_x = 0;
	timer_y = 0; 

	if(temp_x_length > 0)
	{
		step_movetype = 1;
		timer_x = 62;
		if(timer_x > (temp_x_length <<TIME_PARAMETER_1) )
		{
		   timer_x = temp_x_length <<TIME_PARAMETER_1;				   
	   	}
	 	movestep_x(xstep_cou);
		delay_us(400);
	}
	if(temp_y_length > 0)
	{
		step_movetype = 1;
		timer_y = 62;
		if(timer_y > (temp_y_length <<TIME_PARAMETER_1) )
		{
		   timer_y = temp_y_length <<TIME_PARAMETER_1;				      
		}
		movestep_y(ystep_cou);
	}
	if( timer_y > timer_x )
		movestepxy_time = timer_y;
	else
	    movestepxy_time = timer_x;
	
  	move_flag = 0; 
  	delay_ms(movestepxy_time + 1);
  	single_flag = 0; 
	xstep_cou = 0;
	ystep_cou = 0;
	step_movetype = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		move_startpoint
//  Parameters:	None
//  Returns:	None
//  Description: move startpoint
//--------------------------------------------------------------------------------------
void move_startpoint(void)
{

		SewTestStitchCounter = 1;
		if(u48 == 0)
		{
			go_setoutpoint();
		}
		else if(u48 == 1)
		{
			if(start_flag == 1)
			{
			}
			else if(start_flag == 0)
			{
				while(single_flag != 0)
				{	
					course_back();
					if(single_flag == 0)
					{
						break;
					}
				}
			}
		}
		else if(u48 == 2)
		{
			go_origin_xy();          // x and y go origin 
			go_startpoint();         // x and y go startpoint 
			predit_shift = 0;
		} 
	
	single_flag = 0; 
}
//--------------------------------------------------------------------------------------
//  Name:		move_startpoint
//  Parameters:	None
//  Returns:	None
//  Description: move startpoint
//--------------------------------------------------------------------------------------
void move_edit_startpoint(void)
{
	while(first_stitch_flag == 0)
	{
		conprocess_edit_data();
		if(first_stitch_flag == 1)
		{
			do_pat_point_add_one();
			break;
		}
	}
	go_origin_xy();           

	footer_both_down();      
	single_flag = 0; 
	move_flag = 0;
	FootRotateFlag = 0;
	nopmove_flag = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		course_next
//  Parameters:	None
//  Returns:	None
//  Description: course next
//--------------------------------------------------------------------------------------
void course_next(void)
{		
	UINT16 temp16,max16;
	UINT16 x_tmp,y_tmp,dly_time;
	temp16 = 0;
	max16 = 0;
	if(TestStatusChangeFlag == 0)
	{
		TestStatusChangeFlag = 1;
	}
	
	
	process_sewingtest_data();
	
	if(nopmove_flag == 1)
	{
        if(u103 != 0 && inpress_flag == 0)   
		{
			inpress_up();        	
		}
	}
	if(move_flag == 1)
	{
		if(u103 == 2)
		 {
		    if(inpress_flag == 1)  
		     {
			     inpress_down(inpress_high);     	
		    }
		    else
		    {
			   if(single_inpress_flag == 1 )     
			    {
				  	 inpress_to(inpress_high);  
					 inpress_flag = 0;  
			     }    		   
			 }
			 single_inpress_flag = 0;
		 }
	}
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
	if(end_flag == 1)
  	{   
  		single_flag = 0; 	    	
  		do_pat_point_sub_one();
  		end_flag = 0;
		single_reply = 0x52;  
		predit_shift = 0;
  		if(sys.status == PREEDIT)
  		{
  			end_flag = 1;
  		}  
  		return;
  	}    
	if(nopmove_flag == 1)
	{
		do_pat_point_sub_one();
		SewingTestEndFlag = 1;  
		if(ROTATED_CUTTER == 1)//#if ROTATED_CUTTER
		{
			if ( (milling_cutter_action_flag ==1)&&(rotated_cutter_enable ==1) )
				     rotated_cutter_single_stop();
		}
		//#endif
		go_sewingtest_beginpoint();  
		if( nop_move_pause_flag ==1 )
		   single_flag = 0;
		if(StatusChangeLatch == ERROR)
		{
			single_flag = 0;
		}
		SewingTestEndFlag = 0;  
	}
	
	if(FootRotateFlag == 1)
	{
		if( (k110 == 0) )
		{
			marking_flag = 1;
		}
		else
		{
			 if(k110 == 1) 
					R_AIR = R_AIR^1;
			 else if(k110 == 2)
			 {
					if(stretch_foot_flag == 0)
					  stretch_foot_in();
					else
					  stretch_foot_out();	
			 }
			 FootRotateFlag = 0;
		}
	}
	
	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1)
  	{	
		SewingTestEndFlag = 1; 
		allx_step = allx_step + xstep_cou;
    	ally_step = ally_step + ystep_cou;
		if( check_sewing_range())
		{
			allx_step = allx_step - xstep_cou;
    		ally_step = ally_step - ystep_cou;
			do_pat_point_sub_one();
			move_flag = 0;
			single_flag = 0; 
			sys.error = ERROR_15;
			StatusChangeLatch = ERROR;
		}
		else
		{
			SewTestStitchCounter++;
			LastNopMoveFlag = 0;
			if(ROTATED_CUTTER == 1)
			{
				if( rotated_cutter_enable ==1)
				{
							if ( milling_cutter_action_flag ==1)
							{
								rotated_cutter_single_next();		
							}
							else if(milling_cutter_action_flag ==2 )
							{
								rotated_cutter_single_stop();
								milling_cutter_action_flag = 0;
							}
				}
			}			
			x_tmp = fabsm(xstep_cou);
			y_tmp = fabsm(ystep_cou);
			dly_time = 0;
			if( x_tmp> 0)
			{   
				#if DEBUG_XY_MOVEMODE
				timer_x = k112;	
				#else
				timer_x = 62;
				step_movetype = 1;
				if( timer_x > (x_tmp <<TIME_PARAMETER_1) )
			   		timer_x = x_tmp <<TIME_PARAMETER_1;	
				#endif
						   	   
				dly_time = timer_x + 2;
				movestep_x(-xstep_cou);
			  	delay_ms(1);
			}
			if(y_tmp > 0)
			{   
				#if DEBUG_XY_MOVEMODE
				timer_y = k112;	
				#else
				timer_y = 62;
				step_movetype = 1;
				if( timer_y > (y_tmp <<TIME_PARAMETER_1) )
			   		timer_y = y_tmp <<TIME_PARAMETER_1;	
				#endif
				
				if( timer_y > dly_time)
				  dly_time = timer_y + 2;				  
				movestep_y(-ystep_cou);
			}					 
		   	move_flag = 0; 
			delay_ms(dly_time);
			
		}
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
  	}   
	step_movetype = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		course_next
//  Parameters:	None
//  Returns:	None
//  Description: course next
//--------------------------------------------------------------------------------------
void course_inpresser_next(void)
{		
	UINT16 temp16 = 0;
	UINT16 max16 = 0;
	
	if(TestStatusChangeFlag == 0)
	{
		TestStatusChangeFlag = 1;
	}
	
	
	process_sewingtest_data();
	if(course_run_stop_flag == 1)
	{
		if(move_flag == 1 || nopmove_flag == 1)
		{
			do_pat_point_sub_one();
			move_flag = 0;
			nopmove_flag = 0;
		}
	}
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
	if(end_flag == 1)
  	{   
  		single_flag = 0; 	    	
  		do_pat_point_sub_one();
  		end_flag = 0;
  		if(sys.status == PREEDIT)
  		{
  			end_flag = 1;
  		}  
  		return;
  	}    
	if(nopmove_flag == 1)
	{
		do_pat_point_sub_one();
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start
		go_sewingtest_beginpoint();   	// stepper motor move next
		if( nop_move_pause_flag ==1 )
		   single_flag = 0;
		if(StatusChangeLatch == ERROR)
		{
			single_flag = 0;
		}
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
	}
	
	if(FootRotateFlag == 1)
	{
			if(k110 == 1)     
				 R_AIR = R_AIR^1;
			 else if(k110 == 2)      //2012-6-7
				 {
					 if(stretch_foot_flag == 0)
						 stretch_foot_in();
					 else
						 stretch_foot_out();
				 }
			FootRotateFlag = 0;
	}
	
	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1)
  	{	
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start
		
		
		allx_step = allx_step + xstep_cou;
    	ally_step = ally_step + ystep_cou;
		if( check_sewing_range())
		{
			allx_step = allx_step - xstep_cou;
    		ally_step = ally_step - ystep_cou;
			pat_point--;
			move_flag = 0;
			single_flag = 0; 
			sys.error = ERROR_15;
			StatusChangeLatch = ERROR;
		}
		else
		{
			
		
			SewTestStitchCounter++;
			LastNopMoveFlag = 0;
			
			if(fabsm(xstep_cou) > 0)
			{   
				timer_x = 62;
				movestep_x(-xstep_cou);
			  	delay_ms(1);
			}
			if(fabsm(ystep_cou) > 0)
			{
				timer_y = 62;
				movestep_y(-ystep_cou);
			}

	    	move_flag = 0; 
			delay_ms(80);
		}
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
  	}   
}
//--------------------------------------------------------------------------------------
//  Name:		course_thread_next
//  Parameters:	None
//  Returns:	None
//  Description: course next
//--------------------------------------------------------------------------------------
void course_thread_next(void)
{		
	UINT16 temp16 = 0;
	UINT16 max16 = 0;
	
	if(TestStatusChangeFlag == 0)
	{
		TestStatusChangeFlag = 1;
	}
	
	
	process_sewingtest_data();
	if(course_thread_run_stop_flag == 1)
	{
		if(move_flag == 1 || nopmove_flag == 1)
		{
			pat_point--;
			move_flag = 0;
			nopmove_flag = 0;
		}
	}
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
	if(end_flag == 1)
  	{   
  		single_flag = 0; 	    	
  		do_pat_point_sub_one();
  		end_flag = 0;
  		if(sys.status == PREEDIT)
  		{
  			end_flag = 1;
  		}  
  		return;
  	}    
	if(nopmove_flag == 1)
	{
		do_pat_point_sub_one();
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start
		go_sewingtest_beginpoint();   	// stepper motor move next
		if( nop_move_pause_flag ==1 )
		   single_flag = 0;
		if(StatusChangeLatch == ERROR)
		{
			single_flag = 0;
		}
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
	}
	
	if(FootRotateFlag == 1)
	{
			if(k110 == 1)     
			   R_AIR = R_AIR^1;
			else if(k110 == 2)     
				{
					if(stretch_foot_flag == 0)
					  stretch_foot_in();
					else
					   stretch_foot_out();
				 }
			 FootRotateFlag = 0;
	}
	
	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1)
  	{	
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start
		
		
		allx_step = allx_step + xstep_cou;
    	ally_step = ally_step + ystep_cou;
		if( check_sewing_range())
		{
			allx_step = allx_step - xstep_cou;
    		ally_step = ally_step - ystep_cou;
			pat_point--;
			move_flag = 0;
			single_flag = 0; 
			sys.error = ERROR_15;
			StatusChangeLatch = ERROR;
		}
		else
		{
			
		
			SewTestStitchCounter++;
			LastNopMoveFlag = 0;
			
			if(fabsm(xstep_cou) > 0)
			{
			    timer_x = 62;	
				movestep_x(-xstep_cou);
			  	delay_ms(1);
			}
			if(fabsm(ystep_cou) > 0)
			{
				timer_y = 62;
				movestep_y(-ystep_cou);
			}

	    	move_flag = 0; 
			delay_ms(65);
		}
		SewingTestEndFlag = 0;  // nop move end 

  	}   
}
//--------------------------------------------------------------------------------------
//  Name:		course_edit_next
//  Parameters:	None
//  Returns:	None
//  Description: course next
//--------------------------------------------------------------------------------------
void course_edit_next(void)
{		
	UINT16 temp16 = 0;
	UINT16 max16 = 0;
	
	process_edit_data();
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
	if(end_flag == 1)
  	{   
  		single_flag = 0; 	    	
  		do_pat_point_sub_one();
  		return;
  	}    

	if(FootRotateFlag == 1)
	{
		 if(k110 == 1)   //2012-6-7 modify
				R_AIR = R_AIR^1;
		 else if(k110 == 2)
			 {
				if(stretch_foot_flag == 0)
				  stretch_foot_in();
				else
				  stretch_foot_out();	
			 }
			FootRotateFlag = 0;
	}
	if(PointShiftFlag == 1)
	{
		//--------------------------------------------------------------------------------------
	  	//  move stepper motor
	  	//-------------------------------------------------------------------------------------- 	
	  	if(move_flag == 1 || nopmove_flag == 1)
	  	{	
		  	allx_step = allx_step + xstep_cou;
	    	ally_step = ally_step + ystep_cou;
		
			if( check_sewing_range())
			{
				do_pat_point_sub_one();
				single_flag = 0; 	
				nopmove_flag = 0;
				move_flag = 0;
				allx_step = allx_step - xstep_cou;
				ally_step = ally_step - ystep_cou;
				OutOfRange_flag = 1;
				sys.error = ERROR_15;
				StatusChangeLatch = ERROR;
				return;
			}
		
			if(fabsm(xstep_cou) > 0)
			{   
				timer_x = 62;
				movestep_x(-xstep_cou);
			  	delay_ms(1);
			}
			if(fabsm(ystep_cou) > 0)
			{   
				timer_y = 62;
				movestep_y(-ystep_cou);
			}
			nopmove_flag = 0;
	    	move_flag = 0; 
			delay_ms(65);
	  	}
	}
	else
	{
			//--------------------------------------------------------------------------------------
		  	//  move stepper motor
		  	//-------------------------------------------------------------------------------------- 	
		  	if(move_flag == 1 || nopmove_flag == 1)
		  	{	
			  	allx_step = allx_step + xstep_cou;
		    	ally_step = ally_step + ystep_cou;
		
				if( check_sewing_range())
				{
					do_pat_point_sub_one();
				
					single_flag = 0; 	
					nopmove_flag = 0;
					move_flag = 0;
					sys.error = ERROR_15;
					StatusChangeLatch = ERROR;
					allx_step = allx_step - xstep_cou;
					ally_step = ally_step - ystep_cou;
					return;
				}
		
				if(fabsm(xstep_cou) > 0)
				{
					timer_x = 62;
					movestep_x(-xstep_cou);
				  	delay_ms(1);
				}
				if(fabsm(ystep_cou) > 0)
				{   
					timer_y = 62;
					movestep_y(-ystep_cou);
				}
				nopmove_flag = 0;
		    	move_flag = 0; 
				delay_ms(65);
		  	}
			
	}
}

//--------------------------------------------------------------------------------------
//  Name:		course_edit_continue_next //10.09.27 wr add
//  Parameters:	None
//  Returns:	None
//  Description: continue next step
//--------------------------------------------------------------------------------------
void course_edit_continue_next(void)
{
	UINT16 x_tmp,y_tmp,dly_time;
	if(foot_flag == 0)
	{	
		if(sys.error == OK)
		{
			process_edit_data();
		}
		else if(sys.error == ERROR_15)
		{
			single_flag = 0; 	
  			single_reply = 0x51;     // stepper motor is not move
			return;
		}
		//--------------------------------------------------------------------------------------
    	//  end of pattern
    	//-------------------------------------------------------------------------------------- 
		if(end_flag == 1)
    	{   
    		single_flag = 0; 	
    		single_reply = 0x51;     			// stepper motor is not move  
			end_flag = 0;
			do_pat_point_sub_one();
    		return;
    	}        

		if(FootRotateFlag == 1)
		{
			if(k110 == 1)     
				 R_AIR = R_AIR^1;
		   else if(k110 == 2)      //2012-6-7
				 {
					 if(stretch_foot_flag == 0)
						 stretch_foot_in();
					else
						 stretch_foot_out();
				  }
				FootRotateFlag = 0;
		}
    	//--------------------------------------------------------------------------------------
    	//  move stepper motor
    	//-------------------------------------------------------------------------------------- 	
    	if(move_flag == 1 || nopmove_flag == 1)
    	{
    		predit_shift = 1;	
    		
	    	allx_step = allx_step + xstep_cou;
  			ally_step = ally_step + ystep_cou;
			
		    if( check_sewing_range())
			{
				do_pat_point_sub_one();
		
				single_flag = 0; 	
  				single_reply = 0x51;     // stepper motor is not move
				nopmove_flag = 0;
				move_flag = 0;
				sys.error = ERROR_15;
				StatusChangeLatch = ERROR;
				allx_step = allx_step - xstep_cou;
  				ally_step = ally_step - ystep_cou;
				return;
			}
			else
			{
				
				x_tmp = fabsm(xstep_cou);
				y_tmp = fabsm(ystep_cou);
				dly_time = 0;
				if( x_tmp> 0)
				{   
					timer_x = 62;
					step_movetype = 1;
					if( timer_x > (x_tmp <<TIME_PARAMETER_1) )
				   		timer_x = x_tmp <<TIME_PARAMETER_1;				   	   
					dly_time = timer_x + 2;
					movestep_x(-xstep_cou);
				  	delay_ms(1);
				}
				if(y_tmp > 0)
				{   
					timer_y = 62;
					step_movetype = 1;
					if( timer_y > (y_tmp <<TIME_PARAMETER_1) )
				   		timer_y = y_tmp <<TIME_PARAMETER_1;	
					if( timer_y > dly_time)
					  dly_time = timer_y + 2;				  
					movestep_y(-ystep_cou);
				}					 
			   	move_flag = 0; 
				delay_ms(dly_time);
  				nopmove_flag = 0;
			}
			predit_shift = 0;	
			step_movetype = 0;
    	}	
    }
    else    
  	{
  		single_flag = 0; 	
  		single_reply = 0x51;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		course_back
//  Parameters:	None
//  Returns:	None
//  Description: course back
//--------------------------------------------------------------------------------------
void course_back(void)
{
	UINT16 x_tmp,y_tmp,dly_time;
	
	move_flag = 0;
	nopmove_flag = 0;
	lastmove_flag = 0;
	single_inpress_flag = 0;   
	conprocess_sewingtest_data();

	if(nopmove_flag == 1)
	{
		if(inpress_flag == 0)  
		{
			inpress_up();        	
		}
	}
	if(move_flag == 1)
	{
	    if(u103 == 2 && sys.status != EMERMOVE)    
		{
			if(inpress_flag == 1)
			{
				   inpress_down(inpress_high);
			}
			else
			{
			     if(single_inpress_flag == 1)     
				 {
						  inpress_to(inpress_high);  
						  inpress_flag = 0;    	
				  }
			}
			single_inpress_flag = 0;
		}
	}
	
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
  	if(start_flag == 1)
  	{
  		start_flag = 0;
  		single_flag = 0; 
		single_reply = 0x52; 
    	return;
  	}	
	//--------------------------------------------------------------------------------------
  	//  back to endpoint
  	//-------------------------------------------------------------------------------------- 
	//if(lastmove_flag == 1)
	if(nopmove_flag == 1)
  	{   
		do_pat_point_add_one();
		predit_shift = 1;
		SewingTestEndFlag = 1; 
		if(ROTATED_CUTTER == 1)//#if ROTATED_CUTTER
		{
			if ( (milling_cutter_action_flag ==1)&&(rotated_cutter_enable ==1) )
			     rotated_cutter_single_stop();
		}
		//#endif
  		back_endpoint();
		if( nop_move_pause_flag ==1 )
		 single_flag = 0;
		lastmove_flag = 0; 	
		SewingTestEndFlag = 0;  
		predit_shift = 0;
		delay_ms(QUICKMOVETIME);
  		return;
  	}     
	
	if(FootRotateFlag == 1)
	{
		if( (k110 == 0) )
		{
				marking_flag = 1;
		}
		else
		{
			if(k110 == 1)  
				R_AIR = R_AIR^1;
		 	else if(k110 == 2)
			 {
				if(stretch_foot_flag == 0)
				  stretch_foot_in();
				else
				  stretch_foot_out();	
			 }
			FootRotateFlag = 0;
		}
	}       
	
  	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1)
  	{	
	  	SewTestStitchCounter--;
		predit_shift = 1;
		SewingTestEndFlag = 1;  
		
		LastNopMoveFlag = 0;
		allx_step = allx_step - xstep_cou;
    	ally_step = ally_step - ystep_cou;
		if(ROTATED_CUTTER == 1)//#if ROTATED_CUTTER
		{
			if( rotated_cutter_enable == 1)
			{
							if ( milling_cutter_action_flag ==1)
							{
								//rotated_cutter_single_next();		
								rotated_cutter_single_back();		
							}
							else if(milling_cutter_action_flag ==2 )
							{
								rotated_cutter_single_stop();
								milling_cutter_action_flag = 0;
							}
			}
		}
		//#endif
		//#if ENABLE_LASER_CUTTER
	    //milling_cutter_action_flag = 0;
		//#endif
		x_tmp = fabsm(xstep_cou);
		y_tmp = fabsm(ystep_cou);
		dly_time = 0;
		if( x_tmp> 0)
		{   
			timer_x = 62;
			step_movetype = 1;
			if( timer_x > (x_tmp <<TIME_PARAMETER_1) )
			   	timer_x = x_tmp <<TIME_PARAMETER_1;	
			dly_time = timer_x + 2;
			movestep_x(xstep_cou);
		  	delay_ms(1);
		}
		if(y_tmp > 0)
		{   
			timer_y = 62;
			step_movetype = 1;
			if( timer_y > (y_tmp <<TIME_PARAMETER_1) )
			   	timer_y = y_tmp <<TIME_PARAMETER_1;	
			if( timer_y > dly_time)
			    dly_time = timer_y + 2;				 
			movestep_y(ystep_cou);
		}					 
    	
   		move_flag = 0; 
    	delay_ms(dly_time);
		SewingTestEndFlag = 0; 
		predit_shift = 0;
  	}
	step_movetype = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		course_back
//  Parameters:	None
//  Returns:	None
//  Description: course back
//--------------------------------------------------------------------------------------
UINT8 counter = 0;
void course_inpresser_back(void)
{
	move_flag = 0;
	nopmove_flag = 0;
	lastmove_flag = 0;
	conprocess_sewingtest_data();
	
	if(CourseBackStartFlag == 1)
	{
		if(course_run_stop_flag == 1)
		{
			counter++;
			if(counter >= 2)
			{
				counter = 0;
				if(move_flag == 1 || nopmove_flag == 1)
				{
					do_pat_point_add_one();
					do_pat_point_add_one();
					move_flag = 0;
					nopmove_flag = 0;
				}
			}
			else if(counter == 1)
			{
				course_run_stop_flag = 0;
			}
		}
		CourseBackStartFlag = 0;
	}
	else if(CourseBackStartFlag == 0)
	{
		counter = 0;
		if(course_run_stop_flag == 1)
		{
			if(move_flag == 1 || nopmove_flag == 1)
			{
				do_pat_point_add_one();
				do_pat_point_add_one();
				move_flag = 0;
				nopmove_flag = 0;
			}
		}
	}
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
  	if(start_flag == 1)
  	{
  		start_flag = 0;
  		single_flag = 0; 
		predit_shift = 0;	//2013-7-29 add	
    	return;
  	}	
	//--------------------------------------------------------------------------------------
  	//  back to endpoint
  	//-------------------------------------------------------------------------------------- 
	//if(lastmove_flag == 1)
	if(nopmove_flag == 1)
  	{   
		do_pat_point_add_one();
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start  	
  		back_endpoint();
		lastmove_flag = 0; 	
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
		delay_ms(QUICKMOVETIME);
  		return;
  	}     
	
	if(FootRotateFlag == 1)
	{
				if(k110 == 1)     
					R_AIR = R_AIR^1;
			   else if(k110 == 2)      
				   {
					 if(stretch_foot_flag == 0)
						stretch_foot_in();
					else
						stretch_foot_out();
					}
		    	FootRotateFlag = 0;

	}       
	
  	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1)
  	{	
	  	SewTestStitchCounter--;
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start
		
		LastNopMoveFlag = 0;
		allx_step = allx_step - xstep_cou;
    	ally_step = ally_step - ystep_cou;
		
		if(fabsm(xstep_cou) > 0)
		{
			timer_x = 62;
			movestep_x(xstep_cou);
		  	delay_ms(1);
		}
		if(fabsm(ystep_cou) > 0)
		{
			timer_y = 62;
			movestep_y(ystep_cou);
		}					 
    	
   		move_flag = 0; 
    	delay_ms(65);
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		course_thread_back
//  Parameters:	None
//  Returns:	None
//  Description: course back
//--------------------------------------------------------------------------------------
UINT8 counter1 = 0;
void course_thread_back(void)
{
	move_flag = 0;
	nopmove_flag = 0;
	lastmove_flag = 0;
	conprocess_sewingtest_data();
	
	if(CourseBackStartFlag == 1)
	{
		if(course_thread_run_stop_flag == 1)
		{
			counter1++;
			if(counter1 >= 2)
			{
				counter1 = 0;
				if(move_flag == 1 || nopmove_flag == 1)
				{
					do_pat_point_add_one();
					do_pat_point_add_one();
					move_flag = 0;
					nopmove_flag = 0;
				}
			}
			else if(counter1 == 1)
			{
				course_thread_run_stop_flag = 0;
			}
		}
		CourseBackStartFlag = 0;
	}
	else if(CourseBackStartFlag == 0)
	{
		counter1 = 0;
		if(course_thread_run_stop_flag == 1)
		{
			if(move_flag == 1 || nopmove_flag == 1)
			{
				do_pat_point_add_one();
				do_pat_point_add_one();
				move_flag = 0;
				nopmove_flag = 0;
			}
		}
	}
	//--------------------------------------------------------------------------------------
  	//  end of pattern
  	//-------------------------------------------------------------------------------------- 
  	if(start_flag == 1)
  	{
  		start_flag = 0;
  		single_flag = 0; 	
    	return;
  	}	
	//--------------------------------------------------------------------------------------
  	//  back to endpoint
  	//-------------------------------------------------------------------------------------- 
	//if(lastmove_flag == 1)
	if(nopmove_flag == 1)
  	{   
		do_pat_point_add_one();
		predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start  	
  		back_endpoint();
		lastmove_flag = 0; 	
		SewingTestEndFlag = 0;  // nop move end 
		predit_shift = 0;
		delay_ms(QUICKMOVETIME);
  		return;
  	}     
	
	if(FootRotateFlag == 1)
	{

				if(k110 == 1)     
				  R_AIR = R_AIR^1;
				else if(k110 == 2)      //2012-6-7
					  {
						  if(stretch_foot_flag == 0)
							 stretch_foot_in();
						 else
							  stretch_foot_out();
					  }
			      FootRotateFlag = 0;
	}       
	
  	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1)
  	{	
	  	SewTestStitchCounter--;
		//predit_shift = 1;
		SewingTestEndFlag = 1;  // nop move start
		
		LastNopMoveFlag = 0;
		allx_step = allx_step - xstep_cou;
    	ally_step = ally_step - ystep_cou;
		
		if(fabsm(xstep_cou) > 0)
		{
			timer_x = 62;
			movestep_x(xstep_cou);
		  	delay_ms(1);
		}
		if(fabsm(ystep_cou) > 0)
		{
			timer_y = 62;
			movestep_y(ystep_cou);
		}					 
    	
   		move_flag = 0; 
    	delay_ms(65);
		SewingTestEndFlag = 0;  // nop move end 
		//predit_shift = 0;
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		course_edit_back
//  Parameters:	None
//  Returns:	None
//  Description: course back
//--------------------------------------------------------------------------------------
void course_edit_back(void)
{
	conprocess_edit_data();
	
	//--------------------------------------------------------------------------------------
   	//  end of pattern
    //-------------------------------------------------------------------------------------- 
    if(first_stitch_flag == 1)
    {
		start_flag = 0;
    	single_flag = 0; 	
  	  	single_reply = 0x51;     // stepper motor is not move
		do_pat_point_add_one();
		first_stitch_flag = 0;
  	  	return;
    }	            

	if(FootRotateFlag == 1)
	{
		if(k110 == 1)  
				R_AIR = R_AIR^1;
		 else if(k110 == 2)
			 {
				if(stretch_foot_flag == 0)
				  stretch_foot_in();
				else
				  stretch_foot_out();	
			 }
			FootRotateFlag = 0;
	} 

  	//--------------------------------------------------------------------------------------
  	//  move stepper motor
  	//-------------------------------------------------------------------------------------- 	
  	if(move_flag == 1 || nopmove_flag == 1)
  	{	
	  	allx_step = allx_step - xstep_cou;
    	ally_step = ally_step - ystep_cou;
		
		
		if( check_sewing_range())
		{
			pat_point++;
			single_flag = 0; 	
			nopmove_flag = 0;
			move_flag = 0;
			sys.error = ERROR_15;
			StatusChangeLatch = ERROR;
			allx_step = allx_step + xstep_cou;
			ally_step = ally_step + ystep_cou;
			return;
		}
		
		if(fabsm(xstep_cou) > 0)
		{
			timer_x = 62;
			movestep_x(xstep_cou);
		  	delay_ms(1);
		}
		if(fabsm(ystep_cou) > 0)
		{
			timer_y = 62;
			movestep_y(ystep_cou);
		}					 
    	
   		move_flag = 0; 
		nopmove_flag = 0;
    	delay_ms(65);
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		course_edit_continue_back //10.09.27 wr add
//  Parameters:	None
//  Returns:	None
//  Description: continue back step
//--------------------------------------------------------------------------------------
void course_edit_continue_back(void)
{	
	UINT16 x_tmp,y_tmp,dly_time;
	if(foot_flag == 0)
	{	
	  	conprocess_edit_data();
		
	  	//--------------------------------------------------------------------------------------
    	//  end of pattern
    	//-------------------------------------------------------------------------------------- 
    	if(first_stitch_flag == 1)
    	{
			start_flag = 0;
    		single_flag = 0; 	
  	  		single_reply = 0x51;     			// stepper motor is not move
			first_stitch_flag = 0;
			do_pat_point_add_one();
  	  		return;
    	}		

		if(FootRotateFlag == 1)
		{
				if(k110 == 1)     
				  R_AIR = R_AIR^1;
			    else if(k110 == 2)      //2012-6-7
					{
						 if(stretch_foot_flag == 0)
							stretch_foot_in();
						 else
							stretch_foot_out();
					 }
				FootRotateFlag = 0;
		}		
    	if(nopmove_flag == 1 || move_flag == 1)
    	{	
			predit_shift = 1;
			
			allx_step = allx_step - xstep_cou;
  			ally_step = ally_step - ystep_cou;
			
			if( check_sewing_range())
			{
				do_pat_point_add_one();

				single_flag = 0; 	
  				single_reply = 0x51;     // stepper motor is not move
				nopmove_flag = 0;
				move_flag = 0;
				sys.error = ERROR_15;
				StatusChangeLatch = ERROR;
				allx_step = allx_step + xstep_cou;
  				ally_step = ally_step + ystep_cou;
				return;
			}
			else
			{
				x_tmp = fabsm(xstep_cou);
				y_tmp = fabsm(ystep_cou);
				dly_time = 0;
				if( x_tmp> 0)
				{   
					timer_x = 62;
					step_movetype = 1;
					if( timer_x > (x_tmp <<TIME_PARAMETER_1) )
					   	timer_x = x_tmp <<TIME_PARAMETER_1;	
					dly_time = timer_x + 2;
					movestep_x(xstep_cou);
				  	delay_ms(1);
				}
				if(y_tmp > 0)
				{   
					timer_y = 62;
					step_movetype = 1;
					if( timer_y > (y_tmp <<TIME_PARAMETER_1) )
					   	timer_y = y_tmp <<TIME_PARAMETER_1;	
					if( timer_y > dly_time)
					    dly_time = timer_y + 2;				 
					movestep_y(ystep_cou);
				}					 
		    	delay_ms(dly_time);
				nopmove_flag = 0;
  				move_flag = 0;
			}
			step_movetype = 0;
			predit_shift = 0;
    	}
  	}
  	else    
  	{
  		single_flag = 0; 	
  		single_reply = 0x51;
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		course_stop
//  Parameters:	None
//  Returns:	None
//  Description: course stop
//--------------------------------------------------------------------------------------
void course_stop(void)
{
	single_flag = 0; 
}
/********************************
 * 功能：从shift_XX()中提炼
 *
 ********************************/
INT16 one_step_delay_result(void)
{
	INT16 tmp;
	if( one_step_delay ==1)
	    tmp = 1;//0.05mm
	else if( one_step_delay ==2)
	    tmp = 2;//0.1mm
	else
	    tmp = 20;//1mm

	return tmp;
}
//--------------------------------------------------------------------------------------
//  Name:		shift_12
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 12
//--------------------------------------------------------------------------------------
void shift_12(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{
		tmp = one_step_delay_result();
		ally_step = ally_step - tmp;
		
		if(ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  
		{
			remove_stop();
			ally_step = ally_step + tmp;
		}
		else
		{
			#if DEBUG_XY_MOVEMODE
			timer_y =  k112;
			#else
			timer_y = tmp ;
			#endif
			movestep_y(tmp);
      		delay_ms(tmp);     
    	}   
  	}
  	shift_flag = 0; 
  	shift_reply = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		shift_01
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 01
//--------------------------------------------------------------------------------------
void shift_01(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{	
		tmp = one_step_delay_result();		
		ally_step = ally_step - tmp;
      	allx_step = allx_step - tmp;
		 
		if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
		{
			remove_stop();
			ally_step = ally_step + tmp;
      		allx_step = allx_step + tmp; 
		}
		else
		{
			#if DEBUG_XY_MOVEMODE
			timer_y =  k112;
			#else
			timer_y = tmp ;
			#endif
			movestep_y(tmp);
	      	delay_us(400);
			#if DEBUG_XY_MOVEMODE
			timer_x =  k112;
			#else
			timer_x = tmp ;
			#endif
			movestep_x(tmp);
	      	delay_ms(tmp);
    	}
  	}
  	shift_flag = 0; 
	shift_reply = 0; 
}
//--------------------------------------------------------------------------------------
//  Name:		shift_03
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 03
//--------------------------------------------------------------------------------------
void shift_03(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{	
		tmp = one_step_delay_result();		
		allx_step = allx_step - tmp;
        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56) 
		{
			remove_stop();
			allx_step = allx_step + tmp;
		}
		else
		{
			#if DEBUG_XY_MOVEMODE
			timer_x =  k112;
			#else
			timer_x = tmp ;
			#endif
			movestep_x(tmp);
     		delay_ms(tmp);
    	}
  	}
  	shift_flag = 0; 
	shift_reply = 0;   
}
//--------------------------------------------------------------------------------------
//  Name:		shift_04
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 04
//--------------------------------------------------------------------------------------
void shift_04(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{	
		tmp = one_step_delay_result();		
		ally_step = ally_step + tmp;
      	allx_step = allx_step - tmp; 
        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
		{
			remove_stop();
			ally_step = ally_step - tmp;
      		allx_step = allx_step + tmp; 
		}
		else
		{
			#if DEBUG_XY_MOVEMODE
			timer_y =  k112;
			#else
			timer_y = tmp ;
			#endif
			movestep_y(-tmp);
	      	delay_us(400);
			#if DEBUG_XY_MOVEMODE
			timer_x =  k112;
			#else
			timer_x = tmp ;
			#endif
			movestep_x(tmp);
	      	delay_ms(tmp);
    	}
  	}
  	shift_flag = 0; 
	shift_reply = 0; 
}
//--------------------------------------------------------------------------------------
//  Name:		shift_06
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 06
//--------------------------------------------------------------------------------------
void shift_06(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{	
		tmp = one_step_delay_result();		
		ally_step = ally_step + tmp;
        if(ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
		{
			remove_stop();
			ally_step = ally_step - tmp;
		}
		else
		{	
			#if DEBUG_XY_MOVEMODE
			timer_y =  k112;
			#else
			timer_y = tmp ;
			#endif
			movestep_y(-tmp);
      		delay_ms(tmp);    	     
    	}
  	}
  	shift_flag = 0; 
	shift_reply = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		shift_07
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 07
//--------------------------------------------------------------------------------------
void shift_07(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{	
		tmp = one_step_delay_result();		
		ally_step = ally_step + tmp;
      	allx_step = allx_step + tmp;
        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
		{
			remove_stop();
			ally_step = ally_step - tmp;
      		allx_step = allx_step - tmp;
		}
		else
		{	
			#if DEBUG_XY_MOVEMODE
			timer_y =  k112;
			#else
			timer_y = tmp ;
			#endif
			movestep_y(-tmp);
      		delay_us(400);
			#if DEBUG_XY_MOVEMODE
			timer_x =  k112;
			#else
			timer_x = tmp ;
			#endif
			movestep_x(-tmp);
      		delay_ms(tmp);  
    	}
  	}
  	shift_flag = 0; 
	shift_reply = 0; 
}
//--------------------------------------------------------------------------------------
//  Name:		shift_09
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 09
//--------------------------------------------------------------------------------------
void shift_09(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{
		tmp = one_step_delay_result();		
		allx_step = allx_step + tmp;
        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56)  
		{
			remove_stop();
			allx_step = allx_step - tmp;
		}
		else
		{	
			#if DEBUG_XY_MOVEMODE
			timer_x =  k112;
			#else
			timer_x = tmp ;
			#endif
			movestep_x(-tmp);
      		delay_ms(tmp); 
    	}
  	}
  	shift_flag = 0; 
	shift_reply = 0;  
}
//--------------------------------------------------------------------------------------
//  Name:		shift_10
//  Parameters:	None
//  Returns:	None
//  Description: shift step to 10
//--------------------------------------------------------------------------------------
void shift_10(void)
{
	INT16 tmp;
	if(foot_flag == 0)
	{
		tmp = one_step_delay_result();		
		ally_step = ally_step - tmp;
      	allx_step = allx_step + tmp; 
        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
		{
			remove_stop();
			ally_step = ally_step + tmp;
      		allx_step = allx_step - tmp; 
		}
		else
		{
			#if DEBUG_XY_MOVEMODE
			timer_y =  k112;
			#else
			timer_y = tmp ;
			#endif
			movestep_y(tmp);
      		delay_us(400);
			#if DEBUG_XY_MOVEMODE
			timer_x =  k112;
			#else
			timer_x = tmp ;
			#endif
			movestep_x(-tmp);
      		delay_ms(tmp);          	   
    	}
  	} 
  	shift_flag = 0; 
	shift_reply = 0;
}

//--------------------------------------------------------------------------------------
//  Name:		remove_12
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 12
//--------------------------------------------------------------------------------------
void remove_12(void)
{
		if(foot_flag == 0)
		{	
			ally_step = ally_step - 1;
	        if(ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58) 
			{
				remove_stop();
				ally_step = ally_step + 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_y = 1;
				#else
				timer_y = CLOSE_LOOP_TIME;
				#endif
				movestep_y(1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }
}
//--------------------------------------------------------------------------------------
//  Name:		remove_01
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 01
//--------------------------------------------------------------------------------------
void remove_01(void)
{
	if(foot_flag == 0)
	{	
			ally_step = ally_step - 1;
			allx_step = allx_step - 1;
	        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
			{
				remove_stop();
				ally_step = ally_step + 1;
			    allx_step = allx_step + 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_y = 1;
				#else
				timer_y = CLOSE_LOOP_TIME;
				#endif
				movestep_y(1);
			    delay_us(400);
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = CLOSE_LOOP_TIME;
				#endif
				movestep_x(1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }
}
//--------------------------------------------------------------------------------------
//  Name:		remove_03
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 03
//--------------------------------------------------------------------------------------
void remove_03(void)
{
		if(foot_flag == 0)
		{		
			allx_step = allx_step - 1;

	        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56)  
			{
				remove_stop();
				allx_step = allx_step + 1;
				return;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = CLOSE_LOOP_TIME;
				#endif
				movestep_x(1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }

}
//--------------------------------------------------------------------------------------
//  Name:		remove_04
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 04
//--------------------------------------------------------------------------------------
void remove_04(void)
{
	if(foot_flag == 0)
		{			
			ally_step = ally_step + 1;
			allx_step = allx_step - 1;
	        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
			{
				remove_stop();
				ally_step = ally_step - 1;
			    allx_step = allx_step + 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_y = 1;
				#else
				timer_y = CLOSE_LOOP_TIME;
				#endif
				movestep_y(-1);
			    delay_us(400);
			   	#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = CLOSE_LOOP_TIME;
				#endif
				movestep_x(1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }
	
}
//--------------------------------------------------------------------------------------
//  Name:		remove_06
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 06
//--------------------------------------------------------------------------------------
void remove_06(void)
{
		if(foot_flag == 0)
		{	
			ally_step = ally_step + 1;
	        if(ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
			{
				remove_stop();
				ally_step = ally_step - 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_y = 1;
				#else
				timer_y = CLOSE_LOOP_TIME;
				#endif
				movestep_y(-1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }
}
//--------------------------------------------------------------------------------------
//  Name:		remove_07
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 07
//--------------------------------------------------------------------------------------
void remove_07(void)
{
		if(foot_flag == 0)
		{	
			ally_step = ally_step + 1;
			allx_step = allx_step + 1;
	        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)  //2012-12-17 modify
			{
				remove_stop();
				ally_step = ally_step - 1;
			    allx_step = allx_step - 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_y = 1;
				#else
				timer_y = CLOSE_LOOP_TIME;
				#endif
				movestep_y(-1);
			    delay_us(400);
			    #if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = CLOSE_LOOP_TIME;
				#endif
				movestep_x(-1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }
	
}
//--------------------------------------------------------------------------------------
//  Name:		remove_09
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 09
//--------------------------------------------------------------------------------------
void remove_09(void)
{
	if(foot_flag == 0)
		{
			allx_step = allx_step + 1;
	        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56)  //2012-12-17 modify
			{
				remove_stop();
				allx_step = allx_step - 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = CLOSE_LOOP_TIME;
				#endif
				movestep_x(-1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }

}
//--------------------------------------------------------------------------------------
//  Name:		remove_10
//  Parameters:	None
//  Returns:	None
//  Description: remove step to 10
//--------------------------------------------------------------------------------------
void remove_10(void)
{
	if(foot_flag == 0)
		{
			ally_step = ally_step - 1;
			allx_step = allx_step + 1;
	        if(allx_step < -RESOLUTION*k57 || allx_step > RESOLUTION*k56 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58)
			{
				remove_stop();
				ally_step = ally_step + 1;
			    allx_step = allx_step - 1;
			}
			else
			{
				step_movetype = 2;
				#if SUPPORT_UNIFY_DRIVER
				timer_y = 1;
				#else
				timer_y = CLOSE_LOOP_TIME;
				#endif
				movestep_y(1);
			    delay_us(400);
			    #if SUPPORT_UNIFY_DRIVER
				timer_x = 1;
				#else
				timer_x = CLOSE_LOOP_TIME;
				#endif
				movestep_x(-1);
			}
		}
	    else
	    {
	    	remove_stop();
	    }
}
//--------------------------------------------------------------------------------------
//  Name:		remove_stop
//  Parameters:	None
//  Returns:	None
//  Description: remove step stop
//--------------------------------------------------------------------------------------
void remove_stop(void)
{
  	DelayCounter = 0;
	shift_flag = 0; 
	shift_reply = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		go_setoutpoint
//  Parameters:	None
//  Returns:	None
//  Description: go setout point
//--------------------------------------------------------------------------------------
void go_setoutpoint(void)
{
	UINT32 temp16_x,temp16_y,temp16_max,temp32;		
	UINT32 i;	
	INT32 temp16_xo,temp16_yo;	
	UINT16 quick_time = 60;	
	
	pat_point = (PATTERN_DATA *)(pat_buf);
	pat_buff_total_counter = 0;
	move_flag = 0;
	lastmove_flag = 0;
	nopmove_flag = 0;
	origin2_lastmove_flag = 0;
	stop_flag =0 ;
	end_flag = 0;
	sox_step = 0;
	soy_step = 0;
	//--------------------------------------------------------------------------------------
  	//  process pattern data
  	//--------------------------------------------------------------------------------------
	while(1)
	{				
	  	process_data();            
	    if(nopmove_flag == 1)
	    {	      
			if(nopmove_flag == 1)
			{
	      		sox_step = sox_step + xstep_cou;
	      		soy_step = soy_step + ystep_cou; 
			}
			
			if(origin2_lastmove_flag == 1)  
			{
				nopmove_flag = 0;
				SewTestStitchCounter = 0;
				break;
			}
      		nopmove_flag = 0;
    	}
    	else
    	{
			
			if(origin2_lastmove_flag == 0 && move_flag == 1)
			{
    			do_pat_point_sub_one();
				move_flag = 0;
				SewTestStitchCounter = 1; 
				break;
				
			}
			else if(origin2_lastmove_flag == 1)
			{
				do_pat_point_sub_one();
				SewTestStitchCounter = 0;
				break;
			}
			if(end_flag == 1 || move_flag == 1 || RotateFlag == 1)
			{
				end_flag = 0;
				move_flag = 0;
				RotateFlag = 0;
				do_pat_point_sub_one();
				break;
			}
    		   	
    	}	
    	rec_com();    // communication with panel                                       	        
  	}
  	//--------------------------------------------------------------------------------------
  	// calculate displacement
  	//-------------------------------------------------------------------------------------- 
  	temp16_xo = sox_step - allx_step + x_bios;  
	temp16_yo = soy_step - ally_step + y_bios;
	
   //--------------------------------------------------------------------------------------
   // y go start point
   //--------------------------------------------------------------------------------------
   temp16_y = fabsm(temp16_yo);
   temp16_x = fabsm(temp16_xo);
   if(temp16_x > temp16_y)
  	{
  		temp16_max = temp16_x;
  	}
  	else
  	{
  		temp16_max = temp16_y;
  	}

   	if(temp16_max > 255)
	{
		//quick_time = Calculate_QuickMove_Time(temp16_max);
		quick_time = Calculate_QuickMove_Time(temp16_x,temp16_y);
	}
	else if(temp16_max <= 255 && temp16_max > 0)
	{
		quick_time = 62;
	}

  if(temp16_y < 255)
  {
	timer_y = 62;
	movestep_y(-temp16_yo);
  }
  else
  {
	quickmove_y_process(quick_time,-temp16_yo);	
  }
  delay_ms(1);
  //--------------------------------------------------------------------------------------
  // x go start point
  //--------------------------------------------------------------------------------------
 
  if(temp16_x < 255)
  {
	timer_x = 62;
	movestep_x(-temp16_xo);
  }
  else
  {
	quickmove_x_process(quick_time,-temp16_xo);	
  }

  if(temp16_max < 255)
  {
  	 delay_ms(70);
  }
  else
  {
	#if STEPPER_WAITTING_PROTOCOL
	delay_ms(quick_time + 58);
	for(i=0;i<quick_time;i++)
	{
		delay_ms(1);
		if( check_motion_done() )
		{
			delay_ms(50);
			break;
		}
	}
	#else
	 delay_ms(quick_time + 58);
	#endif 
  }
 	
    //--------------------------------------------------------------------------------------
  	// change all step counter
  	//-------------------------------------------------------------------------------------- 
	allx_step = sox_step + x_bios;  
  	ally_step = soy_step + y_bios;
	
	monitor_allx_step = allx_step;
	monitor_ally_step = ally_step;
	monitor_pat_point = pat_point - 1;
	monitor_refresh_flag =1;
	
	rec_com();  
	if(origin2_lastmove_flag == 1)
	{
		
	} 
	else
	{
  		sta_point = pat_point; 
	}
}
//--------------------------------------------------------------------------------------
//  Name:		turnoff_led
//  Parameters:	None
//  Returns:	None
//  Description: turn off led  
//--------------------------------------------------------------------------------------
void turnoff_led(void)
{
	if(alarmled_flag == 1)         			 
  	{	
    	ALARM_LED = 0;        // turn off ALARM LED  
    	alarmled_flag = 0;  	// switch flag	     		   
  	}	
}
//--------------------------------------------------------------------------------------
//  Name:		turnoff_buz
//  Parameters:	None
//  Returns:	None
//  Description: turn off buzzer 
//--------------------------------------------------------------------------------------
void turnoff_buz(void)
{
  	if(alarmbuz_flag == 1)         			 
  	{	
    	SUM = 0;              // turn off ALARM BUZZER   
    	alarmbuz_flag = 0;    // switch flag		     		   
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		turnoff_ledbuz
//  Parameters:	None
//  Returns:	None
//  Description: turn off led and buzzer 
//--------------------------------------------------------------------------------------
void turnoff_ledbuz(void)
{
	turnoff_led();
  	turnoff_buz();
}
//--------------------------------------------------------------------------------------
//  Name:		turnon_led
//  Parameters:	None
//  Returns:	None
//  Description: turn on led  
//--------------------------------------------------------------------------------------
void turnon_led(void)
{
  	if(alarmled_flag == 0)
  	{	         		   
    	ALARM_LED = 1;        // turn on ALARM LED  
    	alarmled_flag = 1;    // switch flag	     		   
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		turnon_buz
//  Parameters:	None
//  Returns:	None
//  Description: turn on buzzer 
//--------------------------------------------------------------------------------------
void turnon_buz(void)
{
  	if(alarmbuz_flag == 0)
  	{	         		   
    	SUM = 1;              // turn on ALARM BUZZER  
    	alarmbuz_flag = 1;    // switch flag		     		   
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		flash_led
//  Parameters:	None
//  Returns:	None
//  Description: flash led  
//--------------------------------------------------------------------------------------
void flash_led(void)
{	          	  
  	if(sound_count <= 25000)
  	{	
  		turnon_led();
  	}         		 
  	else 
  	{
  		turnoff_led();
  	}		
}
//--------------------------------------------------------------------------------------
//  Name:		flash_buz
//  Parameters:	None
//  Returns:	None
//  Description: flash buzzer  
//--------------------------------------------------------------------------------------
void flash_buz(void)
{	          	  
  	if(sound_count <= 25000)
  	{	
  		turnon_buz();
  	}         		 
  	else 
  	{
  		turnoff_buz();
  	}
}
//--------------------------------------------------------------------------------------
//  Name:		emergency
//  Parameters:	None
//  Returns:	None
//  Description: emergency measure  
//--------------------------------------------------------------------------------------
void emergency(void)
{	          	     
  	//--------------------------------------------------------------------------------------
  	// turn off all output
  	//-------------------------------------------------------------------------------------- 
  	if(motor.spd > 10)
  	{
   		motor.spd_obj = 0;
		motor.iq = 0;
   		U=1;U_=1;V=1;V_=1;W=1;W_=1;
   		prcr = 0x02;
   		inv03 = 0;
   		prcr = 0x00;
   		U_=0;V_=0;W_=0;
  	}
  	else
  	{
   		U=1;U_=1;V=1;V_=1;W=1;W_=1;
   		prcr = 0x02;
   		inv03 = 0;
   		prcr = 0x00;
   		OUTPUT_ON = 1;
		motor.iq = 0;
		motor.spd_obj = 0;
  	}   	    
}
//--------------------------------------------------------------------------------------
//  Name:		para_confirm
//  Parameters:	None
//  Returns:	None
//  Description: parameter confirm  
//--------------------------------------------------------------------------------------
void para_confirm(void)
{	  
	UINT16 temp16;
	//--------------------------------------------------------------------------------------
  //  sewing speed confirm
  //--------------------------------------------------------------------------------------        	     
  if(sew_speed > MAX_SPEED_LIMIT || sew_speed < 200)
  {
  	sew_speed = 1600;
  }
  //--------------------------------------------------------------------------------------
  //  1st to 5th stitch speed confirm with thread clamp
  //--------------------------------------------------------------------------------------  

  if(u02 > 15 || u02 < 2)
  {
  	u02 = 15;
  }
  if(u03 > 27 || u03 < 2)
  {
  	u03 = 27;
  }
  if(u04 > 27 || u04 < 2)
  {
  	u04 = 27;
  }
  if(u05 > 27 || u05 < 2)
  {
  	u05 = 27;
  }
  if(u06 > 27 || u06 < 2)
  {
  	u06 = 27;
  }

  //--------------------------------------------------------------------------------------
  //  1st to 5th stitch speed confirm without thread clamp
  //--------------------------------------------------------------------------------------  	
  if(u10 > 15 || u10 < 2)
  {
  	u10 = 2;
  }
  if(u11 > 27 || u11 < 2)
  {
  	u11 = 6;
  }
  if(u12 > 27 || u12 < 2)
  {
  	u12 = 10;
  }
  if(u13 > 27 || u13 < 2)
  {
  	u13 = 15;
  }
  if(u14 > 27 || u14 < 2)
  {
  	u14 = 20;
  }
}
//--------------------------------------------------------------------------------------
//  Name:		sewing_stop
//  Parameters:	None
//  Returns:	None
//  Description: sewing stop 
//--------------------------------------------------------------------------------------
void sewing_stop(void)
{   

	motor.stop_angle = k61;
	if(motor.stop_angle >= 1024)
	{
		motor.stop_angle = motor.stop_angle - 1024;
	}
  	motor.spd_obj = 0;  

}

//--------------------------------------------------------------------------------------
//  Name:		pause_stop
//  Parameters:	None
//  Returns:	None
//  Description: pause stop 
//--------------------------------------------------------------------------------------
void pause_stop(void)
{	
	INT16 temp16;
	INT8 temp8;
	
	zpl_pass = 0;
	#if ONESTEP_STOP
		if(u97 == 0)//三针降速
		{	
			if(motor.spd_obj >= 50 && motor.spd_obj <= 800)
			{
					motor.spd_obj = k43*10;
					temp16 = motor.angle_adjusted;
		        	while( temp16 <= angle_tab[240-8*k95] )
					{ 
		        		rec_com();    
		        		temp16 = motor.angle_adjusted;          
		        	}            
		        	process_flag = 0;	                    
			
					if(u46 == 0)
					{
						 SNT_H = 1;    
					     L_AIR = 1;
					}
					//motor.spd_obj = 100;
					//------------------------------------------------------------------------------------------------------------------------	
		        	 temp16 = motor.angle_adjusted;
		             while( temp16 <= angle_tab[300-8*u09])
				     { 
		    	           rec_com();
			               temp16 = motor.angle_adjusted;
		             }
		             if(k03 == 0)
		             {
			              da0 = 255;
				          DAActionFlag=1;
				          DAActionCounter =0;
		             }
			         else
			         {
			               temp_tension = u08;
		                   at_solenoid();     
		             } 
		      		sewing_stop();
		      		delay_ms(90); 
		      		while(motor.stop_flag == 0)
					{
						rec_com();
					}	
					if(u46 == 0)
					{
						L_AIR = 0;
						L_AIR = 0;
					 }	
				   if(u42 == 1)    
		 	  	   {
			  		    find_dead_point();
				   }
			 
					if(k03 == 0)
					{
						 da0 = 0;
						 SNT_H = 0;
					}
					else
					{
					     temp_tension = 0;  
			      		 at_solenoid();
					}
					if(u46 == 0)
		        		fw_solenoid();
			}
			else if(motor.spd_obj > 400 && motor.spd_obj < 1000)
			{
				motor.spd_obj = k43*10;
			}
			else if(motor.spd_obj >= 1000 && motor.spd_obj < 2000)
			{
				motor.spd_obj = 900;      
			}
			else if(motor.spd_obj >= 2000)
			{
				motor.spd_obj = 1900;      
			}
		}
		else //u97 = 1
		{
			temp16 = motor.angle_adjusted;
			if( temp16 >angle_tab[150])//给急停留个角度区间，150度以内可以急停下来
			{
				temp16 = motor.angle_adjusted;
		    	while( temp16 >=50 )   //多走一圈
				{ 
		        	rec_com();    
		        	temp16 = motor.angle_adjusted;          
		        } 
			}
	        temp16 = motor.angle_adjusted;
	        while( (temp16 <= angle_tab[240-8*u09]) || (temp16 >= 995) )  
			{ 
	    		rec_com();
		    	temp16 = motor.angle_adjusted;
	        }
				 
	        if(k03 == 0)
	        {
		    	da0 = 255;
				DAActionFlag=1;
				DAActionCounter =0;
	        }
		    else
		    {
		    	temp_tension = u08;
	        	at_solenoid();     
	        } 
			process_flag = 0;    	                       	
			sewing_stop();  
			while(motor.stop_flag == 0)
			{
				rec_com();
			} 	     	
			delay_ms(80);
			
			if(u42 == 1)
			{
				find_dead_point();
			}
	
			//-------------------------------------------------------------------------------------------------------------------	
			if(k03 == 0)   
			{                         
				da0 = 0;	
				SNT_H = 0;
			}
			else                       
			{
				temp_tension = 0;       
		    	at_solenoid();          
			}
		}	
		//-------------------------------------------------------------------------------------------------------------------	
		delay_ms(50); 
		inpress_up(); 
		emermove_high = IN_ORIGIN;
	    delay_ms(80);                       			// inpresser up 
		
		if(u208 == 1)
		{
			footer_both_up();   // foot_up();  //2012-5-18 modify
		} 
		//--------------------------------------------------------------------------------------
		//  switch system status 
		//--------------------------------------------------------------------------------------  	     
		sys.status = ERROR;
		StatusChangeLatch = ERROR;
		if(sys.error == OK)
		{
	    	sys.error = ERROR_02;
		}
		if(OutOfRange_flag == 1)
		sys.error = ERROR_15; 
	#else
	
	if(motor.spd_obj >= 50 && motor.spd_obj <= 800)
	{
		if(u97 == 0)
		{	
			trim_action();			
		}
		else if(u97 == 1)
		{
        	#if DOUBLE_X_60MOTOR
			if( motor.spd_obj <=400)
			#endif
			{
				temp16 = motor.angle_adjusted;
	            while( (temp16 <= angle_tab[240-8*u09]) || (temp16 >= 995) )  
				{ 
	    	    	rec_com();
		        	temp16 = motor.angle_adjusted;
	            }
			}
            if(k03 == 0)
            {
	        	da0 = 255;
		     	DAActionFlag=1;
		    	DAActionCounter =0;
            }
	        else
	        {
	        	temp_tension = u08;
            	at_solenoid();     
            } 
			process_flag = 0;    	                       	
	      	sewing_stop();  
			while(motor.stop_flag == 0)
			{
				rec_com();
			} 	     	
	      	delay_ms(80);
			
			if(u42 == 1)
			{
				find_dead_point();
			}
	   		if(k03 == 0)   
			{                         
				da0 = 0;
				SNT_H = 0;
			}
	   	   	else                       
			{
				temp_tension = 0;       
      			at_solenoid();          
			}	
			
			delay_ms(50); 
		}
		//--------------------------------------------------------------------------------------
		//  inpresser up
		//--------------------------------------------------------------------------------------
		inpress_up(); 
		emermove_high = IN_ORIGIN;
	    delay_ms(80);                       		
		
		if(u208 == 1)
		{
			footer_both_up(); 
		} 
		//--------------------------------------------------------------------------------------
		//  switch system status 
		//--------------------------------------------------------------------------------------  	     
		sys.status = ERROR;
		StatusChangeLatch = ERROR;
		if(sys.error == OK)
		{
	    	sys.error = ERROR_02;
		}
		if(OutOfRange_flag == 1)
			sys.error = ERROR_15;    
	}
	#if DOUBLE_X_60MOTOR
	else if(motor.spd_obj >= 800 && motor.spd_obj < 2000)
	{
		motor.spd_obj = 600;     
	}
	else if(motor.spd_obj >= 2000)
	{
		motor.spd_obj = 1900;      
	}
	#else	 
		else if(motor.spd_obj > 400 && motor.spd_obj < 1000)
		{
			motor.spd_obj = k43*10;
		}
		else if(motor.spd_obj >= 1000 && motor.spd_obj < 2000)
		{
			motor.spd_obj = 900;     
		}
		else if(motor.spd_obj >= 2000)
		{
			motor.spd_obj = 1900;      
		}
	#endif
   #endif			
}
//--------------------------------------------------------------------------------------
//  Name:		detect_position
//  Parameters:	None
//  Returns:	UINT8
//  Description: detect needle position
//--------------------------------------------------------------------------------------
UINT8 detect_position(void)
{	   
	INT16 temp16,comp1;	
	       	     
	temp16 = motor.angle_adjusted;
	if(u42 == 0)
	{	
	  	if(temp16 > (INT16)k61+14 || temp16 < (INT16)k61-14)   //40
	  	{
      		return OUT;
	  	}
	  	else
	  	{		    			   	
	    	return IN;    			
	  	}
	}
	else
	{
		temp16 = ( motor.angle_adjusted + 52) % 1024;
		comp1 =  DEADPOINT+52 ;//[0-150]
		if( (temp16 > comp1+25) ||( comp1 >temp16 +25) )
			return OUT;
		else
		    return IN;
	}	 
}
//--------------------------------------------------------------------------------------
//  Name:		repeat_pattern
//  Parameters:	None
//  Returns:	None
//  Description: repeat pattern 
//--------------------------------------------------------------------------------------
void repeat_pattern(void)
{	     
	while(1)
	{  	     
    	course_edit_next();
    	if(end_flag == 1)
    	{
			predit_shift = 0;
			end_flag = 0;
			break;
    	}
    	if(sys.status == ERROR)
    	{
      		return;
    	}  	
  	}
 	nopmove_flag = 0;
	move_flag = 0;
  	end_flag = 0;
}
//--------------------------------------------------------------------------------------
//  Name:		go_manualpoint
//  Parameters:	None
//  Returns:	None
//  Description: go manual point
//--------------------------------------------------------------------------------------
void go_manualpoint(void)
{
	UINT32 temp16_x,temp16_y,temp16_max,temp32;	
	UINT16 i;	
	INT32 temp16_xo,temp16_yo;	
	UINT16 quick_time = 60;	
	
  	//--------------------------------------------------------------------------------------
  	// calculate displacement
  	//--------------------------------------------------------------------------------------  
  	temp16_xo = manx_step - allx_step; 
  	temp16_yo = many_step - ally_step;   
	//--------------------------------------------------------------------------------------
  	// change all step counter
  	//--------------------------------------------------------------------------------------    
  	allx_step = manx_step; 
  	ally_step = many_step;
	
  //--------------------------------------------------------------------------------------
  // y go manual point
  //--------------------------------------------------------------------------------------
   temp16_y = fabsm(temp16_yo);
   temp16_x = fabsm(temp16_xo);
  	if(temp16_x > temp16_y)
  	{
  		temp16_max = temp16_x;
  	}
  	else
  	{
  		temp16_max = temp16_y;
  	}

   	if(temp16_max > 255)
	{
		//quick_time = Calculate_QuickMove_Time(temp16_max);
		quick_time = Calculate_QuickMove_Time(temp16_x,temp16_y);
	}
	else if(temp16_max <= 255 && temp16_max > 0)
	{
		quick_time = 62;
	}
	   
  if(temp16_y < 255)
  {
	timer_y = 62;
	movestep_y(-temp16_yo);
  }
  else
  {
	  quickmove_y_process(quick_time,-temp16_yo);		
  }
  delay_ms(1);
  //--------------------------------------------------------------------------------------
  // x go manual point
  //--------------------------------------------------------------------------------------

  if(temp16_x < 255)
  {
	timer_x = 62;
	movestep_x(-temp16_xo);
  }
  else
  {
	  quickmove_x_process(quick_time,-temp16_xo);		
  }
  
  if(temp16_max < 255)
  {
  	delay_ms(70);
  }
  else
  {
	 delay_ms(quick_time);
	 for(i=0;i<quick_time ;i++)
	 { 
		    delay_ms(1);
			if( check_motion_done() )
			{
			   delay_ms(50);
			   break;
			}
	 }
  } 
}
//--------------------------------------------------------------------------------------
//  Name:		reset_panel
//  Parameters:	None
//  Returns:	None
//  Description: reset_panel
//--------------------------------------------------------------------------------------
void reset_panel(void)
{	     
	delay_ms(100);
	RST_PN = 0;		      // reset control panel
}
//--------------------------------------------------------------------------------------
//  Name:		initial_mainmotor
//  Parameters:	None
//  Returns:	None
//  Description: initial main motor
//--------------------------------------------------------------------------------------
void initial_mainmotor(void)
{	     
	if(motorconfig_flag == 0)
  	{
	  	if(sys.error == 0)
	    {
    		motor_start();
			
    		while(motor.stop_flag == 0)    
      		{
        		rec_com();             // communication with panel	
      		}    
			
      		delay_ms(200);  //2000
			if(FindZeroFlag == 1)//2011-5-15
			{
				if(u42 ==0)
				  	find_up_position();
				else
					find_zero();
				motorconfig_flag = 1;
			}
			else if(FindZeroFlag == 0)
			{
				delay_ms(200);
				if(FindZeroFlag == 1)
				{
					if(u42 ==0)
					  	find_up_position();
					else
						find_zero();
					motorconfig_flag = 1;
				}
				else if(FindZeroFlag == 0)
				{
					delay_ms(200);
					if(FindZeroFlag == 1)//2011-5-15
					{
						if(u42 ==0)
						  	find_up_position();
						else
							find_zero();
						motorconfig_flag = 1;
					}
					else if(FindZeroFlag == 0)
					{
						delay_ms(200);
						if(FindZeroFlag == 1)//2011-5-15
						{
							if(u42 ==0)
							  	find_up_position();
							else
								find_zero();
							motorconfig_flag = 1;
						}
						else if(FindZeroFlag == 0)
						{
							delay_ms(200);
							if(FindZeroFlag == 1)//2011-5-15
							{
								if(u42 ==0)
								  	find_up_position();
								else
									find_zero();
								motorconfig_flag = 1;
							}
							else if(FindZeroFlag == 0)
							{
								delay_ms(200);
								if(FindZeroFlag == 1)//2011-5-15
								{
									if(u42 ==0)
									  	find_up_position();
									else
										find_zero();
									motorconfig_flag = 1;
								}
								else
								{
									EncoderZ_flag = 0;
								}
							}
						}
					}

				}
			}
    	}
    	else
    	{ 
    		sys.status = ERROR;
			StatusChangeLatch = ERROR;
    		return;
    	}	  
  	}
}

//--------------------------------------------------------------------------------------
//  Name:		go_edit1_commandpoint
//  Parameters:	None
//  Returns:	None
//  Description: go edit command point
//--------------------------------------------------------------------------------------
void go_commandpoint(INT32 commandpointcoorx,INT32 commandpointcoory)
{
	UINT32 temp16_x,temp16_y,temp16_max,temp32;		
	UINT32 i,j;	
	INT32 temp16_xo,temp16_yo,tmpx,tmpy;
	UINT16 quick_time = 60;	
	PATTERN_DATA *TempPatpoint;	
	INT32 allx_temp_step,ally_temp_step;	
	
	TempPatpoint = pat_point;
	allx_temp_step = allx_step;
	ally_temp_step = ally_step;
	bakeup_total_counter = pat_buff_total_counter;
  	//--------------------------------------------------------------------------------------
  	// calculate displacement
  	//--------------------------------------------------------------------------------------  
	tmpx = commandpointcoorx;
	tmpy = commandpointcoory;
  	temp16_xo = tmpx - allx_step; 
  	temp16_yo = tmpy - ally_step;   	
	//--------------------------------------------------------------------------------------
	// y go manual point
	//--------------------------------------------------------------------------------------
	temp16_y = fabsm(temp16_yo);
	temp16_x = fabsm(temp16_xo);
  	if(temp16_x > temp16_y)
  	{
  		temp16_max = temp16_x;
  	}
  	else
  	{
  		temp16_max = temp16_y;
  	}

   	if(temp16_max > 255)
	{
		//quick_time = Calculate_QuickMove_Time(temp16_max);
		quick_time = Calculate_QuickMove_Time(temp16_x,temp16_y);
	}
	else if(temp16_max <= 255 && temp16_max > 0)
	{
		quick_time = 62;
	}

  	if(temp16_y < 255)
  	{
		timer_y = 62;
		movestep_y(-temp16_yo);
  	}
  	else
  	{
		quickmove_y_process(quick_time,-temp16_yo);	
  	}
  	delay_ms(1);
  //--------------------------------------------------------------------------------------
  // x go manual point
  //--------------------------------------------------------------------------------------

  	if(temp16_x < 255)
  	{
		timer_x = 62;
		movestep_x(-temp16_xo);
  	}
  	else
  	{
		quickmove_x_process(quick_time,-temp16_xo);		
  	}
  
  	if(temp16_max < 255)
  	{
  		delay_ms(70);
  	}
  	else
  	{
	 
#if STEPPER_WAITTING_PROTOCOL
	  for(i=0;i<quick_time;i++)
	  {
		 delay_ms(1);
		 if( (enable_stop_in_nopmove == 1)&&(sys.status == RUN) )
		 {
			 if(PAUSE == pause_active_level)   
		     {
			     delay_ms(2);
			     if(PAUSE == pause_active_level)
			     {				
					 finish_nopmove_pause_flag = 1;
				     nop_move_emergency(temp16_x,temp16_y); //STOP MOVING
					 
					 for(j=0;j<500;j++)
					 {
						delay_ms(1);
						if( check_motion_done() )
						   break;
				  	 }
				     if( j == 500)
					 {
						
					 	   sys.error = ERROR_70;
						   special_go_allmotor_flag = 1;
						   return;
					
					 }
					 delay_ms(10);
					 tmpx = 0;
					 tmpy = 0;
					 if( temp16_x > 255 )
					     tmpx = get_x_distance();					 
					 else if( temp16_x != 0)
					     tmpx = temp16_x;
					 else
					 	 temp16_xo = 0;
						 
					 delay_ms(10);
					 
					 if( temp16_y > 255  )
					     tmpy = get_y_distance();
					 else if( temp16_y != 0 )
					     tmpy = temp16_y;					 
					 else
						 temp16_yo = 0;
				 
					 if( tmpx == IGNORE_STOP )
					  tmpx = temp16_x;					 
					 if(tmpy ==IGNORE_STOP )
					   tmpy = temp16_y;
					   
					 read_step_x = tmpx;
					 read_step_y = tmpy;
					 
					 last_pattern_point = TempPatpoint;
					 last_allx_step = allx_temp_step;
					 last_ally_step = ally_temp_step;
					 
					 //**************************
					  if( (tmpx == 0)&&(temp16_x !=0) )
					  {
						  if(tmpy !=0)
						    read_step_x = temp16_x;
					  }
					  if( (tmpy == 0)&&(temp16_y !=0) )
					  {
						  if(tmpx !=0)
						    read_step_y = temp16_y;
					  }
					 //**************************
					 
					 if( temp16_xo >0 )
					 {
					  	 nop_move_remainx = temp16_xo - read_step_x;
						 if( nop_move_remainx < 0)
						 {
						     sys.error = ERROR_69;
							 special_go_allmotor_flag = 1;
						 }
							 
					 }
					 else if ( temp16_xo < 0)
					 {
					     nop_move_remainx = temp16_xo + read_step_x;
						 if( nop_move_remainx > 0)
						 {
						    sys.error = ERROR_69;
							special_go_allmotor_flag = 1;
						  }
						 read_step_x = -read_step_x;
					 }
					 else
					 {
						 nop_move_remainx = 0;
						 read_step_x = 0;
					 }
					      
					 if( temp16_yo >0 )	 
					 {
					     nop_move_remainy = temp16_yo - read_step_y;
						 if( nop_move_remainy <0 )
						 {
						   sys.error = ERROR_69;
						   special_go_allmotor_flag = 1;
						 }
					 }
					 else if( temp16_yo <0 )
					 {
					     nop_move_remainy = temp16_yo + read_step_y;
						 if( nop_move_remainy >0 )
						 {
						   sys.error = ERROR_69;
						   special_go_allmotor_flag = 1;
						 }
						 read_step_y = -read_step_y;
					 }
					 else
					 {
						 nop_move_remainy = 0;
						 read_step_y = 0;
					 }
					 break;
		  	     }
			 }
		 }
	  }
	if( nop_move_pause_flag == 0)
	{
		for(i=0;i<quick_time;i++)
		{
			delay_ms(1);
			if( check_motion_done() )
			{
			   delay_ms(50);
			   break;
			}
		}
	}
#else	 
	  if( quick_time < 398 )
	      quick_time = 398;
	  for(i=0;i<quick_time - 398;i++)
	  {
	     delay_ms(1);
		 if( (enable_stop_in_nopmove == 1)&&(sys.status == FINISH) )
		 {
			 if(PAUSE == pause_active_level)   
		     {
			     delay_ms(2);
			     if(PAUSE == pause_active_level)
			     {				
					 finish_nopmove_pause_flag = 1;
				     nop_move_emergency(temp16_x,temp16_y); //STOP MOVING
					 
					 delay_ms(20);//10
					 
					 tmpx = 0;
					 tmpy = 0;
					 if( temp16_x > 255 )
					     tmpx = get_x_distance();					 
					 else if( temp16_x != 0)
					     tmpx = temp16_x;
					 else
					 	 temp16_xo = 0;
						 
					 delay_ms(10);
					 
					 if( temp16_y > 255  )
					     tmpy = get_y_distance();
					 else if( temp16_y != 0 )
					     tmpy = temp16_y;					 
					 else
						 temp16_yo = 0;
					 if( tmpx == IGNORE_STOP )
					  tmpx = temp16_x;					 
					 if(tmpy ==IGNORE_STOP )
					   tmpy = temp16_y;
					   
					 read_step_x = tmpx;
					 read_step_y = tmpy;
					 
					 last_pattern_point = TempPatpoint;
					 last_allx_step = allx_temp_step;
					 last_ally_step = ally_temp_step;
					 
					 //**************************
					  if( (tmpx == 0)&&(temp16_x !=0) )
					  {
						  if(tmpy !=0)
						    read_step_x = temp16_x;
					  }
					  if( (tmpy == 0)&&(temp16_y !=0) )
					  {
						  if(tmpx !=0)
						    read_step_y = temp16_y;
					  }
					 //**************************
					 
					 if( temp16_xo >0 )
					 {
					  	 nop_move_remainx = temp16_xo - read_step_x;
						 if( nop_move_remainx < 0)
						 {
						     sys.error = ERROR_15;
							 special_go_allmotor_flag = 1;
						 }
							 
					 }
					 else if ( temp16_xo < 0)
					 {
					     nop_move_remainx = temp16_xo + read_step_x;
						 if( nop_move_remainx > 0)
						 {
						    sys.error = ERROR_15;
							special_go_allmotor_flag = 1;
						  }
						 read_step_x = -read_step_x;
					 }
					 else
					 {
						 nop_move_remainx = 0;
						 read_step_x = 0;
					 }
					      
					 if( temp16_yo >0 )	 
					 {
					     nop_move_remainy = temp16_yo - read_step_y;
						 if( nop_move_remainy <0 )
						 {
						   sys.error = ERROR_15;
						   special_go_allmotor_flag = 1;
						 }
					 }
					 else if( temp16_yo <0 )
					 {
					     nop_move_remainy = temp16_yo + read_step_y;
						 if( nop_move_remainy >0 )
						 {
						   sys.error = ERROR_15;
						   special_go_allmotor_flag = 1;
						 }
						 read_step_y = -read_step_y;
					 }
					 else
					 {
						 nop_move_remainy = 0;
						 read_step_y = 0;
					 }
					 break;
		  	     }
			 }
		 }
	  }
	  delay_ms(506);
#endif	  
  }
  	
  	//--------------------------------------------------------------------------------------
  	// change all step counter
  	//--------------------------------------------------------------------------------------    
	if(finish_nopmove_pause_flag == 0 )
	{
  		allx_step = commandpointcoorx; 
  		ally_step = commandpointcoory;
	}

  	delay_ms(1);   
}

void process_bottom_thread(void)
{
	/*
	UINT16 x_temp, y_temp,temp16,k;
	if( check_bottom_thread_switch == 1)
	{
		if( bottom_thread_alarm_type == 0)//DISTANCE
		{
			x_temp = fabsm(xstep_cou);
			y_temp = fabsm(ystep_cou);
			temp16 = X2_tab[x_temp];
		    temp16 += X2_tab[y_temp];
			for(k=0;k<256;k++)
			{
			  if( temp16 <= X2_tab[k] )
					   break;
			} 
			temp16 = k;
			if( bottom_thread_remain > k )
			  bottom_thread_remain -= k;
		 
			if( bottom_thread_remain < alarm_thread_length)
			{
				status_now = READY;
				sys.status = ERROR;
				StatusChangeLatch = ERROR;
	      		sys.error = ERROR_45;
			
				return;
			}
		}
		else
		{
			if( bottom_thread_remain > 0 )
			  bottom_thread_remain -= 1;
		 
			if( bottom_thread_remain == 0 )
			{
				status_now = READY;
				sys.status = ERROR;
				StatusChangeLatch = ERROR;
	      		sys.error = ERROR_45;
				return;
			}
		}
	}
	*/
}
//--------------------------------------------------------------------------------------
//  Name:		move_xy
//  Parameters:	None
//  Returns:	None
//  Description: move xy motor
//--------------------------------------------------------------------------------------
void move_xy(void)
{	     
	UINT16 temp16;
	UINT16 sew_area_temp,k;
	UINT16 allx_step_temp;
	UINT16 x_temp, y_temp;
	
	allx_step = allx_step + xstep_cou;                        
  	ally_step = ally_step + ystep_cou;	 
	
	monitor_allx_step = allx_step;
	monitor_ally_step = ally_step;
	monitor_pat_point = pat_point - 1;
	monitor_refresh_flag = 1;
	
#if NEW_CONTROL_PROTOCOL	

	if( movestep_x_flag == 1)//等待动作完成
	{
		while(movestepx_delay_counter >0); 
	}
	movestep_x_flag = 0;
	temp16 = motor.angle_adjusted;
	flag_start_waitcom = 1;
	while( (temp16 <= movestep_angle)  &&(motor.spd_obj >0) )
	{  
		temp16 = motor.angle_adjusted;   
		if( sys.status == ERROR)
			return;
		if(flag_wait_com == 1)
		{     
			rec_com(); 
			counter_wait_com = 0;
			flag_wait_com = 0;
			flag_start_waitcom = 1;
		}     	                                                    
	}
	movestep_x_flag = 1;
	movestepx_delay_counter = timer_x;
	movestep_x_y_both(-xstep_cou,-ystep_cou);
	
#else	
	
	temp16 = motor.angle_adjusted;
	//if( xy_move_mode >= 1) //非同时动框方式
	{
		x_temp = fabsm(xstep_cou);
		y_temp = fabsm(ystep_cou);
		
		if( movestepy_angle > movestepx_angle)//Y轴动框比X轴晚，先动X轴
		{
			if( x_temp > 0)
			{
				if( movestep_x_flag == 1)//确认之前是否有X向位移，等待动作完成
				{
					while(movestepx_delay_counter >0); 
				}
				movestep_x_flag = 0;
				temp16 = motor.angle_adjusted;
				flag_start_waitcom = 1;
			  	while( (temp16 <= movestepx_angle)  &&(motor.spd_obj >0) )
			  	{  
					temp16 = motor.angle_adjusted;   
					if( sys.status == ERROR)
						return;
					if(flag_wait_com == 1)
					{     
	        			rec_com(); 
						counter_wait_com = 0;
						flag_wait_com = 0;
						flag_start_waitcom = 1;
					}     	                                                    
			  	}
				movestep_x(-xstep_cou);				
				movestepx_delay_counter = timer_x +1;
				movestep_x_flag = 1;
				//test_flag = 1;
				if(y_temp > 0)
					delay_us(400);
			}
						
			if(y_temp > 0)
			{
				if( movestep_y_flag == 1)
				{
					while(movestepy_delay_counter >0) ;
				}
				movestep_y_flag = 0;
				temp16 = motor.angle_adjusted;
				flag_start_waitcom = 1;
				while( (temp16 <= movestepy_angle) && (motor.spd_obj >0 ) )
			  	{ 
					temp16 = motor.angle_adjusted;
					if(sys.status == ERROR)
						return;
					if( flag_wait_com == 1)
					{     
	        			rec_com(); 
						counter_wait_com = 0;
						flag_wait_com = 0;
						flag_start_waitcom = 1;
					}            	                                                    
			  	}
				flag_start_waitcom = 0;
				
				movestep_y(-ystep_cou); 				
			    movestepy_delay_counter = timer_y +1; 
				movestep_y_flag = 1;
				//test_flag = 21;
			}
		}
		else
		{
			if(y_temp > 0)
			{
				if( movestep_y_flag == 1)
				{
					while(movestepy_delay_counter >0) ;
				}
				movestep_y_flag = 0;
				temp16 = motor.angle_adjusted;
				flag_start_waitcom = 1;
				while( (temp16 <= movestepy_angle)  && (motor.spd_obj > 0 ) )
			  	{
					temp16 = motor.angle_adjusted;
					
					if(sys.status == ERROR)
						return;
					
					if(flag_wait_com == 1)
					{     
	        			rec_com(); 
						counter_wait_com = 0;
						flag_wait_com = 0;
						flag_start_waitcom = 1;
					}        	                                                    
			  	}
				flag_start_waitcom = 0;
				
				movestep_y(-ystep_cou); 				
				movestepy_delay_counter = timer_y +1; 
				movestep_y_flag = 1;
				//test_flag= 21;
				if(x_temp > 0)
					delay_us(400);
			}
			
			if(x_temp > 0)
			{
				if( movestep_x_flag == 1)
				{
					while(movestepx_delay_counter >0) ;
				}
				movestep_x_flag = 0;
				temp16 = motor.angle_adjusted;
				flag_start_waitcom = 1;
			  	while( (temp16 <= movestepx_angle)  &&( motor.spd_obj >0 ) )
			  	{   
					temp16 = motor.angle_adjusted;        	                                                    
			  		
					if( sys.status == ERROR)
						return;
					if(flag_wait_com == 1)
					{     
	        			rec_com(); 
						counter_wait_com = 0;
						flag_wait_com = 0;
						flag_start_waitcom = 1;
					}        	                                                    
			  	}
				flag_start_waitcom = 0;
				movestep_x(-xstep_cou);
				movestepx_delay_counter = timer_x +1;
				movestep_x_flag = 1;
				//test_flag = 1;
			}
		}
	}
#endif
	
  	move_flag = 0; 
    	  
}

//---------------------------------------------------------------------------------------
//  Name:		zpl_process
//  Parameters:	None
//  Returns:	None
//  Description: zpl process
//--------------------------------------------------------------------------------------
void zpl_process(void)
{
	if(pause_flag ==0 && thbrk_flag == 0)
  	{	 
	    if(process_flag == 1)
	    {	
      		check_data(1);          			     
      		process_data(); 
       		calculate_angle();	   			
			if(stitch_counter != 1 && k03 == 1) 
      		{
     			temp_tension = tension;
        		at_solenoid();       		// 4th step to set thread tension
      		}
    	}
    	stay_flag = 0;           			// no emergency break
    	brkdt_flag = 0;          			// no thread breakage detection  	    
		zpl_pass = 0;
  	}
  	else
  	{
	  	if( pause_flag == 1)
	  	{	
  	  		stay_flag = 1;         			// emergency break
  		}                        
  		if( thbrk_flag == 1)      
  		{                        
  	  		brkdt_flag = 1;        			// thread breakage detection  	  	  	  	  	  	  	  	
  		}	
  	}
	
}
//====================================================================
/**
  * @函数功能 加固缝制的特殊处理
  * @函数功能变更 2016-03-02
  * @参数 flag 0---正向缝制  1---反向（从当前位置向后退缝）  2---原地扎针(2016-03-02)
  * @参数 cnt  加固缝制的针数 
  */
void special_sewing(UINT8 flag,UINT8 cnt,INT16 xoffset)
{
	UINT8 i,j,last_stitch_down;
	INT16 temp16_max,temp16;
	UINT8 action_flag0,action_flag1,action_flag2,action_flag3,action_flag4;
	INT16 inpress_up_angle,inpress_down_angle,max_angle;
	UINT16 tmp16_stitchs;
	i = cnt;
	j = 0;
	last_stitch_down = 0;
	check_data_speed = motor.spd_obj;
	
	while( i > 0 )
	{
		tmp16_stitchs = pat_point - (PATTERN_DATA *)(pat_buf);
		set_func_code_info(0X50+flag,i,tmp16_stitchs>>8,tmp16_stitchs);

		   if( flag == 0 )    //向前缝制
		       process_data();
		   else if(flag == 3) //原地加固
		   {
			   move_flag = 1;
		   }	   
		   else              //向后退缝
		   {
		       conprocess_data();
			   if( start_flag == 1)
			       break;
		   }
		   
		   if( move_flag == 1)
		   {
				 if( (xstep_cou == 0)&&(ystep_cou != 0) )//竖线 则调X轴
				 {
				 	xstep_cou += xoffset;
				 }
				 else if ( (xstep_cou != 0) && (ystep_cou == 0) )//横线 则调Y轴
				 {
				 	ystep_cou += xoffset;
				 }
				 else
				 {
				 	xstep_cou += xoffset;
				 }
				 j++;
				
		 #if FOLLOW_INPRESS_FUN_ENABLE
		 		 
				 check_data(1);			//随动中压脚转速变换了，但指针应该已经超花样了				   
				 calculate_angle();
				 
				 action_flag0 = 1;
				 action_flag1 = 1;
				 action_flag2 = 1;
				 action_flag3 = 1;
				 action_flag4 = 1;
				 
				 temp16 = motor.angle_adjusted;
				 inpress_up_angle   = angle_tab[inpress_follow_up_angle];//中压脚动作角度
				 inpress_down_angle = angle_tab[inpress_follow_down_angle];
				 
				 //if( inpress_down_angle > inpress_up_angle )
				 if( (inpress_down_angle > inpress_up_angle )&&(last_stitch_down ==1) )
				    action_flag2 = 0;
				 else if( (inpress_down_angle > inpress_up_angle )&&(last_stitch_down ==0))
				 {
					inpress_down_angle = 5;
				 }	
				 while( temp16 < 1000 )
				 {
					 temp16 = motor.angle_adjusted;
					 //1
					 if( (u51 == 0)&&(i == cnt)&&(stitch_counter == 1)&&(action_flag0 ==1) )//起缝夹线器的处理程序
					 {
					      	if(temp16 >= 512)    //180d
					        { 
					        	FW = 1;
								action_flag0 = 0;
							}
					 }
					 //2
					 if( (front2stitchs_tension_off ==  1) && ( stitch_counter > 1) )
					 {
						if( k03 == 0 )
						{
							da0 = 0;
							SNT_H = 0;
						}
					 }
					 //3
					 if( (clamp_com == 1) && (stitch_counter <= u33)&&(action_flag1 == 1) )//起缝加固的抓线处理
					 {
						 if( temp16 >= movect_angle )
						 {
						 	 move_ct();
							 action_flag1 = 0;
						 }
					 }
					 //4
					 if( (temp16 > inpress_down_angle ) &&( action_flag2 == 1) )//中压脚下降角度
					 {
						action_flag2 = 0;
						if( inpress_follow_high_flag == FOLLOW_INPRESS_HIGH )
						{
							//test_flag =1;
							movestep_zx(-inpress_follow_range,inpress_follow_down_speed);
							inpress_follow_high_flag = FOLLOW_INPRESS_LOW;
						}
					 }
					 //5
					 if( (temp16 > inpress_up_angle ) &&( action_flag3 == 1) )
					 {
						  action_flag3 = 0;
						  #if FIRST_STITCH_NOT_ACTION 
						  if( (inpress_follow_high_flag == FOLLOW_INPRESS_LOW )&&(stitch_counter > inpress_not_working_stitchs) )
						  #else
						  if( inpress_follow_high_flag == FOLLOW_INPRESS_LOW )
							#endif
						  {
								//test_flag =21;
								
								//2018-8-8
						    	//如果启动了前几针改变中压脚上升高度的功能，且当前针数属于指定的针数内，那么使用指定的随动范围
						    	//此处程序用于将中压脚随动范围恢复到正常值,最后一针的时候，需要把中压脚的高度恢复到正常高度
								if(para.start_sew_change_inpress_high_enable == 55 
									&& stitch_counter == para.start_sew_change_inpress_high_stitchs
									&& stitch_counter < 20
									/*&&para.start_sew_change_inpress_high_range<=inpress_follow_range*/ )
								{
									//计算正常的随动高度到变量inpress_follow_range中
									if( inpress_follow_range_pc == 0)//k173，中压脚随动高度，操作头下发
									{
										if( inpress_follow_mode == 5 )//模式5.随动范围是13，否则为8
										    inpress_follow_range = 13;
										else	
											inpress_follow_range = INPRESS_DELTA_RANGE;
									}
									else
										inpress_follow_range = inpress_follow_range_pc;
								}
									
								movestep_zx(inpress_follow_range,inpress_follow_up_speed);//先升后降
								inpress_follow_high_flag = FOLLOW_INPRESS_HIGH;		
								//========================================
								stitch_counter++;
								pat_point++;
								check_data(0);//看看下针转速，但不改变实际转速
									inpress_down_angle = angle_tab[inpress_follow_down_angle];
									pat_point--;
									stitch_counter--;
									if( inpress_down_angle > inpress_up_angle)//默认情况下是下降小于起始的
									{
										action_flag2 = 1;//允许再次下降
										last_stitch_down = 1;
								}
								else
									last_stitch_down = 0;
								//========================================
						  }
				     }
					 //6
					if( (temp16 > movestep_angle ) &&( action_flag4 == 1) )
					{
						 action_flag4 = 0;
						 if(fabsm(ystep_cou) > 0)
					     {
							 if( flag == 0)
								 movestep_y(-ystep_cou);
							 else if(flag != 3)
						         movestep_y(ystep_cou);
							 if(fabsm(xstep_cou) > 0)
							    delay_us(400);
					     }
						 if(fabsm(xstep_cou) > 0)
						 {
							 if( flag == 0)
							     movestep_x(-xstep_cou);
							 else if(flag != 3)
								 movestep_x(xstep_cou);
						 }
					}
					rec_com();
				 }
		 #else
				 //加固按新算法处理
			     check_data(1);							   
				 calculate_angle(); //计算加固针的动框角度
				 if( (u51 == 0)&&(i == cnt)&&(stitch_counter == 1) )//起缝夹线器的处理程序
				 {
						temp16 = motor.angle_adjusted;
				      	while(temp16 <= 512)    //180d
				        { 
				        	rec_com();
							temp16 = motor.angle_adjusted;
						}
						FW = 1;
				 }
				 if( (front2stitchs_tension_off ==  1) && ( stitch_counter > 1) )
				 {
					if( k03 == 0 )
					{
						da0 = 0;
						SNT_H = 0;
					}
				 }
				 //================================================================
				 if( (clamp_com == 1) && (stitch_counter <= u33) )//起缝加固的抓线处理
				 {
					 if( stitch_counter == 2)//第二针固定角度进行抓紧动作
					 {
						 temp16 = motor.angle_adjusted;
				 		 while( temp16 <= 222 )//
						 { 
							   //rec_com();   
							   if(sys.status == POWEROFF)   
							      return;
							   temp16 = motor.angle_adjusted;        	                                                    
			  	  		  }
					 }
					 move_ct();
				 }
				 //================================================================
				 temp16 = motor.angle_adjusted;
			     while( temp16 <= movestep_angle ) //等动框角度
		    	 { 
				   rec_com();   
				   if(sys.status == POWEROFF)   
				      return;
				   temp16 = motor.angle_adjusted;        	                                                    
		  	     }
		   
				 if(fabsm(ystep_cou) > 0)
			     {
						  if( flag == 0)
						  {
						  		movestep_y(-ystep_cou);
						  }
						  else if(flag == 3)
						  {
						  }
						  else
						  {
						      movestep_y(ystep_cou);
						  }
					      delay_us(400);
			     }
				 if(fabsm(xstep_cou) > 0)
				 {
					 	  if( flag == 0)
						      movestep_x(-xstep_cou);
						  else if(flag == 3)
						  {
						  }
						  else
						  {
						      movestep_x(xstep_cou);
						  }
				 }
		#endif
				 if( flag == 0)
				 {
					allx_step = allx_step + xstep_cou;                       
	  				ally_step = ally_step + ystep_cou;    
				 }
				 else if(flag == 3)
				 {
				 }
				 else
				 {
				 	allx_step = allx_step - xstep_cou;                        
	  			 	ally_step = ally_step - ystep_cou;	    
				 }
	 			 move_flag = 0;
				 i--;
				 if( i>0 )//等这几针处理完退出，最后一针是动框角度之后就退了
				 {
					 while(motor.angle_adjusted >= 16)
			    	 {
			    			rec_com();
			    	 }
					 stitch_counter++; 
				 }
				 if( u51 == 0 )
				 {
					 FW = 0;
				 }
				 //stitch_counter++;
				 process_bottom_thread();//处理底线报警
		   }
		   else
		   {
		   		i--;
				if( (nopmove_flag == 1)&&( (flag == 1)||((flag == 2)) ) )
				{
					do_pat_point_add_one();
				}
				nopmove_flag = 0;
				cut_flag = 0;
				break;
		   }
		   tmp16_stitchs = pat_point - (PATTERN_DATA *)(pat_buf);
		   set_func_code_info(0XA0+flag,i,tmp16_stitchs>>8,tmp16_stitchs);
		   
	}
	if( u51 == 0)
	    FW = 0;
	
}
/*******************************************************
 * function：原地加固
 ******************************************************/
void sew_nomove(UINT8 sew_mode)
{
	if(sew_mode!=0)
	{
		special_sewing(3,sew_mode,0);
		while( motor.angle_adjusted >= 16)
		{
			rec_com(); 
		}
	}
}	
void SewingReverse(void)
{
	INT8 tmp;
	UINT32 tmp32_spd1,tmp32_spd2;
	//-----------------------------------------------------------------------------------
	//adjust speed
	//---------------------------------------------------------------------------------
	if( MotorSpeedRigister >= 2 && MotorSpeedRigister <= MAXSPEED0)
	{
		sew_speed = MotorSpeedRigister*100;
	}
	else if(MotorSpeedRigister == 0)
	{
		MotorSpeedRigister = sew_speed/100;
	}
    
	if( para.speed_limit_switch == 1)
	{
		if( para.speed_percent >100)
			para.speed_percent = 100;
		tmp32_spd1 = para.speed_percent;
		tmp32_spd2 = sew_speed;				
		tmp32_spd2 = tmp32_spd2 * tmp32_spd1 /100; //转速百分比
		tmp32_spd2 = ( tmp32_spd2 + 50 )/100*100;
		if( tmp32_spd2 < 200)
			tmp32_spd2 = 200;
		sew_speed = tmp32_spd2;
	}
	
	if( sewingcontrol_stitchs > 0 )//V 型加固方式 之前要移动指针到加固前端，反向缝到开始再开始正常缝制
	{
		if(clamp_com == 0)           					
	 		motor.spd_obj  = u10 * 100;  
	    else                         					
	 	    motor.spd_obj = u02 * 100; 
		//running...
		if( start_sewcontrol_mode != 0)		//查看是否有原地加固模式
		    sew_nomove(start_sewcontrol_mode);
		special_sewing( 1 ,sewingcontrol_stitchs,0);//反向缝制到花样开始
	}
	else if(sewingcontrol_stitchs< 0)
	{
		tmp = fabs(sewingcontrol_stitchs);
		if( clamp_com == 0)           					
	 	  	motor.spd_obj = u10 * 100;  
	    else                         					
	 	   	motor.spd_obj = u02 * 100;   
		//running...
		if( start_sewcontrol_mode != 0)
		    sew_nomove(start_sewcontrol_mode);
		
		special_sewing( 0 ,tmp,0);
		while(motor.angle_adjusted >= 16)
	    {
	    	rec_com(); 
		}
		special_sewing( 1 ,tmp,0);
		
	}
	else
	{
		if(clamp_com == 0)           					
	 	   motor.spd_obj  = u10 * 100;
	    else                         					
	 	   motor.spd_obj = u02 * 100;
	}
}

//在一针之内缩缝
void zoom_in_one_stitch(UINT8 stitchs,UINT8 cflag)
{
	INT8 tmp_x,tmp_y,remain_x,remain_y,i,tmp,flag;
	INT16 temp16;
	UINT8 action_flag0,action_flag1,action_flag2,action_flag3,action_flag4;
	INT16 inpress_up_angle,inpress_down_angle,max_angle;
	
	//1
	remain_x = 0;
	remain_y = 0;	
	flag = 0;

	calculate_inpress_angle(motor.spd_obj);
	
	for(i=0;i<stitchs;i++)
	{
		if( i== (stitchs-1))
		{
			tmp_x = xstep_cou - remain_x;//最后一针了，计算剩下的距离
			tmp_y = ystep_cou - remain_y;
		}
		else
		{
			tmp_x = xstep_cou/stitchs;//均分这一针的距离
			tmp_y = ystep_cou/stitchs;
			//if( tmp_x > 6 )//0.3mm
			//    tmp_x = 6;
			//if( tmp_y > 6 )//0.3mm
			//    tmp_y = 6;
				
			remain_x +=tmp_x;//已经走过的距离
			remain_y +=tmp_y;
		}
    #if FOLLOW_INPRESS_FUN_ENABLE
				 action_flag0 = 1;
				 action_flag1 = 1;
				 action_flag2 = 1;
				 action_flag3 = 1;
				 action_flag4 = 1;
				 
				 temp16 = motor.angle_adjusted;
				 inpress_up_angle   = angle_tab[inpress_follow_up_angle];
				 inpress_down_angle = angle_tab[inpress_follow_down_angle];
				 
				 if( inpress_down_angle > inpress_up_angle )
				    action_flag2 = 0;
				 
				 while( temp16 < 996 )
				 {
					 temp16 = motor.angle_adjusted;
					 //1
					 if( u51 == 0 )
				     {
							if( (i ==0)&&(stitch_counter==1) )
							{
								if((temp16 >= 512) &&( action_flag1 ==1) )   //180d
						        { 
						        	action_flag1 = 0;
									FW = 1;
								}								
							}
							else 
							{
								FW = 0;
							}
				     }
					 //2
					 if( (temp16 > inpress_down_angle ) &&( action_flag2 == 1) )//中压脚下降角度
					 {
						action_flag2 = 0;
					
						if( inpress_follow_high_flag == FOLLOW_INPRESS_HIGH )
						{
						   //test_flag = 1;
						   movestep_zx(-inpress_follow_range,inpress_follow_down_speed);//先升后降
						   inpress_follow_high_flag = FOLLOW_INPRESS_LOW;
						}
					 }
					 //3
					 if( (temp16 > inpress_up_angle ) &&( action_flag3 == 1) )
					 {
							action_flag3 = 0;
							if( inpress_follow_high_flag == FOLLOW_INPRESS_LOW )
						    {


								//2018-8-10
						    	//如果启动了前几针改变中压脚上升高度的功能，且当前针数属于指定的针数内，那么使用指定的随动范围
						    	//此处程序用于将中压脚随动范围恢复到正常值,最后一针的时候，需要把中压脚的高度恢复到正常高度
								if(para.start_sew_change_inpress_high_enable == 55 
									&& stitch_counter == para.start_sew_change_inpress_high_stitchs
									&& stitch_counter < 20
									/*&&para.start_sew_change_inpress_high_range<=inpress_follow_range*/ )
								{
									//计算正常的随动高度到变量inpress_follow_range中
									if( inpress_follow_range_pc == 0)//k173，中压脚随动高度，操作头下发
									{
										if( inpress_follow_mode == 5 )//模式5.随动范围是13，否则为8
										    inpress_follow_range = 13;
										else	
											inpress_follow_range = INPRESS_DELTA_RANGE;
									}
									else
										inpress_follow_range = inpress_follow_range_pc;
								}
								
								//test_flag = 21;
								movestep_zx(inpress_follow_range,inpress_follow_up_speed);
								inpress_follow_high_flag = FOLLOW_INPRESS_HIGH;
								//========================================
								stitch_counter++;
								pat_point++;
								check_data(0);//看看下针转速，但不改变实际转速
								inpress_down_angle = angle_tab[inpress_follow_down_angle];
								pat_point--;
								stitch_counter--;
								if( inpress_down_angle > inpress_up_angle)//默认情况下是下降小于起始的
								{
									action_flag2 = 1;//允许再次下降
								}
								//========================================
							}
				     }
					 //4
					if( (temp16 > movestep_angle ) &&( action_flag4 == 1) )
					{
						 action_flag4 = 0;
						 if(fabsm(tmp_y) > 0)
						{
					        movestep_y(-tmp_y); 
					        delay_us(400);
					    }
					    if(fabsm(tmp_x) > 0)
						{
						     movestep_x(-tmp_x);
						}
					}
					//5
					if( clamp_com == 1) //起缝加固的抓线处理
					{
								 if( i == 1)//第二针固定角度进行抓紧动作
								 {
							 		 if( temp16 >= 222 )//
									 { 
										 move_ct();       	                                                    
						  	  		 }
								 }
								 if( i==2)
								 {
									 tmp = stitch_counter;
									 stitch_counter = u33;
									 if( (temp16 >= movect_angle)&&(action_flag0 == 1) )
									 {
										 action_flag0 = 0;
										 move_ct();
									 }
									 stitch_counter = tmp;
								 }
					}
					rec_com();
				 }
    	#else
		
		if( u51 == 0)
	    {
				if( (i ==0)&&(stitch_counter==1) )
				{
					temp16 = motor.angle_adjusted;
			      	while(temp16 <= 512)    
			        { 
			        	rec_com();
						temp16 = motor.angle_adjusted;
					}
					FW = 1;
				}
				else
				{
					FW = 0;
				}
	    }
		
		temp16 = motor.angle_adjusted;
		while( temp16 <= movestep_angle )
		{ 
			rec_com();   
	    	temp16 = motor.angle_adjusted;        	                                                    
		}
    	if(fabsm(tmp_y) > 0)
		{
	        movestep_y(-tmp_y); 
	        delay_us(400);
	    }
	    if(fabsm(tmp_x) > 0)
		{
		     movestep_x(-tmp_x);
		}
		    
		if( clamp_com == 1) //起缝加固的抓线处理
		{
					 if( i == 1)//第二针固定角度进行抓紧动作
					 {
						 temp16 = motor.angle_adjusted;
				 		 while( temp16 <= 222 )//
						 { 
							   if(sys.status == POWEROFF)   
							      return;
							   temp16 = motor.angle_adjusted;        	                                                    
			  	  		  }
					 }
					 if( i==2)
					 {
						 tmp = stitch_counter;
						 stitch_counter = u33;
					 }
					 move_ct();
					 if( i==2)
					 {
						 stitch_counter = tmp;
					 }
		}
	#endif
		allx_step = allx_step + tmp_x;                        
  		ally_step = ally_step + tmp_y;	

		if( i< (stitchs-1) )
		{
			 while(motor.angle_adjusted >= 16)
		     {
		    	rec_com(); 
		     }  	
		}
	}
		
	if( u51 == 0)
	    FW = 0;
	process_bottom_thread();
}

void do_pat_point_add_one(void)
{
	pat_point++;
	pat_buff_total_counter ++;
	if(super_pattern_flag == 1)
	{
		if( pat_point >= (PATTERN_DATA *)(pat_buf)+TOTAL_STITCH_COUNTER )
		{
			    pat_point = (PATTERN_DATA *)(pat_buf);
				over_counter++;
				monitor_refresh_flag = 0;
		}
	}
}
void do_pat_point_sub_one(void)
{
	pat_point--;
	if(pat_buff_total_counter >0)
	   pat_buff_total_counter --;
	if(super_pattern_flag == 1)
	{
		if( pat_point < (PATTERN_DATA *)(pat_buf) ) 
		{
		    if( pat_buff_total_counter >0) 
			    pat_point = (PATTERN_DATA *)(pat_buf)+TOTAL_STITCH_COUNTER - 1;
			else
			{
			    pat_point = (PATTERN_DATA *)(pat_buf);
			    start_flag = 1;
			}
		}
	}
}

void find_start_point1(void)
{
	INT32 run_counter,range,i;
	UINT32 quick_time;
	UINT8 speed_tmp,flag,origin_mode;
	UINT16 tmpx,temp16_max,j;
	range =23000; //1000mm*20=20000
	
	timer_x = 1;
	flag = 0;
	origin_mode = 0;
	
#if (COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER38)||(COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER35 )||(COMPILE_MACHINE_TYPE == MACHINE_CONFIG_NUMBER18 )|| (COMPARE_NOPMOVE_SPEED	==1)
	origin_mode = 1;
#elif ENABLE_CONFIG_PARA ==1
	if( para.x_origin_mode == 1)
		origin_mode = 1;
#else
	origin_mode = 0;	
#endif
	
	if( origin_mode ==1)
	{
		go_origin_x1();
		delay_ms(100);
	}
	else
	{
	
#if CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037

	range = 10000;
	quick_time = 1500 + (UINT32)go_setout_speed * 133;
	
#elif SUPPORT_UNIFY_DRIVER
		quick_time = 1550 + (UINT32)go_setout_speed * 133;//快走协议走
#else
		quick_time = 2500 + (UINT32)go_setout_speed * 133;//快走协议走
#endif


		if(XORG == 1)	//如果已经挡上											
		{
			quickmove_x_process(quick_time,range);	

			for( i=0;i< quick_time+30; i++)
			{
				delay_ms(1);
				if( XORG == 0)
				{
					#if CURRENT_STEPPER_CONFIG_TYPE == CONFIG_MACHINE_TYPE_6037
					delay_ms(2);
					#else
					delay_ms(20);
					#endif
					if( XORG ==0)
					{
						nop_move_emergency(500,0);		
						for(j=0;j<2000;j++)
						{
							delay_ms(1);
							if( check_motion_done() )
							   break;
					  	}
					    
					    flag = 1;
					    delay_ms(10);
						tmpx = get_x_distance();					 
						break;
					}
				}
			}
			if( flag == 0)//超时等动作完成
			{
				for(j=0;j<2000;j++)
				{
					delay_ms(1);
					if( check_motion_done() )
					   break;
				}
				if (XORG == 1)
				{
					sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if( sys.error == 0)
		      			sys.error = ERROR_25;
		      		return;
				}
			}
		    if( XORG == 0)//如果已经冲出传感器了,再次高速退回来
			{
			   run_counter = 0;
				while(XORG ==0)						
				{
					#if SUPPORT_UNIFY_DRIVER
					timer_x = 0;
					#else
					timer_x = 0;
					#endif
			    	movestep_x(-1); //向左
					run_counter++;
					if(run_counter > range)
					{
						sys.status = ERROR;
						StatusChangeLatch = ERROR;
						if( sys.error == 0)
		      			    sys.error = ERROR_25;
		      			return;
					}
					#if SUPPORT_UNIFY_DRIVER
					delay_ms(1);
					#else
					delay_ms(1);
					#endif	
				}
			
				for(i=0;i<4;i++)//多走几步	
				{
					#if SUPPORT_UNIFY_DRIVER
					timer_x = 0;
					#else
					timer_x = 0;
					#endif
					movestep_x(-1); 
					#if SUPPORT_UNIFY_DRIVER
					delay_ms(1);
					#else
					delay_ms(1);
					#endif	
				}
			}
		
		}
		else //如果没在光耦里
		{
			quickmove_x_process(quick_time,-range);	

			for( i=0;i< quick_time+30; i++)
			{
				delay_ms(1);
				if( XORG == 1)
				{
					delay_ms(20);
					if( XORG ==1)
					{
						nop_move_emergency(500,0);
						for(j=0;j<2000;j++)
						 {
							delay_ms(1);
							if( check_motion_done() )
							   break;
					  	 }
					  flag = 1;
					    delay_ms(10);
						tmpx = get_x_distance();
						break;
					}
				}
			}
			if( flag == 0)//超时等动作完成
			{
				for(j=0;j<2000;j++)
				{
					delay_ms(1);
					if( check_motion_done() )
					   break;
				}
				if (XORG == 0)
				{
					sys.status = ERROR;
					StatusChangeLatch = ERROR;
					if( sys.error == 0)
		      			sys.error = ERROR_25;
		      		return;
				}
			}	
		    if( XORG == 1)//光耦已经挡上了
			{
			     for(i=0;i<4;i++)//多走几步	
				{
					#if SUPPORT_UNIFY_DRIVER
					timer_x = 0;
					#else
					timer_x = 0;
					#endif
					movestep_x(-1); 
					#if SUPPORT_UNIFY_DRIVER
					delay_ms(1);
					#else
					delay_ms(1);
					#endif	
				}
			}
		
		}
		//
	  run_counter = 0;
	  #if SUPPORT_UNIFY_DRIVER
	  delay_ms(1);
	  #else
	  delay_ms(200);
	  #endif
	  for(i=0;i<3;i++)
	  {
		while(XORG == 1)	//都是从传感器挡上退到不挡状态										
		{
			#if SUPPORT_UNIFY_DRIVER
			timer_x = 0;
			#else
			timer_x = 0;
			#endif
			movestep_x(1);//向右移一步
			run_counter++;
			if(run_counter > range)
			{
				sys.status = ERROR;
				StatusChangeLatch = ERROR;
				if( sys.error == 0)
	      			sys.error = ERROR_25;     		
	      		return;
			}
			#if SUPPORT_UNIFY_DRIVER
			delay_ms(1);
			#else
			delay_ms(3);
			#endif		
		}
		#if SUPPORT_UNIFY_DRIVER
		if(XORG == 0)
		  delay_ms(20);
		#else
		delay_ms(50);
		#endif
	  }
	   #if SUPPORT_UNIFY_DRIVER

	   #else
		delay_ms(100);
	   #endif
	}

	if( x_origin_offset !=0 )
	{
		temp16_max = fabsm( x_origin_offset );
		if(temp16_max > 255)
		{
			//quick_time = Calculate_QuickMove_Time(temp16_max)+ 200;
			quick_time = Calculate_QuickMove_Time(temp16_max,0) + 200;
		}
		else
		{
			quick_time = 62;
		}
        if( (temp16_max <=255)&&(temp16_max >0) )
		{ 
		  	timer_x = 62;
			movestep_x(-x_origin_offset);
		}
		else if( temp16_max >255)
		{
			quickmove_x_process(quick_time,-x_origin_offset);	
		}
  		delay_ms(quick_time);
		for(i=0;i<quick_time;i++)
		{
			delay_ms(1);
			if( check_motion_done() )
			{
			   delay_ms(50);
			   break;
			}
		}
		delay_ms(20);
	}
}

void find_start_point(void)
{
	if( (aging_com == 0) &&(sys.error == 0) )
	{
		find_start_point1();
	}
}


/*
8060:  X[0,800]  Y[-600,0]
K56   +X
K57   -X
K58   +Y
K59   -Y
*/
UINT8 check_sewing_range(void)
{
	if((k01 == 0)&&(allx_step > RESOLUTION*k56 || allx_step < -RESOLUTION*k57 || ally_step < -RESOLUTION*k59 || ally_step > RESOLUTION*k58))
	    return 1;
	else
	    return 0;
}


#if INSERPOINT_ENABLE || SUPPORT_SEWING_MARKING_PEN
/********************************************************************/ 
/* 函数名: Judge_Quadrant */ 
/* 功能：判断参数坐标的所在象限并返回相应象限值*/ 

/********************************************************************/ 
UINT8 Judge_Quadrant(INT32 x, INT32 y) 
{ 
	if (x>=0) 
	{ //象限判断
		if (y>=0)  
		{ 
			return 1; 
		} 
		else 
		{ 
			return 4; 
		}  
	} 
	else  
	{ 
		if (y>=0) 
		{  
			return 2;   
		}   
		else    
		{    
			return 3;   
		}  
	}  
} 

/******************************************************************** 
功能：逐点比较法直线插补
思路：直接用当前的相对坐标做插补处理，步长是1步
      1、确认终点所在的象限
	  2、根据所在象限做相应的处理
	  
	  偏差    1象限  2象限  3象限  4象限  偏差公式
	  Fm>=0   +x     -x     -x     +x     Fm'=Fm-Ye 
	  Fm <0   +y     +y     -y     -y     Fm'=Fm+Xe
	  
	  注意：默认是从（0,0）到目标位置的插补处理，实际进行坐标变换，正好跟花样数据中的相对值对应上了
	  直接用花样坐标的相对值做目标位置，进行相对位置的插补操作
	  
********************************************************************/ 

/*
 用一个缓冲区作为分解后的指令缓冲区，然后后台一直往里输入指令，前台中断从缓冲区拿出指令进行执行。
 转速的规划放到定时里去做了
 
*/
void add_one_action( UINT8 coder)
{
	while( (tra1_ind_w == tra1_ind_r) && (rec1_total_counter>=250) )//缓冲区满了
		rec_com();
	tra1_buf[tra1_ind_w] = coder;
	tra1_ind_w = (tra1_ind_w + 1) % 250;
	rec1_total_counter++;
	
}
/*
void PBP_Line (UINT8 stitch_cnt) 
{   
	INT32  lDevVal;              	//偏差值  	
	INT32  XEnd,YEnd; 			 	//目标位置、当前位置
	UINT16 StepCount,StepMount;	 	//插补次数计数器  
	UINT8  x_count,y_count;
	UINT8  nDir;			     	//当前点所在象限     
	INT32  step;
	
    step = INSERPOINT_SCALE;  //步长
	StepCount = 0;
	XEnd    = xstep_cou;
	YEnd    = ystep_cou;			//目标位置	
	nDir=Judge_Quadrant(XEnd,YEnd); //象限判断 	
	lDevVal = 0;
	XEnd = fabs(XEnd);  
	YEnd = fabs(YEnd);     
	x_count = XEnd;
	y_count = YEnd;
	StepMount = (UINT16) (XEnd+YEnd);    

	while ((x_count>0)||(y_count>0)) //(StepCount < StepMount) //终点判别  
	{
		if (lDevVal>=0)  //偏差〉=0       
		{ 
			switch(nDir) 
			{    
				case 1:   
				case 4: 
						if( x_count > 0)
						{
							add_one_action(1);//x-1
							x_count--;
						}
					break;    
				case 2: 
				case 3:   
					    if( x_count > 0)
						{
							add_one_action(2);//x+1
							x_count++;
						}
					break;    
			}  
			lDevVal-=YEnd; 
		} 
		else
		{ //偏差<0 
 
			switch(nDir) 
			{ 
				case 1:  	
				case 2:
						if( y_count > 0)
						{
							add_one_action(3);//y-1
							y_count --;
						}
				break;  
				case 3:  	
				case 4: 
						if( y_count > 0)
						{
							add_one_action(4);//y+1
							y_count --;
						}
				break; 
			}  
			lDevVal+=XEnd; 
		} 
		StepCount++; 
	} 
} 

*/

void PBP_Line (UINT8 stitch_cnt) 
{   
	INT32  lDevVal;              	//偏差值  	
	INT32  XEnd,YEnd; 			 	//目标位置、当前位置
	UINT16 StepCount,StepMount;	 	//插补次数计数器  
	UINT8  x_count,y_count;
	UINT8  nDir;			     	//当前点所在象限     

	StepCount = 0;
	XEnd    = xstep_cou;
	YEnd    = ystep_cou;			//目标位置	
	nDir=Judge_Quadrant(XEnd,YEnd); //象限判断 	
	lDevVal = 0;
	XEnd = fabs(XEnd);  
	YEnd = fabs(YEnd);     
	x_count = XEnd;
	y_count = YEnd;
	StepMount = (UINT16) (XEnd+YEnd);    

	while ((x_count>0)||(y_count>0)) //(StepCount < StepMount) //终点判别  
	{
		#if LASER_DEBUG_MODE
		com_refresh_flag = 0;
		x_monitor_steps = x_count;
		y_monitor_steps = y_count;
		#endif
		rec_com();
		if (lDevVal>=0)  //偏差〉=0       
		{ 
			switch(nDir) 
			{    
				case 1:   
				case 4: 
						if( x_count > 0)
						{
							#if LASER_DEBUG_MODE
							timer_x = 1;
					  		movestep_x(-1);
							x_count--;
							com_monitor_coder = 1;
							#else
							add_one_action(1);//x-1
							x_count--;
							#endif
						}
					break;    
				case 2: 
				case 3:   
					    if( x_count > 0)
						{
							#if LASER_DEBUG_MODE
							timer_x = 1;
					  		movestep_x(1);
							x_count--;
							com_monitor_coder = 2;
							#else
							add_one_action(2);//x+1
							x_count--;
							#endif
							
						}
					break;    
			}  
			lDevVal -= YEnd; 
		} 
		else
		{ //偏差<0 
 
			switch(nDir) 
			{ 
				case 1:  	
				case 2:
						if( y_count > 0)
						{
							#if LASER_DEBUG_MODE
							timer_y = 1;
					  		movestep_y(-1);
							y_count --;
							com_monitor_coder = 3;
							#else
							add_one_action(3);//y-1
							y_count --;
							#endif
						}
				break;  
				case 3:  	
				case 4: 
						if( y_count > 0)
						{
							#if LASER_DEBUG_MODE
							timer_y = 1;
					  		movestep_y(1);
							y_count --;
							com_monitor_coder = 4;
							#else
							add_one_action(4);//y+1
							y_count --;
							#endif
						}
				break; 
			}  
			lDevVal += XEnd; 
		} 
		StepCount++; 
		#if LASER_DEBUG_MODE
		delay_ms(1);
		//while( com_refresh_flag == 0)
		//rec_com();
		#endif
	} 
} 
#endif



#if CHANGE_DOUBLE_FRAMEWORK

void take_frame_from_one_side(UINT8 side)
{
	INT16 temp16x, temp16y;
	INT16 backup_x,backup_y;
	
	//压框夹扣先打开
	foot_up();	
	temp16y = para_y_backward_dis + 200 ;
	//Y先后退一段距离
	go_commandpoint(allx_step,-500);	
	//X轴到达指定位置
	if( side == 1)
	{
		temp16x = para_x_take_offset_left;
	}
	else
	{
		temp16x = para_x_take_offset_right;
		temp16x = -temp16x;	
	}
	go_commandpoint(temp16x,ally_step);	
    //Y轴向前动作
	delay_ms(50);
	temp16y = para_y_backward_dis ;
	go_commandpoint(allx_step,temp16y);
	
	//压框夹扣锁紧
	delay_ms(50);
	foot_down();
	delay_ms(200);	
	//5 落下对应的定位销
	if( side == 1)
		AUTO_LEFT_FRAME_STANDBY = 1;
	else
		AUTO_RIGHT_FRAME_STANDBY = 1;
	delay_ms(para_catch_delay_time);

	//6 接受条码信息
	if( side == 1)
	{
		temp16x = para_left_barcode_position;
		temp16x = -temp16x;
	}
	else
	{
		temp16x = para_right_barcode_position;		
	}
	go_commandpoint(temp16x,-500);	

}

void return_frame_back(UINT8 side)
{
	INT16 temp16x,temp16y;

  	temp16y = para_y_backward_dis;
	//确保收料侧定位柱已经下去了
	if( side == 1)
		AUTO_LEFT_FRAME_STANDBY = 1;
	else
		AUTO_RIGHT_FRAME_STANDBY = 1;
		
	//直接送到待抓取位置
	if( side == 1)
	{
		temp16x = para_x_take_offset_left;
	}
	else
	{
		temp16x = para_x_take_offset_right;
		temp16x = -temp16x;
	}
	go_commandpoint(temp16x,temp16y);
	//升起顶柱
	if( side == 1)
		AUTO_LEFT_FRAME_STANDBY = 0;
	else
		AUTO_RIGHT_FRAME_STANDBY = 0;
	//松开夹扣
	delay_ms(250);
	foot_up();
	delay_ms(para_catch_delay_time);
	//Y轴后退指定距离
	go_commandpoint(allx_step,-500);


}
#endif

void rotated_cutter_down_positon(void)
{
	DRILL_MOTOR_UPDOWN = 0;//铣刀先降下去
	#if ENABLE_CONFIG_PARA
	if( para.rotate_cutter_detect_valve_down == 1)//使用传感器检测位置
	{
		counter_1ms = 0;
		while( CUTTER_DOWN_POSITON == 0 )
		{
			rec_com();
			if( counter_1ms > 5000)
			{
				sys.error = ERROR_99;
				sys.status = ERROR;				
				//break;
			}
		}
	}
	#endif
}

void check_output_pattern_done(void)
{
	//花样识别借用的输出协议，用于通知主控可以识读新花样
	switch(output_com)
	{	
    	case 6:
		       #if DEBUG_RFID_DA1_FUN	
					da1 = 125;
					rfid_debug_flag = 0;
				#endif
			   /*
			    如果面板回发的模板号与当前记录的模板号一样，表示请求的花样面板接收到了。
				如果所发的花样跟面板当前花样一致，就回发个0通知主控此次识读完成。
			   */
			   if( (confirm_barcode == pattern_number)||(confirm_barcode == 0) )
			   {
			   	    pattern_change_flag = 0;
					ms_scan_counter = 0;//RFID识读重新计数
					#if DEBUG_RFID_DA1_FUN	
					da1 = 150;
					rfid_debug_flag = 0;
					#endif
			   }
				/*
				如果在条码识读到花样下发完成之前，再次进行了条码扫描，这时候已经有新号码在缓冲区了
				这种情况再次启动条码识读请求
				*/
			   if( (confirm_barcode != serail_number)&&(serail_number != 0) )
			   {
				   pattern_number = serail_number;
				   serail_number = 0;
				   pattern_change_flag = 1;
				   #if DEBUG_RFID_DA1_FUN	
				   da1 = 175;
				   rfid_debug_flag = 0;
				   #endif
			   }
			   output_com = 0;
			   waitting_for_pattern_done = 1;
			   set_func_code_info(READY,1,0,0);
			   
			   #if CHANGE_DOUBLE_FRAMEWORK
			   if( (confirm_barcode == pattern_number)&&(confirm_barcode != 0) )
			   {
				   bar_coder_refresh_flag = 1;
				   if( autosewing_allset_flag == 1)
					   autosewing_allow_working = 1;
			   }
			   #else		   
			   if( confirm_barcode != 0)
			   {
				   //SUM = 1;
				   bar_coder_refresh_flag = 1;
				   #if AUTO_CHANGE_PATTERN_FUNCTION || CHANGE_DOUBLE_FRAMEWORK
				   	  if( autosewing_allset_flag == 1)
					  	  autosewing_allow_working = 1;
				   #else
					   #if FUNCTION_AUTOSEWING
					   if( confirm_barcode == pattern_number)
					   	   autosewing_allow_working = 1;
					   #endif
				   #endif
			   }
			  #endif
	        break;
		default:
		output_com = 0;
		break;
	}
}
extern const INT16 atan_tab[];
UINT16 calculae_arctan_angle(void)
{
	#if 0
	float angle;
	float xtmp,ytmp;
	int ang;
	xtmp = xstep_cou;
	ytmp = ystep_cou;
	angle = atan2f(ytmp,xtmp);
	ang = (int)(angle *180 /_PI);
	ang += 360;
	ang %= 360;
	return ang;
	#endif
	/*
	
	
	*/
	INT16 h_yabs,h_xabs;
	INT16 alpha_out;
	INT8  U_sign;
	INT16 temp16;

	U_sign = 0;
	if(ystep_cou >= 0)
	{
		h_yabs = ystep_cou;			   
	}
	else
	{
		h_yabs = -ystep_cou;
		U_sign |= 0x04;			   
	}
	
	if( xstep_cou >= 0)
	{
		h_xabs = xstep_cou;			   
	}
	else
	{
		h_xabs = -xstep_cou;
		U_sign |= 0x02;			   
	}
				 
	if( ystep_cou == 0)
	{
		alpha_out = 0;
		temp16 = fabs(xstep_cou);
	}
	else
	{

		if(h_yabs <= h_xabs)
		{
			temp16 = ((INT32)h_yabs<<7)/h_xabs;	  //计算正切值
			alpha_out = atan_tab[temp16];         //计算反正切值
		}
		else
		{
			temp16 = ((INT32)h_xabs<<7)/h_yabs;
			alpha_out = atan_tab[temp16];
			U_sign |= 0x01;
		}	
		
	}
	switch(U_sign)
	{ 
		case 1: alpha_out =  90 - alpha_out;break;   //x>0 ,y>0  ystep > xstep
		case 2: alpha_out =  180 - alpha_out;break;  //x<0,y>=0  ystep > xstep
		case 3: alpha_out =  90 + alpha_out;break;
		case 4: alpha_out = 360 - alpha_out;break;   //x>=0,y<0
		case 5: alpha_out = 270 + alpha_out;break;
		case 6: alpha_out = 180 + alpha_out;break;   //x<0,y<0
		case 7: alpha_out = 270 - alpha_out;break;		
	}
	return alpha_out;
}
//--------------------------------------------------------------------------------------
//         COPYRIGHT(C) 2006 Beijing xindahao technology Co., Ltd.
//                     ALL RIGHTS RESERVED 
//--------------------------------------------------------------------------------------